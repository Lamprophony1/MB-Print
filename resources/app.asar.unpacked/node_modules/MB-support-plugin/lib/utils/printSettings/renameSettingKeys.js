"use strict";

const renamedSettingKeys = {
  'attached_extruder0': 'extruders',
  'bridgeMaximumLength': null,
  'doBrims': 'baseLayer',
  'doPaddedBase': 'baseLayer',
  'doRaft': 'baseLayer',
  'extruderTemp0': 'extruderProfiles>0>defaultTemperature',
  'extruderProfiles>0>extrusionProfiles>infill>feedrate': 'extruderProfiles>0>extrusionProfiles>sparse>feedrate',
  'extruderProfiles>1>extrusionProfiles>infill>feedrate': 'extruderProfiles>1>extrusionProfiles>sparse>feedrate',
  'extruderProfiles>0>extrusionProfiles>firstModelLayer>fanSpeed': 'extruderProfiles>0>extrusionProfiles>base_layer_surface>fanSpeed',
  'extruderProfiles>1>extrusionProfiles>firstModelLayer>fanSpeed': 'extruderProfiles>1>extrusionProfiles>base_layer_surface>fanSpeed',
  'extruderProfiles>0>extrusionProfiles>firstModelLayer>feedrate': 'extruderProfiles>0>extrusionProfiles>base_layer_surface>feedrate',
  'extruderProfiles>1>extrusionProfiles>firstModelLayer>feedrate': 'extruderProfiles>1>extrusionProfiles>base_layer_surface>feedrate',
  'extruderProfiles>0>extrusionProfiles>raftBase>fanSpeed': 'extruderProfiles>0>extrusionProfiles>raft_base>fanSpeed',
  'extruderProfiles>1>extrusionProfiles>raftBase>fanSpeed': 'extruderProfiles>1>extrusionProfiles>raft_base>fanSpeed',
  'extruderProfiles>0>extrusionProfiles>raftBase>feedrate': 'extruderProfiles>0>extrusionProfiles>raft_base>feedrate',
  'extruderProfiles>1>extrusionProfiles>raftBase>feedrate': 'extruderProfiles>1>extrusionProfiles>raft_base>feedrate',
  'extruderProfiles>0>maxSparseFillThickness': 'maxSparseFillThickness',
  'extrusionProfiles>infill>feedrate': 'extruderProfiles>0>extrusionProfiles>sparse>feedrate',
  'extrusionProfiles>outlines>feedrate': 'extruderProfiles>0>extrusionProfiles>outlines>feedrate',
  'extrusionProfiles>raftBase>feedrate': 'extruderProfiles>0>extrusionProfiles>raft_base>feedrate',
  'extrusionProfiles>raftBase>fanSpeed': 'extruderProfiles>0>extrusionProfiles>raft_base>fanSpeed',
  'extrusionProfiles>firstModelLayer>feedrate': 'extruderProfiles>0>extrusionProfiles>base_layer_surface>feedrate',
  'extrusionProfiles>firstModelLayer>fanSpeed': 'extruderProfiles>0>extrusionProfiles>base_layer_surface>fanSpeed',
  'filament_diameter': 'extruderProfiles>0>feedDiameter',
  'first_model_layer_cooling_fan_speed': 'extruderProfiles>0>extrusionProfiles>base_layer_surface>fanSpeed',
  'first_model_layer_speed': 'extruderProfiles>0>extrusionProfiles>base_layer_surface>feedrate',
  'first_raft_layer_cooling_fan_speed': 'extruderProfiles>0>extrusionProfiles>raft_base>fanSpeed',
  'first_raft_layer_speed': 'extruderProfiles>0>extrusionProfiles>raft_base>feedrate',
  'fixed_shell_start': 'doFixedShellStart',
  'floor_thickness': 'floorThickness',
  'infillDensity': 'modelFillProfiles>sparse>density',
  'infill_layer_height': 'maxSparseFillThickness',
  'infill_print_speed': 'extruderProfiles>0>extrusionProfiles>sparse>feedrate',
  'maximum_bridge_length': null,
  'minimum_layer_duration': null,
  'minLayerDuration': null,
  'numberOfShells': 'modelShellProfiles>extent>numberOfShells',
  'print_speed': 'extruderProfiles>0>extrusionProfiles>outlines>feedrate',
  'raft_margin_offset': 'raftProfiles>base>outsetFromModelEdge',
  'raft_to_model_offset': 'raftModelSpacing',
  'raftBaseOutset': 'raftProfiles>base>outsetFromModelEdge',
  'raftBrimsSpacing': null,
  'raftOutset': 'raftProfiles>base>outsetFromModelEdge',
  'retraction_distance': 'extruderProfiles>0>retractDistance',
  'shell_start_location': 'fixedShellStartDirection',
  'sparseInfillPattern': 'modelFillProfiles>sparse>pattern',
  'support_density': 'supportFillProfiles>sparse>density',
  'support_to_model_margin': 'supportModelSpacing',
  'supported_angles': 'supportAngle'
};
const deletedKeys = ['bridgeMaximumLength', 'maximum_bridge_length', 'minimum_layer_duration', 'minLayerDuration', 'raftBrimsSpacing', 'doSupport']; // Some values can be mapped directly onto the new key.
// These are the ones that need conversion before that can happen.
// The nature of the conversion is noted next to the key

const valueConversionKeys = ['attached_extruder0', // put in array
'doBrims', // set baseLayer to 'brims' or 'paddedBaseBrims'
'doPaddedBase', // set baseLayer to 'paddedBase' or 'paddedBaseBrims'
'doRaft' // set baseLayer to 'raft'
];

const doValueConversion = (key, settings) => {
  const value = settings[key];

  if (key === 'attached_extruder0') {
    return [value];
  } else if (key === 'doRaft') {
    return 'raft';
  } else if (key === 'doPaddedBase') {
    if (Object.keys(settings).includes('doBrims')) {
      return 'paddedBaseBrims';
    } else {
      return 'paddedBase';
    }
  } else if (key === 'doBrims') {
    if (Object.keys(settings).includes('doPaddedBase')) {
      // If the settings contain both doBrims and doPaddedBase, the conversion should have already
      // been handled in the previous 'else if', so just return null
      return null;
    } else {
      return 'brims';
    }
  }
};
/*
 * This function takes in an existing userconfig and goes through each key of its print settings.
 * 1) If the key no longer exists, we skip it, and it does not get added to the new config.
 * 2) If the value of the key is now formatted differently, we reformat it in doValueConversion().
 * 3) If the key now has a different name, look it up in the renamedSettingKeys object,
 * and put the new version into the new config.
 * 4) Otherwise, put the setting into the new config as-is.
 * 5) Replace the config's printSettings with the updated version, and return the whole config.
 */


const updateConfig = config => {
  const oldKeys = Object.keys(renamedSettingKeys);
  const settings = config.printSettings;

  if (settings) {
    const newSettings = Object.keys(settings).reduce((newSettingsObject, key) => {
      if (!deletedKeys.includes(key)) {
        if (valueConversionKeys.includes(key)) {
          const newValue = doValueConversion(key, settings);

          if (newValue) {
            newSettingsObject[renamedSettingKeys[key]] = newValue;
          }
        } else if (oldKeys.includes(key)) {
          newSettingsObject[renamedSettingKeys[key]] = settings[key];
        } else {
          newSettingsObject[key] = settings[key];
        }
      }

      return newSettingsObject;
    }, {});
    config.printSettings = newSettings;
  }

  return config;
};

module.exports = {
  updateConfig
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJlbmFtZVNldHRpbmdLZXlzLmpzIl0sIm5hbWVzIjpbInJlbmFtZWRTZXR0aW5nS2V5cyIsImRlbGV0ZWRLZXlzIiwidmFsdWVDb252ZXJzaW9uS2V5cyIsImRvVmFsdWVDb252ZXJzaW9uIiwia2V5Iiwic2V0dGluZ3MiLCJ2YWx1ZSIsIk9iamVjdCIsImtleXMiLCJpbmNsdWRlcyIsInVwZGF0ZUNvbmZpZyIsImNvbmZpZyIsIm9sZEtleXMiLCJwcmludFNldHRpbmdzIiwibmV3U2V0dGluZ3MiLCJyZWR1Y2UiLCJuZXdTZXR0aW5nc09iamVjdCIsIm5ld1ZhbHVlIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6Ijs7QUFBQSxNQUFNQSxrQkFBa0IsR0FBRztBQUN2Qix3QkFBc0IsV0FEQztBQUV2Qix5QkFBdUIsSUFGQTtBQUd2QixhQUFXLFdBSFk7QUFJdkIsa0JBQWdCLFdBSk87QUFLdkIsWUFBVSxXQUxhO0FBTXZCLG1CQUFpQix1Q0FOTTtBQU92QiwwREFBd0Qsc0RBUGpDO0FBUXZCLDBEQUF3RCxzREFSakM7QUFTdkIsbUVBQ0ksa0VBVm1CO0FBV3ZCLG1FQUNJLGtFQVptQjtBQWF2QixtRUFDSSxrRUFkbUI7QUFldkIsbUVBQ0ksa0VBaEJtQjtBQWlCdkIsNERBQTBELHlEQWpCbkM7QUFrQnZCLDREQUEwRCx5REFsQm5DO0FBbUJ2Qiw0REFBMEQseURBbkJuQztBQW9CdkIsNERBQTBELHlEQXBCbkM7QUFxQnZCLCtDQUE2Qyx3QkFyQnRCO0FBc0J2Qix1Q0FBcUMsc0RBdEJkO0FBdUJ2Qix5Q0FBdUMsd0RBdkJoQjtBQXdCdkIseUNBQXVDLHlEQXhCaEI7QUF5QnZCLHlDQUF1Qyx5REF6QmhCO0FBMEJ2QixnREFBOEMsa0VBMUJ2QjtBQTJCdkIsZ0RBQThDLGtFQTNCdkI7QUE0QnZCLHVCQUFxQixpQ0E1QkU7QUE2QnZCLHlDQUF1QyxrRUE3QmhCO0FBOEJ2Qiw2QkFBMkIsa0VBOUJKO0FBK0J2Qix3Q0FBc0MseURBL0JmO0FBZ0N2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Q0FBakIsR0FBNkNhLFFBQTdDO0FBQ0g7QUFDSixTQUxELE1BS08sSUFBSUwsT0FBTyxDQUFDSCxRQUFSLENBQWlCTCxHQUFqQixDQUFKLEVBQTJCO0FBQzlCWSxVQUFBQSxpQkFBaUIsQ0FBQ2hCLGtCQUFrQixDQUFDSSxHQUFELENBQW5CLENBQWpCLEdBQTZDQyxRQUFRLENBQUNELEdBQUQsQ0FBckQ7QUFDSCxTQUZNLE1BRUE7QUFDSFksVUFBQUEsaUJBQWlCLENBQUNaLEdBQUQsQ0FBakIsR0FBeUJDLFFBQVEsQ0FBQ0QsR0FBRCxDQUFqQztBQUNIO0FBQ0o7O0FBQ0QsYUFBT1ksaUJBQVA7QUFDSCxLQWRtQixFQWNqQixFQWRpQixDQUFwQjtBQWVBTCxJQUFBQSxNQUFNLENBQUNFLGFBQVAsR0FBdUJDLFdBQXZCO0FBQ0g7O0FBQ0QsU0FBT0gsTUFBUDtBQUNILENBdEJEOztBQXdCQU8sTUFBTSxDQUFDQyxPQUFQLEdBQWlCO0FBQ2JULEVBQUFBO0FBRGEsQ0FBakIiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCByZW5hbWVkU2V0dGluZ0tleXMgPSB7XHJcbiAgICAnYXR0YWNoZWRfZXh0cnVkZXIwJzogJ2V4dHJ1ZGVycycsXHJcbiAgICAnYnJpZGdlTWF4aW11bUxlbmd0aCc6IG51bGwsXHJcbiAgICAnZG9Ccmltcyc6ICdiYXNlTGF5ZXInLFxyXG4gICAgJ2RvUGFkZGVkQmFzZSc6ICdiYXNlTGF5ZXInLFxyXG4gICAgJ2RvUmFmdCc6ICdiYXNlTGF5ZXInLFxyXG4gICAgJ2V4dHJ1ZGVyVGVtcDAnOiAnZXh0cnVkZXJQcm9maWxlcz4wPmRlZmF1bHRUZW1wZXJhdHVyZScsXHJcbiAgICAnZXh0cnVkZXJQcm9maWxlcz4wPmV4dHJ1c2lvblByb2ZpbGVzPmluZmlsbD5mZWVkcmF0ZSc6ICdleHRydWRlclByb2ZpbGVzPjA+ZXh0cnVzaW9uUHJvZmlsZXM+c3BhcnNlPmZlZWRyYXRlJyxcclxuICAgICdleHRydWRlclByb2ZpbGVzPjE+ZXh0cnVzaW9uUHJvZmlsZXM+aW5maWxsPmZlZWRyYXRlJzogJ2V4dHJ1ZGVyUHJvZmlsZXM+MT5leHRydXNpb25Qcm9maWxlcz5zcGFyc2U+ZmVlZHJhdGUnLFxyXG4gICAgJ2V4dHJ1ZGVyUHJvZmlsZXM+MD5leHRydXNpb25Qcm9maWxlcz5maXJzdE1vZGVsTGF5ZXI+ZmFuU3BlZWQnOlxyXG4gICAgICAgICdleHRydWRlclByb2ZpbGVzPjA+ZXh0cnVzaW9uUHJvZmlsZXM+YmFzZV9sYXllcl9zdXJmYWNlPmZhblNwZWVkJyxcclxuICAgICdleHRydWRlclByb2ZpbGVzPjE+ZXh0cnVzaW9uUHJvZmlsZXM+Zmlyc3RNb2RlbExheWVyPmZhblNwZWVkJzpcclxuICAgICAgICAnZXh0cnVkZXJQcm9maWxlcz4xPmV4dHJ1c2lvblByb2ZpbGVzPmJhc2VfbGF5ZXJfc3VyZmFjZT5mYW5TcGVlZCcsXHJcbiAgICAnZXh0cnVkZXJQcm9maWxlcz4wPmV4dHJ1c2lvblByb2ZpbGVzPmZpcnN0TW9kZWxMYXllcj5mZWVkcmF0ZSc6XHJcbiAgICAgICAgJ2V4dHJ1ZGVyUHJvZmlsZXM+MD5leHRydXNpb25Qcm9maWxlcz5iYXNlX2xheWVyX3N1cmZhY2U+ZmVlZHJhdGUnLFxyXG4gICAgJ2V4dHJ1ZGVyUHJvZmlsZXM+MT5leHRydXNpb25Qcm9maWxlcz5maXJzdE1vZGVsTGF5ZXI+ZmVlZHJhdGUnOlxyXG4gICAgICAgICdleHRydWRlclByb2ZpbGVzPjE+ZXh0cnVzaW9uUHJvZmlsZXM+YmFzZV9sYXllcl9zdXJmYWNlPmZlZWRyYXRlJyxcclxuICAgICdleHRydWRlclByb2ZpbGVzPjA+ZXh0cnVzaW9uUHJvZmlsZXM+cmFmdEJhc2U+ZmFuU3BlZWQnOiAnZXh0cnVkZXJQcm9maWxlcz4wPmV4dHJ1c2lvblByb2ZpbGVzPnJhZnRfYmFzZT5mYW5TcGVlZCcsXHJcbiAgICAnZXh0cnVkZXJQcm9maWxlcz4xPmV4dHJ1c2lvblByb2ZpbGVzPnJhZnRCYXNlPmZhblNwZWVkJzogJ2V4dHJ1ZGVyUHJvZmlsZXM+MT5leHRydXNpb25Qcm9maWxlcz5yYWZ0X2Jhc2U+ZmFuU3BlZWQnLFxyXG4gICAgJ2V4dHJ1ZGVyUHJvZmlsZXM+MD5leHRydXNpb25Qcm9maWxlcz5yYWZ0QmFzZT5mZWVkcmF0ZSc6ICdleHRydWRlclByb2ZpbGVzPjA+ZXh0cnVzaW9uUHJvZmlsZXM+cmFmdF9iYXNlPmZlZWRyYXRlJyxcclxuICAgICdleHRydWRlclByb2ZpbGVzPjE+ZXh0cnVzaW9uUHJvZmlsZXM+cmFmdEJhc2U+ZmVlZHJhdGUnOiAnZXh0cnVkZXJQcm9maWxlcz4xPmV4dHJ1c2lvblByb2ZpbGVzPnJhZnRfYmFzZT5mZWVkcmF0ZScsXHJcbiAgICAnZXh0cnVkZXJQcm9maWxlcz4wPm1heFNwYXJzZUZpbGxUaGlja25lc3MnOiAnbWF4U3BhcnNlRmlsbFRoaWNrbmVzcycsXHJcbiAgICAnZXh0cnVzaW9uUHJvZmlsZXM+aW5maWxsPmZlZWRyYXRlJzogJ2V4dHJ1ZGVyUHJvZmlsZXM+MD5leHRydXNpb25Qcm9maWxlcz5zcGFyc2U+ZmVlZHJhdGUnLFxyXG4gICAgJ2V4dHJ1c2lvblByb2ZpbGVzPm91dGxpbmVzPmZlZWRyYXRlJzogJ2V4dHJ1ZGVyUHJvZmlsZXM+MD5leHRydXNpb25Qcm9maWxlcz5vdXRsaW5lcz5mZWVkcmF0ZScsXHJcbiAgICAnZXh0cnVzaW9uUHJvZmlsZXM+cmFmdEJhc2U+ZmVlZHJhdGUnOiAnZXh0cnVkZXJQcm9maWxlcz4wPmV4dHJ1c2lvblByb2ZpbGVzPnJhZnRfYmFzZT5mZWVkcmF0ZScsXHJcbiAgICAnZXh0cnVzaW9uUHJvZmlsZXM+cmFmdEJhc2U+ZmFuU3BlZWQnOiAnZXh0cnVkZXJQcm9maWxlcz4wPmV4dHJ1c2lvblByb2ZpbGVzPnJhZnRfYmFzZT5mYW5TcGVlZCcsXHJcbiAgICAnZXh0cnVzaW9uUHJvZmlsZXM+Zmlyc3RNb2RlbExheWVyPmZlZWRyYXRlJzogJ2V4dHJ1ZGVyUHJvZmlsZXM+MD5leHRydXNpb25Qcm9maWxlcz5iYXNlX2xheWVyX3N1cmZhY2U+ZmVlZHJhdGUnLFxyXG4gICAgJ2V4dHJ1c2lvblByb2ZpbGVzPmZpcnN0TW9kZWxMYXllcj5mYW5TcGVlZCc6ICdleHRydWRlclByb2ZpbGVzPjA+ZXh0cnVzaW9uUHJvZmlsZXM+YmFzZV9sYXllcl9zdXJmYWNlPmZhblNwZWVkJyxcclxuICAgICdmaWxhbWVudF9kaWFtZXRlcic6ICdleHRydWRlclByb2ZpbGVzPjA+ZmVlZERpYW1ldGVyJyxcclxuICAgICdmaXJzdF9tb2RlbF9sYXllcl9jb29saW5nX2Zhbl9zcGVlZCc6ICdleHRydWRlclByb2ZpbGVzPjA+ZXh0cnVzaW9uUHJvZmlsZXM+YmFzZV9sYXllcl9zdXJmYWNlPmZhblNwZWVkJyxcclxuICAgICdmaXJzdF9tb2RlbF9sYXllcl9zcGVlZCc6ICdleHRydWRlclByb2ZpbGVzPjA+ZXh0cnVzaW9uUHJvZmlsZXM+YmFzZV9sYXllcl9zdXJmYWNlPmZlZWRyYXRlJyxcclxuICAgICdmaXJzdF9yYWZ0X2xheWVyX2Nvb2xpbmdfZmFuX3NwZWVkJzogJ2V4dHJ1ZGVyUHJvZmlsZXM+MD5leHRydXNpb25Qcm9maWxlcz5yYWZ0X2Jhc2U+ZmFuU3BlZWQnLFxyXG4gICAgJ2ZpcnN0X3JhZnRfbGF5ZXJfc3BlZWQnOiAnZXh0cnVkZXJQcm9maWxlcz4wPmV4dHJ1c2lvblByb2ZpbGVzPnJhZnRfYmFzZT5mZWVkcmF0ZScsXHJcbiAgICAnZml4ZWRfc2hlbGxfc3RhcnQnOiAnZG9GaXhlZFNoZWxsU3RhcnQnLFxyXG4gICAgJ2Zsb29yX3RoaWNrbmVzcyc6ICdmbG9vclRoaWNrbmVzcycsXHJcbiAgICAnaW5maWxsRGVuc2l0eSc6ICdtb2RlbEZpbGxQcm9maWxlcz5zcGFyc2U+ZGVuc2l0eScsXHJcbiAgICAnaW5maWxsX2xheWVyX2hlaWdodCc6ICdtYXhTcGFyc2VGaWxsVGhpY2tuZXNzJyxcclxuICAgICdpbmZpbGxfcHJpbnRfc3BlZWQnOiAnZXh0cnVkZXJQcm9maWxlcz4wPmV4dHJ1c2lvblByb2ZpbGVzPnNwYXJzZT5mZWVkcmF0ZScsXHJcbiAgICAnbWF4aW11bV9icmlkZ2VfbGVuZ3RoJzogbnVsbCxcclxuICAgICdtaW5pbXVtX2xheWVyX2R1cmF0aW9uJzogbnVsbCxcclxuICAgICdtaW5MYXllckR1cmF0aW9uJzogbnVsbCxcclxuICAgICdudW1iZXJPZlNoZWxscyc6ICdtb2RlbFNoZWxsUHJvZmlsZXM+ZXh0ZW50Pm51bWJlck9mU2hlbGxzJyxcclxuICAgICdwcmludF9zcGVlZCc6ICdleHRydWRlclByb2ZpbGVzPjA+ZXh0cnVzaW9uUHJvZmlsZXM+b3V0bGluZXM+ZmVlZHJhdGUnLFxyXG4gICAgJ3JhZnRfbWFyZ2luX29mZnNldCc6ICdyYWZ0UHJvZmlsZXM+YmFzZT5vdXRzZXRGcm9tTW9kZWxFZGdlJyxcclxuICAgICdyYWZ0X3RvX21vZGVsX29mZnNldCc6ICdyYWZ0TW9kZWxTcGFjaW5nJyxcclxuICAgICdyYWZ0QmFzZU91dHNldCc6ICdyYWZ0UHJvZmlsZXM+YmFzZT5vdXRzZXRGcm9tTW9kZWxFZGdlJyxcclxuICAgICdyYWZ0QnJpbXNTcGFjaW5nJzogbnVsbCxcclxuICAgICdyYWZ0T3V0c2V0JzogJ3JhZnRQcm9maWxlcz5iYXNlPm91dHNldEZyb21Nb2RlbEVkZ2UnLFxyXG4gICAgJ3JldHJhY3Rpb25fZGlzdGFuY2UnOiAnZXh0cnVkZXJQcm9maWxlcz4wPnJldHJhY3REaXN0YW5jZScsXHJcbiAgICAnc2hlbGxfc3RhcnRfbG9jYXRpb24nOiAnZml4ZWRTaGVsbFN0YXJ0RGlyZWN0aW9uJyxcclxuICAgICdzcGFyc2VJbmZpbGxQYXR0ZXJuJzogJ21vZGVsRmlsbFByb2ZpbGVzPnNwYXJzZT5wYXR0ZXJuJyxcclxuICAgICdzdXBwb3J0X2RlbnNpdHknOiAnc3VwcG9ydEZpbGxQcm9maWxlcz5zcGFyc2U+ZGVuc2l0eScsXHJcbiAgICAnc3VwcG9ydF90b19tb2RlbF9tYXJnaW4nOiAnc3VwcG9ydE1vZGVsU3BhY2luZycsXHJcbiAgICAnc3VwcG9ydGVkX2FuZ2xlcyc6ICdzdXBwb3J0QW5nbGUnLFxyXG59O1xyXG5cclxuY29uc3QgZGVsZXRlZEtleXMgPSBbXHJcbiAgICAnYnJpZGdlTWF4aW11bUxlbmd0aCcsXHJcbiAgICAnbWF4aW11bV9icmlkZ2VfbGVuZ3RoJyxcclxuICAgICdtaW5pbXVtX2xheWVyX2R1cmF0aW9uJyxcclxuICAgICdtaW5MYXllckR1cmF0aW9uJyxcclxuICAgICdyYWZ0QnJpbXNTcGFjaW5nJyxcclxuICAgICdkb1N1cHBvcnQnLFxyXG5dO1xyXG5cclxuLy8gU29tZSB2YWx1ZXMgY2FuIGJlIG1hcHBlZCBkaXJlY3RseSBvbnRvIHRoZSBuZXcga2V5LlxyXG4vLyBUaGVzZSBhcmUgdGhlIG9uZXMgdGhhdCBuZWVkIGNvbnZlcnNpb24gYmVmb3JlIHRoYXQgY2FuIGhhcHBlbi5cclxuLy8gVGhlIG5hdHVyZSBvZiB0aGUgY29udmVyc2lvbiBpcyBub3RlZCBuZXh0IHRvIHRoZSBrZXlcclxuY29uc3QgdmFsdWVDb252ZXJzaW9uS2V5cyA9IFtcclxuICAgICdhdHRhY2hlZF9leHRydWRlcjAnLCAvLyBwdXQgaW4gYXJyYXlcclxuICAgICdkb0JyaW1zJywgLy8gc2V0IGJhc2VMYXllciB0byAnYnJpbXMnIG9yICdwYWRkZWRCYXNlQnJpbXMnXHJcbiAgICAnZG9QYWRkZWRCYXNlJywgLy8gc2V0IGJhc2VMYXllciB0byAncGFkZGVkQmFzZScgb3IgJ3BhZGRlZEJhc2VCcmltcydcclxuICAgICdkb1JhZnQnLCAvLyBzZXQgYmFzZUxheWVyIHRvICdyYWZ0J1xyXG5dO1xyXG5cclxuY29uc3QgZG9WYWx1ZUNvbnZlcnNpb24gPSAoa2V5LCBzZXR0aW5ncykgPT4ge1xyXG4gICAgY29uc3QgdmFsdWUgPSBzZXR0aW5nc1trZXldO1xyXG4gICAgaWYgKGtleSA9PT0gJ2F0dGFjaGVkX2V4dHJ1ZGVyMCcpIHtcclxuICAgICAgICByZXR1cm4gW3ZhbHVlXTtcclxuICAgIH0gZWxzZSBpZiAoa2V5ID09PSAnZG9SYWZ0Jykge1xyXG4gICAgICAgIHJldHVybiAncmFmdCc7XHJcbiAgICB9IGVsc2UgaWYgKGtleSA9PT0gJ2RvUGFkZGVkQmFzZScpIHtcclxuICAgICAgICBpZiAoT2JqZWN0LmtleXMoc2V0dGluZ3MpLmluY2x1ZGVzKCdkb0JyaW1zJykpIHtcclxuICAgICAgICAgICAgcmV0dXJuICdwYWRkZWRCYXNlQnJpbXMnO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiAncGFkZGVkQmFzZSc7XHJcbiAgICAgICAgfVxyXG4gICAgfSBlbHNlIGlmIChrZXkgPT09ICdkb0JyaW1zJykge1xyXG4gICAgICAgIGlmIChPYmplY3Qua2V5cyhzZXR0aW5ncykuaW5jbHVkZXMoJ2RvUGFkZGVkQmFzZScpKSB7XHJcbiAgICAgICAgICAgIC8vIElmIHRoZSBzZXR0aW5ncyBjb250YWluIGJvdGggZG9CcmltcyBhbmQgZG9QYWRkZWRCYXNlLCB0aGUgY29udmVyc2lvbiBzaG91bGQgaGF2ZSBhbHJlYWR5XHJcbiAgICAgICAgICAgIC8vIGJlZW4gaGFuZGxlZCBpbiB0aGUgcHJldmlvdXMgJ2Vsc2UgaWYnLCBzbyBqdXN0IHJldHVybiBudWxsXHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiAnYnJpbXMnO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufTtcclxuXHJcbi8qXHJcbiAqIFRoaXMgZnVuY3Rpb24gdGFrZXMgaW4gYW4gZXhpc3RpbmcgdXNlcmNvbmZpZyBhbmQgZ29lcyB0aHJvdWdoIGVhY2gga2V5IG9mIGl0cyBwcmludCBzZXR0aW5ncy5cclxuICogMSkgSWYgdGhlIGtleSBubyBsb25nZXIgZXhpc3RzLCB3ZSBza2lwIGl0LCBhbmQgaXQgZG9lcyBub3QgZ2V0IGFkZGVkIHRvIHRoZSBuZXcgY29uZmlnLlxyXG4gKiAyKSBJZiB0aGUgdmFsdWUgb2YgdGhlIGtleSBpcyBub3cgZm9ybWF0dGVkIGRpZmZlcmVudGx5LCB3ZSByZWZvcm1hdCBpdCBpbiBkb1ZhbHVlQ29udmVyc2lvbigpLlxyXG4gKiAzKSBJZiB0aGUga2V5IG5vdyBoYXMgYSBkaWZmZXJlbnQgbmFtZSwgbG9vayBpdCB1cCBpbiB0aGUgcmVuYW1lZFNldHRpbmdLZXlzIG9iamVjdCxcclxuICogYW5kIHB1dCB0aGUgbmV3IHZlcnNpb24gaW50byB0aGUgbmV3IGNvbmZpZy5cclxuICogNCkgT3RoZXJ3aXNlLCBwdXQgdGhlIHNldHRpbmcgaW50byB0aGUgbmV3IGNvbmZpZyBhcy1pcy5cclxuICogNSkgUmVwbGFjZSB0aGUgY29uZmlnJ3MgcHJpbnRTZXR0aW5ncyB3aXRoIHRoZSB1cGRhdGVkIHZlcnNpb24sIGFuZCByZXR1cm4gdGhlIHdob2xlIGNvbmZpZy5cclxuICovXHJcblxyXG5jb25zdCB1cGRhdGVDb25maWcgPSBjb25maWcgPT4ge1xyXG4gICAgY29uc3Qgb2xkS2V5cyA9IE9iamVjdC5rZXlzKHJlbmFtZWRTZXR0aW5nS2V5cyk7XHJcbiAgICBjb25zdCBzZXR0aW5ncyA9IGNvbmZpZy5wcmludFNldHRpbmdzO1xyXG4gICAgaWYgKHNldHRpbmdzKSB7XHJcbiAgICAgICAgY29uc3QgbmV3U2V0dGluZ3MgPSBPYmplY3Qua2V5cyhzZXR0aW5ncykucmVkdWNlKChuZXdTZXR0aW5nc09iamVjdCwga2V5KSA9PiB7XHJcbiAgICAgICAgICAgIGlmICghZGVsZXRlZEtleXMuaW5jbHVkZXMoa2V5KSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlQ29udmVyc2lvbktleXMuaW5jbHVkZXMoa2V5KSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG5ld1ZhbHVlID0gZG9WYWx1ZUNvbnZlcnNpb24oa2V5LCBzZXR0aW5ncyk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG5ld1ZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG5ld1NldHRpbmdzT2JqZWN0W3JlbmFtZWRTZXR0aW5nS2V5c1trZXldXSA9IG5ld1ZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAob2xkS2V5cy5pbmNsdWRlcyhrZXkpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbmV3U2V0dGluZ3NPYmplY3RbcmVuYW1lZFNldHRpbmdLZXlzW2tleV1dID0gc2V0dGluZ3Nba2V5XTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbmV3U2V0dGluZ3NPYmplY3Rba2V5XSA9IHNldHRpbmdzW2tleV07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIG5ld1NldHRpbmdzT2JqZWN0O1xyXG4gICAgICAgIH0sIHt9KTtcclxuICAgICAgICBjb25maWcucHJpbnRTZXR0aW5ncyA9IG5ld1NldHRpbmdzO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGNvbmZpZztcclxufTtcclxuXHJcbm1vZHVsZS5leHBvcnRzID0ge1xyXG4gICAgdXBkYXRlQ29uZmlnLFxyXG59O1xyXG4iXX0=
