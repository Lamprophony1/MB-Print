'use strict';

const R = require('ramda');

const PrintSettingsConstants = require('../../constants/print_settings'); // sortByGroup :: [[g, [k, v]]] -> [[g, [k, v]]]


const sortByGroup = R.sort(([a], [b]) => a.localeCompare(b)); // sortByName :: [[k, v]] -> [[k, v]]

const sortByName = R.sort(([, a], [, b]) => a.name.localeCompare(b.name)); // groupByGroupName :: [[k, v]] -> { g: [k, v] }

const groupByGroupName = R.groupBy(R.pipe(R.last, R.prop('groups'), R.last)); // sortForPanel :: { k: v } -> [[g, [k, v]]]

const sortForPanel = R.pipe(R.pickBy(R.prop('visible')), R.toPairs, sortByName, groupByGroupName, R.toPairs, sortByGroup);

const getSelectedOccIds = project => {
  return project.getOccurrences().toArray().map(occ => occ.getId());
};

const isValidPropVal = R.curry((type, val) => {
  switch (type.toLowerCase()) {
    case PrintSettingsConstants.Types.Scalar:
    case PrintSettingsConstants.Types.UnsignedInt:
    case PrintSettingsConstants.Types.Increment:
    case PrintSettingsConstants.Types.Percent:
      return !isNaN(parseInt(val));

    default:
      return true;
  }
});
/**
 * Saves property value to override object for Slice Config.
 * Invokes FLUX Property Action - savePropValue.
 * @param {path} - projectStore.js needs this for parsing i.e. "occurrence:printMode"
 * @param {string} - val
 */

const savePropValue = R.curry((flux, project, path, val, type) => {
  //TODO: not used, confirm if needed
  // const settingName = path.split(':')[1];
  const {
    actions
  } = flux;

  if (isValidPropVal(type, val)) {
    return actions.property.savePropValue(getSelectedOccIds(project), path, val, null, {
      compose: false
    }).done();
  }
});
const withAsterisk = R.curry((i18n, f, v) => f(v) ? `${i18n(v)}*` : i18n(v));
module.exports = {
  sortByGroup,
  sortByName,
  groupByGroupName,
  sortForPanel,
  getSelectedOccIds,
  savePropValue,
  withAsterisk
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInVpVXRpbHMuanMiXSwibmFtZXMiOlsiUiIsInJlcXVpcmUiLCJQcmludFNldHRpbmdzQ29uc3RhbnRzIiwic29ydEJ5R3JvdXAiLCJzb3J0IiwiYSIsImIiLCJsb2NhbGVDb21wYXJlIiwic29ydEJ5TmFtZSIsIm5hbWUiLCJncm91cEJ5R3JvdXBOYW1lIiwiZ3JvdXBCeSIsInBpcGUiLCJsYXN0IiwicHJvcCIsInNvcnRGb3JQYW5lbCIsInBpY2tCeSIsInRvUGFpcnMiLCJnZXRTZWxlY3RlZE9jY0lkcyIsInByb2plY3QiLCJnZXRPY2N1cnJlbmNlcyIsInRvQXJyYXkiLCJtYXAiLCJvY2MiLCJnZXRJZCIsImlzVmFsaWRQcm9wVmFsIiwiY3VycnkiLCJ0eXBlIiwidmFsIiwidG9Mb3dlckNhc2UiLCJUeXBlcyIsIlNjYWxhciIsIlVuc2lnbmVkSW50IiwiSW5jcmVtZW50IiwiUGVyY2VudCIsImlzTmFOIiwicGFyc2VJbnQiLCJzYXZlUHJvcFZhbHVlIiwiZmx1eCIsInBhdGgiLCJhY3Rpb25zIiwicHJvcGVydHkiLCJjb21wb3NlIiwiZG9uZSIsIndpdGhBc3RlcmlzayIsImkxOG4iLCJmIiwidiIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBLE1BQU1BLENBQUMsR0FBR0MsT0FBTyxDQUFDLE9BQUQsQ0FBakI7O0FBRUEsTUFBTUMsc0JBQXNCLEdBQUdELE9BQU8sQ0FBQyxnQ0FBRCxDQUF0QyxDLENBRUE7OztBQUNBLE1BQU1FLFdBQVcsR0FBR0gsQ0FBQyxDQUFDSSxJQUFGLENBQU8sQ0FBQyxDQUFDQyxDQUFELENBQUQsRUFBTSxDQUFDQyxDQUFELENBQU4sS0FBY0QsQ0FBQyxDQUFDRSxhQUFGLENBQWdCRCxDQUFoQixDQUFyQixDQUFwQixDLENBRUE7O0FBQ0EsTUFBTUUsVUFBVSxHQUFHUixDQUFDLENBQUNJLElBQUYsQ0FBTyxDQUFDLEdBQUdDLENBQUgsQ0FBRCxFQUFRLEdBQUdDLENBQUgsQ0FBUixLQUFr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XHJcblxyXG5jb25zdCBQcmludFNldHRpbmdzQ29uc3RhbnRzID0gcmVxdWlyZSgnLi4vLi4vY29uc3RhbnRzL3ByaW50X3NldHRpbmdzJyk7XHJcblxyXG4vLyBzb3J0QnlHcm91cCA6OiBbW2csIFtrLCB2XV1dIC0+IFtbZywgW2ssIHZdXV1cclxuY29uc3Qgc29ydEJ5R3JvdXAgPSBSLnNvcnQoKFthXSwgW2JdKSA9PiBhLmxvY2FsZUNvbXBhcmUoYikpO1xyXG5cclxuLy8gc29ydEJ5TmFtZSA6OiBbW2ssIHZdXSAtPiBbW2ssIHZdXVxyXG5jb25zdCBzb3J0QnlOYW1lID0gUi5zb3J0KChbLCBhXSwgWywgYl0pID0+IGEubmFtZS5sb2NhbGVDb21wYXJlKGIubmFtZSkpO1xyXG5cclxuLy8gZ3JvdXBCeUdyb3VwTmFtZSA6OiBbW2ssIHZdXSAtPiB7IGc6IFtrLCB2XSB9XHJcbmNvbnN0IGdyb3VwQnlHcm91cE5hbWUgPSBSLmdyb3VwQnkoXHJcbiAgICBSLnBpcGUoXHJcbiAgICAgICAgUi5sYXN0LFxyXG4gICAgICAgIFIucHJvcCgnZ3JvdXBzJyksXHJcbiAgICAgICAgUi5sYXN0XHJcbiAgICApXHJcbik7XHJcblxyXG4vLyBzb3J0Rm9yUGFuZWwgOjogeyBrOiB2IH0gLT4gW1tnLCBbaywgdl1dXVxyXG5jb25zdCBzb3J0Rm9yUGFuZWwgPSBSLnBpcGUoXHJcbiAgICBSLnBpY2tCeShSLnByb3AoJ3Zpc2libGUnKSksXHJcbiAgICBSLnRvUGFpcnMsXHJcbiAgICBzb3J0QnlOYW1lLFxyXG4gICAgZ3JvdXBCeUdyb3VwTmFtZSxcclxuICAgIFIudG9QYWlycyxcclxuICAgIHNvcnRCeUdyb3VwXHJcbik7XHJcblxyXG5jb25zdCBnZXRTZWxlY3RlZE9jY0lkcyA9IHByb2plY3QgPT4ge1xyXG4gICAgcmV0dXJuIHByb2plY3RcclxuICAgICAgICAuZ2V0T2NjdXJyZW5jZXMoKVxyXG4gICAgICAgIC50b0FycmF5KClcclxuICAgICAgICAubWFwKG9jYyA9PiBvY2MuZ2V0SWQoKSk7XHJcbn07XHJcblxyXG5jb25zdCBpc1ZhbGlkUHJvcFZhbCA9IFIuY3VycnkoKHR5cGUsIHZhbCkgPT4ge1xyXG4gICAgc3dpdGNoICh0eXBlLnRvTG93ZXJDYXNlKCkpIHtcclxuICAgICAgICBjYXNlIFByaW50U2V0dGluZ3NDb25zdGFudHMuVHlwZXMuU2NhbGFyOlxyXG4gICAgICAgIGNhc2UgUHJpbnRTZXR0aW5nc0NvbnN0YW50cy5UeXBlcy5VbnNpZ25lZEludDpcclxuICAgICAgICBjYXNlIFByaW50U2V0dGluZ3NDb25zdGFudHMuVHlwZXMuSW5jcmVtZW50OlxyXG4gICAgICAgIGNhc2UgUHJpbnRTZXR0aW5nc0NvbnN0YW50cy5UeXBlcy5QZXJjZW50OlxyXG4gICAgICAgICAgICByZXR1cm4gIWlzTmFOKHBhcnNlSW50KHZhbCkpO1xyXG4gICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfVxyXG59KTtcclxuXHJcbi8qKlxyXG4gKiBTYXZlcyBwcm9wZXJ0eSB2YWx1ZSB0byBvdmVycmlkZSBvYmplY3QgZm9yIFNsaWNlIENvbmZpZy5cclxuICogSW52b2tlcyBGTFVYIFByb3BlcnR5IEFjdGlvbiAtIHNhdmVQcm9wVmFsdWUuXHJcbiAqIEBwYXJhbSB7cGF0aH0gLSBwcm9qZWN0U3RvcmUuanMgbmVlZHMgdGhpcyBmb3IgcGFyc2luZyBpLmUuIFwib2NjdXJyZW5jZTpwcmludE1vZGVcIlxyXG4gKiBAcGFyYW0ge3N0cmluZ30gLSB2YWxcclxuICovXHJcbmNvbnN0IHNhdmVQcm9wVmFsdWUgPSBSLmN1cnJ5KChmbHV4LCBwcm9qZWN0LCBwYXRoLCB2YWwsIHR5cGUpID0+IHtcclxuICAgIC8vVE9ETzogbm90IHVzZWQsIGNvbmZpcm0gaWYgbmVlZGVkXHJcbiAgICAvLyBjb25zdCBzZXR0aW5nTmFtZSA9IHBhdGguc3BsaXQoJzonKVsxXTtcclxuICAgIGNvbnN0IHsgYWN0aW9ucyB9ID0gZmx1eDtcclxuXHJcbiAgICBpZiAoaXNWYWxpZFByb3BWYWwodHlwZSwgdmFsKSkge1xyXG4gICAgICAgIHJldHVybiBhY3Rpb25zLnByb3BlcnR5LnNhdmVQcm9wVmFsdWUoZ2V0U2VsZWN0ZWRPY2NJZHMocHJvamVjdCksIHBhdGgsIHZhbCwgbnVsbCwgeyBjb21wb3NlOiBmYWxzZSB9KS5kb25lKCk7XHJcbiAgICB9XHJcbn0pO1xyXG5cclxuY29uc3Qgd2l0aEFzdGVyaXNrID0gUi5jdXJyeSgoaTE4biwgZiwgdikgPT4gKGYodikgPyBgJHtpMThuKHYpfSpgIDogaTE4bih2KSkpO1xyXG5cclxubW9kdWxlLmV4cG9ydHMgPSB7XHJcbiAgICBzb3J0QnlHcm91cCxcclxuICAgIHNvcnRCeU5hbWUsXHJcbiAgICBncm91cEJ5R3JvdXBOYW1lLFxyXG4gICAgc29ydEZvclBhbmVsLFxyXG4gICAgZ2V0U2VsZWN0ZWRPY2NJZHMsXHJcbiAgICBzYXZlUHJvcFZhbHVlLFxyXG4gICAgd2l0aEFzdGVyaXNrLFxyXG59O1xyXG4iXX0=
