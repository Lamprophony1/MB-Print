'use strict';
/** @author Jon Laing */

const PrinterStateEnum = require('../constants').PrinterStateEnum;

const Errors = require('../errors');

const BirdWingError = require('../croissant').BirdWingError;

const {
  maybe,
  either
} = require('./maybe');
/**
 * A helper function to get the printer store.
 * @param {object} flux
 * @returns {Flux.store}
 */


const getPrinterStore = flux => flux.store('PrinterStore');
/**
 * A helper function to get a printer out of the store
 * @param {object} flux
 * @param {string} id - id of the desired printer
 * @returns {MakerbotPrinter}
 */


const getPrinter = (flux, id) => getPrinterStore(flux).getPrinter(id);
/**
 * A helper function to get the selected printer out of the store
 * @param {object} flux
 * @returns {MakerbotPrinter}
 */


const getSelectedPrinter = flux => getPrinterStore(flux).getSelectedPrinter();
/**
 * A helper object to abstract null-checking on the printer status
 *
 * @param {MakerbotPrinter} printer
 * @param {string} override - some panels need to override the printer status
 * to make the UI look the way we want.
 * @returns {object}
 */


const printerStatus = (printer, override) => ({
  check: f => {
    const s = override || printer && printer.getStatus(); // status or null

    return either(false, s).right(f).lift(); // return s != null && f(s);
  },
  apply: f => {
    const s = override || printer && printer.getStatus(); // status or null

    return maybe(s).map(f).lift(); // return s != null ? f(s) : null;
  }
});
/**
 * A helper object to abstract null-checking on the printer's current process
 *
 * @param {MakerbotPrinter} printer
 * @returns {object}
 */


const currentPrinterProcess = printer => ({
  check: f => printerStatus(printer).check(s => {
    const cp = s.current_process;
    return either(false, cp).right(f).lift(); // return cp != null && f(cp);
  }),
  apply: f => printerStatus(printer).apply(s => {
    const cp = s.current_process;
    return maybe(cp).map(f).lift(); // return cp != null ? f(cp) : null;
  })
}); // Not entirely sure if this is needed, or if there's a more succinct way.
// I took it from the old implementation of PrinterDetailsPanel.


const isAcknowledgeableErr = printer => {
  const err = printer.getLastError();
  if (!err) return false;
  const errInfo = Errors.getErrInfo(printer, err); // this comment is to offset Shirley's bus-factor
  // https://github.com/makerbot/MBCoreUtils/blob/develop/birdwing_codegen/contexts/errors.json#L645

  const acknowledgeable = [BirdWingError.Action.ACKNOWLEDGE, BirdWingError.Action.ACKNOWLEDGE_OR_CONTINUE];
  return acknowledgeable.indexOf(errInfo.action) > -1;
}; // check if the step of the current process is in a particular list
// of steps. This is basically meant to flatten current process steps into
// a handful of "states" for rendering.


const isStep = (printer, override) => stepList => override ? stepList.indexOf(override) !== -1 : currentPrinterProcess(printer).check(cp => stepList.indexOf(cp.step.toLowerCase()) != -1); // all the steps that constitute a printer being "busy"


const busySteps = ['initializing', 'initial_heating', 'final_heating', 'cooling', 'homing', 'position_found', 'preheating', 'calibrating', 'end_sequence', 'cancelling', 'preheating_loading', 'preheating_resuming', 'preheating_unloading', 'stopping_filament', 'cleaning_up', 'loading_print_tool', 'waiting_for_file', 'running', 'extrusion', 'loading_filament', 'unloading_filament']; // Steps that consitute unloading filament.

const unloadingSteps = ['unloading_filament', 'preheating_unloading']; // all the steps that constitute a printer "transferring"

const transferSteps = ['transfer', 'downloading', 'verify_firmware']; // all the steps that constitute a printer "updating its firmware"

const updateFirmwareSteps = ['writing']; // all the steps that constitute a printer "printing"

const printingSteps = ['printing']; // all the steps that constitute a printer "paused"

const pausedSteps = ['suspending', 'suspended', 'unsuspending']; // all the steps that constitute a printer having "started its print"

const startPrintSteps = ['clear_build_plate']; // all the steps that constitute a printer "clearing filament"

const clearFilamentSteps = ['clear_filament']; // all the steps that constitute a printer "removing filament
// for z calibration"

const zCalFilamentSteps = ['remove_filament']; // all the steps that constitute a printer having an "error"

const errorSteps = ['failed', 'error_step']; // all the steps that constitute a printer action having "completed"

const completedSteps = ['completed'];
/**
 * This function returns a really useful object. Basically, the printer
 * details panel can have so many different states based on printer states
 * that it got incredibly unwieldy to not have a common interface for all
 * of it. So, this function returns an object that distills a bunch of
 * printer states into booleans, to make it easier to check.
 *
 * @param {MakerbotPrinter} printer
 * @returns {object}
 */

const printerDetailsStatus = (printer, override) => {
  const methodExists = printer.processMethodExists.bind(printer);
  const status = printerStatus(printer, override).check;
  const currentProcess = currentPrinterProcess(printer).check;
  const step = isStep(printer, override); // We don't have any guarantee that `current_process` has the types
  // we expect because it comes from kaiten which is written in python
  // so we have to coerce some of the process properties into booleans,
  // namely `cancelled` and `cancellable`.

  return {
    has: {
      state: status(s => s.state != null),
      process: currentProcess(() => true),
      extruder: !printer.isMissingExtruder(),
      error: !!printer.getLastError(),
      acknowledgableError: isAcknowledgeableErr(printer),
      dualExtruders: printer.isSixthGen(),
      chamber: printer.getChamberInfo().length > 0,
      platform: printer.getPlatformInfo && printer.getPlatformInfo().length > 0
    },
    is: {
      authenticated: printer.isAuthenticated(),
      idle: status(s => s.state === PrinterStateEnum.Idle),
      pending: status(s => s.state === PrinterStateEnum.Pending),
      cancelled: currentProcess(cp => !!cp.cancelled),
      offline: status(s => s.state === PrinterStateEnum.Offline),
      reconnecting: status(s => s.state === PrinterStateEnum.Reconnecting),
      reauthenticating: status(s => s.state === PrinterStateEnum.Reauthenticating),
      authenticating: status(s => s.state === PrinterStateEnum.Authenticating),
      unauthenticated: status(s => s.state === PrinterStateEnum.Unauthenticated)
    },
    can: {
      suspend: methodExists('suspend'),
      acknowledgeError: methodExists('acknowledge_error'),
      acknowledgeFailure: methodExists('acknowledge_failure'),
      acknowledgeSuccess: methodExists('acknowledge_success'),
      stopFilament: methodExists('stop_filament'),
      printAgain: currentProcess(cp => !!cp.can_print_again),
      resume: methodExists('resume'),
      loadFilament: methodExists('load_filament'),
      unloadFilament: methodExists('unload_filament'),
      cancel: status(s => s.state !== PrinterStateEnum.Pending) && currentProcess(cp => !!cp.cancellable && !cp.cancelled)
    },
    step: {
      failed: currentProcess(cp => cp.step === 'failed'),
      busy: step(busySteps),
      transferring: step(transferSteps),
      updatingFirmware: step(updateFirmwareSteps),
      printing: step(printingSteps),
      paused: step(pausedSteps),
      suspending: currentProcess(cp => cp.step === 'suspending'),
      startPrint: step(startPrintSteps),
      clearFilament: step(clearFilamentSteps),
      unloadingFilament: step(unloadingSteps),
      zCalFilament: step(zCalFilamentSteps),
      error: step(errorSteps),
      completed: step(completedSteps),
      wifiSetUp: currentProcess(cp => cp.name === 'WifiSetupProcess'),
      reconnecting: currentProcess(cp => cp.step === 'reconnecting')
    }
  };
};

module.exports = {
  getPrinterStore,
  getPrinter,
  getSelectedPrinter,
  printerStatus,
  currentPrinterProcess,
  printerDetailsStatus
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInByaW50ZXJEZXRhaWxzLmpzIl0sIm5hbWVzIjpbIlByaW50ZXJTdGF0ZUVudW0iLCJyZXF1aXJlIiwiRXJyb3JzIiwiQmlyZFdpbmdFcnJvciIsIm1heWJlIiwiZWl0aGVyIiwiZ2V0UHJpbnRlclN0b3JlIiwiZmx1eCIsInN0b3JlIiwiZ2V0UHJpbnRlciIsImlkIiwiZ2V0U2VsZWN0ZWRQcmludGVyIiwicHJpbnRlclN0YXR1cyIsInByaW50ZXIiLCJvdmVycmlkZSIsImNoZWNrIiwiZiIsInMiLCJnZXRTdGF0dXMiLCJyaWdodCIsImxpZnQiLCJhcHBseSIsIm1hcCIsImN1cnJlbnRQcmludGVyUHJvY2VzcyIsImNwIiwiY3VycmVudF9wcm9jZXNzIiwiaXNBY2tub3dsZWRnZWFibGVFcnIiLCJlcnIiLCJnZXRMYXN0RXJyb3IiLCJlcnJJbmZvIiwiZ2V0RXJySW5mbyIsImFja25vd2xlZGdlYWJsZSIsIkFjdGlvbiIsIkFDS05PV0xFREdFIiwiQUNLTk9XTEVER0VfT1JfQ09OVElOVUUiLCJpbmRleE9mIiwiYWN0aW9uIiwiaXNTdGVwIiwic3RlcExpc3QiLCJzdGVwIiwidG9Mb3dlckNhc2UiLCJidXN5U3RlcHMiLCJ1bmxvYWRpbmdTdGVwcyIsInRyYW5zZmVyU3RlcHMiLCJ1cGRhdGVGaXJtd2FyZVN0ZXBzIiwicHJpbnRpbmdTdGVwcyIsInBhdXNlZFN0ZXBzIiwic3RhcnRQcmludFN0ZXBzIiwiY2xlYXJGaWxhbWVudFN0ZXBzIiwiekNhbEZpbGFtZW50U3RlcHMiLCJlcnJvclN0ZXBzIiwiY29tcGxldGVkU3RlcHMiLCJwcmludGVyRGV0YWlsc1N0YXR1cyIsIm1ldGhvZEV4aXN0cyIsInByb2Nlc3NNZXRob2RFeGlzdHMiLCJiaW5kIiwic3RhdHVzIiwiY3VycmVudFByb2Nlc3MiLCJoYXMiLCJzdGF0ZSIsInByb2Nlc3MiLCJleHRydWRlciIsImlzTWlzc2luZ0V4dHJ1ZGVyIiwiZXJyb3IiLCJhY2tub3dsZWRnYWJsZUVycm9yIiwiZHVhbEV4dHJ1ZGVycyIsImlzU2l4dGhHZW4iLCJjaGFtYmVyIiwiZ2V0Q2hhbWJlckluZm8iLCJsZW5ndGgiLCJwbGF0Zm9ybSIsImdldFBsYXRmb3JtSW5mbyIsImlzIiwiYXV0aGVudGljYXRlZCIsImlzQXV0aGVudGljYXRlZCIsImlkbGUiLCJJZGxlIiwicGVuZGluZyIsIlBlbmRpbmciLCJjYW5jZWxsZWQiLCJvZmZsaW5lIiwiT2ZmbGluZSIsInJlY29ubmVjdGluZyIsIlJlY29ubmVjdGluZyIsInJlYXV0aGVudGljYXRpbmciLCJSZWF1dGhlbnRpY2F0aW5nIiwiYXV0aGVudGljYXRpbmciLCJBdXRoZW50aWNhdGluZyIsInVuYXV0aGVudGljYXRlZCIsIlVuYXV0aGVudGljYXRlZCIsImNhbiIsInN1c3BlbmQiLCJhY2tub3dsZWRnZUVycm9yIiwiYWNrbm93bGVkZ2VGYWlsdXJlIiwiYWNrbm93bGVkZ2VTdWNjZXNzIiwic3RvcEZpbGFtZW50IiwicHJpbnRBZ2FpbiIsImNhbl9wcmludF9hZ2FpbiIsInJlc3VtZSIsImxvYWRGaWxhbWVudCIsInVubG9hZEZpbGFtZW50IiwiY2FuY2VsIiwiY2FuY2VsbGFibGUiLCJmYWlsZWQiLCJidXN5IiwidHJhbnNmZXJyaW5nIiwidXBkYXRpbmdGaXJtd2FyZSIsInByaW50aW5nIiwicGF1c2VkIiwic3VzcGVuZGluZyIsInN0YXJ0UHJpbnQiLCJjbGVhckZpbGFtZW50IiwidW5sb2FkaW5nRmlsYW1lbnQiLCJ6Q2FsRmlsYW1lbnQiLCJjb21wbGV0ZWQiLCJ3aWZpU2V0VXAiLCJuYW1lIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6IkFBQUE7QUFFQTs7QUFFQSxNQUFNQSxnQkFBZ0IsR0FBR0MsT0FBTyxDQUFDLGNBQUQsQ0FBUCxDQUF3QkQsZ0JBQWpEOztBQUNBLE1BQU1FLE1BQU0sR0FBR0QsT0FBTyxDQUFDLFdBQUQsQ0FBdEI7O0FBQ0EsTUFBTUUsYUFBYSxHQUFHRixPQUFPLENBQUMsY0FBRCxDQUFQLENBQXdCRSxhQUE5Qzs7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Q2JoSCxFQUFBQSxlQURhO0FBRWJHLEVBQUFBLFVBRmE7QUFHYkUsRUFBQUEsa0JBSGE7QUFJYkMsRUFBQUEsYUFKYTtBQUtiVyxFQUFBQSxxQkFMYTtBQU1iNkIsRUFBQUE7QUFOYSxDQUFqQiIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcclxuXHJcbi8qKiBAYXV0aG9yIEpvbiBMYWluZyAqL1xyXG5cclxuY29uc3QgUHJpbnRlclN0YXRlRW51bSA9IHJlcXVpcmUoJy4uL2NvbnN0YW50cycpLlByaW50ZXJTdGF0ZUVudW07XHJcbmNvbnN0IEVycm9ycyA9IHJlcXVpcmUoJy4uL2Vycm9ycycpO1xyXG5jb25zdCBCaXJkV2luZ0Vycm9yID0gcmVxdWlyZSgnLi4vY3JvaXNzYW50JykuQmlyZFdpbmdFcnJvcjtcclxuY29uc3QgeyBtYXliZSwgZWl0aGVyIH0gPSByZXF1aXJlKCcuL21heWJlJyk7XHJcblxyXG4vKipcclxuICogQSBoZWxwZXIgZnVuY3Rpb24gdG8gZ2V0IHRoZSBwcmludGVyIHN0b3JlLlxyXG4gKiBAcGFyYW0ge29iamVjdH0gZmx1eFxyXG4gKiBAcmV0dXJucyB7Rmx1eC5zdG9yZX1cclxuICovXHJcbmNvbnN0IGdldFByaW50ZXJTdG9yZSA9IGZsdXggPT4gZmx1eC5zdG9yZSgnUHJpbnRlclN0b3JlJyk7XHJcblxyXG4vKipcclxuICogQSBoZWxwZXIgZnVuY3Rpb24gdG8gZ2V0IGEgcHJpbnRlciBvdXQgb2YgdGhlIHN0b3JlXHJcbiAqIEBwYXJhbSB7b2JqZWN0fSBmbHV4XHJcbiAqIEBwYXJhbSB7c3RyaW5nfSBpZCAtIGlkIG9mIHRoZSBkZXNpcmVkIHByaW50ZXJcclxuICogQHJldHVybnMge01ha2VyYm90UHJpbnRlcn1cclxuICovXHJcbmNvbnN0IGdldFByaW50ZXIgPSAoZmx1eCwgaWQpID0+IGdldFByaW50ZXJTdG9yZShmbHV4KS5nZXRQcmludGVyKGlkKTtcclxuXHJcbi8qKlxyXG4gKiBBIGhlbHBlciBmdW5jdGlvbiB0byBnZXQgdGhlIHNlbGVjdGVkIHByaW50ZXIgb3V0IG9mIHRoZSBzdG9yZVxyXG4gKiBAcGFyYW0ge29iamVjdH0gZmx1eFxyXG4gKiBAcmV0dXJucyB7TWFrZXJib3RQcmludGVyfVxyXG4gKi9cclxuY29uc3QgZ2V0U2VsZWN0ZWRQcmludGVyID0gZmx1eCA9PiBnZXRQcmludGVyU3RvcmUoZmx1eCkuZ2V0U2VsZWN0ZWRQcmludGVyKCk7XHJcblxyXG4vKipcclxuICogQSBoZWxwZXIgb2JqZWN0IHRvIGFic3RyYWN0IG51bGwtY2hlY2tpbmcgb24gdGhlIHByaW50ZXIgc3RhdHVzXHJcbiAqXHJcbiAqIEBwYXJhbSB7TWFrZXJib3RQcmludGVyfSBwcmludGVyXHJcbiAqIEBwYXJhbSB7c3RyaW5nfSBvdmVycmlkZSAtIHNvbWUgcGFuZWxzIG5lZWQgdG8gb3ZlcnJpZGUgdGhlIHByaW50ZXIgc3RhdHVzXHJcbiAqIHRvIG1ha2UgdGhlIFVJIGxvb2sgdGhlIHdheSB3ZSB3YW50LlxyXG4gKiBAcmV0dXJucyB7b2JqZWN0fVxyXG4gKi9cclxuY29uc3QgcHJpbnRlclN0YXR1cyA9IChwcmludGVyLCBvdmVycmlkZSkgPT4gKHtcclxuICAgIGNoZWNrOiBmID0+IHtcclxuICAgICAgICBjb25zdCBzID0gb3ZlcnJpZGUgfHwgKHByaW50ZXIgJiYgcHJpbnRlci5nZXRTdGF0dXMoKSk7IC8vIHN0YXR1cyBvciBudWxsXHJcbiAgICAgICAgcmV0dXJuIGVpdGhlcihmYWxzZSwgcylcclxuICAgICAgICAgICAgLnJpZ2h0KGYpXHJcbiAgICAgICAgICAgIC5saWZ0KCk7XHJcbiAgICAgICAgLy8gcmV0dXJuIHMgIT0gbnVsbCAmJiBmKHMpO1xyXG4gICAgfSxcclxuXHJcbiAgICBhcHBseTogZiA9PiB7XHJcbiAgICAgICAgY29uc3QgcyA9IG92ZXJyaWRlIHx8IChwcmludGVyICYmIHByaW50ZXIuZ2V0U3RhdHVzKCkpOyAvLyBzdGF0dXMgb3IgbnVsbFxyXG4gICAgICAgIHJldHVybiBtYXliZShzKVxyXG4gICAgICAgICAgICAubWFwKGYpXHJcbiAgICAgICAgICAgIC5saWZ0KCk7XHJcbiAgICAgICAgLy8gcmV0dXJuIHMgIT0gbnVsbCA/IGYocykgOiBudWxsO1xyXG4gICAgfSxcclxufSk7XHJcblxyXG4vKipcclxuICogQSBoZWxwZXIgb2JqZWN0IHRvIGFic3RyYWN0IG51bGwtY2hlY2tpbmcgb24gdGhlIHByaW50ZXIncyBjdXJyZW50IHByb2Nlc3NcclxuICpcclxuICogQHBhcmFtIHtNYWtlcmJvdFByaW50ZXJ9IHByaW50ZXJcclxuICogQHJldHVybnMge29iamVjdH1cclxuICovXHJcbmNvbnN0IGN1cnJlbnRQcmludGVyUHJvY2VzcyA9IHByaW50ZXIgPT4gKHtcclxuICAgIGNoZWNrOiBmID0+XHJcbiAgICAgICAgcHJpbnRlclN0YXR1cyhwcmludGVyKS5jaGVjayhzID0+IHtcclxuICAgICAgICAgICAgY29uc3QgY3AgPSBzLmN1cnJlbnRfcHJvY2VzcztcclxuICAgICAgICAgICAgcmV0dXJuIGVpdGhlcihmYWxzZSwgY3ApXHJcbiAgICAgICAgICAgICAgICAucmlnaHQoZilcclxuICAgICAgICAgICAgICAgIC5saWZ0KCk7XHJcbiAgICAgICAgICAgIC8vIHJldHVybiBjcCAhPSBudWxsICYmIGYoY3ApO1xyXG4gICAgICAgIH0pLFxyXG5cclxuICAgIGFwcGx5OiBmID0+XHJcbiAgICAgICAgcHJpbnRlclN0YXR1cyhwcmludGVyKS5hcHBseShzID0+IHtcclxuICAgICAgICAgICAgY29uc3QgY3AgPSBzLmN1cnJlbnRfcHJvY2VzcztcclxuICAgICAgICAgICAgcmV0dXJuIG1heWJlKGNwKVxyXG4gICAgICAgICAgICAgICAgLm1hcChmKVxyXG4gICAgICAgICAgICAgICAgLmxpZnQoKTtcclxuICAgICAgICAgICAgLy8gcmV0dXJuIGNwICE9IG51bGwgPyBmKGNwKSA6IG51bGw7XHJcbiAgICAgICAgfSksXHJcbn0pO1xyXG5cclxuLy8gTm90IGVudGlyZWx5IHN1cmUgaWYgdGhpcyBpcyBuZWVkZWQsIG9yIGlmIHRoZXJlJ3MgYSBtb3JlIHN1Y2NpbmN0IHdheS5cclxuLy8gSSB0b29rIGl0IGZyb20gdGhlIG9sZCBpbXBsZW1lbnRhdGlvbiBvZiBQcmludGVyRGV0YWlsc1BhbmVsLlxyXG5jb25zdCBpc0Fja25vd2xlZGdlYWJsZUVyciA9IHByaW50ZXIgPT4ge1xyXG4gICAgY29uc3QgZXJyID0gcHJpbnRlci5nZXRMYXN0RXJyb3IoKTtcclxuXHJcbiAgICBpZiAoIWVycikgcmV0dXJuIGZhbHNlO1xyXG5cclxuICAgIGNvbnN0IGVyckluZm8gPSBFcnJvcnMuZ2V0RXJySW5mbyhwcmludGVyLCBlcnIpO1xyXG5cclxuICAgIC8vIHRoaXMgY29tbWVudCBpcyB0byBvZmZzZXQgU2hpcmxleSdzIGJ1cy1mYWN0b3JcclxuICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9tYWtlcmJvdC9NQkNvcmVVdGlscy9ibG9iL2RldmVsb3AvYmlyZHdpbmdfY29kZWdlbi9jb250ZXh0cy9lcnJvcnMuanNvbiNMNjQ1XHJcbiAgICBjb25zdCBhY2tub3dsZWRnZWFibGUgPSBbQmlyZFdpbmdFcnJvci5BY3Rpb24uQUNLTk9XTEVER0UsIEJpcmRXaW5nRXJyb3IuQWN0aW9uLkFDS05PV0xFREdFX09SX0NPTlRJTlVFXTtcclxuXHJcbiAgICByZXR1cm4gYWNrbm93bGVkZ2VhYmxlLmluZGV4T2YoZXJySW5mby5hY3Rpb24pID4gLTE7XHJcbn07XHJcblxyXG4vLyBjaGVjayBpZiB0aGUgc3RlcCBvZiB0aGUgY3VycmVudCBwcm9jZXNzIGlzIGluIGEgcGFydGljdWxhciBsaXN0XHJcbi8vIG9mIHN0ZXBzLiBUaGlzIGlzIGJhc2ljYWxseSBtZWFudCB0byBmbGF0dGVuIGN1cnJlbnQgcHJvY2VzcyBzdGVwcyBpbnRvXHJcbi8vIGEgaGFuZGZ1bCBvZiBcInN0YXRlc1wiIGZvciByZW5kZXJpbmcuXHJcbmNvbnN0IGlzU3RlcCA9IChwcmludGVyLCBvdmVycmlkZSkgPT4gc3RlcExpc3QgPT5cclxuICAgIG92ZXJyaWRlXHJcbiAgICAgICAgPyBzdGVwTGlzdC5pbmRleE9mKG92ZXJyaWRlKSAhPT0gLTFcclxuICAgICAgICA6IGN1cnJlbnRQcmludGVyUHJvY2VzcyhwcmludGVyKS5jaGVjayhjcCA9PiBzdGVwTGlzdC5pbmRleE9mKGNwLnN0ZXAudG9Mb3dlckNhc2UoKSkgIT0gLTEpO1xyXG5cclxuLy8gYWxsIHRoZSBzdGVwcyB0aGF0IGNvbnN0aXR1dGUgYSBwcmludGVyIGJlaW5nIFwiYnVzeVwiXHJcbmNvbnN0IGJ1c3lTdGVwcyA9IFtcclxuICAgICdpbml0aWFsaXppbmcnLFxyXG4gICAgJ2luaXRpYWxfaGVhdGluZycsXHJcbiAgICAnZmluYWxfaGVhdGluZycsXHJcbiAgICAnY29vbGluZycsXHJcbiAgICAnaG9taW5nJyxcclxuICAgICdwb3NpdGlvbl9mb3VuZCcsXHJcbiAgICAncHJlaGVhdGluZycsXHJcbiAgICAnY2FsaWJyYXRpbmcnLFxyXG4gICAgJ2VuZF9zZXF1ZW5jZScsXHJcbiAgICAnY2FuY2VsbGluZycsXHJcbiAgICAncHJlaGVhdGluZ19sb2FkaW5nJyxcclxuICAgICdwcmVoZWF0aW5nX3Jlc3VtaW5nJyxcclxuICAgICdwcmVoZWF0aW5nX3VubG9hZGluZycsXHJcbiAgICAnc3RvcHBpbmdfZmlsYW1lbnQnLFxyXG4gICAgJ2NsZWFuaW5nX3VwJyxcclxuICAgICdsb2FkaW5nX3ByaW50X3Rvb2wnLFxyXG4gICAgJ3dhaXRpbmdfZm9yX2ZpbGUnLFxyXG4gICAgJ3J1bm5pbmcnLFxyXG4gICAgJ2V4dHJ1c2lvbicsXHJcbiAgICAnbG9hZGluZ19maWxhbWVudCcsXHJcbiAgICAndW5sb2FkaW5nX2ZpbGFtZW50JyxcclxuXTtcclxuXHJcbi8vIFN0ZXBzIHRoYXQgY29uc2l0dXRlIHVubG9hZGluZyBmaWxhbWVudC5cclxuY29uc3QgdW5sb2FkaW5nU3RlcHMgPSBbJ3VubG9hZGluZ19maWxhbWVudCcsICdwcmVoZWF0aW5nX3VubG9hZGluZyddO1xyXG5cclxuLy8gYWxsIHRoZSBzdGVwcyB0aGF0IGNvbnN0aXR1dGUgYSBwcmludGVyIFwidHJhbnNmZXJyaW5nXCJcclxuY29uc3QgdHJhbnNmZXJTdGVwcyA9IFsndHJhbnNmZXInLCAnZG93bmxvYWRpbmcnLCAndmVyaWZ5X2Zpcm13YXJlJ107XHJcblxyXG4vLyBhbGwgdGhlIHN0ZXBzIHRoYXQgY29uc3RpdHV0ZSBhIHByaW50ZXIgXCJ1cGRhdGluZyBpdHMgZmlybXdhcmVcIlxyXG5jb25zdCB1cGRhdGVGaXJtd2FyZVN0ZXBzID0gWyd3cml0aW5nJ107XHJcblxyXG4vLyBhbGwgdGhlIHN0ZXBzIHRoYXQgY29uc3RpdHV0ZSBhIHByaW50ZXIgXCJwcmludGluZ1wiXHJcbmNvbnN0IHByaW50aW5nU3RlcHMgPSBbJ3ByaW50aW5nJ107XHJcblxyXG4vLyBhbGwgdGhlIHN0ZXBzIHRoYXQgY29uc3RpdHV0ZSBhIHByaW50ZXIgXCJwYXVzZWRcIlxyXG5jb25zdCBwYXVzZWRTdGVwcyA9IFsnc3VzcGVuZGluZycsICdzdXNwZW5kZWQnLCAndW5zdXNwZW5kaW5nJ107XHJcblxyXG4vLyBhbGwgdGhlIHN0ZXBzIHRoYXQgY29uc3RpdHV0ZSBhIHByaW50ZXIgaGF2aW5nIFwic3RhcnRlZCBpdHMgcHJpbnRcIlxyXG5jb25zdCBzdGFydFByaW50U3RlcHMgPSBbJ2NsZWFyX2J1aWxkX3BsYXRlJ107XHJcblxyXG4vLyBhbGwgdGhlIHN0ZXBzIHRoYXQgY29uc3RpdHV0ZSBhIHByaW50ZXIgXCJjbGVhcmluZyBmaWxhbWVudFwiXHJcbmNvbnN0IGNsZWFyRmlsYW1lbnRTdGVwcyA9IFsnY2xlYXJfZmlsYW1lbnQnXTtcclxuXHJcbi8vIGFsbCB0aGUgc3RlcHMgdGhhdCBjb25zdGl0dXRlIGEgcHJpbnRlciBcInJlbW92aW5nIGZpbGFtZW50XHJcbi8vIGZvciB6IGNhbGlicmF0aW9uXCJcclxuY29uc3QgekNhbEZpbGFtZW50U3RlcHMgPSBbJ3JlbW92ZV9maWxhbWVudCddO1xyXG5cclxuLy8gYWxsIHRoZSBzdGVwcyB0aGF0IGNvbnN0aXR1dGUgYSBwcmludGVyIGhhdmluZyBhbiBcImVycm9yXCJcclxuY29uc3QgZXJyb3JTdGVwcyA9IFsnZmFpbGVkJywgJ2Vycm9yX3N0ZXAnXTtcclxuXHJcbi8vIGFsbCB0aGUgc3RlcHMgdGhhdCBjb25zdGl0dXRlIGEgcHJpbnRlciBhY3Rpb24gaGF2aW5nIFwiY29tcGxldGVkXCJcclxuY29uc3QgY29tcGxldGVkU3RlcHMgPSBbJ2NvbXBsZXRlZCddO1xyXG5cclxuLyoqXHJcbiAqIFRoaXMgZnVuY3Rpb24gcmV0dXJucyBhIHJlYWxseSB1c2VmdWwgb2JqZWN0LiBCYXNpY2FsbHksIHRoZSBwcmludGVyXHJcbiAqIGRldGFpbHMgcGFuZWwgY2FuIGhhdmUgc28gbWFueSBkaWZmZXJlbnQgc3RhdGVzIGJhc2VkIG9uIHByaW50ZXIgc3RhdGVzXHJcbiAqIHRoYXQgaXQgZ290IGluY3JlZGlibHkgdW53aWVsZHkgdG8gbm90IGhhdmUgYSBjb21tb24gaW50ZXJmYWNlIGZvciBhbGxcclxuICogb2YgaXQuIFNvLCB0aGlzIGZ1bmN0aW9uIHJldHVybnMgYW4gb2JqZWN0IHRoYXQgZGlzdGlsbHMgYSBidW5jaCBvZlxyXG4gKiBwcmludGVyIHN0YXRlcyBpbnRvIGJvb2xlYW5zLCB0byBtYWtlIGl0IGVhc2llciB0byBjaGVjay5cclxuICpcclxuICogQHBhcmFtIHtNYWtlcmJvdFByaW50ZXJ9IHByaW50ZXJcclxuICogQHJldHVybnMge29iamVjdH1cclxuICovXHJcbmNvbnN0IHByaW50ZXJEZXRhaWxzU3RhdHVzID0gKHByaW50ZXIsIG92ZXJyaWRlKSA9PiB7XHJcbiAgICBjb25zdCBtZXRob2RFeGlzdHMgPSBwcmludGVyLnByb2Nlc3NNZXRob2RFeGlzdHMuYmluZChwcmludGVyKTtcclxuICAgIGNvbnN0IHN0YXR1cyA9IHByaW50ZXJTdGF0dXMocHJpbnRlciwgb3ZlcnJpZGUpLmNoZWNrO1xyXG4gICAgY29uc3QgY3VycmVudFByb2Nlc3MgPSBjdXJyZW50UHJpbnRlclByb2Nlc3MocHJpbnRlcikuY2hlY2s7XHJcbiAgICBjb25zdCBzdGVwID0gaXNTdGVwKHByaW50ZXIsIG92ZXJyaWRlKTtcclxuXHJcbiAgICAvLyBXZSBkb24ndCBoYXZlIGFueSBndWFyYW50ZWUgdGhhdCBgY3VycmVudF9wcm9jZXNzYCBoYXMgdGhlIHR5cGVzXHJcbiAgICAvLyB3ZSBleHBlY3QgYmVjYXVzZSBpdCBjb21lcyBmcm9tIGthaXRlbiB3aGljaCBpcyB3cml0dGVuIGluIHB5dGhvblxyXG4gICAgLy8gc28gd2UgaGF2ZSB0byBjb2VyY2Ugc29tZSBvZiB0aGUgcHJvY2VzcyBwcm9wZXJ0aWVzIGludG8gYm9vbGVhbnMsXHJcbiAgICAvLyBuYW1lbHkgYGNhbmNlbGxlZGAgYW5kIGBjYW5jZWxsYWJsZWAuXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIGhhczoge1xyXG4gICAgICAgICAgICBzdGF0ZTogc3RhdHVzKHMgPT4gcy5zdGF0ZSAhPSBudWxsKSxcclxuICAgICAgICAgICAgcHJvY2VzczogY3VycmVudFByb2Nlc3MoKCkgPT4gdHJ1ZSksXHJcbiAgICAgICAgICAgIGV4dHJ1ZGVyOiAhcHJpbnRlci5pc01pc3NpbmdFeHRydWRlcigpLFxyXG4gICAgICAgICAgICBlcnJvcjogISFwcmludGVyLmdldExhc3RFcnJvcigpLFxyXG4gICAgICAgICAgICBhY2tub3dsZWRnYWJsZUVycm9yOiBpc0Fja25vd2xlZGdlYWJsZUVycihwcmludGVyKSxcclxuICAgICAgICAgICAgZHVhbEV4dHJ1ZGVyczogcHJpbnRlci5pc1NpeHRoR2VuKCksXHJcbiAgICAgICAgICAgIGNoYW1iZXI6IHByaW50ZXIuZ2V0Q2hhbWJlckluZm8oKS5sZW5ndGggPiAwLFxyXG4gICAgICAgICAgICBwbGF0Zm9ybTogcHJpbnRlci5nZXRQbGF0Zm9ybUluZm8gJiYgcHJpbnRlci5nZXRQbGF0Zm9ybUluZm8oKS5sZW5ndGggPiAwLFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgaXM6IHtcclxuICAgICAgICAgICAgYXV0aGVudGljYXRlZDogcHJpbnRlci5pc0F1dGhlbnRpY2F0ZWQoKSxcclxuICAgICAgICAgICAgaWRsZTogc3RhdHVzKHMgPT4gcy5zdGF0ZSA9PT0gUHJpbnRlclN0YXRlRW51bS5JZGxlKSxcclxuICAgICAgICAgICAgcGVuZGluZzogc3RhdHVzKHMgPT4gcy5zdGF0ZSA9PT0gUHJpbnRlclN0YXRlRW51bS5QZW5kaW5nKSxcclxuICAgICAgICAgICAgY2FuY2VsbGVkOiBjdXJyZW50UHJvY2VzcyhjcCA9PiAhIWNwLmNhbmNlbGxlZCksXHJcbiAgICAgICAgICAgIG9mZmxpbmU6IHN0YXR1cyhzID0+IHMuc3RhdGUgPT09IFByaW50ZXJTdGF0ZUVudW0uT2ZmbGluZSksXHJcbiAgICAgICAgICAgIHJlY29ubmVjdGluZzogc3RhdHVzKHMgPT4gcy5zdGF0ZSA9PT0gUHJpbnRlclN0YXRlRW51bS5SZWNvbm5lY3RpbmcpLFxyXG4gICAgICAgICAgICByZWF1dGhlbnRpY2F0aW5nOiBzdGF0dXMocyA9PiBzLnN0YXRlID09PSBQcmludGVyU3RhdGVFbnVtLlJlYXV0aGVudGljYXRpbmcpLFxyXG4gICAgICAgICAgICBhdXRoZW50aWNhdGluZzogc3RhdHVzKHMgPT4gcy5zdGF0ZSA9PT0gUHJpbnRlclN0YXRlRW51bS5BdXRoZW50aWNhdGluZyksXHJcbiAgICAgICAgICAgIHVuYXV0aGVudGljYXRlZDogc3RhdHVzKHMgPT4gcy5zdGF0ZSA9PT0gUHJpbnRlclN0YXRlRW51bS5VbmF1dGhlbnRpY2F0ZWQpLFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgY2FuOiB7XHJcbiAgICAgICAgICAgIHN1c3BlbmQ6IG1ldGhvZEV4aXN0cygnc3VzcGVuZCcpLFxyXG4gICAgICAgICAgICBhY2tub3dsZWRnZUVycm9yOiBtZXRob2RFeGlzdHMoJ2Fja25vd2xlZGdlX2Vycm9yJyksXHJcbiAgICAgICAgICAgIGFja25vd2xlZGdlRmFpbHVyZTogbWV0aG9kRXhpc3RzKCdhY2tub3dsZWRnZV9mYWlsdXJlJyksXHJcbiAgICAgICAgICAgIGFja25vd2xlZGdlU3VjY2VzczogbWV0aG9kRXhpc3RzKCdhY2tub3dsZWRnZV9zdWNjZXNzJyksXHJcbiAgICAgICAgICAgIHN0b3BGaWxhbWVudDogbWV0aG9kRXhpc3RzKCdzdG9wX2ZpbGFtZW50JyksXHJcbiAgICAgICAgICAgIHByaW50QWdhaW46IGN1cnJlbnRQcm9jZXNzKGNwID0+ICEhY3AuY2FuX3ByaW50X2FnYWluKSxcclxuICAgICAgICAgICAgcmVzdW1lOiBtZXRob2RFeGlzdHMoJ3Jlc3VtZScpLFxyXG4gICAgICAgICAgICBsb2FkRmlsYW1lbnQ6IG1ldGhvZEV4aXN0cygnbG9hZF9maWxhbWVudCcpLFxyXG4gICAgICAgICAgICB1bmxvYWRGaWxhbWVudDogbWV0aG9kRXhpc3RzKCd1bmxvYWRfZmlsYW1lbnQnKSxcclxuICAgICAgICAgICAgY2FuY2VsOlxyXG4gICAgICAgICAgICAgICAgc3RhdHVzKHMgPT4gcy5zdGF0ZSAhPT0gUHJpbnRlclN0YXRlRW51bS5QZW5kaW5nKSAmJlxyXG4gICAgICAgICAgICAgICAgY3VycmVudFByb2Nlc3MoY3AgPT4gISFjcC5jYW5jZWxsYWJsZSAmJiAhY3AuY2FuY2VsbGVkKSxcclxuICAgICAgICB9LFxyXG4gICAgICAgIHN0ZXA6IHtcclxuICAgICAgICAgICAgZmFpbGVkOiBjdXJyZW50UHJvY2VzcyhjcCA9PiBjcC5zdGVwID09PSAnZmFpbGVkJyksXHJcbiAgICAgICAgICAgIGJ1c3k6IHN0ZXAoYnVzeVN0ZXBzKSxcclxuICAgICAgICAgICAgdHJhbnNmZXJyaW5nOiBzdGVwKHRyYW5zZmVyU3RlcHMpLFxyXG4gICAgICAgICAgICB1cGRhdGluZ0Zpcm13YXJlOiBzdGVwKHVwZGF0ZUZpcm13YXJlU3RlcHMpLFxyXG4gICAgICAgICAgICBwcmludGluZzogc3RlcChwcmludGluZ1N0ZXBzKSxcclxuICAgICAgICAgICAgcGF1c2VkOiBzdGVwKHBhdXNlZFN0ZXBzKSxcclxuICAgICAgICAgICAgc3VzcGVuZGluZzogY3VycmVudFByb2Nlc3MoY3AgPT4gY3Auc3RlcCA9PT0gJ3N1c3BlbmRpbmcnKSxcclxuICAgICAgICAgICAgc3RhcnRQcmludDogc3RlcChzdGFydFByaW50U3RlcHMpLFxyXG4gICAgICAgICAgICBjbGVhckZpbGFtZW50OiBzdGVwKGNsZWFyRmlsYW1lbnRTdGVwcyksXHJcbiAgICAgICAgICAgIHVubG9hZGluZ0ZpbGFtZW50OiBzdGVwKHVubG9hZGluZ1N0ZXBzKSxcclxuICAgICAgICAgICAgekNhbEZpbGFtZW50OiBzdGVwKHpDYWxGaWxhbWVudFN0ZXBzKSxcclxuICAgICAgICAgICAgZXJyb3I6IHN0ZXAoZXJyb3JTdGVwcyksXHJcbiAgICAgICAgICAgIGNvbXBsZXRlZDogc3RlcChjb21wbGV0ZWRTdGVwcyksXHJcbiAgICAgICAgICAgIHdpZmlTZXRVcDogY3VycmVudFByb2Nlc3MoY3AgPT4gY3AubmFtZSA9PT0gJ1dpZmlTZXR1cFByb2Nlc3MnKSxcclxuICAgICAgICAgICAgcmVjb25uZWN0aW5nOiBjdXJyZW50UHJvY2VzcyhjcCA9PiBjcC5zdGVwID09PSAncmVjb25uZWN0aW5nJyksXHJcbiAgICAgICAgfSxcclxuICAgIH07XHJcbn07XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IHtcclxuICAgIGdldFByaW50ZXJTdG9yZSxcclxuICAgIGdldFByaW50ZXIsXHJcbiAgICBnZXRTZWxlY3RlZFByaW50ZXIsXHJcbiAgICBwcmludGVyU3RhdHVzLFxyXG4gICAgY3VycmVudFByaW50ZXJQcm9jZXNzLFxyXG4gICAgcHJpbnRlckRldGFpbHNTdGF0dXMsXHJcbn07XHJcbiJdfQ==
