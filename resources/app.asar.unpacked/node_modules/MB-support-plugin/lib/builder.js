'use strict';

const Q = require('q');

const _ = require('lodash');

const BuildProvider = require('eagle-print/services/providers/buildProvider');

const EaglePrint = require('eagle-print');

const makerbot = require('./makerbot');

const Task = EaglePrint.scheduler.Task;

class MakerbotBuildProvider extends BuildProvider {
  constructor() {
    super();
  }

  accept(buildTray) {
    const printer = buildTray.printer;
    return printer && printer.getInfo().vendor.toLowerCase() === 'makerbot';
  } /// Describe the options for the snapshots that the builder bundles
  /// into the dot makerbot files.


  snapshotOptions(printer) {
    /**
     * Standard thumbnails settings to be used on Teams & PrintFromWeb
     * for 5th and 6th Gen printers (PEN-2160)
     */
    const stdThumbnail = {
      isometricSmall: {
        dpi: 1,
        width: 120,
        height: 120,
        projection: 'orthographic',
        camera: {
          angleAndFitToModels: true,
          position: {
            x: -1,
            y: -1,
            z: 1
          },
          up: {
            x: 0,
            y: 0,
            z: 1
          }
        },
        backgroundColor: 0xf2f2f2,
        backgroundOpacity: 0,
        boundingBoxCentered: true,
        objectsToHide: ['tray~node']
      },
      isometricMedium: {
        dpi: 1,
        width: 320,
        height: 320,
        projection: 'orthographic',
        camera: {
          angleAndFitToModels: true,
          position: {
            x: -1,
            y: -1,
            z: 1
          },
          up: {
            x: 0,
            y: 0,
            z: 1
          }
        },
        backgroundColor: 0xf2f2f2,
        backgroundOpacity: 0,
        boundingBoxCentered: true,
        objectsToHide: ['tray~node']
      },
      isometricLarge: {
        dpi: 1,
        width: 640,
        height: 640,
        projection: 'orthographic',
        camera: {
          position: {
            x: -1,
            y: -1,
            z: 1
          },
          up: {
            x: 0,
            y: 0,
            z: 1
          }
        },
        backgroundColor: 0xf2f2f2,
        backgroundOpacity: 0,
        boundingBoxCentered: true,
        objectsToHide: ['grid', 'border', 'innerBorder', 'outerBorder', 'floor', 'floorBottom', 'purgeTower']
      }
    };

    if (printer.isSixthGen()) {
      //Sombrero-style thumbnails
      return Object.assign({}, {
        large: {
          dpi: 1,
          width: 960,
          height: 1460,
          projection: 'orthographic',
          camera: {
            position: {
              x: -1,
              y: -1,
              z: 1
            },
            up: {
              x: 0,
              y: 0,
              z: 1
            }
          },
          backgroundColor: 0x000000,
          boundingBoxCentered: true,
          objectsToHide: ['grid', 'border', 'innerBorder', 'outerBorder', 'floor', 'purgeTower']
        },
        medium: {
          dpi: 1,
          width: 212,
          height: 300,
          projection: 'orthographic',
          camera: {
            position: {
              x: -1,
              y: -1,
              z: 1
            },
            up: {
              x: 0,
              y: 0,
              z: 1
            }
          },
          backgroundColor: 0x000000,
          boundingBoxCentered: true,
          objectsToHide: ['grid', 'border', 'innerBorder', 'outerBorder', 'floor', 'purgeTower']
        },
        small: {
          dpi: 1,
          width: 140,
          height: 106,
          projection: 'orthographic',
          camera: {
            angleAndFitToModels: true,
            position: {
              x: -1,
              y: -1,
              z: 1
            },
            up: {
              x: 0,
              y: 0,
              z: 1
            }
          },
          backgroundColor: 0x000000,
          boundingBoxCentered: true,
          objectsToHide: ['tray~node']
        }
      }, stdThumbnail);
    } else if (printer.isSketchPrinter()) {
      return Object.assign({}, {
        small: {
          dpi: 1,
          width: 90,
          height: 90,
          projection: 'orthographic',
          camera: {
            angleAndFitToModels: true,
            position: {
              x: -1,
              y: -1,
              z: 1
            },
            up: {
              x: 0,
              y: 0,
              z: 1
            }
          },
          backgroundColor: 0x000000,
          backgroundOpacity: 0,
          boundingBoxCentered: true,
          objectsToHide: ['tray~node', 'grid', 'border', 'innerBorder', 'outerBorder', 'floor', 'purgeTower']
        }
      }, stdThumbnail);
    } else {
      //Birdwing-style thumbnails
      return Object.assign({}, {
        large: {
          dpi: 1,
          width: 320,
          height: 200,
          projection: 'isometric',
          camera: {
            fitToModels: true
          },
          objectsToHide: []
        },
        medium: {
          dpi: 1,
          width: 110,
          height: 80,
          projection: 'isometric',
          camera: {
            fitToModels: true
          },
          objectsToHide: []
        },
        small: {
          dpi: 1,
          width: 54,
          height: 40,
          projection: 'isometric',
          camera: {
            fitToModels: true
          },
          objectsToHide: []
        }
      }, stdThumbnail);
    }
  }

  preparePrint(buildTray, flux) {
    const self = this;
    return new Task(function (done, progress, cancelToken) {
      self.getBuiltFile(buildTray, progress, cancelToken, done, flux);
    });
  }

  getBuiltFile(buildTray, progressCallback, cancelToken, callback, flux) {
    const {
      options
    } = buildTray;
    return makerbot.build(buildTray, options ? options : null, progressCallback, cancelToken, null, flux).nodeify(callback);
  } // @return {String} extension of toolpath file generated by build()
  // Always return makerbot even for 4th Gen bots since a .makerbot is
  // required to visualize the toolpath.


  getBuildFileType(printer) {
    return 'makerbot';
  }

  runHealthCheck(callback) {
    return new Q({}).nodeify(callback);
  }

}

module.exports = MakerbotBuildProvider;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImJ1aWxkZXIuanMiXSwibmFtZXMiOlsiUSIsInJlcXVpcmUiLCJfIiwiQnVpbGRQcm92aWRlciIsIkVhZ2xlUHJpbnQiLCJtYWtlcmJvdCIsIlRhc2siLCJzY2hlZHVsZXIiLCJNYWtlcmJvdEJ1aWxkUHJvdmlkZXIiLCJjb25zdHJ1Y3RvciIsImFjY2VwdCIsImJ1aWxkVHJheSIsInByaW50ZXIiLCJnZXRJbmZvIiwidmVuZG9yIiwidG9Mb3dlckNhc2UiLCJzbmFwc2hvdE9wdGlvbnMiLCJzdGRUaHVtYm5haWwiLCJpc29tZXRyaWNTbWFsbCIsImRwaSIsIndpZHRoIiwiaGVpZ2h0IiwicHJvamVjdGlvbiIsImNhbWVyYSIsImFuZ2xlQW5kRml0VG9Nb2RlbHMiLCJwb3NpdGlvbiIsIngiLCJ5IiwieiIsInVwIiwiYmFja2dyb3VuZENvbG9yIiwiYmFja2dyb3VuZE9wYWNpdHkiLCJib3VuZGluZ0JveENlbnRlcmVkIiwib2JqZWN0c1RvSGlkZSIsImlzb21ldHJpY01lZGl1bSIsImlzb21ldHJpY0xhcmdlIiwiaXNTaXh0aEdlbiIsIk9iamVjdCIsImFzc2lnbiIsImxhcmdlIiwibWVkaXVtIiwic21hbGwiLCJpc1NrZXRjaFByaW50ZXIiLCJmaXRUb01vZGVscyIsInByZXBhcmVQcmludCIsImZsdXgiLCJzZWxmIiwiZG9uZSIsInByb2dyZXNzIiwiY2FuY2VsVG9rZW4iLCJnZXRCdWlsdEZpbGUiLCJwcm9ncmVzc0NhbGxiYWNrIiwiY2FsbGJhY2siLCJvcHRpb25zIiwiYnVpbGQiLCJub2RlaWZ5IiwiZ2V0QnVpbGRGaWxlVHlwZSIsInJ1bkhlYWx0aENoZWNrIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUEsTUFBTUEsQ0FBQyxHQUFHQyxPQUFPLENBQUMsR0FBRCxDQUFqQjs7QUFDQSxNQUFNQyxDQUFDLEdBQUdELE9BQU8sQ0FBQyxRQUFELENBQWpCOztBQUNBLE1BQU1FLGFBQWEsR0FBR0YsT0FBTyxDQUFDLDhD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QjtBQUMxQixVQUFNQyxJQUFJLEdBQUcsSUFBYjtBQUNBLFdBQU8sSUFBSXhDLElBQUosQ0FBUyxVQUFTeUMsSUFBVCxFQUFlQyxRQUFmLEVBQXlCQyxXQUF6QixFQUFzQztBQUNsREgsTUFBQUEsSUFBSSxDQUFDSSxZQUFMLENBQWtCdkMsU0FBbEIsRUFBNkJxQyxRQUE3QixFQUF1Q0MsV0FBdkMsRUFBb0RGLElBQXBELEVBQTBERixJQUExRDtBQUNILEtBRk0sQ0FBUDtBQUdIOztBQUVESyxFQUFBQSxZQUFZLENBQUN2QyxTQUFELEVBQVl3QyxnQkFBWixFQUE4QkYsV0FBOUIsRUFBMkNHLFFBQTNDLEVBQXFEUCxJQUFyRCxFQUEyRDtBQUNuRSxVQUFNO0FBQUVRLE1BQUFBO0FBQUYsUUFBYzFDLFNBQXBCO0FBQ0EsV0FBT04sUUFBUSxDQUNWaUQsS0FERSxDQUNJM0MsU0FESixFQUNlMEMsT0FBTyxHQUFHQSxPQUFILEdBQWEsSUFEbkMsRUFDeUNGLGdCQUR6QyxFQUMyREYsV0FEM0QsRUFDd0UsSUFEeEUsRUFDOEVKLElBRDlFLEVBRUZVLE9BRkUsQ0FFTUgsUUFGTixDQUFQO0FBR0gsR0E3TDZDLENBK0w5QztBQUNBO0FBQ0E7OztBQUNBSSxFQUFBQSxnQkFBZ0IsQ0FBQzVDLE9BQUQsRUFBVTtBQUN0QixXQUFPLFVBQVA7QUFDSDs7QUFFRDZDLEVBQUFBLGNBQWMsQ0FBQ0wsUUFBRCxFQUFXO0FBQ3JCLFdBQU8sSUFBSXBELENBQUosQ0FBTSxFQUFOLEVBQVV1RCxPQUFWLENBQWtCSCxRQUFsQixDQUFQO0FBQ0g7O0FBeE02Qzs7QUEyTWxETSxNQUFNLENBQUNDLE9BQVAsR0FBaUJuRCxxQkFBakIiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XHJcblxyXG5jb25zdCBRID0gcmVxdWlyZSgncScpO1xyXG5jb25zdCBfID0gcmVxdWlyZSgnbG9kYXNoJyk7XHJcbmNvbnN0IEJ1aWxkUHJvdmlkZXIgPSByZXF1aXJlKCdlYWdsZS1wcmludC9zZXJ2aWNlcy9wcm92aWRlcnMvYnVpbGRQcm92aWRlcicpO1xyXG5jb25zdCBFYWdsZVByaW50ID0gcmVxdWlyZSgnZWFnbGUtcHJpbnQnKTtcclxuXHJcbmNvbnN0IG1ha2VyYm90ID0gcmVxdWlyZSgnLi9tYWtlcmJvdCcpO1xyXG5jb25zdCBUYXNrID0gRWFnbGVQcmludC5zY2hlZHVsZXIuVGFzaztcclxuXHJcbmNsYXNzIE1ha2VyYm90QnVpbGRQcm92aWRlciBleHRlbmRzIEJ1aWxkUHJvdmlkZXIge1xyXG4gICAgY29uc3RydWN0b3IoKSB7XHJcbiAgICAgICAgc3VwZXIoKTtcclxuICAgIH1cclxuXHJcbiAgICBhY2NlcHQoYnVpbGRUcmF5KSB7XHJcbiAgICAgICAgY29uc3QgcHJpbnRlciA9IGJ1aWxkVHJheS5wcmludGVyO1xyXG4gICAgICAgIHJldHVybiBwcmludGVyICYmIHByaW50ZXIuZ2V0SW5mbygpLnZlbmRvci50b0xvd2VyQ2FzZSgpID09PSAnbWFrZXJib3QnO1xyXG4gICAgfVxyXG5cclxuICAgIC8vLyBEZXNjcmliZSB0aGUgb3B0aW9ucyBmb3IgdGhlIHNuYXBzaG90cyB0aGF0IHRoZSBidWlsZGVyIGJ1bmRsZXNcclxuICAgIC8vLyBpbnRvIHRoZSBkb3QgbWFrZXJib3QgZmlsZXMuXHJcbiAgICBzbmFwc2hvdE9wdGlvbnMocHJpbnRlcikge1xyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIFN0YW5kYXJkIHRodW1ibmFpbHMgc2V0dGluZ3MgdG8gYmUgdXNlZCBvbiBUZWFtcyAmIFByaW50RnJvbVdlYlxyXG4gICAgICAgICAqIGZvciA1dGggYW5kIDZ0aCBHZW4gcHJpbnRlcnMgKFBFTi0yMTYwKVxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIGNvbnN0IHN0ZFRodW1ibmFpbCA9IHtcclxuICAgICAgICAgICAgaXNvbWV0cmljU21hbGw6IHtcclxuICAgICAgICAgICAgICAgIGRwaTogMSxcclxuICAgICAgICAgICAgICAgIHdpZHRoOiAxMjAsXHJcbiAgICAgICAgICAgICAgICBoZWlnaHQ6IDEyMCxcclxuICAgICAgICAgICAgICAgIHByb2plY3Rpb246ICdvcnRob2dyYXBoaWMnLFxyXG4gICAgICAgICAgICAgICAgY2FtZXJhOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgYW5nbGVBbmRGaXRUb01vZGVsczogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogeyB4OiAtMSwgeTogLTEsIHo6IDEgfSxcclxuICAgICAgICAgICAgICAgICAgICB1cDogeyB4OiAwLCB5OiAwLCB6OiAxIH0sXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiAweGYyZjJmMixcclxuICAgICAgICAgICAgICAgIGJhY2tncm91bmRPcGFjaXR5OiAwLFxyXG4gICAgICAgICAgICAgICAgYm91bmRpbmdCb3hDZW50ZXJlZDogdHJ1ZSxcclxuICAgICAgICAgICAgICAgIG9iamVjdHNUb0hpZGU6IFsndHJheX5ub2RlJ10sXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGlzb21ldHJpY01lZGl1bToge1xyXG4gICAgICAgICAgICAgICAgZHBpOiAxLFxyXG4gICAgICAgICAgICAgICAgd2lkdGg6IDMyMCxcclxuICAgICAgICAgICAgICAgIGhlaWdodDogMzIwLFxyXG4gICAgICAgICAgICAgICAgcHJvamVjdGlvbjogJ29ydGhvZ3JhcGhpYycsXHJcbiAgICAgICAgICAgICAgICBjYW1lcmE6IHtcclxuICAgICAgICAgICAgICAgICAgICBhbmdsZUFuZEZpdFRvTW9kZWxzOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiB7IHg6IC0xLCB5OiAtMSwgejogMSB9LFxyXG4gICAgICAgICAgICAgICAgICAgIHVwOiB7IHg6IDAsIHk6IDAsIHo6IDEgfSxcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6IDB4ZjJmMmYyLFxyXG4gICAgICAgICAgICAgICAgYmFja2dyb3VuZE9wYWNpdHk6IDAsXHJcbiAgICAgICAgICAgICAgICBib3VuZGluZ0JveENlbnRlcmVkOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgb2JqZWN0c1RvSGlkZTogWyd0cmF5fm5vZGUnXSxcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgaXNvbWV0cmljTGFyZ2U6IHtcclxuICAgICAgICAgICAgICAgIGRwaTogMSxcclxuICAgICAgICAgICAgICAgIHdpZHRoOiA2NDAsXHJcbiAgICAgICAgICAgICAgICBoZWlnaHQ6IDY0MCxcclxuICAgICAgICAgICAgICAgIHByb2plY3Rpb246ICdvcnRob2dyYXBoaWMnLFxyXG4gICAgICAgICAgICAgICAgY2FtZXJhOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246IHsgeDogLTEsIHk6IC0xLCB6OiAxIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgdXA6IHsgeDogMCwgeTogMCwgejogMSB9LFxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogMHhmMmYyZjIsXHJcbiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kT3BhY2l0eTogMCxcclxuICAgICAgICAgICAgICAgIGJvdW5kaW5nQm94Q2VudGVyZWQ6IHRydWUsXHJcbiAgICAgICAgICAgICAgICBvYmplY3RzVG9IaWRlOiBbJ2dyaWQnLCAnYm9yZGVyJywgJ2lubmVyQm9yZGVyJywgJ291dGVyQm9yZGVyJywgJ2Zsb29yJywgJ2Zsb29yQm90dG9tJywgJ3B1cmdlVG93ZXInXSxcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBpZiAocHJpbnRlci5pc1NpeHRoR2VuKCkpIHtcclxuICAgICAgICAgICAgLy9Tb21icmVyby1zdHlsZSB0aHVtYm5haWxzXHJcbiAgICAgICAgICAgIHJldHVybiBPYmplY3QuYXNzaWduKFxyXG4gICAgICAgICAgICAgICAge30sXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgbGFyZ2U6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZHBpOiAxLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogOTYwLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IDE0NjAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHByb2plY3Rpb246ICdvcnRob2dyYXBoaWMnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYW1lcmE6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiB7IHg6IC0xLCB5OiAtMSwgejogMSB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdXA6IHsgeDogMCwgeTogMCwgejogMSB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6IDB4MDAwMDAwLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBib3VuZGluZ0JveENlbnRlcmVkOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmplY3RzVG9IaWRlOiBbJ2dyaWQnLCAnYm9yZGVyJywgJ2lubmVyQm9yZGVyJywgJ291dGVyQm9yZGVyJywgJ2Zsb29yJywgJ3B1cmdlVG93ZXInXSxcclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgIG1lZGl1bToge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkcGk6IDEsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiAyMTIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogMzAwLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBwcm9qZWN0aW9uOiAnb3J0aG9ncmFwaGljJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FtZXJhOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogeyB4OiAtMSwgeTogLTEsIHo6IDEgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVwOiB7IHg6IDAsIHk6IDAsIHo6IDEgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiAweDAwMDAwMCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgYm91bmRpbmdCb3hDZW50ZXJlZDogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgb2JqZWN0c1RvSGlkZTogWydncmlkJywgJ2JvcmRlcicsICdpbm5lckJvcmRlcicsICdvdXRlckJvcmRlcicsICdmbG9vcicsICdwdXJnZVRvd2VyJ10sXHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICBzbWFsbDoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkcGk6IDEsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiAxNDAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogMTA2LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBwcm9qZWN0aW9uOiAnb3J0aG9ncmFwaGljJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FtZXJhOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbmdsZUFuZEZpdFRvTW9kZWxzOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246IHsgeDogLTEsIHk6IC0xLCB6OiAxIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cDogeyB4OiAwLCB5OiAwLCB6OiAxIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogMHgwMDAwMDAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJvdW5kaW5nQm94Q2VudGVyZWQ6IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iamVjdHNUb0hpZGU6IFsndHJheX5ub2RlJ10sXHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBzdGRUaHVtYm5haWxcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICB9IGVsc2UgaWYgKHByaW50ZXIuaXNTa2V0Y2hQcmludGVyKCkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIE9iamVjdC5hc3NpZ24oXHJcbiAgICAgICAgICAgICAgICB7fSxcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBzbWFsbDoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkcGk6IDEsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiA5MCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiA5MCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgcHJvamVjdGlvbjogJ29ydGhvZ3JhcGhpYycsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhbWVyYToge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYW5nbGVBbmRGaXRUb01vZGVsczogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiB7IHg6IC0xLCB5OiAtMSwgejogMSB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdXA6IHsgeDogMCwgeTogMCwgejogMSB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6IDB4MDAwMDAwLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kT3BhY2l0eTogMCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgYm91bmRpbmdCb3hDZW50ZXJlZDogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgb2JqZWN0c1RvSGlkZTogW1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3RyYXl+bm9kZScsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZ3JpZCcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnYm9yZGVyJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICdpbm5lckJvcmRlcicsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnb3V0ZXJCb3JkZXInLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2Zsb29yJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICdwdXJnZVRvd2VyJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgXSxcclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIHN0ZFRodW1ibmFpbFxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIC8vQmlyZHdpbmctc3R5bGUgdGh1bWJuYWlsc1xyXG4gICAgICAgICAgICByZXR1cm4gT2JqZWN0LmFzc2lnbihcclxuICAgICAgICAgICAgICAgIHt9LFxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIGxhcmdlOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRwaTogMSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IDMyMCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiAyMDAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHByb2plY3Rpb246ICdpc29tZXRyaWMnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYW1lcmE6IHsgZml0VG9Nb2RlbHM6IHRydWUgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgb2JqZWN0c1RvSGlkZTogW10sXHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICBtZWRpdW06IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZHBpOiAxLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogMTEwLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IDgwLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBwcm9qZWN0aW9uOiAnaXNvbWV0cmljJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FtZXJhOiB7IGZpdFRvTW9kZWxzOiB0cnVlIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iamVjdHNUb0hpZGU6IFtdLFxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgc21hbGw6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZHBpOiAxLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogNTQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogNDAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHByb2plY3Rpb246ICdpc29tZXRyaWMnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYW1lcmE6IHsgZml0VG9Nb2RlbHM6IHRydWUgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgb2JqZWN0c1RvSGlkZTogW10sXHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBzdGRUaHVtYm5haWxcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJlcGFyZVByaW50KGJ1aWxkVHJheSwgZmx1eCkge1xyXG4gICAgICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xyXG4gICAgICAgIHJldHVybiBuZXcgVGFzayhmdW5jdGlvbihkb25lLCBwcm9ncmVzcywgY2FuY2VsVG9rZW4pIHtcclxuICAgICAgICAgICAgc2VsZi5nZXRCdWlsdEZpbGUoYnVpbGRUcmF5LCBwcm9ncmVzcywgY2FuY2VsVG9rZW4sIGRvbmUsIGZsdXgpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGdldEJ1aWx0RmlsZShidWlsZFRyYXksIHByb2dyZXNzQ2FsbGJhY2ssIGNhbmNlbFRva2VuLCBjYWxsYmFjaywgZmx1eCkge1xyXG4gICAgICAgIGNvbnN0IHsgb3B0aW9ucyB9ID0gYnVpbGRUcmF5O1xyXG4gICAgICAgIHJldHVybiBtYWtlcmJvdFxyXG4gICAgICAgICAgICAuYnVpbGQoYnVpbGRUcmF5LCBvcHRpb25zID8gb3B0aW9ucyA6IG51bGwsIHByb2dyZXNzQ2FsbGJhY2ssIGNhbmNlbFRva2VuLCBudWxsLCBmbHV4KVxyXG4gICAgICAgICAgICAubm9kZWlmeShjYWxsYmFjayk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gQHJldHVybiB7U3RyaW5nfSBleHRlbnNpb24gb2YgdG9vbHBhdGggZmlsZSBnZW5lcmF0ZWQgYnkgYnVpbGQoKVxyXG4gICAgLy8gQWx3YXlzIHJldHVybiBtYWtlcmJvdCBldmVuIGZvciA0dGggR2VuIGJvdHMgc2luY2UgYSAubWFrZXJib3QgaXNcclxuICAgIC8vIHJlcXVpcmVkIHRvIHZpc3VhbGl6ZSB0aGUgdG9vbHBhdGguXHJcbiAgICBnZXRCdWlsZEZpbGVUeXBlKHByaW50ZXIpIHtcclxuICAgICAgICByZXR1cm4gJ21ha2VyYm90JztcclxuICAgIH1cclxuXHJcbiAgICBydW5IZWFsdGhDaGVjayhjYWxsYmFjaykge1xyXG4gICAgICAgIHJldHVybiBuZXcgUSh7fSkubm9kZWlmeShjYWxsYmFjayk7XHJcbiAgICB9XHJcbn1cclxuXHJcbm1vZHVsZS5leHBvcnRzID0gTWFrZXJib3RCdWlsZFByb3ZpZGVyO1xyXG4iXX0=
