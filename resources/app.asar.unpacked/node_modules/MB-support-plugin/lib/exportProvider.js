'use strict';

const ExportProvider = require('eagle-print/services/providers/exportProvider');

const q = require('q');

const fs = require('fs-extra');

class MakerbotExportProvider extends ExportProvider {
  constructor() {
    super();
  }

  accept(vendor) {
    return vendor.toLowerCase() === 'makerbot';
  }

  exportToFile(exportData) {
    const toolpath = exportData.currentToolpath;
    const sourceFile = toolpath.getPath();
    const destinationFile = exportData.destinationFile;
    return q.Promise(function (resolve, reject) {
      if (!toolpath || !toolpath.getPath()) {
        return reject(new Error('Cannot export invalid toolpath'));
      }

      if (sourceFile === destinationFile) {
        return reject(new Error('Can not export a toolpath that is currently open'));
      }

      fs.copy(sourceFile, destinationFile, function (error) {
        if (error) {
          return reject(error);
        }

        return resolve({
          sourceToolpathFile: sourceFile,
          destinationToolpathFile: destinationFile
        });
      });
    });
  }

  getSupportedFormats(printer) {
    return {
      name: 'Makerbot',
      extensions: ['makerbot']
    };
  }

}

module.exports = MakerbotExportProvider;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImV4cG9ydFByb3ZpZGVyLmpzIl0sIm5hbWVzIjpbIkV4cG9ydFByb3ZpZGVyIiwicmVxdWlyZSIsInEiLCJmcyIsIk1ha2VyYm90RXhwb3J0UHJvdmlkZXIiLCJjb25zdHJ1Y3RvciIsImFjY2VwdCIsInZlbmRvciIsInRvTG93ZXJDYXNlIiwiZXhwb3J0VG9GaWxlIiwiZXhwb3J0RGF0YSIsInRvb2xwYXRoIiwiY3VycmVudFRvb2xwYXRoIiwic291cmNlRmlsZSIsImdldFBhdGgiLCJkZXN0aW5hdGlvbkZpbGUiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsIkVycm9yIiwiY29weSIsImVycm9yIiwic291cmNlVG9vbHBhdGhGaWxlIiwiZGVzdGluYXRpb25Ub29scGF0aEZpbGUiLCJnZXRTdXBwb3J0ZWRGb3JtYXRzIiwicHJpbnRlciIsIm5hbWUiLCJleHRlbnNpb25zIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUEsTUFBTUEsY0FBYyxHQUFHQyxPQUFPLENBQUMsK0NBQUQsQ0FBOUI7O0FBQ0EsTUFBTUMsQ0FBQyxHQUFHRCxPQUFPLENBQUMsR0FBRCxDQUFqQjs7QUFDQSxNQUFNRSxFQUFFLEdBQUdGLE9BQU8sQ0FBQyxVQUFELENBQWxCOztBQUVBLE1BQU1HLHNCQUFOLFNBQXFDSixjQUFyQyxDQUFvRDtBQUNoREssRUFBQUEsV0FBVyxHQUFHO0FBQ1Y7QUFDSDs7QUFFREMsRUFBQUEsTUFBTSxDQUFDQyxNQUFELEVBQVM7QUFDWCxXQUFPQSxNQUFNLENBQUNDLFdBQVAsT0FBeUIsVUFBaEM7QUFDSDs7QUFFREMsRUFBQUEsWUFBWSxDQUFDQyxVQUFELEVBQWE7QUFDckIsVUFBTUMsUUFBUSxHQUFHRCxVQUFVLENBQUNFLGVBQTVCO0FBQ0EsVUFBTUMsVUFBVSxHQUFHRixRQUFRLENBQUNHLE9BQVQsRUFBbkI7QUFFQSxVQUFNQyxlQUFlLEdBQUdMLFVBQVUsQ0FBQ0ssZUFBbkM7QUFDQSxXQUFPYixDQUFDLENBQUNjLE9BQUYsQ0FBVSxVQUFTQyxPQUFULEVBQWtCQyxNQUFsQixFQUEwQjtBQUN2QyxVQUFJLENBQUNQLFFBQUQsSUFBYSxDQUFDQSxRQUFRLENBQUNHLE9BQVQsRUFBbEIsRUFBc0M7QUFDbEMsZUFBT0ksTUFBTSxDQUFDLElBQUlDLEtBQUosQ0FBVSxnQ0FBVixDQUFELENBQWI7QUFDSDs7QUFDRCxVQUFJTixVQUFVLEtBQUtFLGVBQW5CLEVBQW9DO0FBQ2hDLGVBQU9HLE1BQU0sQ0FBQyxJQUFJQyxLQUFKLENBQVUsa0RBQVYsQ0FBRCxDQUFiO0FBQ0g7O0FBQ0RoQixNQUFBQSxFQUFFLENBQUNpQixJQUFILENBQVFQLFVBQVIsRUFBb0JFLGVBQXBCLEVBQXFDLFVBQVNNLEtBQVQsRUFBZ0I7QUFDakQsWUFBSUEsS0FBSixFQUFXO0FBQ1AsaUJBQU9ILE1BQU0sQ0FBQ0csS0FBRCxDQUFiO0FBQ0g7O0FBQ0QsZUFBT0osT0FBTyxDQUFDO0FBQ1hLLFVBQUFBLGtCQUFrQixFQUFFVCxVQURUO0FBRVhVLFVBQUFBLHVCQUF1QixFQUFFUjtBQUZkLFNBQUQsQ0FBZDtBQUlILE9BUkQ7QUFTSCxLQWhCTSxDQUFQO0FBaUJIOztBQUVEUyxFQUFBQSxtQkFBbUIsQ0FBQ0MsT0FBRCxFQUFVO0FBQ3pCLFdBQU87QUFBRUMsTUFBQUEsSUFBSSxFQUFFLFVBQVI7QUFBb0JDLE1BQUFBLFVBQVUsRUFBRSxDQUFDLFVBQUQ7QUFBaEMsS0FBUDtBQUNIOztBQW5DK0M7O0FBc0NwREMsTUFBTSxDQUFDQyxPQUFQLEdBQWlCekIsc0JBQWpCIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xyXG5cclxuY29uc3QgRXhwb3J0UHJvdmlkZXIgPSByZXF1aXJlKCdlYWdsZS1wcmludC9zZXJ2aWNlcy9wcm92aWRlcnMvZXhwb3J0UHJvdmlkZXInKTtcclxuY29uc3QgcSA9IHJlcXVpcmUoJ3EnKTtcclxuY29uc3QgZnMgPSByZXF1aXJlKCdmcy1leHRyYScpO1xyXG5cclxuY2xhc3MgTWFrZXJib3RFeHBvcnRQcm92aWRlciBleHRlbmRzIEV4cG9ydFByb3ZpZGVyIHtcclxuICAgIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgICAgIHN1cGVyKCk7XHJcbiAgICB9XHJcblxyXG4gICAgYWNjZXB0KHZlbmRvcikge1xyXG4gICAgICAgIHJldHVybiB2ZW5kb3IudG9Mb3dlckNhc2UoKSA9PT0gJ21ha2VyYm90JztcclxuICAgIH1cclxuXHJcbiAgICBleHBvcnRUb0ZpbGUoZXhwb3J0RGF0YSkge1xyXG4gICAgICAgIGNvbnN0IHRvb2xwYXRoID0gZXhwb3J0RGF0YS5jdXJyZW50VG9vbHBhdGg7XHJcbiAgICAgICAgY29uc3Qgc291cmNlRmlsZSA9IHRvb2xwYXRoLmdldFBhdGgoKTtcclxuXHJcbiAgICAgICAgY29uc3QgZGVzdGluYXRpb25GaWxlID0gZXhwb3J0RGF0YS5kZXN0aW5hdGlvbkZpbGU7XHJcbiAgICAgICAgcmV0dXJuIHEuUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgaWYgKCF0b29scGF0aCB8fCAhdG9vbHBhdGguZ2V0UGF0aCgpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVqZWN0KG5ldyBFcnJvcignQ2Fubm90IGV4cG9ydCBpbnZhbGlkIHRvb2xwYXRoJykpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChzb3VyY2VGaWxlID09PSBkZXN0aW5hdGlvbkZpbGUpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiByZWplY3QobmV3IEVycm9yKCdDYW4gbm90IGV4cG9ydCBhIHRvb2xwYXRoIHRoYXQgaXMgY3VycmVudGx5IG9wZW4nKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZnMuY29weShzb3VyY2VGaWxlLCBkZXN0aW5hdGlvbkZpbGUsIGZ1bmN0aW9uKGVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVqZWN0KGVycm9yKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJldHVybiByZXNvbHZlKHtcclxuICAgICAgICAgICAgICAgICAgICBzb3VyY2VUb29scGF0aEZpbGU6IHNvdXJjZUZpbGUsXHJcbiAgICAgICAgICAgICAgICAgICAgZGVzdGluYXRpb25Ub29scGF0aEZpbGU6IGRlc3RpbmF0aW9uRmlsZSxcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBnZXRTdXBwb3J0ZWRGb3JtYXRzKHByaW50ZXIpIHtcclxuICAgICAgICByZXR1cm4geyBuYW1lOiAnTWFrZXJib3QnLCBleHRlbnNpb25zOiBbJ21ha2VyYm90J10gfTtcclxuICAgIH1cclxufVxyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBNYWtlcmJvdEV4cG9ydFByb3ZpZGVyO1xyXG4iXX0=
