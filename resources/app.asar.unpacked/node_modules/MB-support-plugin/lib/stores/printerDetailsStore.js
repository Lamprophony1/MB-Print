/* eslint-disable no-unreachable */
'use strict';

const Fluxxor = require('fluxxor');

const _ = require('lodash');

const Immutable = require('immutable');

const {
  SWIPE_LEFT,
  SWIPE_RIGHT
} = require('eagle-print/views/ui/card_container');

const {
  either
} = require('../utils/maybe');

const {
  Dispatch,
  PanelStates,
  ActionButtons,
  ProgressButtons
} = require('../constants/printerDetails');

const {
  getPrinter,
  printerStatus,
  currentPrinterProcess,
  printerDetailsStatus
} = require('../utils/printerDetails'); // NOTE: Since printers are already stored in PrinterStore, there's no reason
// to be redundant here. Most of the state coming out of the printers is
// stored there. For the most part, we're just handing MB specific events
// and returning formatted data for the UI.


let currentPrinterID = '';
let currentPanel = PanelStates.Details;
let panelSwipeDirection = SWIPE_LEFT; // which action buttons are in a "waiting" (spinner) state

let waitingButtons = Immutable.Map();
const CHANGE = 'change';
module.exports = Fluxxor.createStore({
  actions: {
    [Dispatch.AcknowledgeCompleted]: 'onAcknowledgeCompleted',
    [Dispatch.AcknowledgeError]: 'onAcknowledgeError',
    [Dispatch.AcknowledgeResumeError]: 'onAcknowledgeResumeError',
    [Dispatch.AcknowledgeFailure]: 'onAcknowledgeFailure',
    [Dispatch.AcknowledgeSuccess]: 'onAcknowledgeSuccess',
    [Dispatch.Suspend]: 'onSuspend',
    [Dispatch.Resume]: 'onResume',
    [Dispatch.Cancel]: 'onCancel',
    [Dispatch.StopFilament]: 'onStopFilament',
    [Dispatch.PrintAgain]: 'onPrintAgain',
    [Dispatch.ShowPanelDetails]: 'onShowPanelDetails',
    [Dispatch.ShowPanelFilament]: 'onShowPanelFilament',
    [Dispatch.ShowPanelUtilities]: 'onShowPanelUtilities',
    [Dispatch.System]: 'onSystem',
    [Dispatch.State]: 'onState',
    [Dispatch.Status]: 'onStatus',
    [Dispatch.ButtonWait]: 'onButtonWait',
    [Dispatch.ExtruderChange]: 'onExtruderChange'
  },

  getState(printerID) {
    currentPrinterID = printerID;
    const actions = this.flux.actions.PrinterDetailsActions;
    const printer = getPrinter(this.flux, printerID);
    const pStatus = printerStatus(printer);
    const detailsStatus = printerDetailsStatus(printer);
    const currentProcess = currentPrinterProcess(printer);
    const progressButtons = currentProcess.apply(cp => ProgressButtons(printer.getId()).get(cp.step));
    const extruders = printer.getExtruderInfo(); // if there is a current process, use the i18n from that,
    // otherwise use the state

    const progressText = either(pStatus.apply(labelStatus), currentProcess.apply(labelProcess)).map(extruderDetached(extruders)).lift();

    const waitList = _.flatten(waitingButtons.reduce((acc, v) => acc.concat(v), []));

    const actionButtons = formatButtons(printerID, detailsStatus, actions, waitList);
    return {
      detailsStatus,
      currentProcess,
      currentPanel,
      panelSwipeDirection,
      actionButtons,
      progressText,
      progressButtons
    };
  },

  // take a particular set of buttons out of their waiting state
  _unwaitButton(type) {
    waitingButtons = waitingButtons.set(type, []);
  },

  onAcknowledgeCompleted(payload, type) {
    this._unwaitButton(type);

    return payload.id === currentPrinterID ? this.emit(CHANGE) : null;
  },

  onAcknowledgeError(payload, type) {
    this._unwaitButton(type);

    return payload.id === currentPrinterID ? this.emit(CHANGE) : null;
  },

  onAcknowledgeResumeError(payload, type) {
    this._unwaitButton(type);

    return payload.id === currentPrinterID ? this.emit(CHANGE) : null;
  },

  onAcknowledgeFailure(payload, type) {
    this._unwaitButton(type);

    return payload.id === currentPrinterID ? this.emit(CHANGE) : null;
  },

  onAcknowledgeSuccess(payload, type) {
    this._unwaitButton(type);

    return payload.id === currentPrinterID ? this.emit(CHANGE) : null;
  },

  onSuspend(payload, type) {
    this._unwaitButton(type);

    return payload.id === currentPrinterID ? this.emit(CHANGE) : null;
  },

  onResume(payload, type) {
    this._unwaitButton(type);

    return payload.id === currentPrinterID ? this.emit(CHANGE) : null;
  },

  onCancel(payload, type) {
    this._unwaitButton(type);

    return payload.id === currentPrinterID ? this.emit(CHANGE) : null;
  },

  onStopFilament(payload, type) {
    this._unwaitButton(type);

    return payload.id === currentPrinterID ? this.emit(CHANGE) : null;
  },

  onPrintAgain(payload, type) {
    this._unwaitButton(type);

    return payload.id === currentPrinterID ? this.emit(CHANGE) : null;
  },

  onShowPanelDetails(payload, type) {
    this._unwaitButton(type);

    currentPanel = PanelStates.Details;
    panelSwipeDirection = SWIPE_RIGHT;
    return this.emit(CHANGE);
  },

  onShowPanelFilament(payload, type) {
    this._unwaitButton(type);

    currentPanel = PanelStates.Filament;
    panelSwipeDirection = SWIPE_LEFT;
    return this.emit(CHANGE);
  },

  onShowPanelUtilities(payload, type) {
    this._unwaitButton(type);

    currentPanel = PanelStates.Utilities;
    panelSwipeDirection = SWIPE_LEFT;
    return this.emit(CHANGE);
  },

  onSystem(payload) {
    return payload.id === currentPrinterID ? this.emit(CHANGE) : null;
  },

  onState(payload) {
    return payload.id === currentPrinterID ? this.emit(CHANGE) : null;
  },

  onStatus(payload) {
    return payload.id === currentPrinterID ? this.emit(CHANGE) : null;
  },

  // set a particular button into its "waiting" (spinner) state
  onButtonWait(payload) {
    const waiting = waitingButtons.get(payload.action, []);
    waiting.push(payload.key);
    waitingButtons = waitingButtons.set(payload.action, waiting);
    this.emit(CHANGE);
  },

  onExtruderChange(payload) {
    return payload.id === currentPrinterID ? this.emit(CHANGE) : null;
  },

  onNetworkChange(payload) {
    return payload.id === currentPrinterID ? this.emit(CHANGE) : null;
  }

});

const formatButtons = (printerID, status, actions, waitList) => ActionButtons.map((v, k) => _.merge({}, v, {
  icon: v.icon(status),
  enabled: v.enabled(status),
  shouldShow: v.shouldShow(status),
  onClick: v.onClick(actions, printerID),
  waiting: waitList.includes(k)
})).filter(b => b.shouldShow || b.default) // include defaults for now
.groupBy(b => b.order).map(g => g.size > 1 ? g.filter(b => !b.default) : g) // remove defaults
.flatten().sortBy(b => b.order); // helper to set default values for i18n


const i18nOpts = val => ({
  defaultValue: val
});

const processI18nKey = cp => `mb:printerStatus.${cp.name}.${cp.step.toLowerCase()}`;

const labelProcess = cp => i18n => ({
  label: i18n.t(`${processI18nKey(cp)}.label`, i18nOpts(_.startCase(cp.step))),
  description: i18n.t(`${processI18nKey(cp)}.description`, i18nOpts(''))
});

const stateI18nKey = state => `mb:printerStatus.state.${state.toLowerCase()}`;

const labelStatus = status => (i18n, printer) => {
  // Not the best way to handle this fire_e copy change for auth'ing -- Ray
  const isSixthGen = printer && printer.isSixthGen();
  let i18nStrDescription;

  if (['authenticating', 'confirm'].includes(status.state.toLowerCase()) && isSixthGen) {
    i18nStrDescription = `${stateI18nKey(status.state)}.fire_e` + `.description`;
  } else {
    i18nStrDescription = `${stateI18nKey(status.state)}.description`;
  }

  return {
    label: i18n.t(`${stateI18nKey(status.state)}.label`, i18nOpts(_.startCase(status.state))),
    description: i18n.t(i18nStrDescription, i18nOpts(''))
  };
}; // basically, for the most part, checking status and process is enough
// to get all the possible text states for the panel, except for if
// the extruder has been detached. So, this function will transform
// the progressText in just such an event, otherwise it just passes it
// on through.


const extruderDetached = extruders => progressText => {
  const extrudersPresent = extruders.map(extruder => extruder.tool_present);

  switch (extrudersPresent.length) {
    case 1:
      if (!extrudersPresent[0]) {
        return i18n => ({
          label: i18n.t('mb:errors.extruder_detached.title'),
          description: i18n.t('mb:errors.extruder_detached.message')
        });
      } else {
        return progressText;
      }

      break;

    case 2:
      if (extrudersPresent[0] && extrudersPresent[1]) {
        return progressText;
      } else if (extrudersPresent[0] != extrudersPresent[1]) {
        //logical equivalent to XOR
        const slotMissingExtruder = extrudersPresent[1] ? 1 : 2;
        return i18n => ({
          label: i18n.t('mb:errors.extruder_detached.title'),
          description: i18n.t('mb:errors.extruder_detached.missing_one_message', {
            extruderNumber: slotMissingExtruder
          })
        });
      } else {
        return i18n => ({
          label: i18n.t('mb:errors.extruder_detached.title'),
          description: i18n.t('mb:errors.extruder_detached.missing_both_message')
        });
      }

      break;

    default:
      return progressText;
  }
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInByaW50ZXJEZXRhaWxzU3RvcmUuanMiXSwibmFtZXMiOlsiRmx1eHhvciIsInJlcXVpcmUiLCJfIiwiSW1tdXRhYmxlIiwiU1dJUEVfTEVGVCIsIlNXSVBFX1JJR0hUIiwiZWl0aGVyIiwiRGlzcGF0Y2giLCJQYW5lbFN0YXRlcyIsIkFjdGlvbkJ1dHRvbnMiLCJQcm9ncmVzc0J1dHRvbnMiLCJnZXRQcmludGVyIiwicHJpbnRlclN0YXR1cyIsImN1cnJlbnRQcmludGVyUHJvY2VzcyIsInByaW50ZXJEZXRhaWxzU3RhdHVzIiwiY3VycmVudFByaW50ZXJJRCIsImN1cnJlbnRQYW5lbCIsIkRldGFpbHMiLCJwYW5lbFN3aXBlRGlyZWN0aW9uIiwid2FpdGluZ0J1dHRvbnMiLCJNYXAiLCJDSEFOR0UiLCJtb2R1bGUiLCJleHBvcnRzIiwiY3JlYXRlU3RvcmUiLCJhY3Rpb25zIiwiQWNrbm93bGVkZ2VDb21wbGV0ZWQiLCJBY2tub3dsZWRnZUVycm9yIiwiQWNrbm93bGVkZ2VSZXN1bWVFcnJvciIsIkFja25vd2xlZGdlRmFpbHVyZSIsIkFja25vd2xlZGdlU3VjY2VzcyIsIlN1c3BlbmQiLCJSZXN1bWUiLCJDYW5jZWwiLCJTdG9wRmlsYW1lbnQiLCJQcmludEFnYWluIiwiU2hvd1BhbmVsRGV0YWlscyIsIlNob3dQYW5lbEZpbGFtZW50IiwiU2hvd1BhbmVsVXRpbGl0aWVzIiwiU3lzdGVtIiwiU3RhdGUiLCJTdGF0dXMiLCJCdXR0b25XYWl0IiwiRXh0cnVkZXJDaGFuZ2UiLCJnZXRTdGF0ZSIsInByaW50ZXJJRCIsImZsdXgiLCJQcmludGVyRGV0YWlsc0FjdGlvbnMiLCJwcmludGVyIiwicFN0YXR1cyIsImRldGFpbHNTdGF0dXMiLCJjdXJyZW50UHJvY2VzcyIsInByb2dyZXNzQnV0dG9ucyIsImFwcGx5IiwiY3AiLCJnZXRJZCIsImdldCIsInN0ZXAiLCJleHRydWRlcnMiLCJnZXRFeHRydWRlckluZm8iLCJwcm9ncmVzc1RleHQiLCJsYWJlbFN0YXR1cyIsImxhYmVsUHJvY2VzcyIsIm1hcCIsImV4dHJ1ZGVyRGV0YWNoZWQiLCJsaWZ0Iiwid2FpdExpc3QiLCJmbGF0dGVuIiwicmVkdWNlIiwiYWNjIiwidiIsImNvbmNhdCIsImFjdGlvbkJ1dHRvbnMiLCJmb3JtYXRCdXR0b25zIiwiX3Vud2FpdEJ1dHRvbiIsInR5cGUiLCJzZXQiLCJvbkFja25vd2xlZGdlQ29tcGxldGVkIiwicGF5bG9hZCIsImlkIiwiZW1pdCIsIm9uQWNrbm93bGVkZ2VFcnJvciIsIm9uQWNrbm93bGVkZ2VSZXN1bWVFcnJvciIsIm9uQWNrbm93bGVkZ2VGYWlsdXJlIiwib25BY2tub3dsZWRnZVN1Y2Nlc3MiLCJvblN1c3BlbmQiLCJvblJlc3VtZSIsIm9uQ2FuY2VsIiwib25TdG9wRmlsYW1lbnQiLCJvblByaW50QWdhaW4iLCJvblNob3dQYW5lbERldGFpbHMiLCJvblNob3dQYW5lbEZpbGFtZW50IiwiRmlsYW1lbnQiLCJvblNob3dQYW5lbFV0aWxpdGllcyIsIlV0aWxpdGllcyIsIm9uU3lzdGVtIiwib25TdGF0ZSIsIm9uU3RhdHVzIiwib25CdXR0b25XYWl0Iiwid2FpdGluZyIsImFjdGlvbiIsInB1c2giLCJrZXkiLCJvbkV4dHJ1ZGVyQ2hhbmdlIiwib25OZXR3b3JrQ2hhbmdlIiwic3RhdHVzIiwiayIsIm1lcmdlIiwiaWNvbiIsImVuYWJsZWQiLCJzaG91bGRTaG93Iiwib25DbGljayIsImluY2x1ZGVzIiwiZmlsdGVyIiwiYiIsImRlZmF1bHQiLCJncm91cEJ5Iiwib3JkZXIiLCJnIiwic2l6ZSIsInNvcnRCeSIsImkxOG5PcHRzIiwidmFsIiwiZGVmYXVsdFZhbHVlIiwicHJvY2Vzc0kxOG5LZXkiLCJuYW1lIiwidG9Mb3dlckNhc2UiLCJpMThuIiwibGFiZWwiLCJ0Iiwic3RhcnRDYXNlIiwiZGVzY3JpcHRpb24iLCJzdGF0ZUkxOG5LZXkiLCJzdGF0ZSIsImlzU2l4dGhHZW4iLCJpMThuU3RyRGVzY3JpcHRpb24iLCJleHRydWRlcnNQcmVzZW50IiwiZXh0cnVkZXIiLCJ0b29sX3ByZXNlbnQiLCJsZW5ndGgiLCJzbG90TWlzc2luZ0V4dHJ1ZGVyIiwiZXh0cnVkZXJOdW1iZXIiXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7O0FBRUEsTUFBTUEsT0FBTyxHQUFHQyxPQUFPLENBQUMsU0FBRCxDQUF2Qjs7QUFDQSxNQUFNQyxDQUFDLEdBQUdELE9BQU8sQ0FBQyxRQUFELENBQWpCOztBQUNBLE1BQU1FLFNBQVMsR0FBR0YsT0FBTyxDQUFDLFdBQUQsQ0FBekI7O0FBQ0EsTUFBTTtBQUFFRyxFQUFBQSxVQUFGO0FBQWNDLEVBQUFBO0FBQWQsSUFBOEJKLE9BQU8sQ0FBQyxxQ0FBRCxDQUEzQzs7QUFFQSxNQUFNO0FBQUVLLEVBQUFBO0FBQUYsSUFBYUwsT0FBTyxDQUFDLGdCQUFELENBQTFCOztBQUNBLE1BQU07QUFBRU0sRUFBQUEsUUFBRjtBQUFZQyxFQUFBQSxXQUFaO0FBQXlCQyxFQUFBQSxhQUF6QjtBQUF3Q0MsRUFBQUE7QUFBeEMsSUFBNERULE9BQU8sQ0FBQyw2QkFBRCxDQUF6RTs7QUFDQSxNQUFNO0FBQUVVLEVBQUFBLFVBQUY7QUFBY0MsRUFBQUEsYUFBZDtBQUE2QkMsRUFBQUEscUJBQTdCO0FBQW9EQyxFQUFBQTtBQUFwRCxJQUE2RWIsT0FBTyxDQUFDLHlCQUFELENBQTFGLEMsQ0FFQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUEsSUFBSWMsZ0JBQWdCLEdBQUcsRUFBdkI7QUFDQSxJQUFJQyxZQUFZLEdBQUdSLFdBQVcsQ0FBQ1MsT0FBL0I7QUFDQSxJQUFJQyxtQkFBbUIsR0FBR2QsVUFBMUIsQyxDQUVBOztBQUNBLElBQUllLGNBQWMsR0FBR2hCLFNBQVMsQ0FBQ2lCLEdBQVYsRUFBckI7QUFFQSxNQUFNQyxNQUFNLEdBQUcsUUFBZjtBQUVBQyxNQUFNLENBQUNDLE9BQVAsR0FBaUJ2QixPQUFPLENBQUN3QixXQUFSLENBQW9CO0FBQ2pDQyxFQUFBQSxPQUFPLEVBQUU7QUFDTCxLQUFDbEIsUUFBUSxDQUFDbUIsb0JBQVYsR0FBaUMsd0JB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aEIsSUFBdUJBLGdCQUFnQixDQUFDLENBQUQsQ0FBM0MsRUFBZ0Q7QUFDbkQ7QUFDQSxjQUFNSSxtQkFBbUIsR0FBR0osZ0JBQWdCLENBQUMsQ0FBRCxDQUFoQixHQUFzQixDQUF0QixHQUEwQixDQUF0RDtBQUNBLGVBQU9ULElBQUksS0FBSztBQUNaQyxVQUFBQSxLQUFLLEVBQUVELElBQUksQ0FBQ0UsQ0FBTCxDQUFPLG1DQUFQLENBREs7QUFFWkUsVUFBQUEsV0FBVyxFQUFFSixJQUFJLENBQUNFLENBQUwsQ0FBTyxpREFBUCxFQUEwRDtBQUNuRVksWUFBQUEsY0FBYyxFQUFFRDtBQURtRCxXQUExRDtBQUZELFNBQUwsQ0FBWDtBQU1ILE9BVE0sTUFTQTtBQUNILGVBQU9iLElBQUksS0FBSztBQUNaQyxVQUFBQSxLQUFLLEVBQUVELElBQUksQ0FBQ0UsQ0FBTCxDQUFPLG1DQUFQLENBREs7QUFFWkUsVUFBQUEsV0FBVyxFQUFFSixJQUFJLENBQUNFLENBQUwsQ0FBTyxrREFBUDtBQUZELFNBQUwsQ0FBWDtBQUlIOztBQUNEOztBQUNKO0FBQ0ksYUFBT3JFLFlBQVA7QUEvQlI7QUFpQ0gsQ0FwQ0QiLCJzb3VyY2VzQ29udGVudCI6WyIvKiBlc2xpbnQtZGlzYWJsZSBuby11bnJlYWNoYWJsZSAqL1xyXG4ndXNlIHN0cmljdCc7XHJcblxyXG5jb25zdCBGbHV4eG9yID0gcmVxdWlyZSgnZmx1eHhvcicpO1xyXG5jb25zdCBfID0gcmVxdWlyZSgnbG9kYXNoJyk7XHJcbmNvbnN0IEltbXV0YWJsZSA9IHJlcXVpcmUoJ2ltbXV0YWJsZScpO1xyXG5jb25zdCB7IFNXSVBFX0xFRlQsIFNXSVBFX1JJR0hUIH0gPSByZXF1aXJlKCdlYWdsZS1wcmludC92aWV3cy91aS9jYXJkX2NvbnRhaW5lcicpO1xyXG5cclxuY29uc3QgeyBlaXRoZXIgfSA9IHJlcXVpcmUoJy4uL3V0aWxzL21heWJlJyk7XHJcbmNvbnN0IHsgRGlzcGF0Y2gsIFBhbmVsU3RhdGVzLCBBY3Rpb25CdXR0b25zLCBQcm9ncmVzc0J1dHRvbnMgfSA9IHJlcXVpcmUoJy4uL2NvbnN0YW50cy9wcmludGVyRGV0YWlscycpO1xyXG5jb25zdCB7IGdldFByaW50ZXIsIHByaW50ZXJTdGF0dXMsIGN1cnJlbnRQcmludGVyUHJvY2VzcywgcHJpbnRlckRldGFpbHNTdGF0dXMgfSA9IHJlcXVpcmUoJy4uL3V0aWxzL3ByaW50ZXJEZXRhaWxzJyk7XHJcblxyXG4vLyBOT1RFOiBTaW5jZSBwcmludGVycyBhcmUgYWxyZWFkeSBzdG9yZWQgaW4gUHJpbnRlclN0b3JlLCB0aGVyZSdzIG5vIHJlYXNvblxyXG4vLyB0byBiZSByZWR1bmRhbnQgaGVyZS4gTW9zdCBvZiB0aGUgc3RhdGUgY29taW5nIG91dCBvZiB0aGUgcHJpbnRlcnMgaXNcclxuLy8gc3RvcmVkIHRoZXJlLiBGb3IgdGhlIG1vc3QgcGFydCwgd2UncmUganVzdCBoYW5kaW5nIE1CIHNwZWNpZmljIGV2ZW50c1xyXG4vLyBhbmQgcmV0dXJuaW5nIGZvcm1hdHRlZCBkYXRhIGZvciB0aGUgVUkuXHJcblxyXG5sZXQgY3VycmVudFByaW50ZXJJRCA9ICcnO1xyXG5sZXQgY3VycmVudFBhbmVsID0gUGFuZWxTdGF0ZXMuRGV0YWlscztcclxubGV0IHBhbmVsU3dpcGVEaXJlY3Rpb24gPSBTV0lQRV9MRUZUO1xyXG5cclxuLy8gd2hpY2ggYWN0aW9uIGJ1dHRvbnMgYXJlIGluIGEgXCJ3YWl0aW5nXCIgKHNwaW5uZXIpIHN0YXRlXHJcbmxldCB3YWl0aW5nQnV0dG9ucyA9IEltbXV0YWJsZS5NYXAoKTtcclxuXHJcbmNvbnN0IENIQU5HRSA9ICdjaGFuZ2UnO1xyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBGbHV4eG9yLmNyZWF0ZVN0b3JlKHtcclxuICAgIGFjdGlvbnM6IHtcclxuICAgICAgICBbRGlzcGF0Y2guQWNrbm93bGVkZ2VDb21wbGV0ZWRdOiAnb25BY2tub3dsZWRnZUNvbXBsZXRlZCcsXHJcbiAgICAgICAgW0Rpc3BhdGNoLkFja25vd2xlZGdlRXJyb3JdOiAnb25BY2tub3dsZWRnZUVycm9yJyxcclxuICAgICAgICBbRGlzcGF0Y2guQWNrbm93bGVkZ2VSZXN1bWVFcnJvcl06ICdvbkFja25vd2xlZGdlUmVzdW1lRXJyb3InLFxyXG4gICAgICAgIFtEaXNwYXRjaC5BY2tub3dsZWRnZUZhaWx1cmVdOiAnb25BY2tub3dsZWRnZUZhaWx1cmUnLFxyXG4gICAgICAgIFtEaXNwYXRjaC5BY2tub3dsZWRnZVN1Y2Nlc3NdOiAnb25BY2tub3dsZWRnZVN1Y2Nlc3MnLFxyXG4gICAgICAgIFtEaXNwYXRjaC5TdXNwZW5kXTogJ29uU3VzcGVuZCcsXHJcbiAgICAgICAgW0Rpc3BhdGNoLlJlc3VtZV06ICdvblJlc3VtZScsXHJcbiAgICAgICAgW0Rpc3BhdGNoLkNhbmNlbF06ICdvbkNhbmNlbCcsXHJcbiAgICAgICAgW0Rpc3BhdGNoLlN0b3BGaWxhbWVudF06ICdvblN0b3BGaWxhbWVudCcsXHJcbiAgICAgICAgW0Rpc3BhdGNoLlByaW50QWdhaW5dOiAnb25QcmludEFnYWluJyxcclxuICAgICAgICBbRGlzcGF0Y2guU2hvd1BhbmVsRGV0YWlsc106ICdvblNob3dQYW5lbERldGFpbHMnLFxyXG4gICAgICAgIFtEaXNwYXRjaC5TaG93UGFuZWxGaWxhbWVudF06ICdvblNob3dQYW5lbEZpbGFtZW50JyxcclxuICAgICAgICBbRGlzcGF0Y2guU2hvd1BhbmVsVXRpbGl0aWVzXTogJ29uU2hvd1BhbmVsVXRpbGl0aWVzJyxcclxuICAgICAgICBbRGlzcGF0Y2guU3lzdGVtXTogJ29uU3lzdGVtJyxcclxuICAgICAgICBbRGlzcGF0Y2guU3RhdGVdOiAnb25TdGF0ZScsXHJcbiAgICAgICAgW0Rpc3BhdGNoLlN0YXR1c106ICdvblN0YXR1cycsXHJcbiAgICAgICAgW0Rpc3BhdGNoLkJ1dHRvbldhaXRdOiAnb25CdXR0b25XYWl0JyxcclxuICAgICAgICBbRGlzcGF0Y2guRXh0cnVkZXJDaGFuZ2VdOiAnb25FeHRydWRlckNoYW5nZScsXHJcbiAgICB9LFxyXG5cclxuICAgIGdldFN0YXRlKHByaW50ZXJJRCkge1xyXG4gICAgICAgIGN1cnJlbnRQcmludGVySUQgPSBwcmludGVySUQ7XHJcblxyXG4gICAgICAgIGNvbnN0IGFjdGlvbnMgPSB0aGlzLmZsdXguYWN0aW9ucy5QcmludGVyRGV0YWlsc0FjdGlvbnM7XHJcbiAgICAgICAgY29uc3QgcHJpbnRlciA9IGdldFByaW50ZXIodGhpcy5mbHV4LCBwcmludGVySUQpO1xyXG4gICAgICAgIGNvbnN0IHBTdGF0dXMgPSBwcmludGVyU3RhdHVzKHByaW50ZXIpO1xyXG4gICAgICAgIGNvbnN0IGRldGFpbHNTdGF0dXMgPSBwcmludGVyRGV0YWlsc1N0YXR1cyhwcmludGVyKTtcclxuICAgICAgICBjb25zdCBjdXJyZW50UHJvY2VzcyA9IGN1cnJlbnRQcmludGVyUHJvY2VzcyhwcmludGVyKTtcclxuICAgICAgICBjb25zdCBwcm9ncmVzc0J1dHRvbnMgPSBjdXJyZW50UHJvY2Vzcy5hcHBseShjcCA9PiBQcm9ncmVzc0J1dHRvbnMocHJpbnRlci5nZXRJZCgpKS5nZXQoY3Auc3RlcCkpO1xyXG5cclxuICAgICAgICBjb25zdCBleHRydWRlcnMgPSBwcmludGVyLmdldEV4dHJ1ZGVySW5mbygpO1xyXG4gICAgICAgIC8vIGlmIHRoZXJlIGlzIGEgY3VycmVudCBwcm9jZXNzLCB1c2UgdGhlIGkxOG4gZnJvbSB0aGF0LFxyXG4gICAgICAgIC8vIG90aGVyd2lzZSB1c2UgdGhlIHN0YXRlXHJcbiAgICAgICAgY29uc3QgcHJvZ3Jlc3NUZXh0ID0gZWl0aGVyKHBTdGF0dXMuYXBwbHkobGFiZWxTdGF0dXMpLCBjdXJyZW50UHJvY2Vzcy5hcHBseShsYWJlbFByb2Nlc3MpKVxyXG4gICAgICAgICAgICAubWFwKGV4dHJ1ZGVyRGV0YWNoZWQoZXh0cnVkZXJzKSlcclxuICAgICAgICAgICAgLmxpZnQoKTtcclxuXHJcbiAgICAgICAgY29uc3Qgd2FpdExpc3QgPSBfLmZsYXR0ZW4od2FpdGluZ0J1dHRvbnMucmVkdWNlKChhY2MsIHYpID0+IGFjYy5jb25jYXQodiksIFtdKSk7XHJcblxyXG4gICAgICAgIGNvbnN0IGFjdGlvbkJ1dHRvbnMgPSBmb3JtYXRCdXR0b25zKHByaW50ZXJJRCwgZGV0YWlsc1N0YXR1cywgYWN0aW9ucywgd2FpdExpc3QpO1xyXG5cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBkZXRhaWxzU3RhdHVzLFxyXG4gICAgICAgICAgICBjdXJyZW50UHJvY2VzcyxcclxuICAgICAgICAgICAgY3VycmVudFBhbmVsLFxyXG4gICAgICAgICAgICBwYW5lbFN3aXBlRGlyZWN0aW9uLFxyXG4gICAgICAgICAgICBhY3Rpb25CdXR0b25zLFxyXG4gICAgICAgICAgICBwcm9ncmVzc1RleHQsXHJcbiAgICAgICAgICAgIHByb2dyZXNzQnV0dG9ucyxcclxuICAgICAgICB9O1xyXG4gICAgfSxcclxuXHJcbiAgICAvLyB0YWtlIGEgcGFydGljdWxhciBzZXQgb2YgYnV0dG9ucyBvdXQgb2YgdGhlaXIgd2FpdGluZyBzdGF0ZVxyXG4gICAgX3Vud2FpdEJ1dHRvbih0eXBlKSB7XHJcbiAgICAgICAgd2FpdGluZ0J1dHRvbnMgPSB3YWl0aW5nQnV0dG9ucy5zZXQodHlwZSwgW10pO1xyXG4gICAgfSxcclxuXHJcbiAgICBvbkFja25vd2xlZGdlQ29tcGxldGVkKHBheWxvYWQsIHR5cGUpIHtcclxuICAgICAgICB0aGlzLl91bndhaXRCdXR0b24odHlwZSk7XHJcbiAgICAgICAgcmV0dXJuIHBheWxvYWQuaWQgPT09IGN1cnJlbnRQcmludGVySUQgPyB0aGlzLmVtaXQoQ0hBTkdFKSA6IG51bGw7XHJcbiAgICB9LFxyXG5cclxuICAgIG9uQWNrbm93bGVkZ2VFcnJvcihwYXlsb2FkLCB0eXBlKSB7XHJcbiAgICAgICAgdGhpcy5fdW53YWl0QnV0dG9uKHR5cGUpO1xyXG4gICAgICAgIHJldHVybiBwYXlsb2FkLmlkID09PSBjdXJyZW50UHJpbnRlcklEID8gdGhpcy5lbWl0KENIQU5HRSkgOiBudWxsO1xyXG4gICAgfSxcclxuXHJcbiAgICBvbkFja25vd2xlZGdlUmVzdW1lRXJyb3IocGF5bG9hZCwgdHlwZSkge1xyXG4gICAgICAgIHRoaXMuX3Vud2FpdEJ1dHRvbih0eXBlKTtcclxuICAgICAgICByZXR1cm4gcGF5bG9hZC5pZCA9PT0gY3VycmVudFByaW50ZXJJRCA/IHRoaXMuZW1pdChDSEFOR0UpIDogbnVsbDtcclxuICAgIH0sXHJcblxyXG4gICAgb25BY2tub3dsZWRnZUZhaWx1cmUocGF5bG9hZCwgdHlwZSkge1xyXG4gICAgICAgIHRoaXMuX3Vud2FpdEJ1dHRvbih0eXBlKTtcclxuICAgICAgICByZXR1cm4gcGF5bG9hZC5pZCA9PT0gY3VycmVudFByaW50ZXJJRCA/IHRoaXMuZW1pdChDSEFOR0UpIDogbnVsbDtcclxuICAgIH0sXHJcblxyXG4gICAgb25BY2tub3dsZWRnZVN1Y2Nlc3MocGF5bG9hZCwgdHlwZSkge1xyXG4gICAgICAgIHRoaXMuX3Vud2FpdEJ1dHRvbih0eXBlKTtcclxuICAgICAgICByZXR1cm4gcGF5bG9hZC5pZCA9PT0gY3VycmVudFByaW50ZXJJRCA/IHRoaXMuZW1pdChDSEFOR0UpIDogbnVsbDtcclxuICAgIH0sXHJcblxyXG4gICAgb25TdXNwZW5kKHBheWxvYWQsIHR5cGUpIHtcclxuICAgICAgICB0aGlzLl91bndhaXRCdXR0b24odHlwZSk7XHJcbiAgICAgICAgcmV0dXJuIHBheWxvYWQuaWQgPT09IGN1cnJlbnRQcmludGVySUQgPyB0aGlzLmVtaXQoQ0hBTkdFKSA6IG51bGw7XHJcbiAgICB9LFxyXG5cclxuICAgIG9uUmVzdW1lKHBheWxvYWQsIHR5cGUpIHtcclxuICAgICAgICB0aGlzLl91bndhaXRCdXR0b24odHlwZSk7XHJcbiAgICAgICAgcmV0dXJuIHBheWxvYWQuaWQgPT09IGN1cnJlbnRQcmludGVySUQgPyB0aGlzLmVtaXQoQ0hBTkdFKSA6IG51bGw7XHJcbiAgICB9LFxyXG5cclxuICAgIG9uQ2FuY2VsKHBheWxvYWQsIHR5cGUpIHtcclxuICAgICAgICB0aGlzLl91bndhaXRCdXR0b24odHlwZSk7XHJcbiAgICAgICAgcmV0dXJuIHBheWxvYWQuaWQgPT09IGN1cnJlbnRQcmludGVySUQgPyB0aGlzLmVtaXQoQ0hBTkdFKSA6IG51bGw7XHJcbiAgICB9LFxyXG5cclxuICAgIG9uU3RvcEZpbGFtZW50KHBheWxvYWQsIHR5cGUpIHtcclxuICAgICAgICB0aGlzLl91bndhaXRCdXR0b24odHlwZSk7XHJcbiAgICAgICAgcmV0dXJuIHBheWxvYWQuaWQgPT09IGN1cnJlbnRQcmludGVySUQgPyB0aGlzLmVtaXQoQ0hBTkdFKSA6IG51bGw7XHJcbiAgICB9LFxyXG5cclxuICAgIG9uUHJpbnRBZ2FpbihwYXlsb2FkLCB0eXBlKSB7XHJcbiAgICAgICAgdGhpcy5fdW53YWl0QnV0dG9uKHR5cGUpO1xyXG4gICAgICAgIHJldHVybiBwYXlsb2FkLmlkID09PSBjdXJyZW50UHJpbnRlcklEID8gdGhpcy5lbWl0KENIQU5HRSkgOiBudWxsO1xyXG4gICAgfSxcclxuXHJcbiAgICBvblNob3dQYW5lbERldGFpbHMocGF5bG9hZCwgdHlwZSkge1xyXG4gICAgICAgIHRoaXMuX3Vud2FpdEJ1dHRvbih0eXBlKTtcclxuICAgICAgICBjdXJyZW50UGFuZWwgPSBQYW5lbFN0YXRlcy5EZXRhaWxzO1xyXG4gICAgICAgIHBhbmVsU3dpcGVEaXJlY3Rpb24gPSBTV0lQRV9SSUdIVDtcclxuICAgICAgICByZXR1cm4gdGhpcy5lbWl0KENIQU5HRSk7XHJcbiAgICB9LFxyXG5cclxuICAgIG9uU2hvd1BhbmVsRmlsYW1lbnQocGF5bG9hZCwgdHlwZSkge1xyXG4gICAgICAgIHRoaXMuX3Vud2FpdEJ1dHRvbih0eXBlKTtcclxuICAgICAgICBjdXJyZW50UGFuZWwgPSBQYW5lbFN0YXRlcy5GaWxhbWVudDtcclxuICAgICAgICBwYW5lbFN3aXBlRGlyZWN0aW9uID0gU1dJUEVfTEVGVDtcclxuICAgICAgICByZXR1cm4gdGhpcy5lbWl0KENIQU5HRSk7XHJcbiAgICB9LFxyXG5cclxuICAgIG9uU2hvd1BhbmVsVXRpbGl0aWVzKHBheWxvYWQsIHR5cGUpIHtcclxuICAgICAgICB0aGlzLl91bndhaXRCdXR0b24odHlwZSk7XHJcbiAgICAgICAgY3VycmVudFBhbmVsID0gUGFuZWxTdGF0ZXMuVXRpbGl0aWVzO1xyXG4gICAgICAgIHBhbmVsU3dpcGVEaXJlY3Rpb24gPSBTV0lQRV9MRUZUO1xyXG4gICAgICAgIHJldHVybiB0aGlzLmVtaXQoQ0hBTkdFKTtcclxuICAgIH0sXHJcblxyXG4gICAgb25TeXN0ZW0ocGF5bG9hZCkge1xyXG4gICAgICAgIHJldHVybiBwYXlsb2FkLmlkID09PSBjdXJyZW50UHJpbnRlcklEID8gdGhpcy5lbWl0KENIQU5HRSkgOiBudWxsO1xyXG4gICAgfSxcclxuXHJcbiAgICBvblN0YXRlKHBheWxvYWQpIHtcclxuICAgICAgICByZXR1cm4gcGF5bG9hZC5pZCA9PT0gY3VycmVudFByaW50ZXJJRCA/IHRoaXMuZW1pdChDSEFOR0UpIDogbnVsbDtcclxuICAgIH0sXHJcblxyXG4gICAgb25TdGF0dXMocGF5bG9hZCkge1xyXG4gICAgICAgIHJldHVybiBwYXlsb2FkLmlkID09PSBjdXJyZW50UHJpbnRlcklEID8gdGhpcy5lbWl0KENIQU5HRSkgOiBudWxsO1xyXG4gICAgfSxcclxuXHJcbiAgICAvLyBzZXQgYSBwYXJ0aWN1bGFyIGJ1dHRvbiBpbnRvIGl0cyBcIndhaXRpbmdcIiAoc3Bpbm5lcikgc3RhdGVcclxuICAgIG9uQnV0dG9uV2FpdChwYXlsb2FkKSB7XHJcbiAgICAgICAgY29uc3Qgd2FpdGluZyA9IHdhaXRpbmdCdXR0b25zLmdldChwYXlsb2FkLmFjdGlvbiwgW10pO1xyXG4gICAgICAgIHdhaXRpbmcucHVzaChwYXlsb2FkLmtleSk7XHJcblxyXG4gICAgICAgIHdhaXRpbmdCdXR0b25zID0gd2FpdGluZ0J1dHRvbnMuc2V0KHBheWxvYWQuYWN0aW9uLCB3YWl0aW5nKTtcclxuICAgICAgICB0aGlzLmVtaXQoQ0hBTkdFKTtcclxuICAgIH0sXHJcblxyXG4gICAgb25FeHRydWRlckNoYW5nZShwYXlsb2FkKSB7XHJcbiAgICAgICAgcmV0dXJuIHBheWxvYWQuaWQgPT09IGN1cnJlbnRQcmludGVySUQgPyB0aGlzLmVtaXQoQ0hBTkdFKSA6IG51bGw7XHJcbiAgICB9LFxyXG5cclxuICAgIG9uTmV0d29ya0NoYW5nZShwYXlsb2FkKSB7XHJcbiAgICAgICAgcmV0dXJuIHBheWxvYWQuaWQgPT09IGN1cnJlbnRQcmludGVySUQgPyB0aGlzLmVtaXQoQ0hBTkdFKSA6IG51bGw7XHJcbiAgICB9LFxyXG59KTtcclxuXHJcbmNvbnN0IGZvcm1hdEJ1dHRvbnMgPSAocHJpbnRlcklELCBzdGF0dXMsIGFjdGlvbnMsIHdhaXRMaXN0KSA9PlxyXG4gICAgQWN0aW9uQnV0dG9ucy5tYXAoKHYsIGspID0+XHJcbiAgICAgICAgXy5tZXJnZSh7fSwgdiwge1xyXG4gICAgICAgICAgICBpY29uOiB2Lmljb24oc3RhdHVzKSxcclxuICAgICAgICAgICAgZW5hYmxlZDogdi5lbmFibGVkKHN0YXR1cyksXHJcbiAgICAgICAgICAgIHNob3VsZFNob3c6IHYuc2hvdWxkU2hvdyhzdGF0dXMpLFxyXG4gICAgICAgICAgICBvbkNsaWNrOiB2Lm9uQ2xpY2soYWN0aW9ucywgcHJpbnRlcklEKSxcclxuICAgICAgICAgICAgd2FpdGluZzogd2FpdExpc3QuaW5jbHVkZXMoayksXHJcbiAgICAgICAgfSlcclxuICAgIClcclxuICAgICAgICAuZmlsdGVyKGIgPT4gYi5zaG91bGRTaG93IHx8IGIuZGVmYXVsdCkgLy8gaW5jbHVkZSBkZWZhdWx0cyBmb3Igbm93XHJcbiAgICAgICAgLmdyb3VwQnkoYiA9PiBiLm9yZGVyKVxyXG4gICAgICAgIC5tYXAoZyA9PiAoZy5zaXplID4gMSA/IGcuZmlsdGVyKGIgPT4gIWIuZGVmYXVsdCkgOiBnKSkgLy8gcmVtb3ZlIGRlZmF1bHRzXHJcbiAgICAgICAgLmZsYXR0ZW4oKVxyXG4gICAgICAgIC5zb3J0QnkoYiA9PiBiLm9yZGVyKTtcclxuXHJcbi8vIGhlbHBlciB0byBzZXQgZGVmYXVsdCB2YWx1ZXMgZm9yIGkxOG5cclxuY29uc3QgaTE4bk9wdHMgPSB2YWwgPT4gKHsgZGVmYXVsdFZhbHVlOiB2YWwgfSk7XHJcblxyXG5jb25zdCBwcm9jZXNzSTE4bktleSA9IGNwID0+IGBtYjpwcmludGVyU3RhdHVzLiR7Y3AubmFtZX0uJHtjcC5zdGVwLnRvTG93ZXJDYXNlKCl9YDtcclxuY29uc3QgbGFiZWxQcm9jZXNzID0gY3AgPT4gaTE4biA9PiAoe1xyXG4gICAgbGFiZWw6IGkxOG4udChgJHtwcm9jZXNzSTE4bktleShjcCl9LmxhYmVsYCwgaTE4bk9wdHMoXy5zdGFydENhc2UoY3Auc3RlcCkpKSxcclxuICAgIGRlc2NyaXB0aW9uOiBpMThuLnQoYCR7cHJvY2Vzc0kxOG5LZXkoY3ApfS5kZXNjcmlwdGlvbmAsIGkxOG5PcHRzKCcnKSksXHJcbn0pO1xyXG5cclxuY29uc3Qgc3RhdGVJMThuS2V5ID0gc3RhdGUgPT4gYG1iOnByaW50ZXJTdGF0dXMuc3RhdGUuJHtzdGF0ZS50b0xvd2VyQ2FzZSgpfWA7XHJcbmNvbnN0IGxhYmVsU3RhdHVzID0gc3RhdHVzID0+IChpMThuLCBwcmludGVyKSA9PiB7XHJcbiAgICAvLyBOb3QgdGhlIGJlc3Qgd2F5IHRvIGhhbmRsZSB0aGlzIGZpcmVfZSBjb3B5IGNoYW5nZSBmb3IgYXV0aCdpbmcgLS0gUmF5XHJcbiAgICBjb25zdCBpc1NpeHRoR2VuID0gcHJpbnRlciAmJiBwcmludGVyLmlzU2l4dGhHZW4oKTtcclxuICAgIGxldCBpMThuU3RyRGVzY3JpcHRpb247XHJcblxyXG4gICAgaWYgKFsnYXV0aGVudGljYXRpbmcnLCAnY29uZmlybSddLmluY2x1ZGVzKHN0YXR1cy5zdGF0ZS50b0xvd2VyQ2FzZSgpKSAmJiBpc1NpeHRoR2VuKSB7XHJcbiAgICAgICAgaTE4blN0ckRlc2NyaXB0aW9uID0gYCR7c3RhdGVJMThuS2V5KHN0YXR1cy5zdGF0ZSl9LmZpcmVfZWAgKyBgLmRlc2NyaXB0aW9uYDtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgaTE4blN0ckRlc2NyaXB0aW9uID0gYCR7c3RhdGVJMThuS2V5KHN0YXR1cy5zdGF0ZSl9LmRlc2NyaXB0aW9uYDtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIGxhYmVsOiBpMThuLnQoYCR7c3RhdGVJMThuS2V5KHN0YXR1cy5zdGF0ZSl9LmxhYmVsYCwgaTE4bk9wdHMoXy5zdGFydENhc2Uoc3RhdHVzLnN0YXRlKSkpLFxyXG4gICAgICAgIGRlc2NyaXB0aW9uOiBpMThuLnQoaTE4blN0ckRlc2NyaXB0aW9uLCBpMThuT3B0cygnJykpLFxyXG4gICAgfTtcclxufTtcclxuXHJcbi8vIGJhc2ljYWxseSwgZm9yIHRoZSBtb3N0IHBhcnQsIGNoZWNraW5nIHN0YXR1cyBhbmQgcHJvY2VzcyBpcyBlbm91Z2hcclxuLy8gdG8gZ2V0IGFsbCB0aGUgcG9zc2libGUgdGV4dCBzdGF0ZXMgZm9yIHRoZSBwYW5lbCwgZXhjZXB0IGZvciBpZlxyXG4vLyB0aGUgZXh0cnVkZXIgaGFzIGJlZW4gZGV0YWNoZWQuIFNvLCB0aGlzIGZ1bmN0aW9uIHdpbGwgdHJhbnNmb3JtXHJcbi8vIHRoZSBwcm9ncmVzc1RleHQgaW4ganVzdCBzdWNoIGFuIGV2ZW50LCBvdGhlcndpc2UgaXQganVzdCBwYXNzZXMgaXRcclxuLy8gb24gdGhyb3VnaC5cclxuY29uc3QgZXh0cnVkZXJEZXRhY2hlZCA9IGV4dHJ1ZGVycyA9PiBwcm9ncmVzc1RleHQgPT4ge1xyXG4gICAgY29uc3QgZXh0cnVkZXJzUHJlc2VudCA9IGV4dHJ1ZGVycy5tYXAoZXh0cnVkZXIgPT4gZXh0cnVkZXIudG9vbF9wcmVzZW50KTtcclxuXHJcbiAgICBzd2l0Y2ggKGV4dHJ1ZGVyc1ByZXNlbnQubGVuZ3RoKSB7XHJcbiAgICAgICAgY2FzZSAxOlxyXG4gICAgICAgICAgICBpZiAoIWV4dHJ1ZGVyc1ByZXNlbnRbMF0pIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBpMThuID0+ICh7XHJcbiAgICAgICAgICAgICAgICAgICAgbGFiZWw6IGkxOG4udCgnbWI6ZXJyb3JzLmV4dHJ1ZGVyX2RldGFjaGVkLnRpdGxlJyksXHJcbiAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IGkxOG4udCgnbWI6ZXJyb3JzLmV4dHJ1ZGVyX2RldGFjaGVkLm1lc3NhZ2UnKSxcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHByb2dyZXNzVGV4dDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlIDI6XHJcbiAgICAgICAgICAgIGlmIChleHRydWRlcnNQcmVzZW50WzBdICYmIGV4dHJ1ZGVyc1ByZXNlbnRbMV0pIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBwcm9ncmVzc1RleHQ7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoZXh0cnVkZXJzUHJlc2VudFswXSAhPSBleHRydWRlcnNQcmVzZW50WzFdKSB7XHJcbiAgICAgICAgICAgICAgICAvL2xvZ2ljYWwgZXF1aXZhbGVudCB0byBYT1JcclxuICAgICAgICAgICAgICAgIGNvbnN0IHNsb3RNaXNzaW5nRXh0cnVkZXIgPSBleHRydWRlcnNQcmVzZW50WzFdID8gMSA6IDI7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gaTE4biA9PiAoe1xyXG4gICAgICAgICAgICAgICAgICAgIGxhYmVsOiBpMThuLnQoJ21iOmVycm9ycy5leHRydWRlcl9kZXRhY2hlZC50aXRsZScpLFxyXG4gICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBpMThuLnQoJ21iOmVycm9ycy5leHRydWRlcl9kZXRhY2hlZC5taXNzaW5nX29uZV9tZXNzYWdlJywge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBleHRydWRlck51bWJlcjogc2xvdE1pc3NpbmdFeHRydWRlcixcclxuICAgICAgICAgICAgICAgICAgICB9KSxcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGkxOG4gPT4gKHtcclxuICAgICAgICAgICAgICAgICAgICBsYWJlbDogaTE4bi50KCdtYjplcnJvcnMuZXh0cnVkZXJfZGV0YWNoZWQudGl0bGUnKSxcclxuICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogaTE4bi50KCdtYjplcnJvcnMuZXh0cnVkZXJfZGV0YWNoZWQubWlzc2luZ19ib3RoX21lc3NhZ2UnKSxcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgIHJldHVybiBwcm9ncmVzc1RleHQ7XHJcbiAgICB9XHJcbn07XHJcbiJdfQ==
