'use strict';

const Fluxxor = require('fluxxor');

const _ = require('lodash');

const {
  maybe,
  just,
  nothing,
  isNothing,
  getProp,
  getPropLift
} = require('../utils/maybe');

const {
  getPrinter
} = require('../utils/printerDetails');

const {
  PrinterConnTypeEnum
} = require('../constants');

const {
  Actions,
  CHANGE_EVENT,
  NetworkStateEnum
} = require('../constants/networkPreferences'); // Network State


let networkState = nothing();
let availableNetworks = [];
let selectedNetwork = nothing();
let prevSelectedNetwork = nothing(); // Messaging

let currentError = nothing();
let statusMsg = nothing();
let currentMessage = nothing(); // Progress indication:

let waiting = false; // WIFI Password

let passwordAttempt = '';
let showPassword = false; // Static IP Edit containers:
// When the user enables static IP, we need the real values from the printer,
// but changes don't take effect until the user hits 'apply', thus we need
// to have containers to edit the values without changing the preceived state
// of the printer.
// NOTE: There is currently NO VALIDATION as per the spec, that may change...

let editStaticIPAddress = null;
let editNetmask = null;
let editGateway = null;
let editDNSServers = null;
let newDNSItem = '';
let selectedDNSItem = nothing();
const Store = Fluxxor.createStore({
  actions: {
    [Actions.Waiting]: 'onWaiting',
    [Actions.Connecting]: 'onConnecting',
    [Actions.WifiConnected]: 'onWifiConnected',
    [Actions.EthernetConnected]: 'onEthernetConnected',
    [Actions.WifiReady]: 'onWifiReady',
    [Actions.Unconnected]: 'onUnconnected',
    [Actions.SelectNetwork]: 'onSelectNetwork',
    [Actions.ChangePasswordAttempt]: 'onChangePasswordAttempt',
    [Actions.TogglePasswordVisibility]: 'onTogglePasswordVisibility',
    [Actions.WifiForget]: 'onWifiForget',
    [Actions.PrepopulateStaticIPFields]: 'onPrepopulateStaticIPFields',
    [Actions.ChangeStaticIPAddress]: 'onChangeStaticIPAddress',
    [Actions.ChangeNetmask]: 'onChangeNetmask',
    [Actions.ChangeGateway]: 'onChangeGateway',
    [Actions.ChangeDNSServers]: 'onChangeDNSServers',
    [Actions.SelectDNSItem]: 'onSelectDNSItem',
    [Actions.NewDNSItem]: 'onNewDNSItem',
    [Actions.SetStaticIP]: 'onSetStaticIP',
    [Actions.Error]: 'onError',
    [Actions.ClearError]: 'onClearError'
  },

  getState() {
    const networkProp = prop => getPropLift(prop, networkState);

    const getDNS = getDNSServers(selectedDNSItem.lift());
    const currentPath = getPropLift('path', getNetworkByName(networkProp('name')));
    const offline = networkProp('state') === NetworkStateEnum.state.OFFLINE;
    const connectedByEthernet = networkProp('state') === NetworkStateEnum.state.ETHERNET; // we need two different "can edit" flags, one for wifi, and the other
    // for static IP. They both share some common attributes, so I broke
    // that out into a single flag. That's why it's the "base".

    const canEditBase = printer => printer.getConnectionType() === PrinterConnTypeEnum.USB && !isNothing(networkState) && !waiting;

    const canEditWifi = printer => canEditBase(printer) && !connectedByEthernet; // offline but with network selected, or connected by ethernet


    const canEditStaticIP = printer => canEditBase(printer) && (offline && !isNothing(selectedNetwork) || connectedByEthernet); // we'll be enabling some buttons depending on whether this stuff
    // has been edited by the user


    const staticIPEdited = !!(editStaticIPAddress || editNetmask || editGateway || editDNSServers);
    const staticIPAddress = getPropLift('ip', networkState) || getPropLift('ip', selectedNetwork);
    const netmask = getPropLift('netmask', networkState) || getPropLift('netmask', selectedNetwork);
    const gateway = getPropLift('gateway', networkState) || getPropLift('gateway', selectedNetwork);
    const dnsServers = getDNS(editDNSServers, getPropLift('dns', selectedNetwork), getPropLift('dns', networkState));
    return {
      networkState,
      availableNetworks,
      selectedNetwork,
      currentPath,
      currentError,
      statusMsg,
      currentMessage,
      prevSelectedNetwork,
      enableWifi: networkProp('wifi') === 'enabled',
      waiting,
      passwordAttempt,
      showPassword,
      canEditWifi,
      canEditStaticIP,
      staticIPEdited,
      enableStaticIP: networkProp('static'),
      dnsServers,
      newDNSItem,
      staticIPAddress,
      netmask,
      gateway,
      editStaticIPAddress,
      editNetmask,
      editGateway
    };
  },

  onWaiting() {
    waiting = true;
    return this.emit(CHANGE_EVENT);
  },

  onWifiConnected(payload) {
    networkState = maybe(payload.networkState);
    selectedNetwork = nothing();
    availableNetworks = payload.availableNetworks || [];
    statusMsg = just('mb:network.status.connected');
    currentError = nothing();
    waiting = false;

    this._resetStaticIPEdits();

    return this.emit(CHANGE_EVENT);
  },

  onEthernetConnected(payload) {
    const connType = getPrinter(this.flux, payload.printerId).getConnectionType();
    prevSelectedNetwork = selectedNetwork;
    selectedNetwork = nothing();
    networkState = maybe(payload.networkState);
    availableNetworks = payload.availableNetworks || [];
    statusMsg = just('mb:network.status.connectedByEthernet');
    waiting = false;
    currentMessage = connType === PrinterConnTypeEnum.USB ? just('mb:network.messages.connectedByEthernetAndUsb') : just('mb:network.messages.connectedByEthernet');

    this._resetStaticIPEdits();

    return this.emit(CHANGE_EVENT);
  },

  onWifiReady(payload) {
    prevSelectedNetwork = selectedNetwork;
    networkState = maybe(payload.networkState);
    availableNetworks = payload.availableNetworks || [];
    statusMsg = just('mb:network.status.notConnected');
    currentError = nothing();
    currentMessage = nothing();
    passwordAttempt = '';
    waiting = false;
    return this.emit(CHANGE_EVENT);
  },

  onUnconnected(payload) {
    prevSelectedNetwork = selectedNetwork;
    availableNetworks = payload.availableNetworks || [];
    selectedNetwork = getNetworkByName(getProp('name', networkState));
    networkState = maybe(payload.networkState);
    statusMsg = just('mb:network.status.unconnected');
    currentError = nothing();
    currentMessage = just('mb:network.messages.unconnected');
    waiting = false;
    return this.emit(CHANGE_EVENT);
  },

  onSelectNetwork({
    path
  }) {
    prevSelectedNetwork = selectedNetwork;
    selectedNetwork = getNetworkByPath(path);
    return this.emit(CHANGE_EVENT);
  },

  onChangePasswordAttempt({
    password
  }) {
    passwordAttempt = password;
    return this.emit(CHANGE_EVENT);
  },

  onTogglePasswordVisibility() {
    showPassword = !showPassword;
    return this.emit(CHANGE_EVENT);
  },

  onWifiForget() {
    prevSelectedNetwork = selectedNetwork.map(network => network.value.password = 'required');
    selectedNetwork = prevSelectedNetwork;
    return this.emit(CHANGE_EVENT);
  },

  onSetStaticIP({
    dnsServers,
    enable
  }) {
    editDNSServers = dnsServers;
    newDNSItem = null;
    return this.emit(CHANGE_EVENT);
  },

  onPrepopulateStaticIPFields(result) {
    editStaticIPAddress = result.ip;
    editNetmask = result.netmask;
    editGateway = result.gateway;
    editDNSServers = result.dns;
    return this.emit(CHANGE_EVENT);
  },

  onChangeStaticIPAddress({
    ipAddress
  }) {
    editStaticIPAddress = ipAddress;
    return this.emit(CHANGE_EVENT);
  },

  onChangeNetmask({
    netmask
  }) {
    editNetmask = netmask;
    return this.emit(CHANGE_EVENT);
  },

  onChangeGateway({
    gateway
  }) {
    editGateway = gateway;
    return this.emit(CHANGE_EVENT);
  },

  onNewDNSItem({
    item
  }) {
    newDNSItem = item;
    return this.emit(CHANGE_EVENT);
  },

  onChangeDNSServers({
    dnsServers
  }) {
    editDNSServers = dnsServers.filter(s => _.size(s) > 0);
    newDNSItem = '';
    return this.emit(CHANGE_EVENT);
  },

  onSelectDNSItem({
    item
  }) {
    selectedDNSItem = maybe(item);
    return this.emit(CHANGE_EVENT);
  },

  onError({
    error
  }) {
    // ridiculous error handling, because errors here can come in a variety
    // of shapes and sizes...
    const parsedErr = parseJSON(error.message || error);
    const err = errorMsg(parsedErr) || parsedErr;
    waiting = false;
    currentError = just(err);
    console.error(error.message);
    this.emit(CHANGE_EVENT);
  },

  onClearError() {
    currentError = nothing();
    this.emit(CHANGE_EVENT);
  },

  _resetStaticIPEdits() {
    editStaticIPAddress = null;
    editNetmask = null;
    editGateway = null;
    editDNSServers = null;
  }

});

const getNetworkByPath = path => availableNetworks.reduce((acc, v) => v.path === path ? just(v) : acc, nothing());

const getNetworkByName = name => availableNetworks.reduce((acc, v) => v.name === name ? just(v) : acc, nothing());

const getDNSServers = selectedItem => (...serverLists) => {
  if (serverLists.length === 0) return [];
  const recurse = getDNSServers(selectedItem);
  const [head, ...tail] = serverLists;
  if (head != null) return head.map(item => ({
    label: item,
    value: item,
    selected: selectedItem === item
  }));
  return recurse(...tail);
};

const parseJSON = msg => {
  try {
    return JSON.parse(msg);
  } catch (e) {
    return msg;
  }
};

const errorMsg = _.property('error.message');

module.exports = Store;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5ldHdvcmtQcmVmZXJlbmNlcy5qcyJdLCJuYW1lcyI6WyJGbHV4eG9yIiwicmVxdWlyZSIsIl8iLCJtYXliZSIsImp1c3QiLCJub3RoaW5nIiwiaXNOb3RoaW5nIiwiZ2V0UHJvcCIsImdldFByb3BMaWZ0IiwiZ2V0UHJpbnRlciIsIlByaW50ZXJDb25uVHlwZUVudW0iLCJBY3Rpb25zIiwiQ0hBTkdFX0VWRU5UIiwiTmV0d29ya1N0YXRlRW51bSIsIm5ldHdvcmtTdGF0ZSIsImF2YWlsYWJsZU5ldHdvcmtzIiwic2VsZWN0ZWROZXR3b3JrIiwicHJldlNlbGVjdGVkTmV0d29yayIsImN1cnJlbnRFcnJvciIsInN0YXR1c01zZyIsImN1cnJlbnRNZXNzYWdlIiwid2FpdGluZyIsInBhc3N3b3JkQXR0ZW1wdCIsInNob3dQYXNzd29yZCIsImVkaXRTdGF0aWNJUEFkZHJlc3MiLCJlZGl0TmV0bWFzayIsImVkaXRHYXRld2F5IiwiZWRpdEROU1NlcnZlcnMiLCJuZXdETlNJdGVtIiwic2VsZWN0ZWRETlNJdGVtIiwiU3RvcmUiLCJjcmVhdGVTdG9yZSIsImFjdGlvbnMiLCJXYWl0aW5nIiwiQ29ubmVjdGluZyIsIldpZmlDb25uZWN0ZWQiLCJFdGhlcm5ldENvbm5lY3RlZCIsIldpZmlSZWFkeSIsIlVuY29ubmVjdGVkIiwiU2VsZWN0TmV0d29yayIsIkNoYW5nZVBhc3N3b3JkQXR0ZW1wdCIsIlRvZ2dsZVBhc3N3b3JkVmlzaWJpbGl0eSIsIldpZmlGb3JnZXQiLCJQcmVwb3B1bGF0ZVN0YXRpY0lQRmllbGRzIiwiQ2hhbmdlU3RhdGljSVBBZGRyZXNzIiwiQ2hhbmdlTmV0bWFzayIsIkNoYW5nZUdhdGV3YXkiLCJDaGFuZ2VETlNTZXJ2ZXJzIiwiU2VsZWN0RE5TSXRlbSIsIk5ld0ROU0l0ZW0iLCJTZXRTdGF0aWNJUCIsIkVycm9yIiwiQ2xlYXJFcnJvciIsImdldFN0YXRlIiwibmV0d29ya1Byb3AiLCJwcm9wIiwiZ2V0RE5TIiwiZ2V0RE5TU2VydmVycyIsImxpZnQiLCJjdXJyZW50UGF0aCIsImdldE5ldHdvcmtCeU5hbWUiLCJvZmZsaW5lIiwic3RhdGUiLCJPRkZMSU5FIiwiY29ubmVjdGVkQnlFdGhlcm5ldCIsIkVUSEVSTkVUIiwiY2FuRWRpdEJhc2UiLCJwcmludGVyIiwiZ2V0Q29ubmVjdGlvblR5cGUiLCJVU0IiLCJjYW5FZGl0V2lmaSIsImNhbkVkaXRTdGF0aWNJUCIsInN0YXRpY0lQRWRpdGVkIiwic3RhdGljSVBBZGRyZXNzIiwibmV0bWFzayIsImdhdGV3YXkiLCJkbnNTZXJ2ZXJzIiwiZW5hYmxlV2lmaSIsImVuYWJsZVN0YXRpY0lQIiwib25XYWl0aW5nIiwiZW1pdCIsIm9uV2lmaUNvbm5lY3RlZCIsInBheWxvYWQiLCJfcmVzZXRTdGF0aWNJUEVkaXRzIiwib25FdGhlcm5ldENvbm5lY3RlZCIsImNvbm5UeXBlIiwiZmx1eCIsInByaW50ZXJJZCIsIm9uV2lmaVJlYWR5Iiwib25VbmNvbm5lY3RlZCIsIm9uU2VsZWN0TmV0d29yayIsInBhdGgiLCJnZXROZXR3b3JrQnlQYXRoIiwib25DaGFuZ2VQYXNzd29yZEF0dGVtcHQiLCJwYXNzd29yZCIsIm9uVG9nZ2xlUGFzc3dvcmRWaXNpYmlsaXR5Iiwib25XaWZpRm9yZ2V0IiwibWFwIiwibmV0d29yayIsInZhbHVlIiwib25TZXRTdGF0aWNJUCIsImVuYWJsZSIsIm9uUHJlcG9wdWxhdGVTdGF0aWNJUEZpZWxkcyIsInJlc3VsdCIsImlwIiwiZG5zIiwib25DaGFuZ2VTdGF0aWNJUEFkZHJlc3MiLCJpcEFkZHJlc3MiLCJvbkNoYW5nZU5ldG1hc2siLCJvbkNoYW5nZUdhdGV3YXkiLCJvbk5ld0ROU0l0ZW0iLCJpdGVtIiwib25DaGFuZ2VETlNTZXJ2ZXJzIiwiZmlsdGVyIiwicyIsInNpemUiLCJvblNlbGVjdEROU0l0ZW0iLCJvbkVycm9yIiwiZXJyb3IiLCJwYXJzZWRFcnIiLCJwYXJzZUpTT04iLCJtZXNzYWdlIiwiZXJyIiwiZXJyb3JNc2ciLCJjb25zb2xlIiwib25DbGVhckVycm9yIiwicmVkdWNlIiwiYWNjIiwidiIsIm5hbWUiLCJzZWxlY3RlZEl0ZW0iLCJzZXJ2ZXJMaXN0cyIsImxlbmd0aCIsInJlY3Vyc2UiLCJoZWFkIiwidGFpbCIsImxhYmVsIiwic2VsZWN0ZWQiLCJtc2ciLCJKU09OIiwicGFyc2UiLCJlIiwicHJvcGVydHkiLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQSxNQUFNQSxPQUFPLEdBQUdDLE9BQU8sQ0FBQyxTQUFELENBQXZCOztBQUNBLE1BQU1DLENBQUMsR0FBR0QsT0FBTyxDQUFDLFFBQUQsQ0FBakI7O0FBRUEsTUFBTTtBQUFFRSxFQUFBQSxLQUFGO0FBQVNDLEVBQUFBLElBQVQ7QUFBZUMsRUFBQUEsT0FBZjtBQUF3QkMsRUFBQUEsU0FBeEI7QUFBbUNDLEVBQUFBLE9BQW5DO0FBQTRDQyxFQUFBQTtBQUE1QyxJQUE0RFAsT0FBTyxDQUFDLGdCQUFELENBQXpFOztBQUNBLE1BQU07QUFBRVEsRUFBQUE7QUFBRixJQUFpQlIsT0FBTyxDQUFDLHlCQUFELENBQTlCOztBQUNBLE1BQU07QUFBRVMsRUFBQUE7QUFBRixJQUEwQlQsT0FBTyxDQUFDLGNBQUQsQ0FBdkM7O0FBQ0EsTUFBTTtBQUFFVSxFQUFBQSxPQUFGO0FBQVdDLEVBQUFBLFlBQVg7QUFBeUJDLEVBQUFBO0FBQXpCLElBQThDWixPQUFPLENBQUMsaUNBQUQsQ0FBM0QsQyxDQUVBOzs7QUFDQSxJQUFJYSxZQUFZLEdBQUdULE9BQU8sRUFBMUI7QUFDQSxJQUFJVSxpQkFBaUIsR0FBRyxFQUF4QjtBQUNBLElBQUlDLGVBQWUsR0FBR1gsT0FBTyxFQUE3QjtBQUNBLElBQUlZLG1CQUFtQixHQUFHWixPQUFPLEVBQWpDLEMsQ0FFQTs7QUFDQSxJQUFJYSxZQUFZLEdBQUdiLE9BQU8sRUFBMUI7QUFDQSxJQUFJYyxTQUFTLEdBQUdkLE9BQU8sRUFBdkI7QUFDQSxJQUFJZSxjQUFjLEdBQUdmLE9BQU8sRUFBNUIsQyxDQUVBOztBQUNBLElBQUlnQixPQUFPLEdBQUcsS0FBZCxDLENBRUE7O0FBQ0EsSUFBSUMsZUFBZSxHQUFHLEVBQXRCO0FBQ0EsSUFBSUMsWUFBWSxHQUFHLEtBQW5CLEMsQ0FFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBQ0EsSUFBSUMsbUJBQW1CLEdBQUcsSUFBMUI7QUFDQSxJQUFJQyxXQUFXLEdBQUcsSUFBbEI7QUFDQSxJQUFJQyxXQUFXLEdBQUcsSUFBbEI7QUFDQSxJQUFJQyxjQUFjLEdBQUcsSUFBckI7QUFDQSxJQUFJQyxVQUFVLEdBQUcsRUFBakI7QUFDQSxJQUFJQyxlQUFlLEdBQUd4QixPQUFPLEVBQTdCO0FBRUEsTUFBTXlCLEtBQUssR0FBRzlCLE9BQU8sQ0FBQytCLFdBQVIsQ0FBb0I7QUFDOUJDLEVBQUFBLE9BQU8sRUFBRTtBQUNMLEtBQUNyQixPQUFPLENBQUNzQixPQUFULEdBQW1CLFdBRGQ7QUFFTCxLQUFDdEIsT0FBTyxDQUFDdUIsVUFBVCxHQUFzQixjQUZqQjtBQUdMLEtBQUN2QixPQUFPLENBQUN3QixhQUFULEdBQXlCLGlCQUhwQjtBQUlMLEtBQUN4QixPQUFPLENBQUN5QixpQkFBVCxHQUE2QixxQkFKeEI7QUFLTCxLQUFDekIsT0FBTyxDQUFDMEIsU0FBVCxHQUFxQixhQUxoQjtBQU1MLEtBQUMxQixPQUFPLENBQUMyQixXQUFULEdBQXVCLGVBTmxCO0FBT0wsS0FBQzNCLE9BQU8sQ0FBQzRCLGFBQVQsR0FBeUIsaUJBUHBCO0FBUUwsS0FBQzVCLE9BQU8sQ0FBQzZCLHFCQUFULEdBQWlDLHlCQVI1QjtBQVNMLEtBQUM3QixPQUFPLENBQUM4Qix3QkFBVCxHQUFvQyw0QkFUL0I7QUFVTCxLQUFDOUIsT0FBTyxDQUFDK0IsVUFBVCxHQUFzQixjQVZqQjtBQVdMLEtBQUMvQixPQUFPLENBQUNnQyx5QkFBVCxHQUFxQyw2QkFYaEM7QUFZTCxLQUFDaEMsT0FBTyxDQUFDaUMscUJBQVQsR0FBaUMseUJBWjVCO0FBYUwsS0FBQ2pDLE9BQU8sQ0FBQ2tDLGFBQVQsR0FBeUIsaUJBYnBCO0FBY0wsS0FBQ2xDLE9BQU8sQ0FBQ21DLGFBQVQsR0FBeUIsaUJBZHBCO0FBZUwsS0FBQ25DLE9BQU8sQ0FBQ29DLGdCQUFULEdBQTRCLG9CQWZ2QjtBQWdCTCxLQUFDcEMsT0FBTyxDQUFDcUMsYUFBVCxHQUF5QixpQkFoQnBCO0FBaUJMLEtBQUNyQyxPQUFPLENBQUNzQyxVQUFULEdBQXNCLGNBakJqQjtBQWtCTCxLQUFDdEMsT0FBTyxDQUFDdUMsV0FBVCxHQUF1QixlQWxCbEI7QUFtQkwsS0FBQ3ZDLE9BQU8sQ0FBQ3dDLEtBQVQsR0FBaUIsU0FuQlo7QUFvQkwsS0FBQ3hDLE9BQU8sQ0FBQ3lDLFVBQVQsR0FBc0I7QUFwQmpCLEdBRHFCOztBQXdCOUJDLEVBQUFBLFFBQVEsR0FBRztBQUNQLFVBQU1DLFdBQVcsR0FBR0MsSUFBSSxJQUFJL0MsV0FBVyxDQUFDK0MsSUFBRCxFQUFPekMsWUFBUCxDQUF2Qzs7QUFDQSxVQUFNMEMsTUFBTSxHQUFHQyxhQUFhLENBQUM1QixlQUFlLENBQUM2QixJQUFoQixFQUFELENBQTVCO0FBRUEsVUFBTUMsV0FBVyxHQUFHbkQsV0FBVyxDQUFDLE1BQUQsRUFBU29ELGdCQUFnQixDQUFDTixXQUFXLENBQUMsTUFBRCxDQUFaLENBQXpCLENBQS9CO0FBRUEsVUFBTU8sT0FBTyxHQUFHUCxXQUFXLENBQUMsT0FBRCxDQUFYLEtBQXlCekMsZ0JBQWdCLENBQUNpRCxLQUFqQixDQUF1QkMsT0FBaEU7QUFFQSxVQUFNQyxtQkFBbUIsR0FBR1YsV0FBVyxDQUFDLE9BQUQsQ0FBWCxLQUF5QnpDLGdCQUFnQixDQUFDaUQsS0FBakIsQ0FBdUJHLFFBQTVFLENBUk8sQ0FVUDtBQUNBO0FBQ0E7O0FBQ0EsVUFBTUMsV0FBVyxHQUFHQyxPQUFPLElBQ3ZCQSxPQUFPLENBQUNDLGlCQUFSLE9BQWdDMUQsbUJBQW1CLENBQUMyRCxHQUFwRCxJQUEyRCxDQUFDL0QsU0FBUyxDQUFDUSxZQUFELENBQXJFLElBQXVGLENBQUNPLE9BRDVGOztBQUdBLFVBQU1pRCxXQUFXLEdBQUdILE9BQU8sSUFBSUQsV0FBVyxDQUFDQyxPQUFELENBQVgsSUFBd0IsQ0FBQ0gsbUJBQXhELENBaEJPLENBa0JQOzs7QUFDQSxVQUFNTyxlQUFlLEdBQUdKLE9BQU8sSUFDM0JELFdBQVcsQ0FBQ0MsT0FBRCxDQUFYLEtBQTBCTixPQUFPLElBQUksQ0FBQ3ZELFNBQVMsQ0FBQ1UsZUFBRCxDQUF0QixJQUE0Q2dELG1CQUFyRSxDQURKLENBbkJPLENBc0JQO0FBQ0E7OztBQUNBLFVBQU1RLGNBQWMsR0FBRyxDQUFDLEVBQUVoRCxtQkFBbUIsSUFBSUMsV0FBdkIsSUFBc0NDLFdBQXRDLElBQXFEQyxjQUF2RCxDQUF4QjtBQUVBLFVBQU04QyxlQUFlLEdBQUdqRSxXQUFXLENBQUMsSUFBRCxFQUFPTSxZQUFQLENBQVgsSUFBbUNOLFdBQVcsQ0FBQyxJQUFELEVBQU9RLGVBQVAsQ0FBdEU7QUFFQSxVQUFNMEQsT0FBTyxHQUFHbEUsV0FBVyxDQUFDLFNBQUQsRUFBWU0sWUFBWixDQUFYLElBQXdDTixXQUFXLENBQUMsU0FBRCxFQUFZUSxlQUFaLENBQW5FO0FBRUEsVUFBTTJELE9BQU8sR0FBR25FLFdBQVcsQ0FBQyxTQUFELEVBQVlNLFlBQVosQ0FBWCxJQUF3Q04sV0FBVyxDQUFDLFNBQUQsRUFBWVEsZUFBWixDQUFuRTtBQUVBLFVBQU00RCxVQUFVLEdBQUdwQixNQUFNLENBQ3JCN0IsY0FEcUIsRUFFckJuQixXQUFXLENBQUMsS0FBRCxFQUFRUSxlQUFSLENBRlUsRUFHckJSLFdBQVcsQ0FBQyxLQUFELEVBQVFNLFlBQVIsQ0FIVSxDQUF6QjtBQU1BLFdBQU87QUFDSEEsTUFBQUEsWUFERztBQUVIQyxNQUFBQSxpQkFGRztBQUdIQyxNQUFBQSxlQUhHO0FBSUgyQyxNQUFBQSxXQUpHO0FBS0h6QyxNQUFBQSxZQUxHO0FBTUhDLE1BQUFBLFNBTkc7QUFPSEMsTUFBQUEsY0FQRztBQVFISCxNQUFBQSxtQkFSRztBQVNINEQsTUFBQUEsVUFBVSxFQUFFdkIsV0FBVyxDQUFDLE1BQUQsQ0FBWCxLQUF3QixTQVRqQztBQVVIakMsTUFBQUEsT0FWRztBQVdIQyxNQUFBQSxlQVhHO0FBWUhDLE1BQUFBLFlBWkc7QUFhSCtDLE1BQUFBLFdBYkc7QUFjSEMsTUFBQUEsZUFkRztBQWVIQyxNQUFBQSxjQWZHO0FBZ0JITSxNQUFBQSxjQUFjLEVBQUV4QixXQUFXLENBQUMsUUFBRCxDQWhCeEI7QUFpQkhzQixNQUFBQSxVQWpCRztBQWtCSGhELE1BQUFBLFVBbEJHO0FBbUJINkMsTUFBQUEsZUFuQkc7QUFvQkhDLE1BQUFBLE9BcEJHO0FBcUJIQyxNQUFBQSxPQXJCRztBQXNCSG5ELE1BQUFBLG1CQXRCRztBQXVCSEMsTUFBQUEsV0F2Qkc7QUF3QkhDLE1BQUFBO0FBeEJHLEtBQVA7QUEwQkgsR0F4RjZCOztBQTBGOUJxRCxFQUFBQSxTQUFTLEdBQUc7QUFDUjFELElBQUFBLE9BQU8sR0FBRyxJQUFWO0FBQ0EsV0FBTyxLQUFLMkQsSUFBTCxDQUFVcEUsWUFBVixDQUFQO0FBQ0gsR0E3RjZCOztBQStGOUJxRSxFQUFBQSxlQUFlLENBQUNDLE9BQUQsRUFBVTtBQUNyQnBFLElBQUFBLFlBQVksR0FBR1gsS0FBSyxDQUFDK0UsT0FBTyxDQUFDcEUsWUFBVCxDQUFwQjtBQUNBRSxJQUFBQSxlQUFlLEdBQUdYLE9BQU8sRUFBekI7QUFDQVUsSUFBQUEsaUJBQWlCLEdBQUdtRSxPQUFPLENBQUNuRSxpQkFBUixJQUE2QixFQUFqRDtBQUNBSSxJQUFBQSxTQUFTLEdBQUdmLElBQUksQ0FBQyw2QkFBRCxDQUFoQjtBQUNBYyxJQUFBQSxZQUFZLEdBQUdiLE9BQU8sRUFBdEI7QUFDQWdCLElBQUFBLE9BQU8sR0FBRyxLQUFWOztBQUVBLFNBQUs4RCxtQkFBTDs7QUFFQSxXQUFPLEtBQUtILElBQUwsQ0FBVXBFLFlBQVYsQ0FBUDtBQUNILEdBMUc2Qjs7QUE0RzlCd0UsRUFBQUEsbUJBQW1CLENBQUNGLE9BQUQsRUFBVTtBQUN6QixVQUFNRyxRQUFRLEdBQUc1RSxVQUFVLENBQUMsS0FBSzZFLElBQU4sRUFBWUosT0FBTyxDQUFDSyxTQUFwQixDQUFWLENBQXlDbkIsaUJBQXpDLEVBQWpCO0FBRUFuRCxJQUFBQSxtQkFBbUIsR0FBR0QsZUFBdEI7QUFDQUEsSUFBQUEsZUFBZSxHQUFHWCxPQUFPLEVBQXpCO0FBRUFTLElBQUFBLFlBQVksR0FBR1gsS0FBSyxDQUFDK0UsT0FBTyxDQUFDcEUsWUFBVCxDQUFwQjtBQUNBQyxJQUFBQSxpQkFBaUIsR0FBR21FLE9BQU8sQ0FBQ25FLGlCQUFSLElBQTZCLEVBQWpEO0FBQ0FJLElBQUFBLFNBQVMsR0FBR2YsSUFBSSxDQUFDLHVDQUFELENBQWhCO0FBQ0FpQixJQUFBQSxPQUFPLEdBQUcsS0FBVjtBQUVBRCxJQUFBQSxjQUFjLEdBQ1ZpRSxRQUFRLEtBQUszRSxtQkFBbUIsQ0FBQzJELEdBQWpDLEdBQ01qRSxJQUFJLENBQUMsK0NBQUQsQ0FEVixHQUVNQSxJQUFJLENBQUMseUNBQUQsQ0FIZDs7QUFLQSxTQUFLK0UsbUJBQUw7O0FBRUEsV0FBTyxLQUFLSCxJQUFMLENBQVVwRSxZQUFWLENBQVA7QUFDSCxHQS9INkI7O0FBaUk5QjRFLEVBQUFBLFdBQVcsQ0FBQ04sT0FBRCxFQUFVO0FBQ2pCakUsSUFBQUEsbUJBQW1CLEdBQUdELGVBQXRCO0FBRUFGLElBQUFBLFlBQVksR0FBR1gsS0FBSyxDQUFDK0UsT0FBTyxDQUFDcEUsWUFBVCxDQUFwQjtBQUNBQyxJQUFBQSxpQkFBaUIsR0FBR21FLE9BQU8sQ0FBQ25FLGlCQUFSLElBQTZCLEVBQWpEO0FBQ0FJLElBQUFBLFNBQVMsR0FBR2YsSUFBSSxDQUFDLGdDQUFELENBQWhCO0FBQ0FjLElBQUFBLFlBQVksR0FBR2IsT0FBTyxFQUF0QjtBQUNBZSxJQUFBQSxjQUFjLEdBQUdmLE9BQU8sRUFBeEI7QUFDQWlCLElBQUFBLGVBQWUsR0FBRyxFQUFsQjtBQUNBRCxJQUFBQSxPQUFPLEdBQUcsS0FBVjtBQUVBLFdBQU8sS0FBSzJELElBQUwsQ0FBVXBFLFlBQVYsQ0FBUDtBQUNILEdBN0k2Qjs7QUErSTlCNkUsRUFBQUEsYUFBYSxDQUFDUCxPQUFELEVBQVU7QUFDbkJqRSxJQUFBQSxtQkFBbUIsR0FBR0QsZUFBdEI7QUFDQUQsSUFBQUEsaUJBQWlCLEdBQUdtRSxPQUFPLENBQUNuRSxpQkFBUixJQUE2QixFQUFqRDtBQUVBQyxJQUFBQSxlQUFlLEdBQUc0QyxnQkFBZ0IsQ0FBQ3JELE9BQU8sQ0FBQyxNQUFELEVBQVNPLFlBQVQsQ0FBUixDQUFsQztBQUVBQSxJQUFBQSxZQUFZLEdBQUdYLEtBQUssQ0FBQytFLE9BQU8sQ0FBQ3BFLFlBQVQsQ0FBcEI7QUFDQUssSUFBQUEsU0FBUyxHQUFHZixJQUFJLENBQUMsK0JBQUQsQ0FBaEI7QUFDQWMsSUFBQUEsWUFBWSxHQUFHYixPQUFPLEVBQXRCO0FBQ0FlLElBQUFBLGNBQWMsR0FBR2hCLElBQUksQ0FBQyxpQ0FBRCxDQUFyQjtBQUNBaUIsSUFBQUEsT0FBTyxHQUFHLEtBQVY7QUFFQSxXQUFPLEtBQUsyRCxJQUFMLENBQVVwRSxZQUFWLENBQVA7QUFDSCxHQTVKNkI7O0FBOEo5QjhFLEVBQUFBLGVBQWUsQ0FBQztBQUFFQyxJQUFBQTtBQUFGLEdBQUQsRUFBVztBQUN0QjFFLElBQUFBLG1CQUFtQixHQUFHRCxlQUF0QjtBQUNBQSxJQUFBQSxlQUFlLEdBQUc0RSxnQkFBZ0IsQ0FBQ0QsSUFBRCxDQUFsQztBQUVBLFdBQU8sS0FBS1gsSUFBTCxDQUFVcEUsWUFBVixDQUFQO0FBQ0gsR0FuSzZCOztBQXFLOUJpRixFQUFBQSx1QkFBdUIsQ0FBQztBQUFFQyxJQUFBQTtBQUFGLEdBQUQsRUFBZTtBQUNsQ3hFLElBQUFBLGVBQWUsR0FBR3dFLFFBQWxCO0FBQ0EsV0FBTyxLQUFLZCxJQUFMLENBQVVwRSxZQUFWLENBQVA7QUFDSCxHQXhLNkI7O0FBMEs5Qm1GLEVBQUFBLDBCQUEwQixHQUFHO0FBQ3pCeEUsSUFBQUEsWUFBWSxHQUFHLENBQUNBLFlBQWhCO0FBQ0EsV0FBTyxLQUFLeUQsSUFBTCxDQUFVcEUsWUFBVixDQUFQO0FBQ0gsR0E3SzZCOztBQStLOUJvRixFQUFBQSxZQUFZLEdBQUc7QUFDWC9FLElBQUFBLG1CQUFtQixHQUFHRCxlQUFlLENBQUNpRixHQUFoQixDQUFvQkMsT0FBTyxJQUFLQSxPQUFPLENBQUNDLEtBQVIsQ0FBY0wsUUFBZCxHQUF5QixVQUF6RCxDQUF0QjtBQUVBOUUsSUFBQUEsZUFBZSxHQUFHQyxtQkFBbEI7QUFFQSxXQUFPLEtBQUsrRCxJQUFMLENBQVVwRSxZQUFWLENBQVA7QUFDSCxHQXJMNkI7O0FBdUw5QndGLEVBQUFBLGFBQWEsQ0FBQztBQUFFeEIsSUFBQUEsVUFBRjtBQUFjeUIsSUFBQUE7QUFBZCxHQUFELEVBQXlCO0FBQ2xDMUUsSUFBQUEsY0FBYyxHQUFHaUQsVUFBakI7QUFDQWhELElBQUFBLFVBQVUsR0FBRyxJQUFiO0FBRUEsV0FBTyxLQUFLb0QsSUFBTCxDQUFVcEUsWUFBVixDQUFQO0FBQ0gsR0E1TDZCOztBQThMOUIwRixFQUFBQSwyQkFBMkIsQ0FBQ0MsTUFBRCxFQUFTO0FBQ2hDL0UsSUFBQUEsbUJBQW1CLEdBQUcrRSxNQUFNLENBQUNDLEVBQTdCO0FBQ0EvRSxJQUFBQSxXQUFXLEdBQUc4RSxNQUFNLENBQUM3QixPQUFyQjtBQUNBaEQsSUFBQUEsV0FBVyxHQUFHNkUsTUFBTSxDQUFDNUIsT0FBckI7QUFDQWhELElBQUFBLGNBQWMsR0FBRzRFLE1BQU0sQ0FBQ0UsR0FBeEI7QUFFQSxXQUFPLEtBQUt6QixJQUFMLENBQVVwRSxZQUFWLENBQVA7QUFDSCxHQXJNNkI7O0FBdU05QjhGLEVBQUFBLHVCQUF1QixDQUFDO0FBQUVDLElBQUFBO0FBQUYsR0FBRCxFQUFnQjtBQUNuQ25GLElBQUFBLG1CQUFtQixHQUFHbUYsU0FBdEI7QUFFQSxXQUFPLEtBQUszQixJQUFMLENBQVVwRSxZQUFWLENBQVA7QUFDSCxHQTNNNkI7O0FBNk05QmdHLEVBQUFBLGVBQWUsQ0FBQztBQUFFbEMsSUFBQUE7QUFBRixHQUFELEVBQWM7QUFDekJqRCxJQUFBQSxXQUFXLEdBQUdpRCxPQUFkO0FBRUEsV0FBTyxLQUFLTSxJQUFMLENBQVVwRSxZQUFWLENBQVA7QUFDSCxHQWpONkI7O0FBbU45QmlHLEVBQUFBLGVBQWUsQ0FBQztBQUFFbEMsSUFBQUE7QUFBRixHQUFELEVBQWM7QUFDekJqRCxJQUFBQSxXQUFXLEdBQUdpRCxPQUFkO0FBRUEsV0FBTyxLQUFLSyxJQUFMLENBQVVwRSxZQUFWLENBQVA7QUFDSCxHQXZONkI7O0FBeU45QmtHLEVBQUFBLFlBQVksQ0FBQztBQUFFQyxJQUFBQTtBQUFGLEdBQUQsRUFBVztBQUNuQm5GLElBQUFBLFVBQVUsR0FBR21GLElBQWI7QUFDQSxXQUFPLEtBQUsvQixJQUFMLENBQVVwRSxZQUFWLENBQVA7QUFDSCxHQTVONkI7O0FBOE45Qm9HLEVBQUFBLGtCQUFrQixDQUFDO0FBQUVwQyxJQUFBQTtBQUFGLEdBQUQsRUFBaUI7QUFDL0JqRCxJQUFBQSxjQUFjLEdBQUdpRCxVQUFVLENBQUNxQyxNQUFYLENBQWtCQyxDQUFDLElBQUloSCxDQUFDLENBQUNpSCxJQUFGLENBQU9ELENBQVAsSUFBWSxDQUFuQyxDQUFqQjtBQUNBdEYsSUFBQUEsVUFBVSxHQUFHLEVBQWI7QUFFQSxXQUFPLEtBQUtvRCxJQUFMLENBQVVwRSxZQUFWLENBQVA7QUFDSCxHQW5PNkI7O0FBcU85QndHLEVBQUFBLGVBQWUsQ0FBQztBQUFFTCxJQUFBQTtBQUFGLEdBQUQsRUFBVztBQUN0QmxGLElBQUFBLGVBQWUsR0FBRzFCLEtBQUssQ0FBQzRHLElBQUQsQ0FBdkI7QUFDQSxXQUFPLEtBQUsvQixJQUFMLENBQVVwRSxZQUFWLENBQVA7QUFDSCxHQXhPNkI7O0FBME85QnlHLEVBQUFBLE9BQU8sQ0FBQztBQUFFQyxJQUFBQTtBQUFGLEdBQUQsRUFBWTtBQUNmO0FBQ0E7QUFDQSxVQUFNQyxTQUFTLEdBQUdDLFNBQVMsQ0FBQ0YsS0FBSyxDQUFDRyxPQUFOLElBQWlCSCxLQUFsQixDQUEzQjtBQUNBLFVBQU1JLEdBQUcsR0FBR0MsUUFBUSxDQUFDSixTQUFELENBQVIsSUFBdUJBLFNBQW5DO0FBRUFsRyxJQUFBQSxPQUFPLEdBQUcsS0FBVjtBQUNBSCxJQUFBQSxZQUFZLEdBQUdkLElBQUksQ0FBQ3NILEdBQUQsQ0FBbkI7QUFDQUUsSUFBQUEsT0FBTyxDQUFDTixLQUFSLENBQWNBLEtBQUssQ0FBQ0csT0FBcEI7QUFDQSxTQUFLekMsSUFBTCxDQUFVcEUsWUFBVjtBQUNILEdBcFA2Qjs7QUFzUDlCaUgsRUFBQUEsWUFBWSxHQUFHO0FBQ1gzRyxJQUFBQSxZQUFZLEdBQUdiLE9BQU8sRUFBdEI7QUFDQSxTQUFLMkUsSUFBTCxDQUFVcEUsWUFBVjtBQUNILEdBelA2Qjs7QUEyUDlCdUUsRUFBQUEsbUJBQW1CLEdBQUc7QUFDbEIzRCxJQUFBQSxtQkFBbUIsR0FBRyxJQUF0QjtBQUNBQyxJQUFBQSxXQUFXLEdBQUcsSUFBZDtBQUNBQyxJQUFBQSxXQUFXLEdBQUcsSUFBZDtBQUNBQyxJQUFBQSxjQUFjLEdBQUcsSUFBakI7QUFDSDs7QUFoUTZCLENBQXBCLENBQWQ7O0FBbVFBLE1BQU1pRSxnQkFBZ0IsR0FBR0QsSUFBSSxJQUFJNUUsaUJBQWlCLENBQUMrRyxNQUFsQixDQUF5QixDQUFDQyxHQUFELEVBQU1DLENBQU4sS0FBYUEsQ0FBQyxDQUFDckMsSUFBRixLQUFXQSxJQUFYLEdBQWtCdkYsSUFBSSxDQUFDNEgsQ0FBRCxDQUF0QixHQUE0QkQsR0FBbEUsRUFBd0UxSCxPQUFPLEVBQS9FLENBQWpDOztBQUVBLE1BQU11RCxnQkFBZ0IsR0FBR3FFLElBQUksSUFBSWxILGlCQUFpQixDQUFDK0csTUFBbEIsQ0FBeUIsQ0FBQ0MsR0FBRCxFQUFNQyxDQUFOLEtBQWFBLENBQUMsQ0FBQ0MsSUFBRixLQUFXQSxJQUFYLEdBQWtCN0gsSUFBSSxDQUFDNEgsQ0FBRCxDQUF0QixHQUE0QkQsR0FBbEUsRUFBd0UxSCxPQUFPLEVBQS9FLENBQWpDOztBQUVBLE1BQU1vRCxhQUFhLEdBQUd5RSxZQUFZLElBQUksQ0FBQyxHQUFHQyxXQUFKLEtBQW9CO0FBQ3RELE1BQUlBLFdBQVcsQ0FBQ0MsTUFBWixLQUF1QixDQUEzQixFQUE4QixPQUFPLEVBQVA7QUFFOUIsUUFBTUMsT0FBTyxHQUFHNUUsYUFBYSxDQUFDeUUsWUFBRCxDQUE3QjtBQUVBLFFBQU0sQ0FBQ0ksSUFBRCxFQUFPLEdBQUdDLElBQVYsSUFBa0JKLFdBQXhCO0FBRUEsTUFBSUcsSUFBSSxJQUFJLElBQVosRUFDSSxPQUFPQSxJQUFJLENBQUNyQyxHQUFMLENBQVNjLElBQUksS0FBSztBQUNyQnlCLElBQUFBLEtBQUssRUFBRXpCLElBRGM7QUFFckJaLElBQUFBLEtBQUssRUFBRVksSUFGYztBQUdyQjBCLElBQUFBLFFBQVEsRUFBRVAsWUFBWSxLQUFLbkI7QUFITixHQUFMLENBQWIsQ0FBUDtBQU1KLFNBQU9zQixPQUFPLENBQUMsR0FBR0UsSUFBSixDQUFkO0FBQ0gsQ0FmRDs7QUFpQkEsTUFBTWYsU0FBUyxHQUFHa0IsR0FBRyxJQUFJO0FBQ3JCLE1BQUk7QUFDQSxXQUFPQyxJQUFJLENBQUNDLEtBQUwsQ0FBV0YsR0FBWCxDQUFQO0FBQ0gsR0FGRCxDQUVFLE9BQU9HLENBQVAsRUFBVTtBQUNSLFdBQU9ILEdBQVA7QUFDSDtBQUNKLENBTkQ7O0FBUUEsTUFBTWYsUUFBUSxHQUFHekgsQ0FBQyxDQUFDNEksUUFBRixDQUFXLGVBQVgsQ0FBakI7O0FBRUFDLE1BQU0sQ0FBQ0MsT0FBUCxHQUFpQmxILEtBQWpCIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xyXG5cclxuY29uc3QgRmx1eHhvciA9IHJlcXVpcmUoJ2ZsdXh4b3InKTtcclxuY29uc3QgXyA9IHJlcXVpcmUoJ2xvZGFzaCcpO1xyXG5cclxuY29uc3QgeyBtYXliZSwganVzdCwgbm90aGluZywgaXNOb3RoaW5nLCBnZXRQcm9wLCBnZXRQcm9wTGlmdCB9ID0gcmVxdWlyZSgnLi4vdXRpbHMvbWF5YmUnKTtcclxuY29uc3QgeyBnZXRQcmludGVyIH0gPSByZXF1aXJlKCcuLi91dGlscy9wcmludGVyRGV0YWlscycpO1xyXG5jb25zdCB7IFByaW50ZXJDb25uVHlwZUVudW0gfSA9IHJlcXVpcmUoJy4uL2NvbnN0YW50cycpO1xyXG5jb25zdCB7IEFjdGlvbnMsIENIQU5HRV9FVkVOVCwgTmV0d29ya1N0YXRlRW51bSB9ID0gcmVxdWlyZSgnLi4vY29uc3RhbnRzL25ldHdvcmtQcmVmZXJlbmNlcycpO1xyXG5cclxuLy8gTmV0d29yayBTdGF0ZVxyXG5sZXQgbmV0d29ya1N0YXRlID0gbm90aGluZygpO1xyXG5sZXQgYXZhaWxhYmxlTmV0d29ya3MgPSBbXTtcclxubGV0IHNlbGVjdGVkTmV0d29yayA9IG5vdGhpbmcoKTtcclxubGV0IHByZXZTZWxlY3RlZE5ldHdvcmsgPSBub3RoaW5nKCk7XHJcblxyXG4vLyBNZXNzYWdpbmdcclxubGV0IGN1cnJlbnRFcnJvciA9IG5vdGhpbmcoKTtcclxubGV0IHN0YXR1c01zZyA9IG5vdGhpbmcoKTtcclxubGV0IGN1cnJlbnRNZXNzYWdlID0gbm90aGluZygpO1xyXG5cclxuLy8gUHJvZ3Jlc3MgaW5kaWNhdGlvbjpcclxubGV0IHdhaXRpbmcgPSBmYWxzZTtcclxuXHJcbi8vIFdJRkkgUGFzc3dvcmRcclxubGV0IHBhc3N3b3JkQXR0ZW1wdCA9ICcnO1xyXG5sZXQgc2hvd1Bhc3N3b3JkID0gZmFsc2U7XHJcblxyXG4vLyBTdGF0aWMgSVAgRWRpdCBjb250YWluZXJzOlxyXG4vLyBXaGVuIHRoZSB1c2VyIGVuYWJsZXMgc3RhdGljIElQLCB3ZSBuZWVkIHRoZSByZWFsIHZhbHVlcyBmcm9tIHRoZSBwcmludGVyLFxyXG4vLyBidXQgY2hhbmdlcyBkb24ndCB0YWtlIGVmZmVjdCB1bnRpbCB0aGUgdXNlciBoaXRzICdhcHBseScsIHRodXMgd2UgbmVlZFxyXG4vLyB0byBoYXZlIGNvbnRhaW5lcnMgdG8gZWRpdCB0aGUgdmFsdWVzIHdpdGhvdXQgY2hhbmdpbmcgdGhlIHByZWNlaXZlZCBzdGF0ZVxyXG4vLyBvZiB0aGUgcHJpbnRlci5cclxuLy8gTk9URTogVGhlcmUgaXMgY3VycmVudGx5IE5PIFZBTElEQVRJT04gYXMgcGVyIHRoZSBzcGVjLCB0aGF0IG1heSBjaGFuZ2UuLi5cclxubGV0IGVkaXRTdGF0aWNJUEFkZHJlc3MgPSBudWxsO1xyXG5sZXQgZWRpdE5ldG1hc2sgPSBudWxsO1xyXG5sZXQgZWRpdEdhdGV3YXkgPSBudWxsO1xyXG5sZXQgZWRpdEROU1NlcnZlcnMgPSBudWxsO1xyXG5sZXQgbmV3RE5TSXRlbSA9ICcnO1xyXG5sZXQgc2VsZWN0ZWRETlNJdGVtID0gbm90aGluZygpO1xyXG5cclxuY29uc3QgU3RvcmUgPSBGbHV4eG9yLmNyZWF0ZVN0b3JlKHtcclxuICAgIGFjdGlvbnM6IHtcclxuICAgICAgICBbQWN0aW9ucy5XYWl0aW5nXTogJ29uV2FpdGluZycsXHJcbiAgICAgICAgW0FjdGlvbnMuQ29ubmVjdGluZ106ICdvbkNvbm5lY3RpbmcnLFxyXG4gICAgICAgIFtBY3Rpb25zLldpZmlDb25uZWN0ZWRdOiAnb25XaWZpQ29ubmVjdGVkJyxcclxuICAgICAgICBbQWN0aW9ucy5FdGhlcm5ldENvbm5lY3RlZF06ICdvbkV0aGVybmV0Q29ubmVjdGVkJyxcclxuICAgICAgICBbQWN0aW9ucy5XaWZpUmVhZHldOiAnb25XaWZpUmVhZHknLFxyXG4gICAgICAgIFtBY3Rpb25zLlVuY29ubmVjdGVkXTogJ29uVW5jb25uZWN0ZWQnLFxyXG4gICAgICAgIFtBY3Rpb25zLlNlbGVjdE5ldHdvcmtdOiAnb25TZWxlY3ROZXR3b3JrJyxcclxuICAgICAgICBbQWN0aW9ucy5DaGFuZ2VQYXNzd29yZEF0dGVtcHRdOiAnb25DaGFuZ2VQYXNzd29yZEF0dGVtcHQnLFxyXG4gICAgICAgIFtBY3Rpb25zLlRvZ2dsZVBhc3N3b3JkVmlzaWJpbGl0eV06ICdvblRvZ2dsZVBhc3N3b3JkVmlzaWJpbGl0eScsXHJcbiAgICAgICAgW0FjdGlvbnMuV2lmaUZvcmdldF06ICdvbldpZmlGb3JnZXQnLFxyXG4gICAgICAgIFtBY3Rpb25zLlByZXBvcHVsYXRlU3RhdGljSVBGaWVsZHNdOiAnb25QcmVwb3B1bGF0ZVN0YXRpY0lQRmllbGRzJyxcclxuICAgICAgICBbQWN0aW9ucy5DaGFuZ2VTdGF0aWNJUEFkZHJlc3NdOiAnb25DaGFuZ2VTdGF0aWNJUEFkZHJlc3MnLFxyXG4gICAgICAgIFtBY3Rpb25zLkNoYW5nZU5ldG1hc2tdOiAnb25DaGFuZ2VOZXRtYXNrJyxcclxuICAgICAgICBbQWN0aW9ucy5DaGFuZ2VHYXRld2F5XTogJ29uQ2hhbmdlR2F0ZXdheScsXHJcbiAgICAgICAgW0FjdGlvbnMuQ2hhbmdlRE5TU2VydmVyc106ICdvbkNoYW5nZUROU1NlcnZlcnMnLFxyXG4gICAgICAgIFtBY3Rpb25zLlNlbGVjdEROU0l0ZW1dOiAnb25TZWxlY3RETlNJdGVtJyxcclxuICAgICAgICBbQWN0aW9ucy5OZXdETlNJdGVtXTogJ29uTmV3RE5TSXRlbScsXHJcbiAgICAgICAgW0FjdGlvbnMuU2V0U3RhdGljSVBdOiAnb25TZXRTdGF0aWNJUCcsXHJcbiAgICAgICAgW0FjdGlvbnMuRXJyb3JdOiAnb25FcnJvcicsXHJcbiAgICAgICAgW0FjdGlvbnMuQ2xlYXJFcnJvcl06ICdvbkNsZWFyRXJyb3InLFxyXG4gICAgfSxcclxuXHJcbiAgICBnZXRTdGF0ZSgpIHtcclxuICAgICAgICBjb25zdCBuZXR3b3JrUHJvcCA9IHByb3AgPT4gZ2V0UHJvcExpZnQocHJvcCwgbmV0d29ya1N0YXRlKTtcclxuICAgICAgICBjb25zdCBnZXRETlMgPSBnZXRETlNTZXJ2ZXJzKHNlbGVjdGVkRE5TSXRlbS5saWZ0KCkpO1xyXG5cclxuICAgICAgICBjb25zdCBjdXJyZW50UGF0aCA9IGdldFByb3BMaWZ0KCdwYXRoJywgZ2V0TmV0d29ya0J5TmFtZShuZXR3b3JrUHJvcCgnbmFtZScpKSk7XHJcblxyXG4gICAgICAgIGNvbnN0IG9mZmxpbmUgPSBuZXR3b3JrUHJvcCgnc3RhdGUnKSA9PT0gTmV0d29ya1N0YXRlRW51bS5zdGF0ZS5PRkZMSU5FO1xyXG5cclxuICAgICAgICBjb25zdCBjb25uZWN0ZWRCeUV0aGVybmV0ID0gbmV0d29ya1Byb3AoJ3N0YXRlJykgPT09IE5ldHdvcmtTdGF0ZUVudW0uc3RhdGUuRVRIRVJORVQ7XHJcblxyXG4gICAgICAgIC8vIHdlIG5lZWQgdHdvIGRpZmZlcmVudCBcImNhbiBlZGl0XCIgZmxhZ3MsIG9uZSBmb3Igd2lmaSwgYW5kIHRoZSBvdGhlclxyXG4gICAgICAgIC8vIGZvciBzdGF0aWMgSVAuIFRoZXkgYm90aCBzaGFyZSBzb21lIGNvbW1vbiBhdHRyaWJ1dGVzLCBzbyBJIGJyb2tlXHJcbiAgICAgICAgLy8gdGhhdCBvdXQgaW50byBhIHNpbmdsZSBmbGFnLiBUaGF0J3Mgd2h5IGl0J3MgdGhlIFwiYmFzZVwiLlxyXG4gICAgICAgIGNvbnN0IGNhbkVkaXRCYXNlID0gcHJpbnRlciA9PlxyXG4gICAgICAgICAgICBwcmludGVyLmdldENvbm5lY3Rpb25UeXBlKCkgPT09IFByaW50ZXJDb25uVHlwZUVudW0uVVNCICYmICFpc05vdGhpbmcobmV0d29ya1N0YXRlKSAmJiAhd2FpdGluZztcclxuXHJcbiAgICAgICAgY29uc3QgY2FuRWRpdFdpZmkgPSBwcmludGVyID0+IGNhbkVkaXRCYXNlKHByaW50ZXIpICYmICFjb25uZWN0ZWRCeUV0aGVybmV0O1xyXG5cclxuICAgICAgICAvLyBvZmZsaW5lIGJ1dCB3aXRoIG5ldHdvcmsgc2VsZWN0ZWQsIG9yIGNvbm5lY3RlZCBieSBldGhlcm5ldFxyXG4gICAgICAgIGNvbnN0IGNhbkVkaXRTdGF0aWNJUCA9IHByaW50ZXIgPT5cclxuICAgICAgICAgICAgY2FuRWRpdEJhc2UocHJpbnRlcikgJiYgKChvZmZsaW5lICYmICFpc05vdGhpbmcoc2VsZWN0ZWROZXR3b3JrKSkgfHwgY29ubmVjdGVkQnlFdGhlcm5ldCk7XHJcblxyXG4gICAgICAgIC8vIHdlJ2xsIGJlIGVuYWJsaW5nIHNvbWUgYnV0dG9ucyBkZXBlbmRpbmcgb24gd2hldGhlciB0aGlzIHN0dWZmXHJcbiAgICAgICAgLy8gaGFzIGJlZW4gZWRpdGVkIGJ5IHRoZSB1c2VyXHJcbiAgICAgICAgY29uc3Qgc3RhdGljSVBFZGl0ZWQgPSAhIShlZGl0U3RhdGljSVBBZGRyZXNzIHx8IGVkaXROZXRtYXNrIHx8IGVkaXRHYXRld2F5IHx8IGVkaXRETlNTZXJ2ZXJzKTtcclxuXHJcbiAgICAgICAgY29uc3Qgc3RhdGljSVBBZGRyZXNzID0gZ2V0UHJvcExpZnQoJ2lwJywgbmV0d29ya1N0YXRlKSB8fCBnZXRQcm9wTGlmdCgnaXAnLCBzZWxlY3RlZE5ldHdvcmspO1xyXG5cclxuICAgICAgICBjb25zdCBuZXRtYXNrID0gZ2V0UHJvcExpZnQoJ25ldG1hc2snLCBuZXR3b3JrU3RhdGUpIHx8IGdldFByb3BMaWZ0KCduZXRtYXNrJywgc2VsZWN0ZWROZXR3b3JrKTtcclxuXHJcbiAgICAgICAgY29uc3QgZ2F0ZXdheSA9IGdldFByb3BMaWZ0KCdnYXRld2F5JywgbmV0d29ya1N0YXRlKSB8fCBnZXRQcm9wTGlmdCgnZ2F0ZXdheScsIHNlbGVjdGVkTmV0d29yayk7XHJcblxyXG4gICAgICAgIGNvbnN0IGRuc1NlcnZlcnMgPSBnZXRETlMoXHJcbiAgICAgICAgICAgIGVkaXRETlNTZXJ2ZXJzLFxyXG4gICAgICAgICAgICBnZXRQcm9wTGlmdCgnZG5zJywgc2VsZWN0ZWROZXR3b3JrKSxcclxuICAgICAgICAgICAgZ2V0UHJvcExpZnQoJ2RucycsIG5ldHdvcmtTdGF0ZSlcclxuICAgICAgICApO1xyXG5cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBuZXR3b3JrU3RhdGUsXHJcbiAgICAgICAgICAgIGF2YWlsYWJsZU5ldHdvcmtzLFxyXG4gICAgICAgICAgICBzZWxlY3RlZE5ldHdvcmssXHJcbiAgICAgICAgICAgIGN1cnJlbnRQYXRoLFxyXG4gICAgICAgICAgICBjdXJyZW50RXJyb3IsXHJcbiAgICAgICAgICAgIHN0YXR1c01zZyxcclxuICAgICAgICAgICAgY3VycmVudE1lc3NhZ2UsXHJcbiAgICAgICAgICAgIHByZXZTZWxlY3RlZE5ldHdvcmssXHJcbiAgICAgICAgICAgIGVuYWJsZVdpZmk6IG5ldHdvcmtQcm9wKCd3aWZpJykgPT09ICdlbmFibGVkJyxcclxuICAgICAgICAgICAgd2FpdGluZyxcclxuICAgICAgICAgICAgcGFzc3dvcmRBdHRlbXB0LFxyXG4gICAgICAgICAgICBzaG93UGFzc3dvcmQsXHJcbiAgICAgICAgICAgIGNhbkVkaXRXaWZpLFxyXG4gICAgICAgICAgICBjYW5FZGl0U3RhdGljSVAsXHJcbiAgICAgICAgICAgIHN0YXRpY0lQRWRpdGVkLFxyXG4gICAgICAgICAgICBlbmFibGVTdGF0aWNJUDogbmV0d29ya1Byb3AoJ3N0YXRpYycpLFxyXG4gICAgICAgICAgICBkbnNTZXJ2ZXJzLFxyXG4gICAgICAgICAgICBuZXdETlNJdGVtLFxyXG4gICAgICAgICAgICBzdGF0aWNJUEFkZHJlc3MsXHJcbiAgICAgICAgICAgIG5ldG1hc2ssXHJcbiAgICAgICAgICAgIGdhdGV3YXksXHJcbiAgICAgICAgICAgIGVkaXRTdGF0aWNJUEFkZHJlc3MsXHJcbiAgICAgICAgICAgIGVkaXROZXRtYXNrLFxyXG4gICAgICAgICAgICBlZGl0R2F0ZXdheSxcclxuICAgICAgICB9O1xyXG4gICAgfSxcclxuXHJcbiAgICBvbldhaXRpbmcoKSB7XHJcbiAgICAgICAgd2FpdGluZyA9IHRydWU7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZW1pdChDSEFOR0VfRVZFTlQpO1xyXG4gICAgfSxcclxuXHJcbiAgICBvbldpZmlDb25uZWN0ZWQocGF5bG9hZCkge1xyXG4gICAgICAgIG5ldHdvcmtTdGF0ZSA9IG1heWJlKHBheWxvYWQubmV0d29ya1N0YXRlKTtcclxuICAgICAgICBzZWxlY3RlZE5ldHdvcmsgPSBub3RoaW5nKCk7XHJcbiAgICAgICAgYXZhaWxhYmxlTmV0d29ya3MgPSBwYXlsb2FkLmF2YWlsYWJsZU5ldHdvcmtzIHx8IFtdO1xyXG4gICAgICAgIHN0YXR1c01zZyA9IGp1c3QoJ21iOm5ldHdvcmsuc3RhdHVzLmNvbm5lY3RlZCcpO1xyXG4gICAgICAgIGN1cnJlbnRFcnJvciA9IG5vdGhpbmcoKTtcclxuICAgICAgICB3YWl0aW5nID0gZmFsc2U7XHJcblxyXG4gICAgICAgIHRoaXMuX3Jlc2V0U3RhdGljSVBFZGl0cygpO1xyXG5cclxuICAgICAgICByZXR1cm4gdGhpcy5lbWl0KENIQU5HRV9FVkVOVCk7XHJcbiAgICB9LFxyXG5cclxuICAgIG9uRXRoZXJuZXRDb25uZWN0ZWQocGF5bG9hZCkge1xyXG4gICAgICAgIGNvbnN0IGNvbm5UeXBlID0gZ2V0UHJpbnRlcih0aGlzLmZsdXgsIHBheWxvYWQucHJpbnRlcklkKS5nZXRDb25uZWN0aW9uVHlwZSgpO1xyXG5cclxuICAgICAgICBwcmV2U2VsZWN0ZWROZXR3b3JrID0gc2VsZWN0ZWROZXR3b3JrO1xyXG4gICAgICAgIHNlbGVjdGVkTmV0d29yayA9IG5vdGhpbmcoKTtcclxuXHJcbiAgICAgICAgbmV0d29ya1N0YXRlID0gbWF5YmUocGF5bG9hZC5uZXR3b3JrU3RhdGUpO1xyXG4gICAgICAgIGF2YWlsYWJsZU5ldHdvcmtzID0gcGF5bG9hZC5hdmFpbGFibGVOZXR3b3JrcyB8fCBbXTtcclxuICAgICAgICBzdGF0dXNNc2cgPSBqdXN0KCdtYjpuZXR3b3JrLnN0YXR1cy5jb25uZWN0ZWRCeUV0aGVybmV0Jyk7XHJcbiAgICAgICAgd2FpdGluZyA9IGZhbHNlO1xyXG5cclxuICAgICAgICBjdXJyZW50TWVzc2FnZSA9XHJcbiAgICAgICAgICAgIGNvbm5UeXBlID09PSBQcmludGVyQ29ublR5cGVFbnVtLlVTQlxyXG4gICAgICAgICAgICAgICAgPyBqdXN0KCdtYjpuZXR3b3JrLm1lc3NhZ2VzLmNvbm5lY3RlZEJ5RXRoZXJuZXRBbmRVc2InKVxyXG4gICAgICAgICAgICAgICAgOiBqdXN0KCdtYjpuZXR3b3JrLm1lc3NhZ2VzLmNvbm5lY3RlZEJ5RXRoZXJuZXQnKTtcclxuXHJcbiAgICAgICAgdGhpcy5fcmVzZXRTdGF0aWNJUEVkaXRzKCk7XHJcblxyXG4gICAgICAgIHJldHVybiB0aGlzLmVtaXQoQ0hBTkdFX0VWRU5UKTtcclxuICAgIH0sXHJcblxyXG4gICAgb25XaWZpUmVhZHkocGF5bG9hZCkge1xyXG4gICAgICAgIHByZXZTZWxlY3RlZE5ldHdvcmsgPSBzZWxlY3RlZE5ldHdvcms7XHJcblxyXG4gICAgICAgIG5ldHdvcmtTdGF0ZSA9IG1heWJlKHBheWxvYWQubmV0d29ya1N0YXRlKTtcclxuICAgICAgICBhdmFpbGFibGVOZXR3b3JrcyA9IHBheWxvYWQuYXZhaWxhYmxlTmV0d29ya3MgfHwgW107XHJcbiAgICAgICAgc3RhdHVzTXNnID0ganVzdCgnbWI6bmV0d29yay5zdGF0dXMubm90Q29ubmVjdGVkJyk7XHJcbiAgICAgICAgY3VycmVudEVycm9yID0gbm90aGluZygpO1xyXG4gICAgICAgIGN1cnJlbnRNZXNzYWdlID0gbm90aGluZygpO1xyXG4gICAgICAgIHBhc3N3b3JkQXR0ZW1wdCA9ICcnO1xyXG4gICAgICAgIHdhaXRpbmcgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZW1pdChDSEFOR0VfRVZFTlQpO1xyXG4gICAgfSxcclxuXHJcbiAgICBvblVuY29ubmVjdGVkKHBheWxvYWQpIHtcclxuICAgICAgICBwcmV2U2VsZWN0ZWROZXR3b3JrID0gc2VsZWN0ZWROZXR3b3JrO1xyXG4gICAgICAgIGF2YWlsYWJsZU5ldHdvcmtzID0gcGF5bG9hZC5hdmFpbGFibGVOZXR3b3JrcyB8fCBbXTtcclxuXHJcbiAgICAgICAgc2VsZWN0ZWROZXR3b3JrID0gZ2V0TmV0d29ya0J5TmFtZShnZXRQcm9wKCduYW1lJywgbmV0d29ya1N0YXRlKSk7XHJcblxyXG4gICAgICAgIG5ldHdvcmtTdGF0ZSA9IG1heWJlKHBheWxvYWQubmV0d29ya1N0YXRlKTtcclxuICAgICAgICBzdGF0dXNNc2cgPSBqdXN0KCdtYjpuZXR3b3JrLnN0YXR1cy51bmNvbm5lY3RlZCcpO1xyXG4gICAgICAgIGN1cnJlbnRFcnJvciA9IG5vdGhpbmcoKTtcclxuICAgICAgICBjdXJyZW50TWVzc2FnZSA9IGp1c3QoJ21iOm5ldHdvcmsubWVzc2FnZXMudW5jb25uZWN0ZWQnKTtcclxuICAgICAgICB3YWl0aW5nID0gZmFsc2U7XHJcblxyXG4gICAgICAgIHJldHVybiB0aGlzLmVtaXQoQ0hBTkdFX0VWRU5UKTtcclxuICAgIH0sXHJcblxyXG4gICAgb25TZWxlY3ROZXR3b3JrKHsgcGF0aCB9KSB7XHJcbiAgICAgICAgcHJldlNlbGVjdGVkTmV0d29yayA9IHNlbGVjdGVkTmV0d29yaztcclxuICAgICAgICBzZWxlY3RlZE5ldHdvcmsgPSBnZXROZXR3b3JrQnlQYXRoKHBhdGgpO1xyXG5cclxuICAgICAgICByZXR1cm4gdGhpcy5lbWl0KENIQU5HRV9FVkVOVCk7XHJcbiAgICB9LFxyXG5cclxuICAgIG9uQ2hhbmdlUGFzc3dvcmRBdHRlbXB0KHsgcGFzc3dvcmQgfSkge1xyXG4gICAgICAgIHBhc3N3b3JkQXR0ZW1wdCA9IHBhc3N3b3JkO1xyXG4gICAgICAgIHJldHVybiB0aGlzLmVtaXQoQ0hBTkdFX0VWRU5UKTtcclxuICAgIH0sXHJcblxyXG4gICAgb25Ub2dnbGVQYXNzd29yZFZpc2liaWxpdHkoKSB7XHJcbiAgICAgICAgc2hvd1Bhc3N3b3JkID0gIXNob3dQYXNzd29yZDtcclxuICAgICAgICByZXR1cm4gdGhpcy5lbWl0KENIQU5HRV9FVkVOVCk7XHJcbiAgICB9LFxyXG5cclxuICAgIG9uV2lmaUZvcmdldCgpIHtcclxuICAgICAgICBwcmV2U2VsZWN0ZWROZXR3b3JrID0gc2VsZWN0ZWROZXR3b3JrLm1hcChuZXR3b3JrID0+IChuZXR3b3JrLnZhbHVlLnBhc3N3b3JkID0gJ3JlcXVpcmVkJykpO1xyXG5cclxuICAgICAgICBzZWxlY3RlZE5ldHdvcmsgPSBwcmV2U2VsZWN0ZWROZXR3b3JrO1xyXG5cclxuICAgICAgICByZXR1cm4gdGhpcy5lbWl0KENIQU5HRV9FVkVOVCk7XHJcbiAgICB9LFxyXG5cclxuICAgIG9uU2V0U3RhdGljSVAoeyBkbnNTZXJ2ZXJzLCBlbmFibGUgfSkge1xyXG4gICAgICAgIGVkaXRETlNTZXJ2ZXJzID0gZG5zU2VydmVycztcclxuICAgICAgICBuZXdETlNJdGVtID0gbnVsbDtcclxuXHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZW1pdChDSEFOR0VfRVZFTlQpO1xyXG4gICAgfSxcclxuXHJcbiAgICBvblByZXBvcHVsYXRlU3RhdGljSVBGaWVsZHMocmVzdWx0KSB7XHJcbiAgICAgICAgZWRpdFN0YXRpY0lQQWRkcmVzcyA9IHJlc3VsdC5pcDtcclxuICAgICAgICBlZGl0TmV0bWFzayA9IHJlc3VsdC5uZXRtYXNrO1xyXG4gICAgICAgIGVkaXRHYXRld2F5ID0gcmVzdWx0LmdhdGV3YXk7XHJcbiAgICAgICAgZWRpdEROU1NlcnZlcnMgPSByZXN1bHQuZG5zO1xyXG5cclxuICAgICAgICByZXR1cm4gdGhpcy5lbWl0KENIQU5HRV9FVkVOVCk7XHJcbiAgICB9LFxyXG5cclxuICAgIG9uQ2hhbmdlU3RhdGljSVBBZGRyZXNzKHsgaXBBZGRyZXNzIH0pIHtcclxuICAgICAgICBlZGl0U3RhdGljSVBBZGRyZXNzID0gaXBBZGRyZXNzO1xyXG5cclxuICAgICAgICByZXR1cm4gdGhpcy5lbWl0KENIQU5HRV9FVkVOVCk7XHJcbiAgICB9LFxyXG5cclxuICAgIG9uQ2hhbmdlTmV0bWFzayh7IG5ldG1hc2sgfSkge1xyXG4gICAgICAgIGVkaXROZXRtYXNrID0gbmV0bWFzaztcclxuXHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZW1pdChDSEFOR0VfRVZFTlQpO1xyXG4gICAgfSxcclxuXHJcbiAgICBvbkNoYW5nZUdhdGV3YXkoeyBnYXRld2F5IH0pIHtcclxuICAgICAgICBlZGl0R2F0ZXdheSA9IGdhdGV3YXk7XHJcblxyXG4gICAgICAgIHJldHVybiB0aGlzLmVtaXQoQ0hBTkdFX0VWRU5UKTtcclxuICAgIH0sXHJcblxyXG4gICAgb25OZXdETlNJdGVtKHsgaXRlbSB9KSB7XHJcbiAgICAgICAgbmV3RE5TSXRlbSA9IGl0ZW07XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZW1pdChDSEFOR0VfRVZFTlQpO1xyXG4gICAgfSxcclxuXHJcbiAgICBvbkNoYW5nZUROU1NlcnZlcnMoeyBkbnNTZXJ2ZXJzIH0pIHtcclxuICAgICAgICBlZGl0RE5TU2VydmVycyA9IGRuc1NlcnZlcnMuZmlsdGVyKHMgPT4gXy5zaXplKHMpID4gMCk7XHJcbiAgICAgICAgbmV3RE5TSXRlbSA9ICcnO1xyXG5cclxuICAgICAgICByZXR1cm4gdGhpcy5lbWl0KENIQU5HRV9FVkVOVCk7XHJcbiAgICB9LFxyXG5cclxuICAgIG9uU2VsZWN0RE5TSXRlbSh7IGl0ZW0gfSkge1xyXG4gICAgICAgIHNlbGVjdGVkRE5TSXRlbSA9IG1heWJlKGl0ZW0pO1xyXG4gICAgICAgIHJldHVybiB0aGlzLmVtaXQoQ0hBTkdFX0VWRU5UKTtcclxuICAgIH0sXHJcblxyXG4gICAgb25FcnJvcih7IGVycm9yIH0pIHtcclxuICAgICAgICAvLyByaWRpY3Vsb3VzIGVycm9yIGhhbmRsaW5nLCBiZWNhdXNlIGVycm9ycyBoZXJlIGNhbiBjb21lIGluIGEgdmFyaWV0eVxyXG4gICAgICAgIC8vIG9mIHNoYXBlcyBhbmQgc2l6ZXMuLi5cclxuICAgICAgICBjb25zdCBwYXJzZWRFcnIgPSBwYXJzZUpTT04oZXJyb3IubWVzc2FnZSB8fCBlcnJvcik7XHJcbiAgICAgICAgY29uc3QgZXJyID0gZXJyb3JNc2cocGFyc2VkRXJyKSB8fCBwYXJzZWRFcnI7XHJcblxyXG4gICAgICAgIHdhaXRpbmcgPSBmYWxzZTtcclxuICAgICAgICBjdXJyZW50RXJyb3IgPSBqdXN0KGVycik7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcihlcnJvci5tZXNzYWdlKTtcclxuICAgICAgICB0aGlzLmVtaXQoQ0hBTkdFX0VWRU5UKTtcclxuICAgIH0sXHJcblxyXG4gICAgb25DbGVhckVycm9yKCkge1xyXG4gICAgICAgIGN1cnJlbnRFcnJvciA9IG5vdGhpbmcoKTtcclxuICAgICAgICB0aGlzLmVtaXQoQ0hBTkdFX0VWRU5UKTtcclxuICAgIH0sXHJcblxyXG4gICAgX3Jlc2V0U3RhdGljSVBFZGl0cygpIHtcclxuICAgICAgICBlZGl0U3RhdGljSVBBZGRyZXNzID0gbnVsbDtcclxuICAgICAgICBlZGl0TmV0bWFzayA9IG51bGw7XHJcbiAgICAgICAgZWRpdEdhdGV3YXkgPSBudWxsO1xyXG4gICAgICAgIGVkaXRETlNTZXJ2ZXJzID0gbnVsbDtcclxuICAgIH0sXHJcbn0pO1xyXG5cclxuY29uc3QgZ2V0TmV0d29ya0J5UGF0aCA9IHBhdGggPT4gYXZhaWxhYmxlTmV0d29ya3MucmVkdWNlKChhY2MsIHYpID0+ICh2LnBhdGggPT09IHBhdGggPyBqdXN0KHYpIDogYWNjKSwgbm90aGluZygpKTtcclxuXHJcbmNvbnN0IGdldE5ldHdvcmtCeU5hbWUgPSBuYW1lID0+IGF2YWlsYWJsZU5ldHdvcmtzLnJlZHVjZSgoYWNjLCB2KSA9PiAodi5uYW1lID09PSBuYW1lID8ganVzdCh2KSA6IGFjYyksIG5vdGhpbmcoKSk7XHJcblxyXG5jb25zdCBnZXRETlNTZXJ2ZXJzID0gc2VsZWN0ZWRJdGVtID0+ICguLi5zZXJ2ZXJMaXN0cykgPT4ge1xyXG4gICAgaWYgKHNlcnZlckxpc3RzLmxlbmd0aCA9PT0gMCkgcmV0dXJuIFtdO1xyXG5cclxuICAgIGNvbnN0IHJlY3Vyc2UgPSBnZXRETlNTZXJ2ZXJzKHNlbGVjdGVkSXRlbSk7XHJcblxyXG4gICAgY29uc3QgW2hlYWQsIC4uLnRhaWxdID0gc2VydmVyTGlzdHM7XHJcblxyXG4gICAgaWYgKGhlYWQgIT0gbnVsbClcclxuICAgICAgICByZXR1cm4gaGVhZC5tYXAoaXRlbSA9PiAoe1xyXG4gICAgICAgICAgICBsYWJlbDogaXRlbSxcclxuICAgICAgICAgICAgdmFsdWU6IGl0ZW0sXHJcbiAgICAgICAgICAgIHNlbGVjdGVkOiBzZWxlY3RlZEl0ZW0gPT09IGl0ZW0sXHJcbiAgICAgICAgfSkpO1xyXG5cclxuICAgIHJldHVybiByZWN1cnNlKC4uLnRhaWwpO1xyXG59O1xyXG5cclxuY29uc3QgcGFyc2VKU09OID0gbXNnID0+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgICAgcmV0dXJuIEpTT04ucGFyc2UobXNnKTtcclxuICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICByZXR1cm4gbXNnO1xyXG4gICAgfVxyXG59O1xyXG5cclxuY29uc3QgZXJyb3JNc2cgPSBfLnByb3BlcnR5KCdlcnJvci5tZXNzYWdlJyk7XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IFN0b3JlO1xyXG4iXX0=
