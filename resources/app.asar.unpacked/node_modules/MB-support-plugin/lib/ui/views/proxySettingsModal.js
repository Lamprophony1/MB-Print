'use strict';

const React = require('react');

const DOM = React.DOM;
const ce = React.createElement;

const FluxComponent = require('eagle-print/views/flux_component');

const Dropdown = require('eagle-print/views/ui/input_dropdown');

const crypto = require('crypto');

class ProxySettingsModal extends FluxComponent {
  constructor(props) {
    super(props);
    this.configService = this.getFlux().getService('ConfigService');
    this.i18n = this.getFlux().getService('TranslationService');
    this.trackingService = this.getFlux().getService('TrackingService');
    this.state = {
      protocol: 'http://',
      address: '',
      port: '',
      username: '',
      password: ''
    };
  }

  componentDidMount() {
    // Grab config and set the state.
    const proxyConfig = this.configService.get('proxySettings');

    if (proxyConfig) {
      const password = proxyConfig.password ? this._decryptPassword(proxyConfig.password) : '';
      this.setState({
        protocol: proxyConfig.protocol,
        address: proxyConfig.address,
        port: proxyConfig.port,
        username: proxyConfig.username,
        password
      });
    }
  }

  _encryptPassword(password) {
    const cipher = crypto.createCipher('aes192', 'full speed ahead');
    return cipher.update(password, 'utf8', 'base64') + cipher.final('base64');
  }

  _decryptPassword(encryptedPassword) {
    const decipher = crypto.createDecipher('aes192', 'full speed ahead');
    return decipher.update(encryptedPassword, 'base64', 'utf8') + decipher.final('utf8');
  }

  saveProxySettings() {
    const proxySettings = Object.assign({}, this.state);

    if (proxySettings.password) {
      proxySettings.password = this._encryptPassword(proxySettings.password);
    }

    this.trackingService.addEvent({
      name: 'Proxy Settings Saved'
    });
    this.configService.set('proxySettings', proxySettings);
    this.configService.save();
    this.props.onDone();
  }

  handleProtocolChange(option) {
    this.setState({
      protocol: option.value
    });
  }

  handleAddressChange(e) {
    this.setState({
      address: e.target.value
    });
  }

  handlePortChange(e) {
    this.setState({
      port: e.target.value
    });
  }

  handleUserNameChange(e) {
    this.setState({
      username: e.target.value
    });
  }

  handlePasswordChange(e) {
    this.setState({
      password: e.target.value
    });
  }

  render() {
    return DOM.div({
      className: 'proxy-settings-modal'
    }, DOM.div({
      className: 'form-group'
    }, DOM.div({}, DOM.h3({}, this.i18n.t('proxy_settings.modal_header'))), DOM.div({}, DOM.label({}, this.i18n.t('proxy_settings.protocol')), DOM.br({}), ce(Dropdown, {
      name: 'protocol',
      value: this.state.protocol,
      options: [{
        value: 'http://',
        label: this.i18n.t('proxy_settings.http')
      }, {
        value: 'https://',
        label: this.i18n.t('proxy_settings.https')
      }],
      onChange: this.handleProtocolChange.bind(this)
    })), DOM.div({}, DOM.label({}, this.i18n.t('proxy_settings.address')), DOM.br({}), DOM.input({
      value: this.state.address,
      onChange: this.handleAddressChange.bind(this)
    })), DOM.div({}, DOM.label({}, this.i18n.t('proxy_settings.port')), DOM.br({}), DOM.input({
      value: this.state.port,
      onChange: this.handlePortChange.bind(this)
    })), DOM.div({}, DOM.label({}, this.i18n.t('proxy_settings.user')), DOM.br({}), DOM.input({
      value: this.state.username,
      onChange: this.handleUserNameChange.bind(this)
    })), DOM.div({}, DOM.label({}, this.i18n.t('proxy_settings.password')), DOM.br({}), DOM.input({
      value: this.state.password,
      type: 'password',
      onChange: this.handlePasswordChange.bind(this)
    }))), DOM.div({
      className: 'buttonGroup'
    }, DOM.button({
      className: 'button secondary',
      onClick: () => this.props.onDone()
    }, this.i18n.t('system_preferences.cancel')), DOM.button({
      className: 'button primary',
      onClick: () => this.saveProxySettings()
    }, this.i18n.t('system_preferences.save'))));
  }

}

module.exports = ProxySettingsModal;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInByb3h5U2V0dGluZ3NNb2RhbC5qcyJdLCJuYW1lcyI6WyJSZWFjdCIsInJlcXVpcmUiLCJET00iLCJjZSIsImNyZWF0ZUVsZW1lbnQiLCJGbHV4Q29tcG9uZW50IiwiRHJvcGRvd24iLCJjcnlwdG8iLCJQcm94eVNldHRpbmdzTW9kYWwiLCJjb25zdHJ1Y3RvciIsInByb3BzIiwiY29uZmlnU2VydmljZSIsImdldEZsdXgiLCJnZXRTZXJ2aWNlIiwiaTE4biIsInRyYWNraW5nU2VydmljZSIsInN0YXRlIiwicHJvdG9jb2wiLCJhZGRyZXNzIiwicG9ydCIsInVzZXJuYW1lIiwicGFzc3dvcmQiLCJjb21wb25lbnREaWRNb3VudCIsInByb3h5Q29uZmlnIiwiZ2V0IiwiX2RlY3J5cHRQYXNzd29yZCIsInNldFN0YXRlIiwiX2VuY3J5cHRQYXNzd29yZCIsImNpcGhlciIsImNyZWF0ZUNpcGhlciIsInVwZGF0ZSIsImZpbmFsIiwiZW5jcnlwdGVkUGFzc3dvcmQiLCJkZWNpcGhlciIsImNyZWF0ZURlY2lwaGVyIiwic2F2ZVByb3h5U2V0dGluZ3MiLCJwcm94eVNldHRpbmdzIiwiT2JqZWN0IiwiYXNzaWduIiwiYWRkRXZlbnQiLCJuYW1lIiwic2V0Iiwic2F2ZSIsIm9uRG9uZSIsImhhbmRsZVByb3RvY29sQ2hhbmdlIiwib3B0aW9uIiwidmFsdWUiLCJoYW5kbGVBZGRyZXNzQ2hhbmdlIiwiZSIsInRhcmdldCIsImhhbmRsZVBvcnRDaGFuZ2UiLCJoYW5kbGVVc2VyTmFtZUNoYW5nZSIsImhhbmRsZVBhc3N3b3JkQ2hhbmdlIiwicmVuZGVyIiwiZGl2IiwiY2xhc3NOYW1lIiwiaDMiLCJ0IiwibGFiZWwiLCJiciIsIm9wdGlvbnMiLCJvbkNoYW5nZSIsImJpbmQiLCJpbnB1dCIsInR5cGUiLCJidXR0b24iLCJvbkNsaWNrIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUEsTUFBTUEsS0FBSyxHQUFHQyxPQUFPLENBQUMsT0FB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QUssRUFBRSxLQUFLOUIsS0FBTCxDQUFXSyxRQURaO0FBRU4yQyxNQUFBQSxJQUFJLEVBQUUsVUFGQTtBQUdOSCxNQUFBQSxRQUFRLEVBQUUsS0FBS1Qsb0JBQUwsQ0FBMEJVLElBQTFCLENBQStCLElBQS9CO0FBSEosS0FBVixDQUpKLENBbERKLENBRkcsRUErREg1RCxHQUFHLENBQUNvRCxHQUFKLENBQ0k7QUFBRUMsTUFBQUEsU0FBUyxFQUFFO0FBQWIsS0FESixFQUVJckQsR0FBRyxDQUFDK0QsTUFBSixDQUNJO0FBQ0lWLE1BQUFBLFNBQVMsRUFBRSxrQkFEZjtBQUVJVyxNQUFBQSxPQUFPLEVBQUUsTUFBTSxLQUFLeEQsS0FBTCxDQUFXaUMsTUFBWDtBQUZuQixLQURKLEVBS0ksS0FBSzdCLElBQUwsQ0FBVTJDLENBQVYsQ0FBWSwyQkFBWixDQUxKLENBRkosRUFTSXZELEdBQUcsQ0FBQytELE1BQUosQ0FDSTtBQUNJVixNQUFBQSxTQUFTLEVBQUUsZ0JBRGY7QUFFSVcsTUFBQUEsT0FBTyxFQUFFLE1BQU0sS0FBSy9CLGlCQUFMO0FBRm5CLEtBREosRUFLSSxLQUFLckIsSUFBTCxDQUFVMkMsQ0FBVixDQUFZLHlCQUFaLENBTEosQ0FUSixDQS9ERyxDQUFQO0FBaUZIOztBQXhKMEM7O0FBMEovQ1UsTUFBTSxDQUFDQyxPQUFQLEdBQWlCNUQsa0JBQWpCIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xyXG5cclxuY29uc3QgUmVhY3QgPSByZXF1aXJlKCdyZWFjdCcpO1xyXG5jb25zdCBET00gPSBSZWFjdC5ET007XHJcbmNvbnN0IGNlID0gUmVhY3QuY3JlYXRlRWxlbWVudDtcclxuY29uc3QgRmx1eENvbXBvbmVudCA9IHJlcXVpcmUoJ2VhZ2xlLXByaW50L3ZpZXdzL2ZsdXhfY29tcG9uZW50Jyk7XHJcbmNvbnN0IERyb3Bkb3duID0gcmVxdWlyZSgnZWFnbGUtcHJpbnQvdmlld3MvdWkvaW5wdXRfZHJvcGRvd24nKTtcclxuY29uc3QgY3J5cHRvID0gcmVxdWlyZSgnY3J5cHRvJyk7XHJcblxyXG5jbGFzcyBQcm94eVNldHRpbmdzTW9kYWwgZXh0ZW5kcyBGbHV4Q29tcG9uZW50IHtcclxuICAgIGNvbnN0cnVjdG9yKHByb3BzKSB7XHJcbiAgICAgICAgc3VwZXIocHJvcHMpO1xyXG4gICAgICAgIHRoaXMuY29uZmlnU2VydmljZSA9IHRoaXMuZ2V0Rmx1eCgpLmdldFNlcnZpY2UoJ0NvbmZpZ1NlcnZpY2UnKTtcclxuICAgICAgICB0aGlzLmkxOG4gPSB0aGlzLmdldEZsdXgoKS5nZXRTZXJ2aWNlKCdUcmFuc2xhdGlvblNlcnZpY2UnKTtcclxuICAgICAgICB0aGlzLnRyYWNraW5nU2VydmljZSA9IHRoaXMuZ2V0Rmx1eCgpLmdldFNlcnZpY2UoJ1RyYWNraW5nU2VydmljZScpO1xyXG4gICAgICAgIHRoaXMuc3RhdGUgPSB7XHJcbiAgICAgICAgICAgIHByb3RvY29sOiAnaHR0cDovLycsXHJcbiAgICAgICAgICAgIGFkZHJlc3M6ICcnLFxyXG4gICAgICAgICAgICBwb3J0OiAnJyxcclxuICAgICAgICAgICAgdXNlcm5hbWU6ICcnLFxyXG4gICAgICAgICAgICBwYXNzd29yZDogJycsXHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuICAgIGNvbXBvbmVudERpZE1vdW50KCkge1xyXG4gICAgICAgIC8vIEdyYWIgY29uZmlnIGFuZCBzZXQgdGhlIHN0YXRlLlxyXG4gICAgICAgIGNvbnN0IHByb3h5Q29uZmlnID0gdGhpcy5jb25maWdTZXJ2aWNlLmdldCgncHJveHlTZXR0aW5ncycpO1xyXG4gICAgICAgIGlmIChwcm94eUNvbmZpZykge1xyXG4gICAgICAgICAgICBjb25zdCBwYXNzd29yZCA9IHByb3h5Q29uZmlnLnBhc3N3b3JkID8gdGhpcy5fZGVjcnlwdFBhc3N3b3JkKHByb3h5Q29uZmlnLnBhc3N3b3JkKSA6ICcnO1xyXG4gICAgICAgICAgICB0aGlzLnNldFN0YXRlKHtcclxuICAgICAgICAgICAgICAgIHByb3RvY29sOiBwcm94eUNvbmZpZy5wcm90b2NvbCxcclxuICAgICAgICAgICAgICAgIGFkZHJlc3M6IHByb3h5Q29uZmlnLmFkZHJlc3MsXHJcbiAgICAgICAgICAgICAgICBwb3J0OiBwcm94eUNvbmZpZy5wb3J0LFxyXG4gICAgICAgICAgICAgICAgdXNlcm5hbWU6IHByb3h5Q29uZmlnLnVzZXJuYW1lLFxyXG4gICAgICAgICAgICAgICAgcGFzc3dvcmQsXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBfZW5jcnlwdFBhc3N3b3JkKHBhc3N3b3JkKSB7XHJcbiAgICAgICAgY29uc3QgY2lwaGVyID0gY3J5cHRvLmNyZWF0ZUNpcGhlcignYWVzMTkyJywgJ2Z1bGwgc3BlZWQgYWhlYWQnKTtcclxuICAgICAgICByZXR1cm4gY2lwaGVyLnVwZGF0ZShwYXNzd29yZCwgJ3V0ZjgnLCAnYmFzZTY0JykgKyBjaXBoZXIuZmluYWwoJ2Jhc2U2NCcpO1xyXG4gICAgfVxyXG5cclxuICAgIF9kZWNyeXB0UGFzc3dvcmQoZW5jcnlwdGVkUGFzc3dvcmQpIHtcclxuICAgICAgICBjb25zdCBkZWNpcGhlciA9IGNyeXB0by5jcmVhdGVEZWNpcGhlcignYWVzMTkyJywgJ2Z1bGwgc3BlZWQgYWhlYWQnKTtcclxuICAgICAgICByZXR1cm4gZGVjaXBoZXIudXBkYXRlKGVuY3J5cHRlZFBhc3N3b3JkLCAnYmFzZTY0JywgJ3V0ZjgnKSArIGRlY2lwaGVyLmZpbmFsKCd1dGY4Jyk7XHJcbiAgICB9XHJcblxyXG4gICAgc2F2ZVByb3h5U2V0dGluZ3MoKSB7XHJcbiAgICAgICAgY29uc3QgcHJveHlTZXR0aW5ncyA9IE9iamVjdC5hc3NpZ24oe30sIHRoaXMuc3RhdGUpO1xyXG4gICAgICAgIGlmIChwcm94eVNldHRpbmdzLnBhc3N3b3JkKSB7XHJcbiAgICAgICAgICAgIHByb3h5U2V0dGluZ3MucGFzc3dvcmQgPSB0aGlzLl9lbmNyeXB0UGFzc3dvcmQocHJveHlTZXR0aW5ncy5wYXNzd29yZCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMudHJhY2tpbmdTZXJ2aWNlLmFkZEV2ZW50KHsgbmFtZTogJ1Byb3h5IFNldHRpbmdzIFNhdmVkJyB9KTtcclxuICAgICAgICB0aGlzLmNvbmZpZ1NlcnZpY2Uuc2V0KCdwcm94eVNldHRpbmdzJywgcHJveHlTZXR0aW5ncyk7XHJcbiAgICAgICAgdGhpcy5jb25maWdTZXJ2aWNlLnNhdmUoKTtcclxuICAgICAgICB0aGlzLnByb3BzLm9uRG9uZSgpO1xyXG4gICAgfVxyXG5cclxuICAgIGhhbmRsZVByb3RvY29sQ2hhbmdlKG9wdGlvbikge1xyXG4gICAgICAgIHRoaXMuc2V0U3RhdGUoeyBwcm90b2NvbDogb3B0aW9uLnZhbHVlIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGhhbmRsZUFkZHJlc3NDaGFuZ2UoZSkge1xyXG4gICAgICAgIHRoaXMuc2V0U3RhdGUoeyBhZGRyZXNzOiBlLnRhcmdldC52YWx1ZSB9KTtcclxuICAgIH1cclxuXHJcbiAgICBoYW5kbGVQb3J0Q2hhbmdlKGUpIHtcclxuICAgICAgICB0aGlzLnNldFN0YXRlKHsgcG9ydDogZS50YXJnZXQudmFsdWUgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgaGFuZGxlVXNlck5hbWVDaGFuZ2UoZSkge1xyXG4gICAgICAgIHRoaXMuc2V0U3RhdGUoeyB1c2VybmFtZTogZS50YXJnZXQudmFsdWUgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgaGFuZGxlUGFzc3dvcmRDaGFuZ2UoZSkge1xyXG4gICAgICAgIHRoaXMuc2V0U3RhdGUoeyBwYXNzd29yZDogZS50YXJnZXQudmFsdWUgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgcmVuZGVyKCkge1xyXG4gICAgICAgIHJldHVybiBET00uZGl2KFxyXG4gICAgICAgICAgICB7IGNsYXNzTmFtZTogJ3Byb3h5LXNldHRpbmdzLW1vZGFsJyB9LFxyXG4gICAgICAgICAgICBET00uZGl2KFxyXG4gICAgICAgICAgICAgICAgeyBjbGFzc05hbWU6ICdmb3JtLWdyb3VwJyB9LFxyXG4gICAgICAgICAgICAgICAgRE9NLmRpdih7fSwgRE9NLmgzKHt9LCB0aGlzLmkxOG4udCgncHJveHlfc2V0dGluZ3MubW9kYWxfaGVhZGVyJykpKSxcclxuICAgICAgICAgICAgICAgIERPTS5kaXYoXHJcbiAgICAgICAgICAgICAgICAgICAge30sXHJcbiAgICAgICAgICAgICAgICAgICAgRE9NLmxhYmVsKHt9LCB0aGlzLmkxOG4udCgncHJveHlfc2V0dGluZ3MucHJvdG9jb2wnKSksXHJcbiAgICAgICAgICAgICAgICAgICAgRE9NLmJyKHt9KSxcclxuICAgICAgICAgICAgICAgICAgICBjZShEcm9wZG93biwge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAncHJvdG9jb2wnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5zdGF0ZS5wcm90b2NvbCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9uczogW1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiAnaHR0cDovLycsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw6IHRoaXMuaTE4bi50KCdwcm94eV9zZXR0aW5ncy5odHRwJyksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiAnaHR0cHM6Ly8nLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsOiB0aGlzLmkxOG4udCgncHJveHlfc2V0dGluZ3MuaHR0cHMnKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIF0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2hhbmdlOiB0aGlzLmhhbmRsZVByb3RvY29sQ2hhbmdlLmJpbmQodGhpcyksXHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICksXHJcbiAgICAgICAgICAgICAgICBET00uZGl2KFxyXG4gICAgICAgICAgICAgICAgICAgIHt9LFxyXG4gICAgICAgICAgICAgICAgICAgIERPTS5sYWJlbCh7fSwgdGhpcy5pMThuLnQoJ3Byb3h5X3NldHRpbmdzLmFkZHJlc3MnKSksXHJcbiAgICAgICAgICAgICAgICAgICAgRE9NLmJyKHt9KSxcclxuICAgICAgICAgICAgICAgICAgICBET00uaW5wdXQoe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5zdGF0ZS5hZGRyZXNzLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBvbkNoYW5nZTogdGhpcy5oYW5kbGVBZGRyZXNzQ2hhbmdlLmJpbmQodGhpcyksXHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICksXHJcbiAgICAgICAgICAgICAgICBET00uZGl2KFxyXG4gICAgICAgICAgICAgICAgICAgIHt9LFxyXG4gICAgICAgICAgICAgICAgICAgIERPTS5sYWJlbCh7fSwgdGhpcy5pMThuLnQoJ3Byb3h5X3NldHRpbmdzLnBvcnQnKSksXHJcbiAgICAgICAgICAgICAgICAgICAgRE9NLmJyKHt9KSxcclxuICAgICAgICAgICAgICAgICAgICBET00uaW5wdXQoe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5zdGF0ZS5wb3J0LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBvbkNoYW5nZTogdGhpcy5oYW5kbGVQb3J0Q2hhbmdlLmJpbmQodGhpcyksXHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICksXHJcbiAgICAgICAgICAgICAgICBET00uZGl2KFxyXG4gICAgICAgICAgICAgICAgICAgIHt9LFxyXG4gICAgICAgICAgICAgICAgICAgIERPTS5sYWJlbCh7fSwgdGhpcy5pMThuLnQoJ3Byb3h5X3NldHRpbmdzLnVzZXInKSksXHJcbiAgICAgICAgICAgICAgICAgICAgRE9NLmJyKHt9KSxcclxuICAgICAgICAgICAgICAgICAgICBET00uaW5wdXQoe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5zdGF0ZS51c2VybmFtZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgb25DaGFuZ2U6IHRoaXMuaGFuZGxlVXNlck5hbWVDaGFuZ2UuYmluZCh0aGlzKSxcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgKSxcclxuICAgICAgICAgICAgICAgIERPTS5kaXYoXHJcbiAgICAgICAgICAgICAgICAgICAge30sXHJcbiAgICAgICAgICAgICAgICAgICAgRE9NLmxhYmVsKHt9LCB0aGlzLmkxOG4udCgncHJveHlfc2V0dGluZ3MucGFzc3dvcmQnKSksXHJcbiAgICAgICAgICAgICAgICAgICAgRE9NLmJyKHt9KSxcclxuICAgICAgICAgICAgICAgICAgICBET00uaW5wdXQoe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5zdGF0ZS5wYXNzd29yZCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ3Bhc3N3b3JkJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgb25DaGFuZ2U6IHRoaXMuaGFuZGxlUGFzc3dvcmRDaGFuZ2UuYmluZCh0aGlzKSxcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgKVxyXG4gICAgICAgICAgICApLFxyXG4gICAgICAgICAgICBET00uZGl2KFxyXG4gICAgICAgICAgICAgICAgeyBjbGFzc05hbWU6ICdidXR0b25Hcm91cCcgfSxcclxuICAgICAgICAgICAgICAgIERPTS5idXR0b24oXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU6ICdidXR0b24gc2Vjb25kYXJ5JyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgb25DbGljazogKCkgPT4gdGhpcy5wcm9wcy5vbkRvbmUoKSxcclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaTE4bi50KCdzeXN0ZW1fcHJlZmVyZW5jZXMuY2FuY2VsJylcclxuICAgICAgICAgICAgICAgICksXHJcbiAgICAgICAgICAgICAgICBET00uYnV0dG9uKFxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lOiAnYnV0dG9uIHByaW1hcnknLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBvbkNsaWNrOiAoKSA9PiB0aGlzLnNhdmVQcm94eVNldHRpbmdzKCksXHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmkxOG4udCgnc3lzdGVtX3ByZWZlcmVuY2VzLnNhdmUnKVxyXG4gICAgICAgICAgICAgICAgKVxyXG4gICAgICAgICAgICApXHJcbiAgICAgICAgKTtcclxuICAgIH1cclxufVxyXG5tb2R1bGUuZXhwb3J0cyA9IFByb3h5U2V0dGluZ3NNb2RhbDtcclxuIl19
