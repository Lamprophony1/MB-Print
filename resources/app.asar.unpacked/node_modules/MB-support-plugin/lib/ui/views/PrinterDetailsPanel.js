'use strict';

const React = require('react');

const Isvg = require('react-inlinesvg');

const PrinterCardContainer = require('eagle-print/views/printers/printer_card_container');

const FluxComponent = require('eagle-print/views/flux_component');

const CameraFeed = require('./cameraFeed');

const PrinterDetailsPanelButton = require('./printerDetailsPanelButton');

const PrintProgressBadge = require('./printProgressBadge');

const PrintProgressText = require('./printProgressText');

const PrinterUtilityPanel = require('./utilities/PrinterUtilityPanel');

const PrinterFilamentPanel = require('./filament');

const DualFilamentPanel = require('./dualFilament');

const FirmwareUpdateBanner = require('./firmwareUpdateBanner');

const HeaderSelectButton = require('./headerSelectButton');

const {
  PanelStates
} = require('../../constants/printerDetails');

class PrinterDetailsPanel extends FluxComponent {
  constructor(props, context) {
    super(props, context);
    this._flux = this.getFlux();
    this._store = this._flux.store('PrinterDetailsStore');
    this._actions = this._flux.actions.PrinterDetailsActions;
    this._i18n = this._flux.getService('TranslationService');
    this._tracking = this._flux.getService('TrackingService');
    this.onChange = this.onChange.bind(this); // STATE:
    // {
    //     detailsStatus: Object,
    //     currentProcess: Object,
    //     currentPanel: String,
    //     panelSwipeDirection: String,
    //     actionButtons: Immutable.Map,
    //     progressText: Object,
    //     progressButtons: Immutable.Map
    // }

    this.state = Object.assign({}, this.state, this._store.getState(this.props.printer.getId()));
  }

  componentDidUpdate(prevProps) {
    const prevPrinterId = prevProps.printer.getId();
    const currentPrinterId = this.props.printer.getId(); // if the printer is different and is unauthenticated, then authenticate it

    if (prevPrinterId !== currentPrinterId && !this.state.detailsStatus.is.authenticated) {
      this.getFlux().actions.printer.authenticate(this.props.printer);
    }
  }

  componentDidMount() {
    super.componentDidMount();

    if (!this.state.detailsStatus.is.authenticated) {
      this.getFlux().actions.printer.authenticate(this.props.printer);
    }

    this._store.addListener('change', this.onChange);
  }

  componentWillUnmount() {
    this._store.removeListener('change', this.onChange);
  }

  componentWillReceiveProps(nextProps) {
    if (nextProps.shouldShowMainDetailsPanel && nextProps.shouldShowMainDetailsPanel() && this.state.showPanel !== PanelStates.Details) {
      this.onOpenDetails();
    }
  }

  onChange() {
    this.setState(this._store.getState(this.props.printer.getId()));
  }

  onOpenDetails() {
    this._actions.details();
  }

  renderMonitorPill() {
    const flux = this.getFlux();
    return /*#__PURE__*/React.createElement("div", {
      id: "printerDetailsBody"
    }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("div", {
      id: "printerDetailsProgressBadge"
    }, /*#__PURE__*/React.createElement(PrintProgressBadge, {
      printer: this.props.printer,
      currentProcess: this.state.currentProcess,
      strokeWidth: 6,
      r: 50
    })), /*#__PURE__*/React.createElement(PrintProgressText, {
      currentProcess: this.state.currentProcess,
      detailsStatus: this.state.detailsStatus,
      progressText: this.state.progressText,
      progressButtons: this.state.progressButtons,
      printer: this.props.printer,
      flux: flux,
      onBack: this.props.onBack
    })));
  }

  onBack() {
    if (!this.state.detailsStatus.Authenticated) {
      this.getFlux().actions.printer.authenticateCancel();
    }

    this.props.onBack();
  }

  renderButtons() {
    // Button:
    // {
    //      label: i18n => String,
    //      icon: String,
    //      order: Int,
    //      enabled: Bool,
    //      shouldShow: Bool,
    //      onClick: () => q.Promise()
    // }
    return this.state.actionButtons.map((v, k) => /*#__PURE__*/React.createElement(PrinterDetailsPanelButton, {
      key: k // Waiting for render refactor before these buttons can see the
      // light of day...
      //waiting: !!this.state.button2Waiting,
      ,
      waiting: v.waiting,
      buttonText: v.label(this._i18n),
      buttonIcon: v.icon,
      enabled: v.enabled,
      buttonClick: v.onClick
    })).toArray();
  }

  renderCard() {
    const info = this.props.printer.getInfo() || {};

    switch (this.state.currentPanel) {
      case PanelStates.Utilities:
        return /*#__PURE__*/React.createElement(PrinterUtilityPanel, {
          key: "printerUtilities",
          printer: this.props.printer,
          onClose: this.props.onClose,
          onBack: () => this.onOpenDetails(),
          onResetSuccess: this.props.onBack,
          flux: this._flux
        });

      case PanelStates.Filament:
        return this.props.printer.isSixthGen() ? /*#__PURE__*/React.createElement(DualFilamentPanel, {
          key: "dualFilament",
          printer: this.props.printer,
          onClose: this.props.onClose,
          onBack: () => this.onOpenDetails(),
          flux: this._flux
        }) : /*#__PURE__*/React.createElement(PrinterFilamentPanel, {
          key: "printerFilament",
          printer: this.props.printer,
          onClose: this.props.onClose,
          onBack: () => this.onOpenDetails(),
          flux: this._flux
        });

      default:
        // Details panel
        return /*#__PURE__*/React.createElement("div", {
          id: "printerDetailsPanel",
          className: "printerPanel",
          key: "printerDetails"
        }, /*#__PURE__*/React.createElement("div", {
          className: "printerPanelHeader"
        }, /*#__PURE__*/React.createElement("div", {
          className: "printerPanelBackButton",
          onClick: () => this.onBack()
        }, /*#__PURE__*/React.createElement(Isvg, {
          src: "icons/back-arrow.svg"
        })), /*#__PURE__*/React.createElement("div", {
          className: "printerPanelHeaderLabel"
        }, /*#__PURE__*/React.createElement("h1", null, this.props.printer.getName()), /*#__PURE__*/React.createElement("h3", null, /*#__PURE__*/React.createElement("span", {
          className: "printer-model"
        }, info.model))), /*#__PURE__*/React.createElement(HeaderSelectButton, {
          flux: this._flux,
          printer: this.props.printer
        }), /*#__PURE__*/React.createElement("div", {
          className: "printerPanelArrowDown",
          onClick: this.props.onClose
        }, /*#__PURE__*/React.createElement(Isvg, {
          src: "icons/back-arrow.svg"
        }))), /*#__PURE__*/React.createElement("div", {
          id: "printerDetailsContents"
        }, /*#__PURE__*/React.createElement("div", {
          style: {
            position: 'relative',
            overflowX: 'hidden',
            overflowY: 'auto'
          }
        }, /*#__PURE__*/React.createElement(CameraFeed, {
          printer: this.props.printer
        }), /*#__PURE__*/React.createElement(FirmwareUpdateBanner, {
          flux: this._flux,
          printer: this.props.printer
        })), this.renderMonitorPill(), /*#__PURE__*/React.createElement("div", {
          id: "printerDetailsButtonBar"
        }, this.renderButtons())));
    }
  }

  render() {
    return (
      /*#__PURE__*/
      //spread combined obj as props
      React.createElement(PrinterCardContainer, Object.assign({}, this.props, {
        swipeDirection: this.state.panelSwipeDirection
      }), this.renderCard())
    );
  }

}

PrinterDetailsPanel.propTypes = Object.assign({}, FluxComponent.propTypes, {
  onClose: React.PropTypes.func.isRequired,
  onBack: React.PropTypes.func.isRequired,
  shouldShowMainDetailsPanel: React.PropTypes.func,
  printer: React.PropTypes.shape({
    acknowledgeLastError: React.PropTypes.func.isRequired,
    getId: React.PropTypes.func.isRequired,
    getInfo: React.PropTypes.func.isRequired,
    getName: React.PropTypes.func.isRequired,
    getStatus: React.PropTypes.func.isRequired,
    invoke: React.PropTypes.func.isRequired
  }).isRequired
});
PrinterDetailsPanel.displayName = 'PrinterDetailsPanel';
module.exports = PrinterDetailsPanel;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlByaW50ZXJEZXRhaWxzUGFuZWwuanMiXSwibmFtZXMiOlsiUmVhY3QiLCJyZXF1aXJlIiwiSXN2ZyIsIlByaW50ZXJDYXJkQ29udGFpbmVyIiwiRmx1eENvbXBvbmVudCIsIkNhbWVyYUZlZWQiLCJQcmludGVyRGV0YWlsc1BhbmVsQnV0dG9uIiwiUHJpbnRQcm9ncmVzc0JhZGdlIiwiUHJpbnRQcm9ncmVzc1RleHQiLCJQcmludGVyVXRpbGl0eVBhbmVsIiwiUHJpbnRlckZpbGFtZW50UGFuZWwiLCJEdWFsRmlsYW1lbnRQYW5lbCIsIkZpcm13YXJlVXBkYXRlQmFubmVyIiwiSGVhZGVyU2VsZWN0QnV0dG9uIiwiUGFuZWxTdGF0ZXMiLCJQcmludGVyRGV0YWlsc1BhbmVsIiwiY29uc3RydWN0b3IiLCJwcm9wcyIsImNvbnRleHQiLCJfZmx1eCIsImdldEZsdXgiLCJfc3RvcmUiLCJzdG9yZSIsIl9hY3Rpb25zIiwiYWN0aW9ucyIsIlByaW50ZXJEZXRhaWxzQWN0aW9ucyIsIl9pMThuIiwiZ2V0U2VydmljZSIsIl90cmFja2luZyIsIm9uQ2hhbmdlIiwiYmluZCIsInN0YXRlIiwiT2JqZWN0IiwiYXNzaWduIiwiZ2V0U3RhdGUiLCJwcmludGVyIiwiZ2V0SWQiLCJjb21wb25lbnREaWRVcGRhdGUiLCJwcmV2UHJvcHMiLCJwcmV2UHJpbnRlcklkIiwiY3VycmVudFByaW50ZXJJZCIsImRldGFpbHNTdGF0dXMiLCJpcyIsImF1dGhlbnRpY2F0ZWQiLCJhdXRoZW50aWNhdGUiLCJjb21wb25lbnREaWRNb3VudCIsImFkZExpc3RlbmVyIiwiY29tcG9uZW50V2lsbFVubW91bnQiLCJyZW1vdmVMaXN0ZW5lciIsImNvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHMiLCJuZXh0UHJvcHMiLCJzaG91bGRTaG93TWFpbkRldGFpbHNQYW5lbCIsInNob3dQYW5lbCIsIkRldGFpbHMiLCJvbk9wZW5EZXRhaWxzIiwic2V0U3RhdGUiLCJkZXRhaWxzIiwicmVuZGVyTW9uaXRvclBpbGwiLCJmbHV4IiwiY3VycmVudFByb2Nlc3MiLCJwcm9ncmVzc1RleHQiLCJwcm9ncmVzc0J1dHRvbnMiLCJvbkJhY2siLCJBdXRoZW50aWNhdGVkIiwiYXV0aGVudGljYXRlQ2FuY2VsIiwicmVuZGVyQnV0dG9ucyIsImFjdGlvbkJ1dHRvbnMiLCJtYXAiLCJ2IiwiayIsIndhaXRpbmciLCJsYWJlbCIsImljb24iLCJlbmFibGVkIiwib25DbGljayIsInRvQXJyYXkiLCJyZW5kZXJDYXJkIiwiaW5mbyIsImdldEluZm8iLCJjdXJyZW50UGFuZWwiLCJVdGlsaXRpZXMiLCJvbkNsb3NlIiwiRmlsYW1lbnQiLCJpc1NpeHRoR2VuIiwiZ2V0TmFtZSIsIm1vZGVsIiwicG9zaXRpb24iLCJvdmVyZmxvd1giLCJvdmVyZmxvd1kiLCJyZW5kZXIiLCJzd2lwZURpcmVjdGlvbiIsInBhbmVsU3dpcGVEaXJlY3Rpb24iLCJwcm9wVHlwZXMiLCJQcm9wVHlwZXMiLCJmdW5jIiwiaXNSZXF1aXJlZCIsInNoYXBlIiwiYWNrbm93bGVkZ2VMYXN0RXJyb3IiLCJnZXRTdGF0dXMiLCJpbnZva2UiLCJkaXNwbGF5TmFtZSIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBLE1BQU1BLEtBQUssR0FBR0MsT0FBTyxDQUFDLE9BQUQsQ0FBckI7O0FBQ0EsTUFBTUMsSUFBSSxHQUFHRCxPQUFPLENBQUMsaUJBQUQsQ0FBcEI7O0FBQ0EsTUFBTUUsb0JBQW9CLEdBQUdGLE9BQU8sQ0FBQyxtREFBRCxDQUFwQzs7QUFDQSxNQUFNRyxhQUFhLEdBQUdILE9BQU8sQ0FBQyxrQ0FBRCxDQUE3Qjs7QUFFQSxNQUFNSSxVQUFVLEdBQUdKLE9BQU8sQ0FBQyxjQUFELENBQTFCOztBQUNBLE1BQU1LLHlCQUF5QixHQUFHTCxPQUFPLENBQUMsNkJBQUQsQ0FBekM7O0FBQ0EsTUFBTU0sa0JBQWtCLEdBQUdOLE9BQU8sQ0FBQyxzQkFBRCxDQUFsQzs7QUFDQSxNQUFNTyxpQkFBaUIsR0FBR1AsT0FB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cUJDO0FBTkYsR0FBdEIsRUFPTkE7QUFYb0UsQ0FBM0MsQ0FBaEM7QUFjQWhGLG1CQUFtQixDQUFDcUYsV0FBcEIsR0FBa0MscUJBQWxDO0FBRUFDLE1BQU0sQ0FBQ0MsT0FBUCxHQUFpQnZGLG1CQUFqQiIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcclxuXHJcbmNvbnN0IFJlYWN0ID0gcmVxdWlyZSgncmVhY3QnKTtcclxuY29uc3QgSXN2ZyA9IHJlcXVpcmUoJ3JlYWN0LWlubGluZXN2ZycpO1xyXG5jb25zdCBQcmludGVyQ2FyZENvbnRhaW5lciA9IHJlcXVpcmUoJ2VhZ2xlLXByaW50L3ZpZXdzL3ByaW50ZXJzL3ByaW50ZXJfY2FyZF9jb250YWluZXInKTtcclxuY29uc3QgRmx1eENvbXBvbmVudCA9IHJlcXVpcmUoJ2VhZ2xlLXByaW50L3ZpZXdzL2ZsdXhfY29tcG9uZW50Jyk7XHJcblxyXG5jb25zdCBDYW1lcmFGZWVkID0gcmVxdWlyZSgnLi9jYW1lcmFGZWVkJyk7XHJcbmNvbnN0IFByaW50ZXJEZXRhaWxzUGFuZWxCdXR0b24gPSByZXF1aXJlKCcuL3ByaW50ZXJEZXRhaWxzUGFuZWxCdXR0b24nKTtcclxuY29uc3QgUHJpbnRQcm9ncmVzc0JhZGdlID0gcmVxdWlyZSgnLi9wcmludFByb2dyZXNzQmFkZ2UnKTtcclxuY29uc3QgUHJpbnRQcm9ncmVzc1RleHQgPSByZXF1aXJlKCcuL3ByaW50UHJvZ3Jlc3NUZXh0Jyk7XHJcbmNvbnN0IFByaW50ZXJVdGlsaXR5UGFuZWwgPSByZXF1aXJlKCcuL3V0aWxpdGllcy9QcmludGVyVXRpbGl0eVBhbmVsJyk7XHJcbmNvbnN0IFByaW50ZXJGaWxhbWVudFBhbmVsID0gcmVxdWlyZSgnLi9maWxhbWVudCcpO1xyXG5jb25zdCBEdWFsRmlsYW1lbnRQYW5lbCA9IHJlcXVpcmUoJy4vZHVhbEZpbGFtZW50Jyk7XHJcbmNvbnN0IEZpcm13YXJlVXBkYXRlQmFubmVyID0gcmVxdWlyZSgnLi9maXJtd2FyZVVwZGF0ZUJhbm5lcicpO1xyXG5jb25zdCBIZWFkZXJTZWxlY3RCdXR0b24gPSByZXF1aXJlKCcuL2hlYWRlclNlbGVjdEJ1dHRvbicpO1xyXG5jb25zdCB7IFBhbmVsU3RhdGVzIH0gPSByZXF1aXJlKCcuLi8uLi9jb25zdGFudHMvcHJpbnRlckRldGFpbHMnKTtcclxuXHJcbmNsYXNzIFByaW50ZXJEZXRhaWxzUGFuZWwgZXh0ZW5kcyBGbHV4Q29tcG9uZW50IHtcclxuICAgIGNvbnN0cnVjdG9yKHByb3BzLCBjb250ZXh0KSB7XHJcbiAgICAgICAgc3VwZXIocHJvcHMsIGNvbnRleHQpO1xyXG5cclxuICAgICAgICB0aGlzLl9mbHV4ID0gdGhpcy5nZXRGbHV4KCk7XHJcbiAgICAgICAgdGhpcy5fc3RvcmUgPSB0aGlzLl9mbHV4LnN0b3JlKCdQcmludGVyRGV0YWlsc1N0b3JlJyk7XHJcbiAgICAgICAgdGhpcy5fYWN0aW9ucyA9IHRoaXMuX2ZsdXguYWN0aW9ucy5QcmludGVyRGV0YWlsc0FjdGlvbnM7XHJcbiAgICAgICAgdGhpcy5faTE4biA9IHRoaXMuX2ZsdXguZ2V0U2VydmljZSgnVHJhbnNsYXRpb25TZXJ2aWNlJyk7XHJcbiAgICAgICAgdGhpcy5fdHJhY2tpbmcgPSB0aGlzLl9mbHV4LmdldFNlcnZpY2UoJ1RyYWNraW5nU2VydmljZScpO1xyXG4gICAgICAgIHRoaXMub25DaGFuZ2UgPSB0aGlzLm9uQ2hhbmdlLmJpbmQodGhpcyk7XHJcblxyXG4gICAgICAgIC8vIFNUQVRFOlxyXG4gICAgICAgIC8vIHtcclxuICAgICAgICAvLyAgICAgZGV0YWlsc1N0YXR1czogT2JqZWN0LFxyXG4gICAgICAgIC8vICAgICBjdXJyZW50UHJvY2VzczogT2JqZWN0LFxyXG4gICAgICAgIC8vICAgICBjdXJyZW50UGFuZWw6IFN0cmluZyxcclxuICAgICAgICAvLyAgICAgcGFuZWxTd2lwZURpcmVjdGlvbjogU3RyaW5nLFxyXG4gICAgICAgIC8vICAgICBhY3Rpb25CdXR0b25zOiBJbW11dGFibGUuTWFwLFxyXG4gICAgICAgIC8vICAgICBwcm9ncmVzc1RleHQ6IE9iamVjdCxcclxuICAgICAgICAvLyAgICAgcHJvZ3Jlc3NCdXR0b25zOiBJbW11dGFibGUuTWFwXHJcbiAgICAgICAgLy8gfVxyXG4gICAgICAgIHRoaXMuc3RhdGUgPSBPYmplY3QuYXNzaWduKHt9LCB0aGlzLnN0YXRlLCB0aGlzLl9zdG9yZS5nZXRTdGF0ZSh0aGlzLnByb3BzLnByaW50ZXIuZ2V0SWQoKSkpO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbXBvbmVudERpZFVwZGF0ZShwcmV2UHJvcHMpIHtcclxuICAgICAgICBjb25zdCBwcmV2UHJpbnRlcklkID0gcHJldlByb3BzLnByaW50ZXIuZ2V0SWQoKTtcclxuICAgICAgICBjb25zdCBjdXJyZW50UHJpbnRlcklkID0gdGhpcy5wcm9wcy5wcmludGVyLmdldElkKCk7XHJcblxyXG4gICAgICAgIC8vIGlmIHRoZSBwcmludGVyIGlzIGRpZmZlcmVudCBhbmQgaXMgdW5hdXRoZW50aWNhdGVkLCB0aGVuIGF1dGhlbnRpY2F0ZSBpdFxyXG4gICAgICAgIGlmIChwcmV2UHJpbnRlcklkICE9PSBjdXJyZW50UHJpbnRlcklkICYmICF0aGlzLnN0YXRlLmRldGFpbHNTdGF0dXMuaXMuYXV0aGVudGljYXRlZCkge1xyXG4gICAgICAgICAgICB0aGlzLmdldEZsdXgoKS5hY3Rpb25zLnByaW50ZXIuYXV0aGVudGljYXRlKHRoaXMucHJvcHMucHJpbnRlcik7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGNvbXBvbmVudERpZE1vdW50KCkge1xyXG4gICAgICAgIHN1cGVyLmNvbXBvbmVudERpZE1vdW50KCk7XHJcbiAgICAgICAgaWYgKCF0aGlzLnN0YXRlLmRldGFpbHNTdGF0dXMuaXMuYXV0aGVudGljYXRlZCkge1xyXG4gICAgICAgICAgICB0aGlzLmdldEZsdXgoKS5hY3Rpb25zLnByaW50ZXIuYXV0aGVudGljYXRlKHRoaXMucHJvcHMucHJpbnRlcik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLl9zdG9yZS5hZGRMaXN0ZW5lcignY2hhbmdlJywgdGhpcy5vbkNoYW5nZSk7XHJcbiAgICB9XHJcblxyXG4gICAgY29tcG9uZW50V2lsbFVubW91bnQoKSB7XHJcbiAgICAgICAgdGhpcy5fc3RvcmUucmVtb3ZlTGlzdGVuZXIoJ2NoYW5nZScsIHRoaXMub25DaGFuZ2UpO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHMobmV4dFByb3BzKSB7XHJcbiAgICAgICAgaWYgKFxyXG4gICAgICAgICAgICBuZXh0UHJvcHMuc2hvdWxkU2hvd01haW5EZXRhaWxzUGFuZWwgJiZcclxuICAgICAgICAgICAgbmV4dFByb3BzLnNob3VsZFNob3dNYWluRGV0YWlsc1BhbmVsKCkgJiZcclxuICAgICAgICAgICAgdGhpcy5zdGF0ZS5zaG93UGFuZWwgIT09IFBhbmVsU3RhdGVzLkRldGFpbHNcclxuICAgICAgICApIHtcclxuICAgICAgICAgICAgdGhpcy5vbk9wZW5EZXRhaWxzKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIG9uQ2hhbmdlKCkge1xyXG4gICAgICAgIHRoaXMuc2V0U3RhdGUodGhpcy5fc3RvcmUuZ2V0U3RhdGUodGhpcy5wcm9wcy5wcmludGVyLmdldElkKCkpKTtcclxuICAgIH1cclxuXHJcbiAgICBvbk9wZW5EZXRhaWxzKCkge1xyXG4gICAgICAgIHRoaXMuX2FjdGlvbnMuZGV0YWlscygpO1xyXG4gICAgfVxyXG5cclxuICAgIHJlbmRlck1vbml0b3JQaWxsKCkge1xyXG4gICAgICAgIGNvbnN0IGZsdXggPSB0aGlzLmdldEZsdXgoKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIChcclxuICAgICAgICAgICAgPGRpdiBpZD0ncHJpbnRlckRldGFpbHNCb2R5Jz5cclxuICAgICAgICAgICAgICAgIDxkaXY+XHJcbiAgICAgICAgICAgICAgICAgICAgPGRpdiBpZD0ncHJpbnRlckRldGFpbHNQcm9ncmVzc0JhZGdlJz5cclxuICAgICAgICAgICAgICAgICAgICAgICAgPFByaW50UHJvZ3Jlc3NCYWRnZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnRlcj17dGhpcy5wcm9wcy5wcmludGVyfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudFByb2Nlc3M9e3RoaXMuc3RhdGUuY3VycmVudFByb2Nlc3N9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJva2VXaWR0aD17Nn1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHI9ezUwfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvPlxyXG4gICAgICAgICAgICAgICAgICAgIDwvZGl2PlxyXG4gICAgICAgICAgICAgICAgICAgIDxQcmludFByb2dyZXNzVGV4dFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50UHJvY2Vzcz17dGhpcy5zdGF0ZS5jdXJyZW50UHJvY2Vzc31cclxuICAgICAgICAgICAgICAgICAgICAgICAgZGV0YWlsc1N0YXR1cz17dGhpcy5zdGF0ZS5kZXRhaWxzU3RhdHVzfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBwcm9ncmVzc1RleHQ9e3RoaXMuc3RhdGUucHJvZ3Jlc3NUZXh0fVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBwcm9ncmVzc0J1dHRvbnM9e3RoaXMuc3RhdGUucHJvZ3Jlc3NCdXR0b25zfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBwcmludGVyPXt0aGlzLnByb3BzLnByaW50ZXJ9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZsdXg9e2ZsdXh9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9uQmFjaz17dGhpcy5wcm9wcy5vbkJhY2t9XHJcbiAgICAgICAgICAgICAgICAgICAgLz5cclxuICAgICAgICAgICAgICAgIDwvZGl2PlxyXG4gICAgICAgICAgICA8L2Rpdj5cclxuICAgICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIG9uQmFjaygpIHtcclxuICAgICAgICBpZiAoIXRoaXMuc3RhdGUuZGV0YWlsc1N0YXR1cy5BdXRoZW50aWNhdGVkKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZ2V0Rmx1eCgpLmFjdGlvbnMucHJpbnRlci5hdXRoZW50aWNhdGVDYW5jZWwoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5wcm9wcy5vbkJhY2soKTtcclxuICAgIH1cclxuXHJcbiAgICByZW5kZXJCdXR0b25zKCkge1xyXG4gICAgICAgIC8vIEJ1dHRvbjpcclxuICAgICAgICAvLyB7XHJcbiAgICAgICAgLy8gICAgICBsYWJlbDogaTE4biA9PiBTdHJpbmcsXHJcbiAgICAgICAgLy8gICAgICBpY29uOiBTdHJpbmcsXHJcbiAgICAgICAgLy8gICAgICBvcmRlcjogSW50LFxyXG4gICAgICAgIC8vICAgICAgZW5hYmxlZDogQm9vbCxcclxuICAgICAgICAvLyAgICAgIHNob3VsZFNob3c6IEJvb2wsXHJcbiAgICAgICAgLy8gICAgICBvbkNsaWNrOiAoKSA9PiBxLlByb21pc2UoKVxyXG4gICAgICAgIC8vIH1cclxuICAgICAgICByZXR1cm4gdGhpcy5zdGF0ZS5hY3Rpb25CdXR0b25zXHJcbiAgICAgICAgICAgIC5tYXAoKHYsIGspID0+IChcclxuICAgICAgICAgICAgICAgIDxQcmludGVyRGV0YWlsc1BhbmVsQnV0dG9uXHJcbiAgICAgICAgICAgICAgICAgICAga2V5PXtrfVxyXG4gICAgICAgICAgICAgICAgICAgIC8vIFdhaXRpbmcgZm9yIHJlbmRlciByZWZhY3RvciBiZWZvcmUgdGhlc2UgYnV0dG9ucyBjYW4gc2VlIHRoZVxyXG4gICAgICAgICAgICAgICAgICAgIC8vIGxpZ2h0IG9mIGRheS4uLlxyXG4gICAgICAgICAgICAgICAgICAgIC8vd2FpdGluZzogISF0aGlzLnN0YXRlLmJ1dHRvbjJXYWl0aW5nLFxyXG4gICAgICAgICAgICAgICAgICAgIHdhaXRpbmc9e3Yud2FpdGluZ31cclxuICAgICAgICAgICAgICAgICAgICBidXR0b25UZXh0PXt2LmxhYmVsKHRoaXMuX2kxOG4pfVxyXG4gICAgICAgICAgICAgICAgICAgIGJ1dHRvbkljb249e3YuaWNvbn1cclxuICAgICAgICAgICAgICAgICAgICBlbmFibGVkPXt2LmVuYWJsZWR9XHJcbiAgICAgICAgICAgICAgICAgICAgYnV0dG9uQ2xpY2s9e3Yub25DbGlja31cclxuICAgICAgICAgICAgICAgIC8+XHJcbiAgICAgICAgICAgICkpXHJcbiAgICAgICAgICAgIC50b0FycmF5KCk7XHJcbiAgICB9XHJcblxyXG4gICAgcmVuZGVyQ2FyZCgpIHtcclxuICAgICAgICBjb25zdCBpbmZvID0gdGhpcy5wcm9wcy5wcmludGVyLmdldEluZm8oKSB8fCB7fTtcclxuXHJcbiAgICAgICAgc3dpdGNoICh0aGlzLnN0YXRlLmN1cnJlbnRQYW5lbCkge1xyXG4gICAgICAgICAgICBjYXNlIFBhbmVsU3RhdGVzLlV0aWxpdGllczpcclxuICAgICAgICAgICAgICAgIHJldHVybiAoXHJcbiAgICAgICAgICAgICAgICAgICAgPFByaW50ZXJVdGlsaXR5UGFuZWxcclxuICAgICAgICAgICAgICAgICAgICAgICAga2V5PSdwcmludGVyVXRpbGl0aWVzJ1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBwcmludGVyPXt0aGlzLnByb3BzLnByaW50ZXJ9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2xvc2U9e3RoaXMucHJvcHMub25DbG9zZX1cclxuICAgICAgICAgICAgICAgICAgICAgICAgb25CYWNrPXsoKSA9PiB0aGlzLm9uT3BlbkRldGFpbHMoKX1cclxuICAgICAgICAgICAgICAgICAgICAgICAgb25SZXNldFN1Y2Nlc3M9e3RoaXMucHJvcHMub25CYWNrfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBmbHV4PXt0aGlzLl9mbHV4fVxyXG4gICAgICAgICAgICAgICAgICAgIC8+XHJcbiAgICAgICAgICAgICAgICApO1xyXG4gICAgICAgICAgICBjYXNlIFBhbmVsU3RhdGVzLkZpbGFtZW50OlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucHJvcHMucHJpbnRlci5pc1NpeHRoR2VuKCkgPyAoXHJcbiAgICAgICAgICAgICAgICAgICAgPER1YWxGaWxhbWVudFBhbmVsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGtleT0nZHVhbEZpbGFtZW50J1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBwcmludGVyPXt0aGlzLnByb3BzLnByaW50ZXJ9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2xvc2U9e3RoaXMucHJvcHMub25DbG9zZX1cclxuICAgICAgICAgICAgICAgICAgICAgICAgb25CYWNrPXsoKSA9PiB0aGlzLm9uT3BlbkRldGFpbHMoKX1cclxuICAgICAgICAgICAgICAgICAgICAgICAgZmx1eD17dGhpcy5fZmx1eH1cclxuICAgICAgICAgICAgICAgICAgICAvPlxyXG4gICAgICAgICAgICAgICAgKSA6IChcclxuICAgICAgICAgICAgICAgICAgICA8UHJpbnRlckZpbGFtZW50UGFuZWxcclxuICAgICAgICAgICAgICAgICAgICAgICAga2V5PSdwcmludGVyRmlsYW1lbnQnXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50ZXI9e3RoaXMucHJvcHMucHJpbnRlcn1cclxuICAgICAgICAgICAgICAgICAgICAgICAgb25DbG9zZT17dGhpcy5wcm9wcy5vbkNsb3NlfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBvbkJhY2s9eygpID0+IHRoaXMub25PcGVuRGV0YWlscygpfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBmbHV4PXt0aGlzLl9mbHV4fVxyXG4gICAgICAgICAgICAgICAgICAgIC8+XHJcbiAgICAgICAgICAgICAgICApO1xyXG4gICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgLy8gRGV0YWlscyBwYW5lbFxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIChcclxuICAgICAgICAgICAgICAgICAgICA8ZGl2IGlkPSdwcmludGVyRGV0YWlsc1BhbmVsJyBjbGFzc05hbWU9J3ByaW50ZXJQYW5lbCcga2V5PSdwcmludGVyRGV0YWlscyc+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSdwcmludGVyUGFuZWxIZWFkZXInPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9J3ByaW50ZXJQYW5lbEJhY2tCdXR0b24nIG9uQ2xpY2s9eygpID0+IHRoaXMub25CYWNrKCl9PlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxJc3ZnIHNyYz0naWNvbnMvYmFjay1hcnJvdy5zdmcnIC8+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSdwcmludGVyUGFuZWxIZWFkZXJMYWJlbCc+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGgxPnt0aGlzLnByb3BzLnByaW50ZXIuZ2V0TmFtZSgpfTwvaDE+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGgzPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzc05hbWU9J3ByaW50ZXItbW9kZWwnPntpbmZvLm1vZGVsfTwvc3Bhbj5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2gzPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8SGVhZGVyU2VsZWN0QnV0dG9uIGZsdXg9e3RoaXMuX2ZsdXh9IHByaW50ZXI9e3RoaXMucHJvcHMucHJpbnRlcn0gLz5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSdwcmludGVyUGFuZWxBcnJvd0Rvd24nIG9uQ2xpY2s9e3RoaXMucHJvcHMub25DbG9zZX0+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPElzdmcgc3JjPSdpY29ucy9iYWNrLWFycm93LnN2ZycgLz5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PlxyXG4gICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cclxuICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBpZD0ncHJpbnRlckRldGFpbHNDb250ZW50cyc+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3R5bGU9e3tcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246ICdyZWxhdGl2ZScsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG92ZXJmbG93WDogJ2hpZGRlbicsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG92ZXJmbG93WTogJ2F1dG8nLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH19XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPENhbWVyYUZlZWQgcHJpbnRlcj17dGhpcy5wcm9wcy5wcmludGVyfSAvPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxGaXJtd2FyZVVwZGF0ZUJhbm5lciBmbHV4PXt0aGlzLl9mbHV4fSBwcmludGVyPXt0aGlzLnByb3BzLnByaW50ZXJ9IC8+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHt0aGlzLnJlbmRlck1vbml0b3JQaWxsKCl9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGlkPSdwcmludGVyRGV0YWlsc0J1dHRvbkJhcic+e3RoaXMucmVuZGVyQnV0dG9ucygpfTwvZGl2PlxyXG4gICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cclxuICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cclxuICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHJlbmRlcigpIHtcclxuICAgICAgICByZXR1cm4gKFxyXG4gICAgICAgICAgICAvL3NwcmVhZCBjb21iaW5lZCBvYmogYXMgcHJvcHNcclxuICAgICAgICAgICAgPFByaW50ZXJDYXJkQ29udGFpbmVyXHJcbiAgICAgICAgICAgICAgICB7Li4uT2JqZWN0LmFzc2lnbih7fSwgdGhpcy5wcm9wcywge1xyXG4gICAgICAgICAgICAgICAgICAgIHN3aXBlRGlyZWN0aW9uOiB0aGlzLnN0YXRlLnBhbmVsU3dpcGVEaXJlY3Rpb24sXHJcbiAgICAgICAgICAgICAgICB9KX1cclxuICAgICAgICAgICAgPlxyXG4gICAgICAgICAgICAgICAge3RoaXMucmVuZGVyQ2FyZCgpfVxyXG4gICAgICAgICAgICA8L1ByaW50ZXJDYXJkQ29udGFpbmVyPlxyXG4gICAgICAgICk7XHJcbiAgICB9XHJcbn1cclxuXHJcblByaW50ZXJEZXRhaWxzUGFuZWwucHJvcFR5cGVzID0gT2JqZWN0LmFzc2lnbih7fSwgRmx1eENvbXBvbmVudC5wcm9wVHlwZXMsIHtcclxuICAgIG9uQ2xvc2U6IFJlYWN0LlByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsXHJcbiAgICBvbkJhY2s6IFJlYWN0LlByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsXHJcbiAgICBzaG91bGRTaG93TWFpbkRldGFpbHNQYW5lbDogUmVhY3QuUHJvcFR5cGVzLmZ1bmMsXHJcbiAgICBwcmludGVyOiBSZWFjdC5Qcm9wVHlwZXMuc2hhcGUoe1xyXG4gICAgICAgIGFja25vd2xlZGdlTGFzdEVycm9yOiBSZWFjdC5Qcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxyXG4gICAgICAgIGdldElkOiBSZWFjdC5Qcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxyXG4gICAgICAgIGdldEluZm86IFJlYWN0LlByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsXHJcbiAgICAgICAgZ2V0TmFtZTogUmVhY3QuUHJvcFR5cGVzLmZ1bmMuaXNSZXF1aXJlZCxcclxuICAgICAgICBnZXRTdGF0dXM6IFJlYWN0LlByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsXHJcbiAgICAgICAgaW52b2tlOiBSZWFjdC5Qcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxyXG4gICAgfSkuaXNSZXF1aXJlZCxcclxufSk7XHJcblxyXG5QcmludGVyRGV0YWlsc1BhbmVsLmRpc3BsYXlOYW1lID0gJ1ByaW50ZXJEZXRhaWxzUGFuZWwnO1xyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBQcmludGVyRGV0YWlsc1BhbmVsO1xyXG4iXX0=
