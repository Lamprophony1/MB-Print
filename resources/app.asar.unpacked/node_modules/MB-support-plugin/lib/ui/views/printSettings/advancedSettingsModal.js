'use strict';

const React = require('react');

const R = require('ramda');

const path = require('path');

const Isvg = require('react-inlinesvg');

const Button = require('eagle-print/views//ui/button');

const FluxComponent = require('eagle-print/views/flux_component');

const q = require('q');

const AdvancedItem = require('./advancedSettingToggle');

const util = require('../../../util');

const ui = require('../../../utils/printSettings/uiUtils');

const PrintSettingsConstants = require('../../../constants/print_settings');

const reducers = require('../../../utils/printSettings/reducers');

const GroupKeys = R.omit(['BasicSettings'], PrintSettingsConstants.GroupKeys); // don't need Basic Settings here

const SettingsKeys = PrintSettingsConstants.SettingsKeys;

const PrintModeElement = require('./printMode');

const Listbox = require('../input/listbox');

const ButtonWithDropdown = require('../buttonWithDropdown');

const Icons = Object.freeze({
  overview: '../images/quick-info-settings.svg',
  [GroupKeys.QuickSettings]: '../images/as-quick-settings.svg',
  [GroupKeys.Printer]: '../images/as-printers.svg',
  [GroupKeys.Extruder]: '../images/as-extruder.svg',
  [GroupKeys.Roofs]: '../images/as-roof.svg',
  [GroupKeys.Shells]: '../images/as-shells.svg',
  [GroupKeys.Infill]: '../images/as-infill.svg',
  [GroupKeys.Floors]: '../images/as-floors.svg',
  [GroupKeys.SupportsBridging]: '../images/as-supports-and-bridging.svg',
  [GroupKeys.Rafts]: '../images/as-rafts-base.svg',
  [GroupKeys.Brims]: '../images/as-rafts-base.svg',
  [GroupKeys.BaseLayer]: '../images/as-rafts-base.svg'
});
const EEIcon = '../images/as-extruder-ee.svg';

class AdvancedSettingsModal extends FluxComponent {
  constructor(props) {
    super(props);
    this.store = this.getFlux().store('PrintSettingsStore');
    this.actions = this.getFlux().actions.PrintSettingsActions;
    this.i18n = this.props.flux.getService('TranslationService');
    this.savePropValue = ui.savePropValue(this.getFlux(), this.props.project);
    this.onChange = this.onChange.bind(this);
    this.state = R.merge(this.store.getState(), {
      tab: this.state.currentPreset ? GroupKeys.QuickSettings : 'overview'
    });
  }

  componentDidMount() {
    this.store.addListener('change', this.onChange);
    this.onChange();
  }

  componentWillUnmount() {
    this.store.removeListener('change', this.onChange);
  }

  onChange() {
    const {
      tab
    } = this.state;
    const {
      currentPreset
    } = this.store.getState();
    const newTab = currentPreset && isOverview(tab) ? GroupKeys.QuickSettings : tab;
    const newState = R.merge(this.store.getState(), {
      tab: newTab
    });
    this.setState(newState);
  }

  onToggle(setting) {
    this.getFlux().actions.PrintSettingsActions.toggleProp(setting);
  }

  onSelectionChanged(selection) {
    // if selection is undefined, key will default to the tab in state
    const tab = R.reduce((curr, v) => v === selection ? v : curr, this.state.tab, ['overview', ...R.values(GroupKeys)]); // can't switch to "overview" if there's a preset set

    if (this.state.currentPreset && isOverview(tab)) return;
    this.setState({
      tab
    });
  }

  close() {
    this.actions.closeAdvSettingsModal(this.getFlux());
  } // this function is here because there's some confusion as to whether "close" and "done" are the same thing...


  done() {
    this.close();
  }

  jumpToSetting(setting) {
    if (R.has(setting, this.state.settings)) {
      // no need to check for undefined, because onSelectionChanged() will handle it
      const group = R.path([setting, 'groups', 0], this.state.settings);
      this.onSelectionChanged(group);
    }
  }

  renderPresetsPanel() {
    const currentPrintMode = this.state.printMode.selected; //Alphabetize print modes, to keep them in a consistent order

    const printModes = this.state.printMode.supported.sort();

    const icon = preset => reducers.presetIsExperimental(preset) ? /*#__PURE__*/React.createElement(Isvg, {
      src: util.fullIconPath(path.resolve(__dirname, EEIcon))
    }) : null;

    const mapPresets = preset => ({
      label: /*#__PURE__*/React.createElement("div", null, ui.withAsterisk(R.identity, this.store.hasOverridesForPreset, preset.name), icon(preset)),
      value: preset.name,
      selected: this.state.currentPreset === preset.name,
      disabled: preset.disabled
    });

    const presets = R.map(mapPresets, R.sortBy(R.prop('name'), this.state.presets));

    const displayPrintMode = v => this.i18n.t(`mb:printSettings.${v}`);

    const printModeSelected = mode => currentPrintMode === mode && !this.state.currentPreset;

    return /*#__PURE__*/React.createElement("div", {
      className: "print-modes"
    }, /*#__PURE__*/React.createElement("p", null, this.i18n.t(`mb:printSettings.advancedSettings.default`)), /*#__PURE__*/React.createElement("div", {
      className: "default list-box"
    }, /*#__PURE__*/React.createElement("ul", {
      className: "list-box-items"
    }, printModes.map(v => /*#__PURE__*/React.createElement("li", {
      key: v,
      className: `list-box-item${printModeSelected(v) ? ' list-box-item-selected' : ''}`,
      onClick: () => {
        this.savePropValue('occurrence:printMode', v, 'string');
        return q().then(() => this.actions.unapplyPreset()).then(() => this.actions.updatePrintMode(v)).done();
      }
    }, ui.withAsterisk(displayPrintMode, this.store.hasOverridesForPrintMode, v))))), /*#__PURE__*/React.createElement("p", null, this.i18n.t(`mb:printSettings.advancedSettings.custom`)), /*#__PURE__*/React.createElement(Listbox, {
      className: "custom",
      items: presets,
      newItem: this.state.newPresetName,
      onAdd: () => {
        this.actions.createPreset(this.state.newPresetName, currentPrintMode).then(() => this.setState({
          newPresetName: null
        }));
      },
      onRemove: () => this.actions.destroyPreset(this.state.currentPreset),
      onSelect: p => this.actions.applyPreset(p),
      onChange: s => this.setState({
        newPresetName: s
      }),
      placeholder: this.i18n.t('mb:printSettings.presets.nameModal.title.new'),
      disabled: false,
      addLabel: "+",
      removeLabel: "-",
      error: this.state.presetError.map(R.T).lift(),
      emptyLabel: this.i18n.t('mb:printSettings.presets.noneAvailable')
    }));
  }

  renderGroupsPanel() {
    const className = v => (this.state.tab === v ? `${v} active` : v) + (this.state.currentPreset && isOverview(v) ? ' disabled' : '');

    return /*#__PURE__*/React.createElement("ul", {
      className: "advanced-settings-tabs"
    }, ['overview', ...Object.values(GroupKeys)].map(groupName => /*#__PURE__*/React.createElement("li", {
      className: className(groupName),
      key: groupName,
      onClick: () => this.onSelectionChanged(groupName)
    }, /*#__PURE__*/React.createElement(Isvg, {
      src: util.fullIconPath(path.resolve(__dirname, Icons[groupName]))
    }), this.i18n.t(`mb:printSettings.groups.${groupName}`))));
  }

  renderSettingsPanel() {
    const currentPrinter = this.getFlux().store('PrinterStore').getSelectedPrinter();
    const quickSettingsIsSelected = this.state.tab === 'quick_settings';

    const advancedItemProps = (v, k) => {
      return R.merge(v, {
        flux: this.getFlux(),
        name: k,
        title: v.name,
        active: v.visible,
        disabled: k === SettingsKeys.Supports,
        onToggle: this.onToggle.bind(this),
        onChange: this.props.onChangeProp,
        // A temporary hack, to avoid testing errors caused by the fact that the
        // base layer surface temp setting's fields are not properly populated
        value: v.value === null || v.value === undefined ? 0 : v.value
      });
    };

    const elem = (v, k) => {
      const isSupportsElement = k === 'supportType';
      if (!currentPrinter.isSixthGen() && quickSettingsIsSelected && isSupportsElement) return;else {
        return /*#__PURE__*/React.createElement("li", {
          key: k
        }, /*#__PURE__*/React.createElement(AdvancedItem, advancedItemProps(v, k)));
      }
    };

    const renderOverrides = R.pipe(R.pickBy(R.pipe(R.prop('groups'), R.contains(this.state.tab))), R.mapObjIndexed(elem), R.values);
    const printMode = this.state.printMode.selected;

    if (isOverview(this.state.tab)) {
      return /*#__PURE__*/React.createElement("div", {
        className: "print-mode-view"
      }, /*#__PURE__*/React.createElement(PrintModeElement, {
        i18n: this.i18n,
        printer: currentPrinter,
        opt: printMode,
        selected: false,
        disabled: true,
        onClick: () => {}
      }));
    } else {
      const overrides = renderOverrides(this.state.settings);
      return /*#__PURE__*/React.createElement("div", {
        className: "panel-body advanced-settings-list-container"
      }, /*#__PURE__*/React.createElement("ul", {
        className: "advanced-settings-list"
      }, overrides.length > 0 ? overrides : /*#__PURE__*/React.createElement("li", {
        className: "advanced-settings-none"
      }, "No available settings")));
    }
  }

  renderSettingsOptions() {
    return /*#__PURE__*/React.createElement(ButtonWithDropdown, {
      i18n: this._i18n,
      flux: this.props.flux,
      id: "resetSettingsButton",
      classes: "secondary1 resetSettingsButton",
      dropdownClasses: "secondary1 resetSettingsDropdown",
      label: this.i18n.t('mb:printSettings.right_click.reset_all_to_default'),
      onClick: () => this.actions.resetAllToDefault(),
      menuItems: [{
        path: 'removeAllSettings',
        label: this.i18n.t('mb:printSettings.right_click.remove_all_settings'),
        action: () => this.actions.removeAllSettings()
      }]
    });
  }

  renderPresetActions() {
    const actionsDict = {
      import: {
        onClick: () => this.actions.readPresets(),
        disabled: false
      },
      export: {
        onClick: () => this.actions.writePreset(this.state.currentPreset),
        disabled: R.isNil(this.state.currentPreset)
      },
      save: {
        onClick: () => this.actions.updatePreset(this.state.currentPreset),
        disabled: R.isNil(this.state.currentPreset) || !this.store.hasOverridesForPreset(this.state.currentPreset)
      }
    };

    const actionsMapper = (v, k) => /*#__PURE__*/React.createElement(Button, {
      type: "secondary",
      key: k,
      label: this.i18n.t(`mb:printSettings.presets.${k}`),
      onClick: v.onClick,
      disabled: v.disabled
    });

    return /*#__PURE__*/React.createElement("div", {
      className: "active-settings-preset-actions"
    }, /*#__PURE__*/React.createElement("div", {
      className: "buttonGroup"
    }, this.renderSettingsOptions(), R.values(R.mapObjIndexed(actionsMapper, actionsDict))));
  }

  renderSelectedSettings() {
    const elem = (v, k) => /*#__PURE__*/React.createElement("a", {
      key: k,
      onClick: () => this.jumpToSetting(k)
    }, v.name);

    const renderSettings = R.pipe(R.pickBy(R.prop('visible')), R.mapObjIndexed(elem), R.values);
    return /*#__PURE__*/React.createElement("div", {
      className: "advanced-settings-active"
    }, /*#__PURE__*/React.createElement("strong", null, this.i18n.t(`mb:printSettings.advancedSettings.added`)), renderSettings(this.state.settings));
  }

  render() {
    if (!this.state) return /*#__PURE__*/React.createElement("div", null);
    return /*#__PURE__*/React.createElement("div", {
      className: "advanced-settings-modal"
    }, /*#__PURE__*/React.createElement("div", {
      className: "systemPreferences"
    }, /*#__PURE__*/React.createElement("div", {
      className: "left"
    }, this.renderPresetsPanel()), /*#__PURE__*/React.createElement("div", {
      className: "left"
    }, /*#__PURE__*/React.createElement("p", null, this.i18n.t(`mb:printSettings.advancedSettings.settings`)), this.renderGroupsPanel()), /*#__PURE__*/React.createElement("div", {
      className: "right"
    }, /*#__PURE__*/React.createElement("p", {
      style: {
        textAlign: 'right'
      }
    }, this.i18n.t(`mb:printSettings.advancedSettings.settingsVisible`)), this.renderSettingsPanel())), /*#__PURE__*/React.createElement("div", {
      className: "bottom"
    }, this.renderSelectedSettings(), /*#__PURE__*/React.createElement("div", {
      className: "buttonGroup"
    }, this.renderPresetActions(), /*#__PURE__*/React.createElement(Button, {
      classNames: "doneButton",
      type: "secondary",
      label: "Done",
      onClick: this.done.bind(this)
    }))));
  }

}

const isOverview = v => v === 'overview';

AdvancedSettingsModal.displayName = 'AdvancedSettingsModal';
AdvancedSettingsModal.propTypes = {
  flux: React.PropTypes.shape({
    store: React.PropTypes.func.isRequired,
    getService: React.PropTypes.func.isRequired
  }).isRequired,
  project: React.PropTypes.object,
  onChangeProp: React.PropTypes.func
};
module.exports = AdvancedSettingsModal;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFkdmFuY2VkU2V0dGluZ3NNb2RhbC5qcyJdLCJuYW1lcyI6WyJSZWFjdCIsInJlcXVpcmUiLCJSIiwicGF0aCIsIklzdmciLCJCdXR0b24iLCJGbHV4Q29tcG9uZW50IiwicSIsIkFkdmFuY2VkSXRlbSIsInV0aWwiLCJ1aSIsIlByaW50U2V0dGluZ3NDb25zdGFudHMiLCJyZWR1Y2VycyIsIkdyb3VwS2V5cyIsIm9taXQiLCJTZXR0aW5nc0tleXMiLCJQcmludE1vZGVFbGVtZW50IiwiTGlzdGJveCIsIkJ1dHRvbldpdGhEcm9wZG93biIsIkljb25zIiwiT2JqZWN0IiwiZnJlZXplIiwib3ZlcnZpZXciLCJRdWlja1NldHRpbmdzIiwiUHJpbnRlciIsIkV4dHJ1ZGVyIiwiUm9vZnMiLCJTaGVsbHMiLCJJbmZpbGwiLCJGbG9vcnMiLCJTdXBwb3J0c0JyaWRnaW5nIiwiUmFmdHMiLCJCcmltcyIsIkJhc2VMYXllciIsIkVFSWNvbiIsIkFkdmFuY2VkU2V0dGluZ3NNb2RhbCIsImNvbnN0cnVjdG9yIiwicHJvcHMiLCJzdG9yZSIsImdldEZsdXgiLCJhY3Rpb25zIiwiUHJpbnRTZXR0aW5nc0FjdGlvbnMiLCJpMThuIiwiZmx1eCIsImdldFNlcnZpY2UiLCJzYXZlUHJvcFZhbHVlIiwicHJvamVjdCIsIm9uQ2hhbmdlIiwiYmluZCIsInN0YXRlIiwibWVyZ2UiLCJnZXRTdGF0ZSIsInRhYiIsImN1cnJlbnRQcmVzZXQiLCJjb21wb25lbnREaWRNb3VudCIsImFkZExpc3RlbmVyIiwiY29tcG9uZW50V2lsbFVubW91bnQiLCJyZW1vdmVMaXN0ZW5lciIsIm5ld1RhYiIsImlzT3ZlcnZpZXciLCJuZXdTdGF0ZSIsInNldFN0YXRlIiwib25Ub2dnbGUiLCJzZXR0aW5nIiwidG9nZ2xlUHJvcCIsIm9uU2VsZWN0aW9uQ2hhbmdlZCIsInNlbGVjdGlvbiIsInJlZHVjZSIsImN1cnIiLCJ2IiwidmFsdWVzIiwiY2xvc2UiLCJjbG9zZUFkdlNldHRpbmdzTW9kYWwiLCJkb25lIiwianVtcFRvU2V0dGluZyIsImhhcyIsInNldHRpbmdzIiwiZ3JvdXAiLCJyZW5kZXJQcmVzZXRzUGFuZWwiLCJjdXJyZW50UHJpbnRNb2RlIiwicHJpbnRNb2RlIiwic2VsZWN0ZWQiLCJwcmludE1vZGVzIiwic3VwcG9ydGVkIiwic29ydCIsImljb24iLCJwcmVzZXQiLCJwcmVzZXRJc0V4cGVyaW1lbnRhbCIsImZ1bGxJY29uUGF0aCIsInJlc29sdmUiLCJfX2Rpcm5hbWUiLCJtYXBQcmVzZXRzIiwibGFiZWwiLCJ3aXRoQXN0ZXJpc2siLCJpZGVudGl0eSIsImhhc092ZXJyaWRlc0ZvclByZXNldCIsIm5hbWUiLCJ2YWx1ZSIsImRpc2FibGVkIiwicHJlc2V0cyIsIm1hcCIsInNvcnRCeSIsInByb3AiLCJkaXNwbGF5UHJpbnRNb2RlIiwidCIsInByaW50TW9kZVNlbGVjdGVkIiwibW9kZSIsInRoZW4iLCJ1bmFwcGx5UHJlc2V0IiwidXBkYXRlUHJpbnRNb2RlIiwiaGFzT3ZlcnJpZGVzRm9yUHJpbnRNb2RlIiwibmV3UHJlc2V0TmFtZSIsImNyZWF0ZVByZXNldCIsImRlc3Ryb3lQcmVzZXQiLCJwIiwiYXBwbHlQcmVzZXQiLCJzIiwicHJlc2V0RXJyb3IiLCJUIiwibGlmdCIsInJlbmRlckdyb3Vwc1BhbmVsIiwiY2xhc3NOYW1lIiwiZ3JvdXBOYW1lIiwicmVuZGVyU2V0dGluZ3NQYW5lbCIsImN1cnJlbnRQcmludGVyIiwiZ2V0U2VsZWN0ZWRQcmludGVyIiwicXVpY2tTZXR0aW5nc0lzU2VsZWN0ZWQiLCJhZHZhbmNlZEl0ZW1Qcm9wcyIsImsiLCJ0aXRsZSIsImFjdGl2ZSIsInZpc2libGUiLCJTdXBwb3J0cyIsIm9uQ2hhbmdlUHJvcCIsInVuZGVmaW5lZCIsImVsZW0iLCJpc1N1cHBvcnRzRWxlbWVudCIsImlzU2l4dGhHZW4iLCJyZW5kZXJPdmVycmlkZXMiLCJwaXBlIiwicGlja0J5IiwiY29udGFpbnMiLCJtYXBPYmpJbmRleGVkIiwib3ZlcnJpZGVzIiwibGVuZ3RoIiwicmVuZGVyU2V0dGluZ3NPcHRpb25zIiwiX2kxOG4iLCJyZXNldEFsbFRvRGVmYXVsdCIsImFjdGlvbiIsInJlbW92ZUFsbFNldHRpbmdzIiwicmVuZGVyUHJlc2V0QWN0aW9ucyIsImFjdGlvbnNEaWN0IiwiaW1wb3J0Iiwib25DbGljayIsInJlYWRQcmVzZXRzIiwiZXhwb3J0Iiwid3JpdGVQcmVzZXQiLCJpc05pbCIsInNhdmUiLCJ1cGRhdGVQcmVzZXQiLCJhY3Rpb25zTWFwcGVyIiwicmVuZGVyU2VsZWN0ZWRTZXR0aW5ncyIsInJlbmRlclNldHRpbmdzIiwicmVuZGVyIiwidGV4dEFsaWduIiwiZGlzcGxheU5hbWUiLCJwcm9wVHlwZXMiLCJQcm9wVHlwZXMiLCJzaGFwZSIsImZ1bmMiLCJpc1JlcXVpcmVkIiwib2JqZWN0IiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUEsTUFBTUEsS0FBSyxHQUFHQyxPQUFPLENBQUMsT0FBRCxDQUFyQjs7QUFDQSxNQUFNQyxDQUFDLEdBQUdELE9BQU8sQ0FBQyxPQUFELENBQWpCOztBQUNBLE1BQU1FLElBQUksR0FBR0YsT0FBTyxDQUFDLE1BQUQsQ0FBcEI7O0FBQ0EsTUFBTUcsSUFBSSxHQUFHSCxPQUFPLENBQUMsaUJBQUQsQ0FBcEI7O0FBQ0EsTUFBTUksTUFBTSxHQUFHSixPQUFPLENBQUMsOEJBQUQsQ0FBdEI7O0FBQ0EsTUFBTUssYUFBYSxHQUFHTCxPQUFPLENBQUMsa0NBQUQsQ0FBN0I7O0FBQ0EsTUFBTU0sQ0FBQyxHQUFHTixPQUFPLENBQUMsR0FBRCxDQUFqQjs7QUFFQSxNQUFNTyxZQUFZLEdBQUdQLE9BQU8sQ0FBQyx5QkFBRCxDQUE1Qjs7QUFDQSxNQUFNUSxJQUFJLEdBQUdSLE9BQU8sQ0FBQyxlQUFELENBQXBCOztBQUNBLE1BQU1TLEVBQUUsR0FBR1QsT0FBTyxDQUFDLHNDQUFELENBQWxCOztBQUNBLE1BQU1VLHNCQUFzQixHQUFHVixPQUFPLENBQUMsbUNBQUQsQ0FBdEM7O0FBQ0EsTUFBTVcs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bnN0IFJlYWN0ID0gcmVxdWlyZSgncmVhY3QnKTtcclxuY29uc3QgUiA9IHJlcXVpcmUoJ3JhbWRhJyk7XHJcbmNvbnN0IHBhdGggPSByZXF1aXJlKCdwYXRoJyk7XHJcbmNvbnN0IElzdmcgPSByZXF1aXJlKCdyZWFjdC1pbmxpbmVzdmcnKTtcclxuY29uc3QgQnV0dG9uID0gcmVxdWlyZSgnZWFnbGUtcHJpbnQvdmlld3MvL3VpL2J1dHRvbicpO1xyXG5jb25zdCBGbHV4Q29tcG9uZW50ID0gcmVxdWlyZSgnZWFnbGUtcHJpbnQvdmlld3MvZmx1eF9jb21wb25lbnQnKTtcclxuY29uc3QgcSA9IHJlcXVpcmUoJ3EnKTtcclxuXHJcbmNvbnN0IEFkdmFuY2VkSXRlbSA9IHJlcXVpcmUoJy4vYWR2YW5jZWRTZXR0aW5nVG9nZ2xlJyk7XHJcbmNvbnN0IHV0aWwgPSByZXF1aXJlKCcuLi8uLi8uLi91dGlsJyk7XHJcbmNvbnN0IHVpID0gcmVxdWlyZSgnLi4vLi4vLi4vdXRpbHMvcHJpbnRTZXR0aW5ncy91aVV0aWxzJyk7XHJcbmNvbnN0IFByaW50U2V0dGluZ3NDb25zdGFudHMgPSByZXF1aXJlKCcuLi8uLi8uLi9jb25zdGFudHMvcHJpbnRfc2V0dGluZ3MnKTtcclxuY29uc3QgcmVkdWNlcnMgPSByZXF1aXJlKCcuLi8uLi8uLi91dGlscy9wcmludFNldHRpbmdzL3JlZHVjZXJzJyk7XHJcbmNvbnN0IEdyb3VwS2V5cyA9IFIub21pdChbJ0Jhc2ljU2V0dGluZ3MnXSwgUHJpbnRTZXR0aW5nc0NvbnN0YW50cy5Hcm91cEtleXMpOyAvLyBkb24ndCBuZWVkIEJhc2ljIFNldHRpbmdzIGhlcmVcclxuY29uc3QgU2V0dGluZ3NLZXlzID0gUHJpbnRTZXR0aW5nc0NvbnN0YW50cy5TZXR0aW5nc0tleXM7XHJcbmNvbnN0IFByaW50TW9kZUVsZW1lbnQgPSByZXF1aXJlKCcuL3ByaW50TW9kZScpO1xyXG5jb25zdCBMaXN0Ym94ID0gcmVxdWlyZSgnLi4vaW5wdXQvbGlzdGJveCcpO1xyXG5jb25zdCBCdXR0b25XaXRoRHJvcGRvd24gPSByZXF1aXJlKCcuLi9idXR0b25XaXRoRHJvcGRvd24nKTtcclxuXHJcbmNvbnN0IEljb25zID0gT2JqZWN0LmZyZWV6ZSh7XHJcbiAgICBvdmVydmlldzogJy4uL2ltYWdlcy9xdWljay1pbmZvLXNldHRpbmdzLnN2ZycsXHJcbiAgICBbR3JvdXBLZXlzLlF1aWNrU2V0dGluZ3NdOiAnLi4vaW1hZ2VzL2FzLXF1aWNrLXNldHRpbmdzLnN2ZycsXHJcbiAgICBbR3JvdXBLZXlzLlByaW50ZXJdOiAnLi4vaW1hZ2VzL2FzLXByaW50ZXJzLnN2ZycsXHJcbiAgICBbR3JvdXBLZXlzLkV4dHJ1ZGVyXTogJy4uL2ltYWdlcy9hcy1leHRydWRlci5zdmcnLFxyXG4gICAgW0dyb3VwS2V5cy5Sb29mc106ICcuLi9pbWFnZXMvYXMtcm9vZi5zdmcnLFxyXG4gICAgW0dyb3VwS2V5cy5TaGVsbHNdOiAnLi4vaW1hZ2VzL2FzLXNoZWxscy5zdmcnLFxyXG4gICAgW0dyb3VwS2V5cy5JbmZpbGxdOiAnLi4vaW1hZ2VzL2FzLWluZmlsbC5zdmcnLFxyXG4gICAgW0dyb3VwS2V5cy5GbG9vcnNdOiAnLi4vaW1hZ2VzL2FzLWZsb29ycy5zdmcnLFxyXG4gICAgW0dyb3VwS2V5cy5TdXBwb3J0c0JyaWRnaW5nXTogJy4uL2ltYWdlcy9hcy1zdXBwb3J0cy1hbmQtYnJpZGdpbmcuc3ZnJyxcclxuICAgIFtHcm91cEtleXMuUmFmdHNdOiAnLi4vaW1hZ2VzL2FzLXJhZnRzLWJhc2Uuc3ZnJyxcclxuICAgIFtHcm91cEtleXMuQnJpbXNdOiAnLi4vaW1hZ2VzL2FzLXJhZnRzLWJhc2Uuc3ZnJyxcclxuICAgIFtHcm91cEtleXMuQmFzZUxheWVyXTogJy4uL2ltYWdlcy9hcy1yYWZ0cy1iYXNlLnN2ZycsXHJcbn0pO1xyXG5cclxuY29uc3QgRUVJY29uID0gJy4uL2ltYWdlcy9hcy1leHRydWRlci1lZS5zdmcnO1xyXG5cclxuY2xhc3MgQWR2YW5jZWRTZXR0aW5nc01vZGFsIGV4dGVuZHMgRmx1eENvbXBvbmVudCB7XHJcbiAgICBjb25zdHJ1Y3Rvcihwcm9wcykge1xyXG4gICAgICAgIHN1cGVyKHByb3BzKTtcclxuXHJcbiAgICAgICAgdGhpcy5zdG9yZSA9IHRoaXMuZ2V0Rmx1eCgpLnN0b3JlKCdQcmludFNldHRpbmdzU3RvcmUnKTtcclxuICAgICAgICB0aGlzLmFjdGlvbnMgPSB0aGlzLmdldEZsdXgoKS5hY3Rpb25zLlByaW50U2V0dGluZ3NBY3Rpb25zO1xyXG4gICAgICAgIHRoaXMuaTE4biA9IHRoaXMucHJvcHMuZmx1eC5nZXRTZXJ2aWNlKCdUcmFuc2xhdGlvblNlcnZpY2UnKTtcclxuXHJcbiAgICAgICAgdGhpcy5zYXZlUHJvcFZhbHVlID0gdWkuc2F2ZVByb3BWYWx1ZSh0aGlzLmdldEZsdXgoKSwgdGhpcy5wcm9wcy5wcm9qZWN0KTtcclxuXHJcbiAgICAgICAgdGhpcy5vbkNoYW5nZSA9IHRoaXMub25DaGFuZ2UuYmluZCh0aGlzKTtcclxuXHJcbiAgICAgICAgdGhpcy5zdGF0ZSA9IFIubWVyZ2UodGhpcy5zdG9yZS5nZXRTdGF0ZSgpLCB7XHJcbiAgICAgICAgICAgIHRhYjogdGhpcy5zdGF0ZS5jdXJyZW50UHJlc2V0ID8gR3JvdXBLZXlzLlF1aWNrU2V0dGluZ3MgOiAnb3ZlcnZpZXcnLFxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbXBvbmVudERpZE1vdW50KCkge1xyXG4gICAgICAgIHRoaXMuc3RvcmUuYWRkTGlzdGVuZXIoJ2NoYW5nZScsIHRoaXMub25DaGFuZ2UpO1xyXG4gICAgICAgIHRoaXMub25DaGFuZ2UoKTtcclxuICAgIH1cclxuXHJcbiAgICBjb21wb25lbnRXaWxsVW5tb3VudCgpIHtcclxuICAgICAgICB0aGlzLnN0b3JlLnJlbW92ZUxpc3RlbmVyKCdjaGFuZ2UnLCB0aGlzLm9uQ2hhbmdlKTtcclxuICAgIH1cclxuXHJcbiAgICBvbkNoYW5nZSgpIHtcclxuICAgICAgICBjb25zdCB7IHRhYiB9ID0gdGhpcy5zdGF0ZTtcclxuICAgICAgICBjb25zdCB7IGN1cnJlbnRQcmVzZXQgfSA9IHRoaXMuc3RvcmUuZ2V0U3RhdGUoKTtcclxuICAgICAgICBjb25zdCBuZXdUYWIgPSBjdXJyZW50UHJlc2V0ICYmIGlzT3ZlcnZpZXcodGFiKSA/IEdyb3VwS2V5cy5RdWlja1NldHRpbmdzIDogdGFiO1xyXG5cclxuICAgICAgICBjb25zdCBuZXdTdGF0ZSA9IFIubWVyZ2UodGhpcy5zdG9yZS5nZXRTdGF0ZSgpLCB7IHRhYjogbmV3VGFiIH0pO1xyXG5cclxuICAgICAgICB0aGlzLnNldFN0YXRlKG5ld1N0YXRlKTtcclxuICAgIH1cclxuXHJcbiAgICBvblRvZ2dsZShzZXR0aW5nKSB7XHJcbiAgICAgICAgdGhpcy5nZXRGbHV4KCkuYWN0aW9ucy5QcmludFNldHRpbmdzQWN0aW9ucy50b2dnbGVQcm9wKHNldHRpbmcpO1xyXG4gICAgfVxyXG5cclxuICAgIG9uU2VsZWN0aW9uQ2hhbmdlZChzZWxlY3Rpb24pIHtcclxuICAgICAgICAvLyBpZiBzZWxlY3Rpb24gaXMgdW5kZWZpbmVkLCBrZXkgd2lsbCBkZWZhdWx0IHRvIHRoZSB0YWIgaW4gc3RhdGVcclxuICAgICAgICBjb25zdCB0YWIgPSBSLnJlZHVjZSgoY3VyciwgdikgPT4gKHYgPT09IHNlbGVjdGlvbiA/IHYgOiBjdXJyKSwgdGhpcy5zdGF0ZS50YWIsIFtcclxuICAgICAgICAgICAgJ292ZXJ2aWV3JyxcclxuICAgICAgICAgICAgLi4uUi52YWx1ZXMoR3JvdXBLZXlzKSxcclxuICAgICAgICBdKTtcclxuXHJcbiAgICAgICAgLy8gY2FuJ3Qgc3dpdGNoIHRvIFwib3ZlcnZpZXdcIiBpZiB0aGVyZSdzIGEgcHJlc2V0IHNldFxyXG4gICAgICAgIGlmICh0aGlzLnN0YXRlLmN1cnJlbnRQcmVzZXQgJiYgaXNPdmVydmlldyh0YWIpKSByZXR1cm47XHJcblxyXG4gICAgICAgIHRoaXMuc2V0U3RhdGUoeyB0YWIgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgY2xvc2UoKSB7XHJcbiAgICAgICAgdGhpcy5hY3Rpb25zLmNsb3NlQWR2U2V0dGluZ3NNb2RhbCh0aGlzLmdldEZsdXgoKSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gdGhpcyBmdW5jdGlvbiBpcyBoZXJlIGJlY2F1c2UgdGhlcmUncyBzb21lIGNvbmZ1c2lvbiBhcyB0byB3aGV0aGVyIFwiY2xvc2VcIiBhbmQgXCJkb25lXCIgYXJlIHRoZSBzYW1lIHRoaW5nLi4uXHJcbiAgICBkb25lKCkge1xyXG4gICAgICAgIHRoaXMuY2xvc2UoKTtcclxuICAgIH1cclxuXHJcbiAgICBqdW1wVG9TZXR0aW5nKHNldHRpbmcpIHtcclxuICAgICAgICBpZiAoUi5oYXMoc2V0dGluZywgdGhpcy5zdGF0ZS5zZXR0aW5ncykpIHtcclxuICAgICAgICAgICAgLy8gbm8gbmVlZCB0byBjaGVjayBmb3IgdW5kZWZpbmVkLCBiZWNhdXNlIG9uU2VsZWN0aW9uQ2hhbmdlZCgpIHdpbGwgaGFuZGxlIGl0XHJcbiAgICAgICAgICAgIGNvbnN0IGdyb3VwID0gUi5wYXRoKFtzZXR0aW5nLCAnZ3JvdXBzJywgMF0sIHRoaXMuc3RhdGUuc2V0dGluZ3MpO1xyXG4gICAgICAgICAgICB0aGlzLm9uU2VsZWN0aW9uQ2hhbmdlZChncm91cCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHJlbmRlclByZXNldHNQYW5lbCgpIHtcclxuICAgICAgICBjb25zdCBjdXJyZW50UHJpbnRNb2RlID0gdGhpcy5zdGF0ZS5wcmludE1vZGUuc2VsZWN0ZWQ7XHJcbiAgICAgICAgLy9BbHBoYWJldGl6ZSBwcmludCBtb2RlcywgdG8ga2VlcCB0aGVtIGluIGEgY29uc2lzdGVudCBvcmRlclxyXG4gICAgICAgIGNvbnN0IHByaW50TW9kZXMgPSB0aGlzLnN0YXRlLnByaW50TW9kZS5zdXBwb3J0ZWQuc29ydCgpO1xyXG4gICAgICAgIGNvbnN0IGljb24gPSBwcmVzZXQgPT5cclxuICAgICAgICAgICAgcmVkdWNlcnMucHJlc2V0SXNFeHBlcmltZW50YWwocHJlc2V0KSA/IChcclxuICAgICAgICAgICAgICAgIDxJc3ZnIHNyYz17dXRpbC5mdWxsSWNvblBhdGgocGF0aC5yZXNvbHZlKF9fZGlybmFtZSwgRUVJY29uKSl9IC8+XHJcbiAgICAgICAgICAgICkgOiBudWxsO1xyXG5cclxuICAgICAgICBjb25zdCBtYXBQcmVzZXRzID0gcHJlc2V0ID0+ICh7XHJcbiAgICAgICAgICAgIGxhYmVsOiAoXHJcbiAgICAgICAgICAgICAgICA8ZGl2PlxyXG4gICAgICAgICAgICAgICAgICAgIHt1aS53aXRoQXN0ZXJpc2soUi5pZGVudGl0eSwgdGhpcy5zdG9yZS5oYXNPdmVycmlkZXNGb3JQcmVzZXQsIHByZXNldC5uYW1lKX1cclxuICAgICAgICAgICAgICAgICAgICB7aWNvbihwcmVzZXQpfVxyXG4gICAgICAgICAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgICAgICksXHJcbiAgICAgICAgICAgIHZhbHVlOiBwcmVzZXQubmFtZSxcclxuICAgICAgICAgICAgc2VsZWN0ZWQ6IHRoaXMuc3RhdGUuY3VycmVudFByZXNldCA9PT0gcHJlc2V0Lm5hbWUsXHJcbiAgICAgICAgICAgIGRpc2FibGVkOiBwcmVzZXQuZGlzYWJsZWQsXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGNvbnN0IHByZXNldHMgPSBSLm1hcChtYXBQcmVzZXRzLCBSLnNvcnRCeShSLnByb3AoJ25hbWUnKSwgdGhpcy5zdGF0ZS5wcmVzZXRzKSk7XHJcblxyXG4gICAgICAgIGNvbnN0IGRpc3BsYXlQcmludE1vZGUgPSB2ID0+IHRoaXMuaTE4bi50KGBtYjpwcmludFNldHRpbmdzLiR7dn1gKTtcclxuXHJcbiAgICAgICAgY29uc3QgcHJpbnRNb2RlU2VsZWN0ZWQgPSBtb2RlID0+IGN1cnJlbnRQcmludE1vZGUgPT09IG1vZGUgJiYgIXRoaXMuc3RhdGUuY3VycmVudFByZXNldDtcclxuXHJcbiAgICAgICAgcmV0dXJuIChcclxuICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9J3ByaW50LW1vZGVzJz5cclxuICAgICAgICAgICAgICAgIDxwPnt0aGlzLmkxOG4udChgbWI6cHJpbnRTZXR0aW5ncy5hZHZhbmNlZFNldHRpbmdzLmRlZmF1bHRgKX08L3A+XHJcbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0nZGVmYXVsdCBsaXN0LWJveCc+XHJcbiAgICAgICAgICAgICAgICAgICAgPHVsIGNsYXNzTmFtZT0nbGlzdC1ib3gtaXRlbXMnPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICB7cHJpbnRNb2Rlcy5tYXAodiA9PiAoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8bGlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBrZXk9e3Z9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lPXtgbGlzdC1ib3gtaXRlbSR7cHJpbnRNb2RlU2VsZWN0ZWQodikgPyAnIGxpc3QtYm94LWl0ZW0tc2VsZWN0ZWQnIDogJyd9YH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbkNsaWNrPXsoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2F2ZVByb3BWYWx1ZSgnb2NjdXJyZW5jZTpwcmludE1vZGUnLCB2LCAnc3RyaW5nJyk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcSgpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAudGhlbigoKSA9PiB0aGlzLmFjdGlvbnMudW5hcHBseVByZXNldCgpKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oKCkgPT4gdGhpcy5hY3Rpb25zLnVwZGF0ZVByaW50TW9kZSh2KSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5kb25lKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfX1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgID5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7dWkud2l0aEFzdGVyaXNrKGRpc3BsYXlQcmludE1vZGUsIHRoaXMuc3RvcmUuaGFzT3ZlcnJpZGVzRm9yUHJpbnRNb2RlLCB2KX1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvbGk+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICkpfVxyXG4gICAgICAgICAgICAgICAgICAgIDwvdWw+XHJcbiAgICAgICAgICAgICAgICA8L2Rpdj5cclxuICAgICAgICAgICAgICAgIDxwPnt0aGlzLmkxOG4udChgbWI6cHJpbnRTZXR0aW5ncy5hZHZhbmNlZFNldHRpbmdzLmN1c3RvbWApfTwvcD5cclxuICAgICAgICAgICAgICAgIDxMaXN0Ym94XHJcbiAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lPSdjdXN0b20nXHJcbiAgICAgICAgICAgICAgICAgICAgaXRlbXM9e3ByZXNldHN9XHJcbiAgICAgICAgICAgICAgICAgICAgbmV3SXRlbT17dGhpcy5zdGF0ZS5uZXdQcmVzZXROYW1lfVxyXG4gICAgICAgICAgICAgICAgICAgIG9uQWRkPXsoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYWN0aW9uc1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmNyZWF0ZVByZXNldCh0aGlzLnN0YXRlLm5ld1ByZXNldE5hbWUsIGN1cnJlbnRQcmludE1vZGUpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAudGhlbigoKSA9PiB0aGlzLnNldFN0YXRlKHsgbmV3UHJlc2V0TmFtZTogbnVsbCB9KSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfX1cclxuICAgICAgICAgICAgICAgICAgICBvblJlbW92ZT17KCkgPT4gdGhpcy5hY3Rpb25zLmRlc3Ryb3lQcmVzZXQodGhpcy5zdGF0ZS5jdXJyZW50UHJlc2V0KX1cclxuICAgICAgICAgICAgICAgICAgICBvblNlbGVjdD17cCA9PiB0aGlzLmFjdGlvbnMuYXBwbHlQcmVzZXQocCl9XHJcbiAgICAgICAgICAgICAgICAgICAgb25DaGFuZ2U9e3MgPT4gdGhpcy5zZXRTdGF0ZSh7IG5ld1ByZXNldE5hbWU6IHMgfSl9XHJcbiAgICAgICAgICAgICAgICAgICAgcGxhY2Vob2xkZXI9e3RoaXMuaTE4bi50KCdtYjpwcmludFNldHRpbmdzLnByZXNldHMubmFtZU1vZGFsLnRpdGxlLm5ldycpfVxyXG4gICAgICAgICAgICAgICAgICAgIGRpc2FibGVkPXtmYWxzZX1cclxuICAgICAgICAgICAgICAgICAgICBhZGRMYWJlbD0nKydcclxuICAgICAgICAgICAgICAgICAgICByZW1vdmVMYWJlbD0nLSdcclxuICAgICAgICAgICAgICAgICAgICBlcnJvcj17dGhpcy5zdGF0ZS5wcmVzZXRFcnJvci5tYXAoUi5UKS5saWZ0KCl9XHJcbiAgICAgICAgICAgICAgICAgICAgZW1wdHlMYWJlbD17dGhpcy5pMThuLnQoJ21iOnByaW50U2V0dGluZ3MucHJlc2V0cy5ub25lQXZhaWxhYmxlJyl9XHJcbiAgICAgICAgICAgICAgICAvPlxyXG4gICAgICAgICAgICA8L2Rpdj5cclxuICAgICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIHJlbmRlckdyb3Vwc1BhbmVsKCkge1xyXG4gICAgICAgIGNvbnN0IGNsYXNzTmFtZSA9IHYgPT5cclxuICAgICAgICAgICAgKHRoaXMuc3RhdGUudGFiID09PSB2ID8gYCR7dn0gYWN0aXZlYCA6IHYpICsgKHRoaXMuc3RhdGUuY3VycmVudFByZXNldCAmJiBpc092ZXJ2aWV3KHYpID8gJyBkaXNhYmxlZCcgOiAnJyk7XHJcblxyXG4gICAgICAgIHJldHVybiAoXHJcbiAgICAgICAgICAgIDx1bCBjbGFzc05hbWU9J2FkdmFuY2VkLXNldHRpbmdzLXRhYnMnPlxyXG4gICAgICAgICAgICAgICAge1snb3ZlcnZpZXcnLCAuLi5PYmplY3QudmFsdWVzKEdyb3VwS2V5cyldLm1hcChncm91cE5hbWUgPT4gKFxyXG4gICAgICAgICAgICAgICAgICAgIDxsaVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU9e2NsYXNzTmFtZShncm91cE5hbWUpfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBrZXk9e2dyb3VwTmFtZX1cclxuICAgICAgICAgICAgICAgICAgICAgICAgb25DbGljaz17KCkgPT4gdGhpcy5vblNlbGVjdGlvbkNoYW5nZWQoZ3JvdXBOYW1lKX1cclxuICAgICAgICAgICAgICAgICAgICA+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIDxJc3ZnIHNyYz17dXRpbC5mdWxsSWNvblBhdGgocGF0aC5yZXNvbHZlKF9fZGlybmFtZSwgSWNvbnNbZ3JvdXBOYW1lXSkpfSAvPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICB7dGhpcy5pMThuLnQoYG1iOnByaW50U2V0dGluZ3MuZ3JvdXBzLiR7Z3JvdXBOYW1lfWApfVxyXG4gICAgICAgICAgICAgICAgICAgIDwvbGk+XHJcbiAgICAgICAgICAgICAgICApKX1cclxuICAgICAgICAgICAgPC91bD5cclxuICAgICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIHJlbmRlclNldHRpbmdzUGFuZWwoKSB7XHJcbiAgICAgICAgY29uc3QgY3VycmVudFByaW50ZXIgPSB0aGlzLmdldEZsdXgoKVxyXG4gICAgICAgICAgICAuc3RvcmUoJ1ByaW50ZXJTdG9yZScpXHJcbiAgICAgICAgICAgIC5nZXRTZWxlY3RlZFByaW50ZXIoKTtcclxuICAgICAgICBjb25zdCBxdWlja1NldHRpbmdzSXNTZWxlY3RlZCA9IHRoaXMuc3RhdGUudGFiID09PSAncXVpY2tfc2V0dGluZ3MnO1xyXG4gICAgICAgIGNvbnN0IGFkdmFuY2VkSXRlbVByb3BzID0gKHYsIGspID0+IHtcclxuICAgICAgICAgICAgcmV0dXJuIFIubWVyZ2Uodiwge1xyXG4gICAgICAgICAgICAgICAgZmx1eDogdGhpcy5nZXRGbHV4KCksXHJcbiAgICAgICAgICAgICAgICBuYW1lOiBrLFxyXG4gICAgICAgICAgICAgICAgdGl0bGU6IHYubmFtZSxcclxuICAgICAgICAgICAgICAgIGFjdGl2ZTogdi52aXNpYmxlLFxyXG4gICAgICAgICAgICAgICAgZGlzYWJsZWQ6IGsgPT09IFNldHRpbmdzS2V5cy5TdXBwb3J0cyxcclxuICAgICAgICAgICAgICAgIG9uVG9nZ2xlOiB0aGlzLm9uVG9nZ2xlLmJpbmQodGhpcyksXHJcbiAgICAgICAgICAgICAgICBvbkNoYW5nZTogdGhpcy5wcm9wcy5vbkNoYW5nZVByb3AsXHJcbiAgICAgICAgICAgICAgICAvLyBBIHRlbXBvcmFyeSBoYWNrLCB0byBhdm9pZCB0ZXN0aW5nIGVycm9ycyBjYXVzZWQgYnkgdGhlIGZhY3QgdGhhdCB0aGVcclxuICAgICAgICAgICAgICAgIC8vIGJhc2UgbGF5ZXIgc3VyZmFjZSB0ZW1wIHNldHRpbmcncyBmaWVsZHMgYXJlIG5vdCBwcm9wZXJseSBwb3B1bGF0ZWRcclxuICAgICAgICAgICAgICAgIHZhbHVlOiB2LnZhbHVlID09PSBudWxsIHx8IHYudmFsdWUgPT09IHVuZGVmaW5lZCA/IDAgOiB2LnZhbHVlLFxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBjb25zdCBlbGVtID0gKHYsIGspID0+IHtcclxuICAgICAgICAgICAgY29uc3QgaXNTdXBwb3J0c0VsZW1lbnQgPSBrID09PSAnc3VwcG9ydFR5cGUnO1xyXG5cclxuICAgICAgICAgICAgaWYgKCFjdXJyZW50UHJpbnRlci5pc1NpeHRoR2VuKCkgJiYgcXVpY2tTZXR0aW5nc0lzU2VsZWN0ZWQgJiYgaXNTdXBwb3J0c0VsZW1lbnQpIHJldHVybjtcclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gKFxyXG4gICAgICAgICAgICAgICAgICAgIDxsaSBrZXk9e2t9PlxyXG4gICAgICAgICAgICAgICAgICAgICAgICA8QWR2YW5jZWRJdGVtIHsuLi5hZHZhbmNlZEl0ZW1Qcm9wcyh2LCBrKX0gLz5cclxuICAgICAgICAgICAgICAgICAgICA8L2xpPlxyXG4gICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGNvbnN0IHJlbmRlck92ZXJyaWRlcyA9IFIucGlwZShcclxuICAgICAgICAgICAgUi5waWNrQnkoUi5waXBlKFIucHJvcCgnZ3JvdXBzJyksIFIuY29udGFpbnModGhpcy5zdGF0ZS50YWIpKSksXHJcbiAgICAgICAgICAgIFIubWFwT2JqSW5kZXhlZChlbGVtKSxcclxuICAgICAgICAgICAgUi52YWx1ZXNcclxuICAgICAgICApO1xyXG5cclxuICAgICAgICBjb25zdCBwcmludE1vZGUgPSB0aGlzLnN0YXRlLnByaW50TW9kZS5zZWxlY3RlZDtcclxuXHJcbiAgICAgICAgaWYgKGlzT3ZlcnZpZXcodGhpcy5zdGF0ZS50YWIpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAoXHJcbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0ncHJpbnQtbW9kZS12aWV3Jz5cclxuICAgICAgICAgICAgICAgICAgICA8UHJpbnRNb2RlRWxlbWVudFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpMThuPXt0aGlzLmkxOG59XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50ZXI9e2N1cnJlbnRQcmludGVyfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBvcHQ9e3ByaW50TW9kZX1cclxuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0ZWQ9e2ZhbHNlfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBkaXNhYmxlZD17dHJ1ZX1cclxuICAgICAgICAgICAgICAgICAgICAgICAgb25DbGljaz17KCkgPT4ge319XHJcbiAgICAgICAgICAgICAgICAgICAgLz5cclxuICAgICAgICAgICAgICAgIDwvZGl2PlxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGNvbnN0IG92ZXJyaWRlcyA9IHJlbmRlck92ZXJyaWRlcyh0aGlzLnN0YXRlLnNldHRpbmdzKTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiAoXHJcbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0ncGFuZWwtYm9keSBhZHZhbmNlZC1zZXR0aW5ncy1saXN0LWNvbnRhaW5lcic+XHJcbiAgICAgICAgICAgICAgICAgICAgPHVsIGNsYXNzTmFtZT0nYWR2YW5jZWQtc2V0dGluZ3MtbGlzdCc+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHtvdmVycmlkZXMubGVuZ3RoID4gMCA/IChcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG92ZXJyaWRlc1xyXG4gICAgICAgICAgICAgICAgICAgICAgICApIDogKFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPGxpIGNsYXNzTmFtZT0nYWR2YW5jZWQtc2V0dGluZ3Mtbm9uZSc+Tm8gYXZhaWxhYmxlIHNldHRpbmdzPC9saT5cclxuICAgICAgICAgICAgICAgICAgICAgICAgKX1cclxuICAgICAgICAgICAgICAgICAgICA8L3VsPlxyXG4gICAgICAgICAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHJlbmRlclNldHRpbmdzT3B0aW9ucygpIHtcclxuICAgICAgICByZXR1cm4gKFxyXG4gICAgICAgICAgICA8QnV0dG9uV2l0aERyb3Bkb3duXHJcbiAgICAgICAgICAgICAgICBpMThuPXt0aGlzLl9pMThufVxyXG4gICAgICAgICAgICAgICAgZmx1eD17dGhpcy5wcm9wcy5mbHV4fVxyXG4gICAgICAgICAgICAgICAgaWQ9J3Jlc2V0U2V0dGluZ3NCdXR0b24nXHJcbiAgICAgICAgICAgICAgICBjbGFzc2VzPSdzZWNvbmRhcnkxIHJlc2V0U2V0dGluZ3NCdXR0b24nXHJcbiAgICAgICAgICAgICAgICBkcm9wZG93bkNsYXNzZXM9J3NlY29uZGFyeTEgcmVzZXRTZXR0aW5nc0Ryb3Bkb3duJ1xyXG4gICAgICAgICAgICAgICAgbGFiZWw9e3RoaXMuaTE4bi50KCdtYjpwcmludFNldHRpbmdzLnJpZ2h0X2NsaWNrLnJlc2V0X2FsbF90b19kZWZhdWx0Jyl9XHJcbiAgICAgICAgICAgICAgICBvbkNsaWNrPXsoKSA9PiB0aGlzLmFjdGlvbnMucmVzZXRBbGxUb0RlZmF1bHQoKX1cclxuICAgICAgICAgICAgICAgIG1lbnVJdGVtcz17W1xyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcGF0aDogJ3JlbW92ZUFsbFNldHRpbmdzJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw6IHRoaXMuaTE4bi50KCdtYjpwcmludFNldHRpbmdzLnJpZ2h0X2NsaWNrLnJlbW92ZV9hbGxfc2V0dGluZ3MnKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uOiAoKSA9PiB0aGlzLmFjdGlvbnMucmVtb3ZlQWxsU2V0dGluZ3MoKSxcclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgXX1cclxuICAgICAgICAgICAgLz5cclxuICAgICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIHJlbmRlclByZXNldEFjdGlvbnMoKSB7XHJcbiAgICAgICAgY29uc3QgYWN0aW9uc0RpY3QgPSB7XHJcbiAgICAgICAgICAgIGltcG9ydDoge1xyXG4gICAgICAgICAgICAgICAgb25DbGljazogKCkgPT4gdGhpcy5hY3Rpb25zLnJlYWRQcmVzZXRzKCksXHJcbiAgICAgICAgICAgICAgICBkaXNhYmxlZDogZmFsc2UsXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGV4cG9ydDoge1xyXG4gICAgICAgICAgICAgICAgb25DbGljazogKCkgPT4gdGhpcy5hY3Rpb25zLndyaXRlUHJlc2V0KHRoaXMuc3RhdGUuY3VycmVudFByZXNldCksXHJcbiAgICAgICAgICAgICAgICBkaXNhYmxlZDogUi5pc05pbCh0aGlzLnN0YXRlLmN1cnJlbnRQcmVzZXQpLFxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBzYXZlOiB7XHJcbiAgICAgICAgICAgICAgICBvbkNsaWNrOiAoKSA9PiB0aGlzLmFjdGlvbnMudXBkYXRlUHJlc2V0KHRoaXMuc3RhdGUuY3VycmVudFByZXNldCksXHJcbiAgICAgICAgICAgICAgICBkaXNhYmxlZDpcclxuICAgICAgICAgICAgICAgICAgICBSLmlzTmlsKHRoaXMuc3RhdGUuY3VycmVudFByZXNldCkgfHwgIXRoaXMuc3RvcmUuaGFzT3ZlcnJpZGVzRm9yUHJlc2V0KHRoaXMuc3RhdGUuY3VycmVudFByZXNldCksXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgY29uc3QgYWN0aW9uc01hcHBlciA9ICh2LCBrKSA9PiAoXHJcbiAgICAgICAgICAgIDxCdXR0b25cclxuICAgICAgICAgICAgICAgIHR5cGU9J3NlY29uZGFyeSdcclxuICAgICAgICAgICAgICAgIGtleT17a31cclxuICAgICAgICAgICAgICAgIGxhYmVsPXt0aGlzLmkxOG4udChgbWI6cHJpbnRTZXR0aW5ncy5wcmVzZXRzLiR7a31gKX1cclxuICAgICAgICAgICAgICAgIG9uQ2xpY2s9e3Yub25DbGlja31cclxuICAgICAgICAgICAgICAgIGRpc2FibGVkPXt2LmRpc2FibGVkfVxyXG4gICAgICAgICAgICAvPlxyXG4gICAgICAgICk7XHJcblxyXG4gICAgICAgIHJldHVybiAoXHJcbiAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSdhY3RpdmUtc2V0dGluZ3MtcHJlc2V0LWFjdGlvbnMnPlxyXG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9J2J1dHRvbkdyb3VwJz5cclxuICAgICAgICAgICAgICAgICAgICB7dGhpcy5yZW5kZXJTZXR0aW5nc09wdGlvbnMoKX1cclxuICAgICAgICAgICAgICAgICAgICB7Ui52YWx1ZXMoUi5tYXBPYmpJbmRleGVkKGFjdGlvbnNNYXBwZXIsIGFjdGlvbnNEaWN0KSl9XHJcbiAgICAgICAgICAgICAgICA8L2Rpdj5cclxuICAgICAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgKTtcclxuICAgIH1cclxuXHJcbiAgICByZW5kZXJTZWxlY3RlZFNldHRpbmdzKCkge1xyXG4gICAgICAgIGNvbnN0IGVsZW0gPSAodiwgaykgPT4gKFxyXG4gICAgICAgICAgICA8YSBrZXk9e2t9IG9uQ2xpY2s9eygpID0+IHRoaXMuanVtcFRvU2V0dGluZyhrKX0+XHJcbiAgICAgICAgICAgICAgICB7di5uYW1lfVxyXG4gICAgICAgICAgICA8L2E+XHJcbiAgICAgICAgKTtcclxuXHJcbiAgICAgICAgY29uc3QgcmVuZGVyU2V0dGluZ3MgPSBSLnBpcGUoUi5waWNrQnkoUi5wcm9wKCd2aXNpYmxlJykpLCBSLm1hcE9iakluZGV4ZWQoZWxlbSksIFIudmFsdWVzKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIChcclxuICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9J2FkdmFuY2VkLXNldHRpbmdzLWFjdGl2ZSc+XHJcbiAgICAgICAgICAgICAgICA8c3Ryb25nPnt0aGlzLmkxOG4udChgbWI6cHJpbnRTZXR0aW5ncy5hZHZhbmNlZFNldHRpbmdzLmFkZGVkYCl9PC9zdHJvbmc+XHJcbiAgICAgICAgICAgICAgICB7cmVuZGVyU2V0dGluZ3ModGhpcy5zdGF0ZS5zZXR0aW5ncyl9XHJcbiAgICAgICAgICAgIDwvZGl2PlxyXG4gICAgICAgICk7XHJcbiAgICB9XHJcblxyXG4gICAgcmVuZGVyKCkge1xyXG4gICAgICAgIGlmICghdGhpcy5zdGF0ZSkgcmV0dXJuIDxkaXYgLz47XHJcblxyXG4gICAgICAgIHJldHVybiAoXHJcbiAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSdhZHZhbmNlZC1zZXR0aW5ncy1tb2RhbCc+XHJcbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0nc3lzdGVtUHJlZmVyZW5jZXMnPlxyXG4gICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSdsZWZ0Jz57dGhpcy5yZW5kZXJQcmVzZXRzUGFuZWwoKX08L2Rpdj5cclxuICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0nbGVmdCc+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIDxwPnt0aGlzLmkxOG4udChgbWI6cHJpbnRTZXR0aW5ncy5hZHZhbmNlZFNldHRpbmdzLnNldHRpbmdzYCl9PC9wPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICB7dGhpcy5yZW5kZXJHcm91cHNQYW5lbCgpfVxyXG4gICAgICAgICAgICAgICAgICAgIDwvZGl2PlxyXG4gICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSdyaWdodCc+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIDxwIHN0eWxlPXt7IHRleHRBbGlnbjogJ3JpZ2h0JyB9fT5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHt0aGlzLmkxOG4udChgbWI6cHJpbnRTZXR0aW5ncy5hZHZhbmNlZFNldHRpbmdzLnNldHRpbmdzVmlzaWJsZWApfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICA8L3A+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHt0aGlzLnJlbmRlclNldHRpbmdzUGFuZWwoKX1cclxuICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cclxuICAgICAgICAgICAgICAgIDwvZGl2PlxyXG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9J2JvdHRvbSc+XHJcbiAgICAgICAgICAgICAgICAgICAge3RoaXMucmVuZGVyU2VsZWN0ZWRTZXR0aW5ncygpfVxyXG4gICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSdidXR0b25Hcm91cCc+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHt0aGlzLnJlbmRlclByZXNldEFjdGlvbnMoKX1cclxuICAgICAgICAgICAgICAgICAgICAgICAgPEJ1dHRvbiBjbGFzc05hbWVzPSdkb25lQnV0dG9uJyB0eXBlPSdzZWNvbmRhcnknIGxhYmVsPSdEb25lJyBvbkNsaWNrPXt0aGlzLmRvbmUuYmluZCh0aGlzKX0gLz5cclxuICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cclxuICAgICAgICAgICAgICAgIDwvZGl2PlxyXG4gICAgICAgICAgICA8L2Rpdj5cclxuICAgICAgICApO1xyXG4gICAgfVxyXG59XHJcblxyXG5jb25zdCBpc092ZXJ2aWV3ID0gdiA9PiB2ID09PSAnb3ZlcnZpZXcnO1xyXG5cclxuQWR2YW5jZWRTZXR0aW5nc01vZGFsLmRpc3BsYXlOYW1lID0gJ0FkdmFuY2VkU2V0dGluZ3NNb2RhbCc7XHJcbkFkdmFuY2VkU2V0dGluZ3NNb2RhbC5wcm9wVHlwZXMgPSB7XHJcbiAgICBmbHV4OiBSZWFjdC5Qcm9wVHlwZXMuc2hhcGUoe1xyXG4gICAgICAgIHN0b3JlOiBSZWFjdC5Qcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxyXG4gICAgICAgIGdldFNlcnZpY2U6IFJlYWN0LlByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsXHJcbiAgICB9KS5pc1JlcXVpcmVkLFxyXG4gICAgcHJvamVjdDogUmVhY3QuUHJvcFR5cGVzLm9iamVjdCxcclxuICAgIG9uQ2hhbmdlUHJvcDogUmVhY3QuUHJvcFR5cGVzLmZ1bmMsXHJcbn07XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IEFkdmFuY2VkU2V0dGluZ3NNb2RhbDtcclxuIl19
