'use strict';

const React = require('react');

const Isvg = require('react-inlinesvg');

const _ = require('lodash');

const Button = require('eagle-print/views/ui/button');

const Checkbox = require('eagle-print/views/ui/input_checkbox');

const HeaderSelectButton = require('../headerSelectButton');

class ResetToFactory extends React.Component {
  constructor(props) {
    super(props);
    this._i18n = this.props.flux.getService('TranslationService');
    this._logger = this.props.flux.getService('LoggingService');
    this._trackingService = this.props.flux.getService('TrackingService');
    this.state = {
      clearCalibration: false,
      canCalibrate: false
    };
  }
  /**
   * Adds event to tracking service
   * @param {string} name - message to track
   */


  addTrackingEvent(name) {
    const merged = _.merge({
      name
    }, this.props.printer.getTrackingInfo());

    this._trackingService.addEvent(merged);
  }

  componentDidMount() {
    this.props.printer.invoke('HasZCalibrationRoutine').then(results => {
      this.setState({
        canCalibrate: results === true
      });
    });
  }

  handleEnableClearCalibrationToggle() {
    this.setState({
      clearCalibration: !this.state.clearCalibration
    });
  }

  onConfirm() {
    this.addTrackingEvent('Confirm Reset To Factory');

    this._logger.info(`Reset to factory setting with clearCalibration ` + `flag set to ${this.state.clearCalibration}`);

    this.props.printer.invoke('ResetToFactory', [this.state.clearCalibration]).then(() => {
      this.props.onResetSuccess();
      this.addTrackingEvent('Reset To Factory Success');
    }).catch(err => {
      this._logger.log(err);

      this.addTrackingEvent('Reset To Factory Failed');
    }).done();
  }

  onReset() {
    this.addTrackingEvent('Reset To Factory');
    const modalService = this.props.flux.getService('ModalService');
    modalService.confirm({
      title: this._i18n.t('mb:resetToFactory.modal.title'),
      body: this._i18n.t('mb:resetToFactory.modal.body', {
        printerName: this.props.printer.getName()
      }),
      cancelText: this._i18n.t('modal.cancel'),
      confirmText: this._i18n.t('mb:resetToFactory.modal.reset'),
      modalClass: 'w400 warningModal',
      onConfirm: () => this.onConfirm()
    });
  }

  renderResetButtonElm() {
    const props = {
      style: {
        margin: '0 25px',
        padding: '8px 12px'
      },
      type: 'secondary',
      label: this._i18n.t('mb:resetToFactory.button'),
      onClick: () => this.onReset()
    };
    return /*#__PURE__*/React.createElement(Button, props);
  }

  renderPrinterPanelHeader() {
    const headerSelectButtonProps = {
      flux: this.props.flux,
      printer: this.props.printer
    };
    return /*#__PURE__*/React.createElement("div", {
      className: "printerPanelHeader"
    }, /*#__PURE__*/React.createElement("div", {
      className: "printerPanelBackButton",
      onClick: this.props.onBack
    }, /*#__PURE__*/React.createElement(Isvg, {
      src: "icons/back-arrow.svg"
    })), /*#__PURE__*/React.createElement("div", {
      className: "printerPanelHeaderLabel"
    }, /*#__PURE__*/React.createElement("h1", null, this._i18n.t('mb:resetToFactory.header'))), /*#__PURE__*/React.createElement(HeaderSelectButton, headerSelectButtonProps), /*#__PURE__*/React.createElement("div", {
      className: "printerPanelArrowDown",
      onClick: this.props.onClose
    }, /*#__PURE__*/React.createElement(Isvg, {
      src: "icons/back-arrow.svg"
    })));
  }

  renderClearCalibrationCheckbox() {
    const checkboxProps = {
      ref: 'clearCalibrationCheckbox',
      label: this._i18n.t('mb:resetToFactory.checkbox.clearCalibration'),
      classNames: 'clear-calibration-checkbox',
      labelClassNames: 'status-checkbox-label',
      onChange: () => this.handleEnableClearCalibrationToggle()
    };
    return this.state.canCalibrate ? /*#__PURE__*/React.createElement("div", {
      style: {
        margin: 26
      }
    }, /*#__PURE__*/React.createElement(Checkbox, checkboxProps)) : null;
  }

  renderPrinterPanel() {
    return /*#__PURE__*/React.createElement("div", {
      className: "printerPanel"
    }, /*#__PURE__*/React.createElement("div", {
      style: {
        margin: 26,
        display: 'block'
      }
    }, this._i18n.t('mb:resetToFactory.warningMessage')), this.renderClearCalibrationCheckbox(), this.renderResetButtonElm());
  }

  render() {
    const props = _.assign({}, this.props, {
      className: `${this.props.className || ''} printerPanel`
    });

    return /*#__PURE__*/React.createElement("div", props, this.renderPrinterPanelHeader(), this.renderPrinterPanel());
  }

}

ResetToFactory.propTypes = {
  flux: React.PropTypes.object.isRequired,
  onBack: React.PropTypes.func.isRequired,
  onClose: React.PropTypes.func.isRequired,
  onResetSuccess: React.PropTypes.func.isRequired,
  printer: React.PropTypes.object.isRequired,
  className: React.PropTypes.string
};
module.exports = ResetToFactory;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJlc2V0VG9GYWN0b3J5LmpzIl0sIm5hbWVzIjpbIlJlYWN0IiwicmVxdWlyZSIsIklzdmciLCJfIiwiQnV0dG9uIiwiQ2hlY2tib3giLCJIZWFkZXJTZWxlY3RCdXR0b24iLCJSZXNldFRvRmFjdG9yeSIsIkNvbXBvbmVudCIsImNvbnN0cnVjdG9yIiwicHJvcHMiLCJfaTE4biIsImZsdXgiLCJnZXRTZXJ2aWNlIiwiX2xvZ2dlciIsIl90cmFja2luZ1NlcnZpY2UiLCJzdGF0ZSIsImNsZWFyQ2FsaWJyYXRpb24iLCJjYW5DYWxpYnJhdGUiLCJhZGRUcmFja2luZ0V2ZW50IiwibmFtZSIsIm1lcmdlZCIsIm1lcmdlIiwicHJpbnRlciIsImdldFRyYWNraW5nSW5mbyIsImFkZEV2ZW50IiwiY29tcG9uZW50RGlkTW91bnQiLCJpbnZva2UiLCJ0aGVuIiwicmVzdWx0cyIsInNldFN0YXRlIiwiaGFuZGxlRW5hYmxlQ2xlYXJDYWxpYnJhdGlvblRvZ2dsZSIsIm9uQ29uZmlybSIsImluZm8iLCJvblJlc2V0U3VjY2VzcyIsImNhdGNoIiwiZXJyIiwibG9nIiwiZG9uZSIsIm9uUmVzZXQiLCJtb2RhbFNlcnZpY2UiLCJjb25maXJtIiwidGl0bGUiLCJ0IiwiYm9keSIsInByaW50ZXJOYW1lIiwiZ2V0TmFtZSIsImNhbmNlbFRleHQiLCJjb25maXJtVGV4dCIsIm1vZGFsQ2xhc3MiLCJyZW5kZXJSZXNldEJ1dHRvbkVsbSIsInN0eWxlIiwibWFyZ2luIiwicGFkZGluZyIsInR5cGUiLCJsYWJlbCIsIm9uQ2xpY2siLCJyZW5kZXJQcmludGVyUGFuZWxIZWFkZXIiLCJoZWFkZXJTZWxlY3RCdXR0b25Qcm9wcyIsIm9uQmFjayIsIm9uQ2xvc2UiLCJyZW5kZXJDbGVhckNhbGlicmF0aW9uQ2hlY2tib3giLCJjaGVja2JveFByb3BzIiwicmVmIiwiY2xhc3NOYW1lcyIsImxhYmVsQ2xhc3NOYW1lcyIsIm9uQ2hhbmdlIiwicmVuZGVyUHJpbnRlclBhbmVsIiwiZGlzcGxheSIsInJlbmRlciIsImFzc2lnbiIsImNsYXNzTmFtZSIsInByb3BUeXBlcyIsIlByb3BUeXBlcyIsIm9iamVjdCIsImlzUmVxdWlyZWQiLCJmdW5jIiwic3RyaW5nIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUEsTUFBTUEsS0FBSyxHQUFHQyxPQUFPLENBQUMsT0FBRCxDQUFyQjs7QUFDQSxNQUFNQyxJQUFJLEdBQUdELE9BQU8sQ0FBQyxpQkFBRCxDQUFwQjs7QUFDQSxNQUFNRSxDQUFDLEdBQUdGLE9BQU8sQ0FBQyxRQUFELENBQWpCOztBQUNBLE1BQU1HLE1BQU0sR0FBR0gsT0FBTyxDQUFDLDZCQUFELENBQXRCOztBQUNBLE1BQU1JLFFBQVEsR0FBR0osT0FBTyxDQUFDLHFDQUFELENBQXhCOztBQUVBLE1BQU1LLGtCQUFrQixHQUFHTCxPQUFPLENBQUMsdUJBQUQsQ0FBbEM7O0FBRUEsTUFBTU0sY0FBTixTQUE2QlAsS0FBSyxDQUFDUSxTQUFuQyxDQUE2QztBQUN6Q0MsRUFBQUEsV0FBVyxDQUFDQyxLQUFELEVBQVE7QUFDZixVQUFNQSxLQUFOO0FBQ0EsU0FBS0MsS0FBTCxHQUFhLEtBQUtELEtBQUwsQ0FBV0UsSUFBWCxDQUFnQkMsVUFBaEIsQ0FBMkIsb0JBQTNCLENBQWI7QUFDQSxTQUFLQyxPQUFMLEdBQWUsS0FBS0osS0FBTCxDQUFXRSxJQUFYLENBQWdCQyxVQUFoQixDQUEyQixnQkFBM0IsQ0FBZjtBQUNBLFNBQUtFLGdCQUFMLEdBQXdCLEtBQUtMLEtBQUwsQ0FBV0UsSUFBWCxDQUFnQkMsVUFBaEIsQ0FBMkIsaUJBQTNCLENBQXhCO0FBRUEsU0FBS0csS0FBTCxHQUFhO0FBQ1RDLE1BQUFBLGdCQUFnQixFQUFFLEtBRFQ7QUFFVEMsTUFBQUEsWUFBWSxFQUFFO0FBRkwsS0FBYjtBQUlIO0FBRUQ7QUFDSjtBQUNBO0FBQ0E7OztBQUNJQyxFQUFBQSxnQkFBZ0IsQ0FBQ0MsSUFBRCxFQUFPO0FBQ25CLFVBQU1DLE1BQU0sR0FBR2xCLENBQUMs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S0FBSyxDQUFDeUUsU0FBTixDQUFnQkMsTUFBaEIsQ0FBdUJDLFVBTFQ7QUFNdkJKLEVBQUFBLFNBQVMsRUFBRXZFLEtBQUssQ0FBQ3lFLFNBQU4sQ0FBZ0JJO0FBTkosQ0FBM0I7QUFTQUMsTUFBTSxDQUFDQyxPQUFQLEdBQWlCeEUsY0FBakIiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XHJcblxyXG5jb25zdCBSZWFjdCA9IHJlcXVpcmUoJ3JlYWN0Jyk7XHJcbmNvbnN0IElzdmcgPSByZXF1aXJlKCdyZWFjdC1pbmxpbmVzdmcnKTtcclxuY29uc3QgXyA9IHJlcXVpcmUoJ2xvZGFzaCcpO1xyXG5jb25zdCBCdXR0b24gPSByZXF1aXJlKCdlYWdsZS1wcmludC92aWV3cy91aS9idXR0b24nKTtcclxuY29uc3QgQ2hlY2tib3ggPSByZXF1aXJlKCdlYWdsZS1wcmludC92aWV3cy91aS9pbnB1dF9jaGVja2JveCcpO1xyXG5cclxuY29uc3QgSGVhZGVyU2VsZWN0QnV0dG9uID0gcmVxdWlyZSgnLi4vaGVhZGVyU2VsZWN0QnV0dG9uJyk7XHJcblxyXG5jbGFzcyBSZXNldFRvRmFjdG9yeSBleHRlbmRzIFJlYWN0LkNvbXBvbmVudCB7XHJcbiAgICBjb25zdHJ1Y3Rvcihwcm9wcykge1xyXG4gICAgICAgIHN1cGVyKHByb3BzKTtcclxuICAgICAgICB0aGlzLl9pMThuID0gdGhpcy5wcm9wcy5mbHV4LmdldFNlcnZpY2UoJ1RyYW5zbGF0aW9uU2VydmljZScpO1xyXG4gICAgICAgIHRoaXMuX2xvZ2dlciA9IHRoaXMucHJvcHMuZmx1eC5nZXRTZXJ2aWNlKCdMb2dnaW5nU2VydmljZScpO1xyXG4gICAgICAgIHRoaXMuX3RyYWNraW5nU2VydmljZSA9IHRoaXMucHJvcHMuZmx1eC5nZXRTZXJ2aWNlKCdUcmFja2luZ1NlcnZpY2UnKTtcclxuXHJcbiAgICAgICAgdGhpcy5zdGF0ZSA9IHtcclxuICAgICAgICAgICAgY2xlYXJDYWxpYnJhdGlvbjogZmFsc2UsXHJcbiAgICAgICAgICAgIGNhbkNhbGlicmF0ZTogZmFsc2UsXHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEFkZHMgZXZlbnQgdG8gdHJhY2tpbmcgc2VydmljZVxyXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IG5hbWUgLSBtZXNzYWdlIHRvIHRyYWNrXHJcbiAgICAgKi9cclxuICAgIGFkZFRyYWNraW5nRXZlbnQobmFtZSkge1xyXG4gICAgICAgIGNvbnN0IG1lcmdlZCA9IF8ubWVyZ2UoeyBuYW1lIH0sIHRoaXMucHJvcHMucHJpbnRlci5nZXRUcmFja2luZ0luZm8oKSk7XHJcbiAgICAgICAgdGhpcy5fdHJhY2tpbmdTZXJ2aWNlLmFkZEV2ZW50KG1lcmdlZCk7XHJcbiAgICB9XHJcblxyXG4gICAgY29tcG9uZW50RGlkTW91bnQoKSB7XHJcbiAgICAgICAgdGhpcy5wcm9wcy5wcmludGVyLmludm9rZSgnSGFzWkNhbGlicmF0aW9uUm91dGluZScpLnRoZW4ocmVzdWx0cyA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoeyBjYW5DYWxpYnJhdGU6IHJlc3VsdHMgPT09IHRydWUgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgaGFuZGxlRW5hYmxlQ2xlYXJDYWxpYnJhdGlvblRvZ2dsZSgpIHtcclxuICAgICAgICB0aGlzLnNldFN0YXRlKHsgY2xlYXJDYWxpYnJhdGlvbjogIXRoaXMuc3RhdGUuY2xlYXJDYWxpYnJhdGlvbiB9KTtcclxuICAgIH1cclxuXHJcbiAgICBvbkNvbmZpcm0oKSB7XHJcbiAgICAgICAgdGhpcy5hZGRUcmFja2luZ0V2ZW50KCdDb25maXJtIFJlc2V0IFRvIEZhY3RvcnknKTtcclxuICAgICAgICB0aGlzLl9sb2dnZXIuaW5mbyhcclxuICAgICAgICAgICAgYFJlc2V0IHRvIGZhY3Rvcnkgc2V0dGluZyB3aXRoIGNsZWFyQ2FsaWJyYXRpb24gYCArIGBmbGFnIHNldCB0byAke3RoaXMuc3RhdGUuY2xlYXJDYWxpYnJhdGlvbn1gXHJcbiAgICAgICAgKTtcclxuXHJcbiAgICAgICAgdGhpcy5wcm9wcy5wcmludGVyXHJcbiAgICAgICAgICAgIC5pbnZva2UoJ1Jlc2V0VG9GYWN0b3J5JywgW3RoaXMuc3RhdGUuY2xlYXJDYWxpYnJhdGlvbl0pXHJcbiAgICAgICAgICAgIC50aGVuKCgpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMucHJvcHMub25SZXNldFN1Y2Nlc3MoKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuYWRkVHJhY2tpbmdFdmVudCgnUmVzZXQgVG8gRmFjdG9yeSBTdWNjZXNzJyk7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC5jYXRjaChlcnIgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fbG9nZ2VyLmxvZyhlcnIpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5hZGRUcmFja2luZ0V2ZW50KCdSZXNldCBUbyBGYWN0b3J5IEZhaWxlZCcpO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAuZG9uZSgpO1xyXG4gICAgfVxyXG5cclxuICAgIG9uUmVzZXQoKSB7XHJcbiAgICAgICAgdGhpcy5hZGRUcmFja2luZ0V2ZW50KCdSZXNldCBUbyBGYWN0b3J5Jyk7XHJcblxyXG4gICAgICAgIGNvbnN0IG1vZGFsU2VydmljZSA9IHRoaXMucHJvcHMuZmx1eC5nZXRTZXJ2aWNlKCdNb2RhbFNlcnZpY2UnKTtcclxuICAgICAgICBtb2RhbFNlcnZpY2UuY29uZmlybSh7XHJcbiAgICAgICAgICAgIHRpdGxlOiB0aGlzLl9pMThuLnQoJ21iOnJlc2V0VG9GYWN0b3J5Lm1vZGFsLnRpdGxlJyksXHJcbiAgICAgICAgICAgIGJvZHk6IHRoaXMuX2kxOG4udCgnbWI6cmVzZXRUb0ZhY3RvcnkubW9kYWwuYm9keScsIHsgcHJpbnRlck5hbWU6IHRoaXMucHJvcHMucHJpbnRlci5nZXROYW1lKCkgfSksXHJcbiAgICAgICAgICAgIGNhbmNlbFRleHQ6IHRoaXMuX2kxOG4udCgnbW9kYWwuY2FuY2VsJyksXHJcbiAgICAgICAgICAgIGNvbmZpcm1UZXh0OiB0aGlzLl9pMThuLnQoJ21iOnJlc2V0VG9GYWN0b3J5Lm1vZGFsLnJlc2V0JyksXHJcbiAgICAgICAgICAgIG1vZGFsQ2xhc3M6ICd3NDAwIHdhcm5pbmdNb2RhbCcsXHJcbiAgICAgICAgICAgIG9uQ29uZmlybTogKCkgPT4gdGhpcy5vbkNvbmZpcm0oKSxcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICByZW5kZXJSZXNldEJ1dHRvbkVsbSgpIHtcclxuICAgICAgICBjb25zdCBwcm9wcyA9IHtcclxuICAgICAgICAgICAgc3R5bGU6IHsgbWFyZ2luOiAnMCAyNXB4JywgcGFkZGluZzogJzhweCAxMnB4JyB9LFxyXG4gICAgICAgICAgICB0eXBlOiAnc2Vjb25kYXJ5JyxcclxuICAgICAgICAgICAgbGFiZWw6IHRoaXMuX2kxOG4udCgnbWI6cmVzZXRUb0ZhY3RvcnkuYnV0dG9uJyksXHJcbiAgICAgICAgICAgIG9uQ2xpY2s6ICgpID0+IHRoaXMub25SZXNldCgpLFxyXG4gICAgICAgIH07XHJcbiAgICAgICAgcmV0dXJuIDxCdXR0b24gey4uLnByb3BzfSAvPjtcclxuICAgIH1cclxuXHJcbiAgICByZW5kZXJQcmludGVyUGFuZWxIZWFkZXIoKSB7XHJcbiAgICAgICAgY29uc3QgaGVhZGVyU2VsZWN0QnV0dG9uUHJvcHMgPSB7XHJcbiAgICAgICAgICAgIGZsdXg6IHRoaXMucHJvcHMuZmx1eCxcclxuICAgICAgICAgICAgcHJpbnRlcjogdGhpcy5wcm9wcy5wcmludGVyLFxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHJldHVybiAoXHJcbiAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSdwcmludGVyUGFuZWxIZWFkZXInPlxyXG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9J3ByaW50ZXJQYW5lbEJhY2tCdXR0b24nIG9uQ2xpY2s9e3RoaXMucHJvcHMub25CYWNrfT5cclxuICAgICAgICAgICAgICAgICAgICA8SXN2ZyBzcmM9J2ljb25zL2JhY2stYXJyb3cuc3ZnJyAvPlxyXG4gICAgICAgICAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0ncHJpbnRlclBhbmVsSGVhZGVyTGFiZWwnPlxyXG4gICAgICAgICAgICAgICAgICAgIDxoMT57dGhpcy5faTE4bi50KCdtYjpyZXNldFRvRmFjdG9yeS5oZWFkZXInKX08L2gxPlxyXG4gICAgICAgICAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgICAgICAgICA8SGVhZGVyU2VsZWN0QnV0dG9uIHsuLi5oZWFkZXJTZWxlY3RCdXR0b25Qcm9wc30gLz5cclxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSdwcmludGVyUGFuZWxBcnJvd0Rvd24nIG9uQ2xpY2s9e3RoaXMucHJvcHMub25DbG9zZX0+XHJcbiAgICAgICAgICAgICAgICAgICAgPElzdmcgc3JjPSdpY29ucy9iYWNrLWFycm93LnN2ZycgLz5cclxuICAgICAgICAgICAgICAgIDwvZGl2PlxyXG4gICAgICAgICAgICA8L2Rpdj5cclxuICAgICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIHJlbmRlckNsZWFyQ2FsaWJyYXRpb25DaGVja2JveCgpIHtcclxuICAgICAgICBjb25zdCBjaGVja2JveFByb3BzID0ge1xyXG4gICAgICAgICAgICByZWY6ICdjbGVhckNhbGlicmF0aW9uQ2hlY2tib3gnLFxyXG4gICAgICAgICAgICBsYWJlbDogdGhpcy5faTE4bi50KCdtYjpyZXNldFRvRmFjdG9yeS5jaGVja2JveC5jbGVhckNhbGlicmF0aW9uJyksXHJcbiAgICAgICAgICAgIGNsYXNzTmFtZXM6ICdjbGVhci1jYWxpYnJhdGlvbi1jaGVja2JveCcsXHJcbiAgICAgICAgICAgIGxhYmVsQ2xhc3NOYW1lczogJ3N0YXR1cy1jaGVja2JveC1sYWJlbCcsXHJcbiAgICAgICAgICAgIG9uQ2hhbmdlOiAoKSA9PiB0aGlzLmhhbmRsZUVuYWJsZUNsZWFyQ2FsaWJyYXRpb25Ub2dnbGUoKSxcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICByZXR1cm4gdGhpcy5zdGF0ZS5jYW5DYWxpYnJhdGUgPyAoXHJcbiAgICAgICAgICAgIDxkaXYgc3R5bGU9e3sgbWFyZ2luOiAyNiB9fT5cclxuICAgICAgICAgICAgICAgIDxDaGVja2JveCB7Li4uY2hlY2tib3hQcm9wc30gLz5cclxuICAgICAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgKSA6IG51bGw7XHJcbiAgICB9XHJcblxyXG4gICAgcmVuZGVyUHJpbnRlclBhbmVsKCkge1xyXG4gICAgICAgIHJldHVybiAoXHJcbiAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSdwcmludGVyUGFuZWwnPlxyXG4gICAgICAgICAgICAgICAgPGRpdiBzdHlsZT17eyBtYXJnaW46IDI2LCBkaXNwbGF5OiAnYmxvY2snIH19Pnt0aGlzLl9pMThuLnQoJ21iOnJlc2V0VG9GYWN0b3J5Lndhcm5pbmdNZXNzYWdlJyl9PC9kaXY+XHJcbiAgICAgICAgICAgICAgICB7dGhpcy5yZW5kZXJDbGVhckNhbGlicmF0aW9uQ2hlY2tib3goKX1cclxuICAgICAgICAgICAgICAgIHt0aGlzLnJlbmRlclJlc2V0QnV0dG9uRWxtKCl9XHJcbiAgICAgICAgICAgIDwvZGl2PlxyXG4gICAgICAgICk7XHJcbiAgICB9XHJcblxyXG4gICAgcmVuZGVyKCkge1xyXG4gICAgICAgIGNvbnN0IHByb3BzID0gXy5hc3NpZ24oe30sIHRoaXMucHJvcHMsIHsgY2xhc3NOYW1lOiBgJHt0aGlzLnByb3BzLmNsYXNzTmFtZSB8fCAnJ30gcHJpbnRlclBhbmVsYCB9KTtcclxuXHJcbiAgICAgICAgcmV0dXJuIChcclxuICAgICAgICAgICAgPGRpdiB7Li4ucHJvcHN9PlxyXG4gICAgICAgICAgICAgICAge3RoaXMucmVuZGVyUHJpbnRlclBhbmVsSGVhZGVyKCl9XHJcbiAgICAgICAgICAgICAgICB7dGhpcy5yZW5kZXJQcmludGVyUGFuZWwoKX1cclxuICAgICAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgKTtcclxuICAgIH1cclxufVxyXG5SZXNldFRvRmFjdG9yeS5wcm9wVHlwZXMgPSB7XHJcbiAgICBmbHV4OiBSZWFjdC5Qcm9wVHlwZXMub2JqZWN0LmlzUmVxdWlyZWQsXHJcbiAgICBvbkJhY2s6IFJlYWN0LlByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsXHJcbiAgICBvbkNsb3NlOiBSZWFjdC5Qcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxyXG4gICAgb25SZXNldFN1Y2Nlc3M6IFJlYWN0LlByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsXHJcbiAgICBwcmludGVyOiBSZWFjdC5Qcm9wVHlwZXMub2JqZWN0LmlzUmVxdWlyZWQsXHJcbiAgICBjbGFzc05hbWU6IFJlYWN0LlByb3BUeXBlcy5zdHJpbmcsXHJcbn07XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IFJlc2V0VG9GYWN0b3J5O1xyXG4iXX0=
