'use strict';

const React = require('react');

const DOM = React.DOM;
const ce = React.createElement;

const Isvg = require('react-inlinesvg');

const _ = require('lodash');

const path = require('path');

const FluxComponent = require('eagle-print/views/flux_component');

const Slider = require('eagle-print/views/ui/slider');

const util = require('../../../util');

const ZOffsetButton = require('./zoffsetButton');

const HeaderSelectButton = require('../headerSelectButton');

const LinkClickUtils = require('../../../utils/linkClick');

const UrlConst = require('../../../constants/urls').url;

class ZOffset extends FluxComponent {
  constructor(props, context) {
    super(props, context);
    this.i18n = this.props.flux.getService('TranslationService');
    this.logger = this.props.flux.getService('LoggingService');
    this.tracking = this.props.flux.getService('TrackingService'); // setting this as a instance variable rather than a state
    // variable, because again, setting state will cause a re-render

    this.offset = 0;

    _.assign(this.state, {
      initialOffset: 0
    });
  }
  /**
   * Basically we don't want this updating to frequently, because
   * the slider will forget that it's being dragged, essentially making it
   * so the user can only drag one tick at a time, which is insanely annoying.
   * So, we basically almost never update the state, which allows the user
   * to drag on the slider properly.
   */


  shouldComponentUpdate() {
    return !this._hasChanged();
  }

  componentDidMount() {
    this._getInitialOffset();
  }
  /**
   * Figure out what the printer's z-offset is currently set to
   */


  _getInitialOffset() {
    // we have to manually disable the apply button, rather than
    // setting state. This is kinda hacky, but we have to do it this way
    // because we can't allow the slider to re-render.
    this._apply.disable();

    return this.props.printer.invoke('GetZAdjustedOffset').then(val => this.offset = val * 10) // multiplying by ten because printer settings go from -0.8 to 0.8, but the slider goes in integers
    .then(() => this.setState({
      initialOffset: this.offset
    })).catch(err => this.logger.warn(err));
  }
  /**
   * Fires when the slider changes its value. You may notice that
   * we don't set state in here. That's because setting state
   * usually triggers a re-render, which will prevent the user
   * from being able to drag the slider. Instead we edit the UI
   * inline. It's not very React, but as it turns out, neither is the
   * slider, and that's what's really screwing us up.
   */


  _onChange(val) {
    // setting this as a instance variable rather than a state
    // variable, because again, setting state will cause a re-render
    this.offset = val.newValue;

    if (this._preview) {
      // move the preview to keep up with the slider
      this._preview.style.top = this._offsetStyle();
    }

    if (this._label) {
      // change the label to reflect the settings on the slider
      this._label.innerText = this._formatOffset();
    }

    if (this.state.initialOffset !== this.offset) {
      this._apply.enable();
    }

    if (this.state.initialOffset === this.offset) {
      this._apply.disable();
    }
  }

  _hasChanged() {
    return this.offset !== this.state.initialOffset;
  }
  /**
   * Just making the extruder icon move and fit within the space
   * in a reasonable way.
   */


  _offsetStyle() {
    return this.offset * 3 + 20;
  }
  /**
   * When the apply button is clicked
   */


  _handleClick() {
    if (!this._hasChanged()) {
      return;
    } // dividing by ten because printer settings go from -0.8 to 0.8, but the slider goes in integers


    return this.props.printer.invoke('SetZAdjustedOffset', [this.offset / 10]).then(() => this._getInitialOffset()).then(() => this.tracking.addEvent({
      name: 'z-offset_change'
    })).catch(err => this.logger.warn(err));
  }
  /**
   * Formats the label that sits in the middle of the
   * buildplate icon.
   */


  _formatOffset() {
    /* Ok so this is weird. When sending a command to the bot,
    the bot acutally thinks postive numbers should be closer to the plate, 
    where the UI represents closer to the plate as a negative number.
    So when we send an offset that looks negitive on the UI 
    we are really sending a postive number to the bot.
    
    Flip the sign here to match the UI. */
    const sign = this.offset > 0 ? '-' : '+';
    return `${sign}0.${Math.abs(this.offset)}0mm`;
  }

  render() {
    // really just UI sugar, doesn't affect how the thing works
    const ticks = _.range(7).map(() => DOM.li({}, '-'));

    return DOM.div(_.assign({}, this.props, {
      className: `${this.props.className || ''} printerPanel`
    }), DOM.div({
      className: 'printerPanelHeader'
    }, DOM.div({
      className: 'printerPanelBackButton',
      onClick: this.props.onBack
    }, ce(Isvg, {
      src: 'icons/back-arrow.svg'
    })), DOM.div({
      className: 'printerPanelHeaderLabel'
    }, DOM.h1({}, DOM.a({
      className: 'supportLink',
      onClick: () => {
        LinkClickUtils.clickAction(this.getFlux(), 'ZOffset_link_clicked', UrlConst.zOffset);
      }
    }, this.i18n.t('mb:zoffset.header'), ce(Isvg, {
      className: 'helperLinkIcon',
      src: 'icons/helpful-link.svg'
    })))), ce(HeaderSelectButton, {
      flux: this.getFlux(),
      printer: this.props.printer
    }), DOM.div({
      className: 'printerPanelArrowDown',
      onClick: this.props.onClose
    }, ce(Isvg, {
      src: 'icons/back-arrow.svg'
    }))), DOM.div({
      className: 'panel-body'
    }, DOM.div({
      style: {
        marginBottom: 50
      }
    }, DOM.p({}, this.i18n.t('mb:zoffset.paragraph')), DOM.div({
      className: 'zoffset'
    }, DOM.div({
      className: 'zoffset-preview'
    }, DOM.div({
      className: 'zoffset-extruder',
      style: {
        top: this._offsetStyle()
      },
      ref: c => this._preview = c
    }, ce(Isvg, {
      src: util.getPathForIsvg(path.resolve(__dirname, '../images/extruder-inside.svg'))
    })), DOM.div({
      className: 'zoffset-buildplate'
    }, ce(Isvg, {
      src: util.getPathForIsvg(path.resolve(__dirname, '../images/bottom-build-plate.svg'))
    }), DOM.span({
      className: 'zoffset-buildplate-label',
      ref: c => this._label = c
    }, this._formatOffset()))), DOM.div({
      className: 'zoffset-slider-container'
    }, // This is that jerk slider that causes so much grief in this component.
    // It's kind of a jerk. Don't tell it I said that though.
    ce(Slider, {
      ref: c => this._slider = c,
      onChange: this._onChange.bind(this),
      unit: 'mm',
      min: -8,
      max: 8,
      value: this.offset,
      ticks: false,
      orientation: 'vertical',
      disable: false,
      showLabels: true
    }), DOM.ul({
      className: 'zoffset-slider-ticks'
    }, ticks), DOM.ul({
      className: 'zoffset-slider-labels'
    }, DOM.li({}, '+0.80mm'), DOM.li({}, 'Default'), DOM.li({}, '-0.80mm')))), // This is that weird button I had to make to compensate
    // for the Slider being a jerk.
    ce(ZOffsetButton, {
      ref: c => this._apply = c,
      disabled: true,
      onClick: this._handleClick.bind(this),
      flux: this.props.flux
    }))));
  }

}

ZOffset.propTypes = {
  onBack: React.PropTypes.func,
  onClose: React.PropTypes.func,
  flux: React.PropTypes.object.isRequired,
  printer: React.PropTypes.object.isRequired
};
ZOffset.defaultProps = {
  onBack: () => {},
  onClose: () => {}
};
module.exports = ZOffset;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInpPZmZzZXQuanMiXSwibmFtZXMiOlsiUmVhY3QiLCJyZXF1aXJlIiwiRE9NIiwiY2UiLCJjcmVhdGVFbGVtZW50IiwiSXN2ZyIsIl8iLCJwYXRoIiwiRmx1eENvbXBvbmVudCIsIlNsaWRlciIsInV0aWwiLCJaT2Zmc2V0QnV0dG9uIiwiSGVhZGVyU2VsZWN0QnV0dG9uIiwiTGlua0NsaWNrVXRpbHMiLCJVcmxDb25zdCIsInVybCIsIlpPZmZzZXQiLCJjb25zdHJ1Y3RvciIsInByb3BzIiwiY29udGV4dCIsImkxOG4iLCJmbHV4IiwiZ2V0U2VydmljZSIsImxvZ2dlciIsInRyYWNraW5nIiwib2Zmc2V0IiwiYXNzaWduIiwic3RhdGUiLCJpbml0aWFsT2Zmc2V0Iiwic2hvdWxkQ29tcG9uZW50VXBkYXRlIiwiX2hhc0NoYW5nZWQiLCJjb21wb25lbnREaWRNb3VudCIsIl9nZXRJbml0aWFsT2Zmc2V0IiwiX2FwcGx5IiwiZGlzYWJsZSIsInByaW50ZXIiLCJpbnZva2UiLCJ0aGVuIiwidmFsIiwic2V0U3RhdGUiLCJjYXRjaCIsImVyciIsIndhcm4iLCJfb25DaGFuZ2UiLCJuZXdWYWx1ZSIsIl9wcmV2aWV3Iiwic3R5bGUiLCJ0b3AiLCJfb2Zmc2V0U3R5bGUiLCJfbGFiZWwiLCJpbm5lclRleHQiLCJfZm9ybWF0T2Zmc2V0IiwiZW5hYmxlIiwiX2hhbmRsZUNsaWNrIiwiYWRkRXZlbnQiLCJuYW1lIiwic2lnbiIsIk1hdGgiLCJhYnMiLCJyZW5kZXIiLCJ0aWNrcyIsInJhbmdlIiwibWFwIiwibGkiLCJkaXYiLCJjbGFzc05hbWUiLCJvbkNsaWNrIiwib25CYWNrIiwic3JjIiwiaDEiLCJhIiwiY2xpY2tBY3Rpb24iLCJnZXRGbHV4Iiwiek9mZnNldCIsInQiLCJvbkNsb3NlIiwibWFyZ2luQm90dG9tIiwicCIsInJlZiIsImMiLCJnZXRQYXRoRm9ySXN2ZyIsInJlc29sdmUiLCJfX2Rpcm5hbWUiLCJzcGFuIiwiX3NsaWRlciIsIm9uQ2hhbmdlIiwiYmluZCIsInVuaXQiLCJtaW4iLCJtYXgiLCJ2YWx1ZSIsIm9yaWVudGF0aW9uIiwic2hvd0xhYmVscyIsInVsIiwiZGlzYWJsZWQiLCJwcm9wVHlwZXMiLCJQcm9wVHlwZXMiLCJmdW5jIiwib2JqZWN0IiwiaXNSZXF1aXJlZCIsImRlZmF1bHRQcm9wcyIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBLE1BQU1BLEtBQUssR0FBR0MsT0FBTyxDQUFDLE9BQUQsQ0FBckI7O0FBQ0EsTUFBTUMsR0FBRyxHQUFHRixLQUFLLENBQUNFLEdBQWxCO0FBQ0EsTUFBTUMsRUFBRSxHQUFHSCxLQUFLLENBQUNJLGFBQWpCOztBQUNBLE1BQU1DLElBQUksR0FBR0osT0FBTyxDQUFDLGlCQUFELENBQXBCOztBQUNBLE1BQU1LLENBQUMsR0FBR0wsT0FBTyxDQUFDLFFBQUQsQ0FBakI7O0FBQ0EsTUFBTU0sSUFBSSxHQUFHTixPQUFPLENBQUMsTUFBRCxDQUFwQjs7QUFDQSxNQUFNTyxhQUFhLEdBQUdQLE9BQU8sQ0FBQyxrQ0FBRCxDQUE3Qjs7QUFDQSxNQUFNUSxNQUFNLEdBQUdSLE9BQU8sQ0FBQyw2QkFBRCxDQUF0Qjs7QUFFQSxNQUFNUyxJQUFJLEdBQUdULE9BQU8sQ0FBQyxlQUFELENBQXBCOztBQUNBLE1BQU1VLGFBQWEsR0FBR1YsT0FBTyxDQUFDLGlCQUFELENBQTdCOztBQUNBLE1BQU1XLGtCQUFrQixHQUFHWCxPQUFPLENBQUMsdUJBQUQsQ0FBbEM7O0FBQ0EsTUFBTVksY0FBYyxHQUFHWixPQUFPLENBQUMsMEJBQUQsQ0FBOUI7O0FBQ0EsTUFBTWEsUUFBUSxHQUFHYixPQUFPLENBQUMseUJBQUQsQ0FBUCxDQUFtQ2MsR0FBcEQ7O0FBRUEsTUFBTUMsT0FBTixTQUFzQlIsYUFBdEIsQ0FBb0M7QUFDaENTLEVBQUFBLFdBQVcsQ0FBQ0MsS0FBRCxFQUFRQyxPQUFSLEVBQWlCO0FBQ3hCLFVBQU1ELEtBQU4sRUFBYUMsT0FBYjtBQUNBLFNBQUtDLElBQUwsR0FBWSxLQUFL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QSxRQUFRLEVBQUUsSUFGSTtBQUdkNUIsTUFBQUEsT0FBTyxFQUFFLEtBQUtiLFlBQUwsQ0FBa0JpQyxJQUFsQixDQUF1QixJQUF2QixDQUhLO0FBSWRqRSxNQUFBQSxJQUFJLEVBQUUsS0FBS0gsS0FBTCxDQUFXRztBQUpILEtBQWhCLENBNUROLENBRkosQ0F4Q0csQ0FBUDtBQStHSDs7QUE3TytCOztBQWdQcENMLE9BQU8sQ0FBQytFLFNBQVIsR0FBb0I7QUFDaEI1QixFQUFBQSxNQUFNLEVBQUVuRSxLQUFLLENBQUNnRyxTQUFOLENBQWdCQyxJQURSO0FBRWhCdEIsRUFBQUEsT0FBTyxFQUFFM0UsS0FBSyxDQUFDZ0csU0FBTixDQUFnQkMsSUFGVDtBQUdoQjVFLEVBQUFBLElBQUksRUFBRXJCLEtBQUssQ0FBQ2dHLFNBQU4sQ0FBZ0JFLE1BQWhCLENBQXVCQyxVQUhiO0FBSWhCaEUsRUFBQUEsT0FBTyxFQUFFbkMsS0FBSyxDQUFDZ0csU0FBTixDQUFnQkUsTUFBaEIsQ0FBdUJDO0FBSmhCLENBQXBCO0FBT0FuRixPQUFPLENBQUNvRixZQUFSLEdBQXVCO0FBQ25CakMsRUFBQUEsTUFBTSxFQUFFLE1BQU0sQ0FBRSxDQURHO0FBRW5CUSxFQUFBQSxPQUFPLEVBQUUsTUFBTSxDQUFFO0FBRkUsQ0FBdkI7QUFLQTBCLE1BQU0sQ0FBQ0MsT0FBUCxHQUFpQnRGLE9BQWpCIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xyXG5cclxuY29uc3QgUmVhY3QgPSByZXF1aXJlKCdyZWFjdCcpO1xyXG5jb25zdCBET00gPSBSZWFjdC5ET007XHJcbmNvbnN0IGNlID0gUmVhY3QuY3JlYXRlRWxlbWVudDtcclxuY29uc3QgSXN2ZyA9IHJlcXVpcmUoJ3JlYWN0LWlubGluZXN2ZycpO1xyXG5jb25zdCBfID0gcmVxdWlyZSgnbG9kYXNoJyk7XHJcbmNvbnN0IHBhdGggPSByZXF1aXJlKCdwYXRoJyk7XHJcbmNvbnN0IEZsdXhDb21wb25lbnQgPSByZXF1aXJlKCdlYWdsZS1wcmludC92aWV3cy9mbHV4X2NvbXBvbmVudCcpO1xyXG5jb25zdCBTbGlkZXIgPSByZXF1aXJlKCdlYWdsZS1wcmludC92aWV3cy91aS9zbGlkZXInKTtcclxuXHJcbmNvbnN0IHV0aWwgPSByZXF1aXJlKCcuLi8uLi8uLi91dGlsJyk7XHJcbmNvbnN0IFpPZmZzZXRCdXR0b24gPSByZXF1aXJlKCcuL3pvZmZzZXRCdXR0b24nKTtcclxuY29uc3QgSGVhZGVyU2VsZWN0QnV0dG9uID0gcmVxdWlyZSgnLi4vaGVhZGVyU2VsZWN0QnV0dG9uJyk7XHJcbmNvbnN0IExpbmtDbGlja1V0aWxzID0gcmVxdWlyZSgnLi4vLi4vLi4vdXRpbHMvbGlua0NsaWNrJyk7XHJcbmNvbnN0IFVybENvbnN0ID0gcmVxdWlyZSgnLi4vLi4vLi4vY29uc3RhbnRzL3VybHMnKS51cmw7XHJcblxyXG5jbGFzcyBaT2Zmc2V0IGV4dGVuZHMgRmx1eENvbXBvbmVudCB7XHJcbiAgICBjb25zdHJ1Y3Rvcihwcm9wcywgY29udGV4dCkge1xyXG4gICAgICAgIHN1cGVyKHByb3BzLCBjb250ZXh0KTtcclxuICAgICAgICB0aGlzLmkxOG4gPSB0aGlzLnByb3BzLmZsdXguZ2V0U2VydmljZSgnVHJhbnNsYXRpb25TZXJ2aWNlJyk7XHJcbiAgICAgICAgdGhpcy5sb2dnZXIgPSB0aGlzLnByb3BzLmZsdXguZ2V0U2VydmljZSgnTG9nZ2luZ1NlcnZpY2UnKTtcclxuICAgICAgICB0aGlzLnRyYWNraW5nID0gdGhpcy5wcm9wcy5mbHV4LmdldFNlcnZpY2UoJ1RyYWNraW5nU2VydmljZScpO1xyXG5cclxuICAgICAgICAvLyBzZXR0aW5nIHRoaXMgYXMgYSBpbnN0YW5jZSB2YXJpYWJsZSByYXRoZXIgdGhhbiBhIHN0YXRlXHJcbiAgICAgICAgLy8gdmFyaWFibGUsIGJlY2F1c2UgYWdhaW4sIHNldHRpbmcgc3RhdGUgd2lsbCBjYXVzZSBhIHJlLXJlbmRlclxyXG4gICAgICAgIHRoaXMub2Zmc2V0ID0gMDtcclxuXHJcbiAgICAgICAgXy5hc3NpZ24odGhpcy5zdGF0ZSwge1xyXG4gICAgICAgICAgICBpbml0aWFsT2Zmc2V0OiAwLFxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogQmFzaWNhbGx5IHdlIGRvbid0IHdhbnQgdGhpcyB1cGRhdGluZyB0byBmcmVxdWVudGx5LCBiZWNhdXNlXHJcbiAgICAgKiB0aGUgc2xpZGVyIHdpbGwgZm9yZ2V0IHRoYXQgaXQncyBiZWluZyBkcmFnZ2VkLCBlc3NlbnRpYWxseSBtYWtpbmcgaXRcclxuICAgICAqIHNvIHRoZSB1c2VyIGNhbiBvbmx5IGRyYWcgb25lIHRpY2sgYXQgYSB0aW1lLCB3aGljaCBpcyBpbnNhbmVseSBhbm5veWluZy5cclxuICAgICAqIFNvLCB3ZSBiYXNpY2FsbHkgYWxtb3N0IG5ldmVyIHVwZGF0ZSB0aGUgc3RhdGUsIHdoaWNoIGFsbG93cyB0aGUgdXNlclxyXG4gICAgICogdG8gZHJhZyBvbiB0aGUgc2xpZGVyIHByb3Blcmx5LlxyXG4gICAgICovXHJcbiAgICBzaG91bGRDb21wb25lbnRVcGRhdGUoKSB7XHJcbiAgICAgICAgcmV0dXJuICF0aGlzLl9oYXNDaGFuZ2VkKCk7XHJcbiAgICB9XHJcblxyXG4gICAgY29tcG9uZW50RGlkTW91bnQoKSB7XHJcbiAgICAgICAgdGhpcy5fZ2V0SW5pdGlhbE9mZnNldCgpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogRmlndXJlIG91dCB3aGF0IHRoZSBwcmludGVyJ3Mgei1vZmZzZXQgaXMgY3VycmVudGx5IHNldCB0b1xyXG4gICAgICovXHJcbiAgICBfZ2V0SW5pdGlhbE9mZnNldCgpIHtcclxuICAgICAgICAvLyB3ZSBoYXZlIHRvIG1hbnVhbGx5IGRpc2FibGUgdGhlIGFwcGx5IGJ1dHRvbiwgcmF0aGVyIHRoYW5cclxuICAgICAgICAvLyBzZXR0aW5nIHN0YXRlLiBUaGlzIGlzIGtpbmRhIGhhY2t5LCBidXQgd2UgaGF2ZSB0byBkbyBpdCB0aGlzIHdheVxyXG4gICAgICAgIC8vIGJlY2F1c2Ugd2UgY2FuJ3QgYWxsb3cgdGhlIHNsaWRlciB0byByZS1yZW5kZXIuXHJcbiAgICAgICAgdGhpcy5fYXBwbHkuZGlzYWJsZSgpO1xyXG5cclxuICAgICAgICByZXR1cm4gdGhpcy5wcm9wcy5wcmludGVyXHJcbiAgICAgICAgICAgIC5pbnZva2UoJ0dldFpBZGp1c3RlZE9mZnNldCcpXHJcbiAgICAgICAgICAgIC50aGVuKHZhbCA9PiAodGhpcy5vZmZzZXQgPSB2YWwgKiAxMCkpIC8vIG11bHRpcGx5aW5nIGJ5IHRlbiBiZWNhdXNlIHByaW50ZXIgc2V0dGluZ3MgZ28gZnJvbSAtMC44IHRvIDAuOCwgYnV0IHRoZSBzbGlkZXIgZ29lcyBpbiBpbnRlZ2Vyc1xyXG4gICAgICAgICAgICAudGhlbigoKSA9PiB0aGlzLnNldFN0YXRlKHsgaW5pdGlhbE9mZnNldDogdGhpcy5vZmZzZXQgfSkpXHJcbiAgICAgICAgICAgIC5jYXRjaChlcnIgPT4gdGhpcy5sb2dnZXIud2FybihlcnIpKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEZpcmVzIHdoZW4gdGhlIHNsaWRlciBjaGFuZ2VzIGl0cyB2YWx1ZS4gWW91IG1heSBub3RpY2UgdGhhdFxyXG4gICAgICogd2UgZG9uJ3Qgc2V0IHN0YXRlIGluIGhlcmUuIFRoYXQncyBiZWNhdXNlIHNldHRpbmcgc3RhdGVcclxuICAgICAqIHVzdWFsbHkgdHJpZ2dlcnMgYSByZS1yZW5kZXIsIHdoaWNoIHdpbGwgcHJldmVudCB0aGUgdXNlclxyXG4gICAgICogZnJvbSBiZWluZyBhYmxlIHRvIGRyYWcgdGhlIHNsaWRlci4gSW5zdGVhZCB3ZSBlZGl0IHRoZSBVSVxyXG4gICAgICogaW5saW5lLiBJdCdzIG5vdCB2ZXJ5IFJlYWN0LCBidXQgYXMgaXQgdHVybnMgb3V0LCBuZWl0aGVyIGlzIHRoZVxyXG4gICAgICogc2xpZGVyLCBhbmQgdGhhdCdzIHdoYXQncyByZWFsbHkgc2NyZXdpbmcgdXMgdXAuXHJcbiAgICAgKi9cclxuICAgIF9vbkNoYW5nZSh2YWwpIHtcclxuICAgICAgICAvLyBzZXR0aW5nIHRoaXMgYXMgYSBpbnN0YW5jZSB2YXJpYWJsZSByYXRoZXIgdGhhbiBhIHN0YXRlXHJcbiAgICAgICAgLy8gdmFyaWFibGUsIGJlY2F1c2UgYWdhaW4sIHNldHRpbmcgc3RhdGUgd2lsbCBjYXVzZSBhIHJlLXJlbmRlclxyXG4gICAgICAgIHRoaXMub2Zmc2V0ID0gdmFsLm5ld1ZhbHVlO1xyXG5cclxuICAgICAgICBpZiAodGhpcy5fcHJldmlldykge1xyXG4gICAgICAgICAgICAvLyBtb3ZlIHRoZSBwcmV2aWV3IHRvIGtlZXAgdXAgd2l0aCB0aGUgc2xpZGVyXHJcbiAgICAgICAgICAgIHRoaXMuX3ByZXZpZXcuc3R5bGUudG9wID0gdGhpcy5fb2Zmc2V0U3R5bGUoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0aGlzLl9sYWJlbCkge1xyXG4gICAgICAgICAgICAvLyBjaGFuZ2UgdGhlIGxhYmVsIHRvIHJlZmxlY3QgdGhlIHNldHRpbmdzIG9uIHRoZSBzbGlkZXJcclxuICAgICAgICAgICAgdGhpcy5fbGFiZWwuaW5uZXJUZXh0ID0gdGhpcy5fZm9ybWF0T2Zmc2V0KCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGhpcy5zdGF0ZS5pbml0aWFsT2Zmc2V0ICE9PSB0aGlzLm9mZnNldCkge1xyXG4gICAgICAgICAgICB0aGlzLl9hcHBseS5lbmFibGUoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0aGlzLnN0YXRlLmluaXRpYWxPZmZzZXQgPT09IHRoaXMub2Zmc2V0KSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2FwcGx5LmRpc2FibGUoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgX2hhc0NoYW5nZWQoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMub2Zmc2V0ICE9PSB0aGlzLnN0YXRlLmluaXRpYWxPZmZzZXQ7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBKdXN0IG1ha2luZyB0aGUgZXh0cnVkZXIgaWNvbiBtb3ZlIGFuZCBmaXQgd2l0aGluIHRoZSBzcGFjZVxyXG4gICAgICogaW4gYSByZWFzb25hYmxlIHdheS5cclxuICAgICAqL1xyXG4gICAgX29mZnNldFN0eWxlKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLm9mZnNldCAqIDMgKyAyMDtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIFdoZW4gdGhlIGFwcGx5IGJ1dHRvbiBpcyBjbGlja2VkXHJcbiAgICAgKi9cclxuICAgIF9oYW5kbGVDbGljaygpIHtcclxuICAgICAgICBpZiAoIXRoaXMuX2hhc0NoYW5nZWQoKSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBkaXZpZGluZyBieSB0ZW4gYmVjYXVzZSBwcmludGVyIHNldHRpbmdzIGdvIGZyb20gLTAuOCB0byAwLjgsIGJ1dCB0aGUgc2xpZGVyIGdvZXMgaW4gaW50ZWdlcnNcclxuICAgICAgICByZXR1cm4gdGhpcy5wcm9wcy5wcmludGVyXHJcbiAgICAgICAgICAgIC5pbnZva2UoJ1NldFpBZGp1c3RlZE9mZnNldCcsIFt0aGlzLm9mZnNldCAvIDEwXSlcclxuICAgICAgICAgICAgLnRoZW4oKCkgPT4gdGhpcy5fZ2V0SW5pdGlhbE9mZnNldCgpKVxyXG4gICAgICAgICAgICAudGhlbigoKSA9PiB0aGlzLnRyYWNraW5nLmFkZEV2ZW50KHsgbmFtZTogJ3otb2Zmc2V0X2NoYW5nZScgfSkpXHJcbiAgICAgICAgICAgIC5jYXRjaChlcnIgPT4gdGhpcy5sb2dnZXIud2FybihlcnIpKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEZvcm1hdHMgdGhlIGxhYmVsIHRoYXQgc2l0cyBpbiB0aGUgbWlkZGxlIG9mIHRoZVxyXG4gICAgICogYnVpbGRwbGF0ZSBpY29uLlxyXG4gICAgICovXHJcbiAgICBfZm9ybWF0T2Zmc2V0KCkge1xyXG4gICAgICAgIC8qIE9rIHNvIHRoaXMgaXMgd2VpcmQuIFdoZW4gc2VuZGluZyBhIGNvbW1hbmQgdG8gdGhlIGJvdCxcclxuICAgICAgICB0aGUgYm90IGFjdXRhbGx5IHRoaW5rcyBwb3N0aXZlIG51bWJlcnMgc2hvdWxkIGJlIGNsb3NlciB0byB0aGUgcGxhdGUsIFxyXG4gICAgICAgIHdoZXJlIHRoZSBVSSByZXByZXNlbnRzIGNsb3NlciB0byB0aGUgcGxhdGUgYXMgYSBuZWdhdGl2ZSBudW1iZXIuXHJcbiAgICAgICAgU28gd2hlbiB3ZSBzZW5kIGFuIG9mZnNldCB0aGF0IGxvb2tzIG5lZ2l0aXZlIG9uIHRoZSBVSSBcclxuICAgICAgICB3ZSBhcmUgcmVhbGx5IHNlbmRpbmcgYSBwb3N0aXZlIG51bWJlciB0byB0aGUgYm90LlxyXG4gICAgICAgIFxyXG4gICAgICAgIEZsaXAgdGhlIHNpZ24gaGVyZSB0byBtYXRjaCB0aGUgVUkuICovXHJcbiAgICAgICAgY29uc3Qgc2lnbiA9IHRoaXMub2Zmc2V0ID4gMCA/ICctJyA6ICcrJztcclxuICAgICAgICByZXR1cm4gYCR7c2lnbn0wLiR7TWF0aC5hYnModGhpcy5vZmZzZXQpfTBtbWA7XHJcbiAgICB9XHJcblxyXG4gICAgcmVuZGVyKCkge1xyXG4gICAgICAgIC8vIHJlYWxseSBqdXN0IFVJIHN1Z2FyLCBkb2Vzbid0IGFmZmVjdCBob3cgdGhlIHRoaW5nIHdvcmtzXHJcbiAgICAgICAgY29uc3QgdGlja3MgPSBfLnJhbmdlKDcpLm1hcCgoKSA9PiBET00ubGkoe30sICctJykpO1xyXG4gICAgICAgIHJldHVybiBET00uZGl2KFxyXG4gICAgICAgICAgICBfLmFzc2lnbih7fSwgdGhpcy5wcm9wcywgeyBjbGFzc05hbWU6IGAke3RoaXMucHJvcHMuY2xhc3NOYW1lIHx8ICcnfSBwcmludGVyUGFuZWxgIH0pLFxyXG4gICAgICAgICAgICBET00uZGl2KFxyXG4gICAgICAgICAgICAgICAgeyBjbGFzc05hbWU6ICdwcmludGVyUGFuZWxIZWFkZXInIH0sXHJcbiAgICAgICAgICAgICAgICBET00uZGl2KFxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lOiAncHJpbnRlclBhbmVsQmFja0J1dHRvbicsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s6IHRoaXMucHJvcHMub25CYWNrLFxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgY2UoSXN2ZywgeyBzcmM6ICdpY29ucy9iYWNrLWFycm93LnN2ZycgfSlcclxuICAgICAgICAgICAgICAgICksXHJcbiAgICAgICAgICAgICAgICBET00uZGl2KFxyXG4gICAgICAgICAgICAgICAgICAgIHsgY2xhc3NOYW1lOiAncHJpbnRlclBhbmVsSGVhZGVyTGFiZWwnIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgRE9NLmgxKFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB7fSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgRE9NLmEoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lOiAnc3VwcG9ydExpbmsnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s6ICgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTGlua0NsaWNrVXRpbHMuY2xpY2tBY3Rpb24oXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmdldEZsdXgoKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdaT2Zmc2V0X2xpbmtfY2xpY2tlZCcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBVcmxDb25zdC56T2Zmc2V0XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmkxOG4udCgnbWI6em9mZnNldC5oZWFkZXInKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNlKElzdmcsIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU6ICdoZWxwZXJMaW5rSWNvbicsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3JjOiAnaWNvbnMvaGVscGZ1bC1saW5rLnN2ZycsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICApXHJcbiAgICAgICAgICAgICAgICAgICAgKVxyXG4gICAgICAgICAgICAgICAgKSxcclxuICAgICAgICAgICAgICAgIGNlKEhlYWRlclNlbGVjdEJ1dHRvbiwgeyBmbHV4OiB0aGlzLmdldEZsdXgoKSwgcHJpbnRlcjogdGhpcy5wcm9wcy5wcmludGVyIH0pLFxyXG4gICAgICAgICAgICAgICAgRE9NLmRpdihcclxuICAgICAgICAgICAgICAgICAgICB7IGNsYXNzTmFtZTogJ3ByaW50ZXJQYW5lbEFycm93RG93bicsIG9uQ2xpY2s6IHRoaXMucHJvcHMub25DbG9zZSB9LFxyXG4gICAgICAgICAgICAgICAgICAgIGNlKElzdmcsIHsgc3JjOiAnaWNvbnMvYmFjay1hcnJvdy5zdmcnIH0pXHJcbiAgICAgICAgICAgICAgICApXHJcbiAgICAgICAgICAgICksXHJcbiAgICAgICAgICAgIERPTS5kaXYoXHJcbiAgICAgICAgICAgICAgICB7IGNsYXNzTmFtZTogJ3BhbmVsLWJvZHknIH0sXHJcbiAgICAgICAgICAgICAgICBET00uZGl2KFxyXG4gICAgICAgICAgICAgICAgICAgIHsgc3R5bGU6IHsgbWFyZ2luQm90dG9tOiA1MCB9IH0sXHJcbiAgICAgICAgICAgICAgICAgICAgRE9NLnAoe30sIHRoaXMuaTE4bi50KCdtYjp6b2Zmc2V0LnBhcmFncmFwaCcpKSxcclxuICAgICAgICAgICAgICAgICAgICBET00uZGl2KFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB7IGNsYXNzTmFtZTogJ3pvZmZzZXQnIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIERPTS5kaXYoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7IGNsYXNzTmFtZTogJ3pvZmZzZXQtcHJldmlldycgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIERPTS5kaXYoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU6ICd6b2Zmc2V0LWV4dHJ1ZGVyJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3R5bGU6IHsgdG9wOiB0aGlzLl9vZmZzZXRTdHlsZSgpIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZjogYyA9PiAodGhpcy5fcHJldmlldyA9IGMpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2UoSXN2Zywge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcmM6IHV0aWwuZ2V0UGF0aEZvcklzdmcocGF0aC5yZXNvbHZlKF9fZGlybmFtZSwgJy4uL2ltYWdlcy9leHRydWRlci1pbnNpZGUuc3ZnJykpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICApLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgRE9NLmRpdihcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7IGNsYXNzTmFtZTogJ3pvZmZzZXQtYnVpbGRwbGF0ZScgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjZShJc3ZnLCB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNyYzogdXRpbC5nZXRQYXRoRm9ySXN2ZyhcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhdGgucmVzb2x2ZShfX2Rpcm5hbWUsICcuLi9pbWFnZXMvYm90dG9tLWJ1aWxkLXBsYXRlLnN2ZycpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRE9NLnNwYW4oXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogJ3pvZmZzZXQtYnVpbGRwbGF0ZS1sYWJlbCcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWY6IGMgPT4gKHRoaXMuX2xhYmVsID0gYyksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2Zvcm1hdE9mZnNldCgpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICApLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBET00uZGl2KFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgeyBjbGFzc05hbWU6ICd6b2Zmc2V0LXNsaWRlci1jb250YWluZXInIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBUaGlzIGlzIHRoYXQgamVyayBzbGlkZXIgdGhhdCBjYXVzZXMgc28gbXVjaCBncmllZiBpbiB0aGlzIGNvbXBvbmVudC5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEl0J3Mga2luZCBvZiBhIGplcmsuIERvbid0IHRlbGwgaXQgSSBzYWlkIHRoYXQgdGhvdWdoLlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2UoU2xpZGVyLCB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVmOiBjID0+ICh0aGlzLl9zbGlkZXIgPSBjKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbkNoYW5nZTogdGhpcy5fb25DaGFuZ2UuYmluZCh0aGlzKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bml0OiAnbW0nLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1pbjogLTgsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWF4OiA4LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLm9mZnNldCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aWNrczogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3JpZW50YXRpb246ICd2ZXJ0aWNhbCcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlzYWJsZTogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2hvd0xhYmVsczogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgRE9NLnVsKHsgY2xhc3NOYW1lOiAnem9mZnNldC1zbGlkZXItdGlja3MnIH0sIHRpY2tzKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIERPTS51bChcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7IGNsYXNzTmFtZTogJ3pvZmZzZXQtc2xpZGVyLWxhYmVscycgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBET00ubGkoe30sICcrMC44MG1tJyksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRE9NLmxpKHt9LCAnRGVmYXVsdCcpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIERPTS5saSh7fSwgJy0wLjgwbW0nKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICApXHJcbiAgICAgICAgICAgICAgICAgICAgKSxcclxuICAgICAgICAgICAgICAgICAgICAvLyBUaGlzIGlzIHRoYXQgd2VpcmQgYnV0dG9uIEkgaGFkIHRvIG1ha2UgdG8gY29tcGVuc2F0ZVxyXG4gICAgICAgICAgICAgICAgICAgIC8vIGZvciB0aGUgU2xpZGVyIGJlaW5nIGEgamVyay5cclxuICAgICAgICAgICAgICAgICAgICBjZShaT2Zmc2V0QnV0dG9uLCB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlZjogYyA9PiAodGhpcy5fYXBwbHkgPSBjKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGlzYWJsZWQ6IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s6IHRoaXMuX2hhbmRsZUNsaWNrLmJpbmQodGhpcyksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZsdXg6IHRoaXMucHJvcHMuZmx1eCxcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgKVxyXG4gICAgICAgICAgICApXHJcbiAgICAgICAgKTtcclxuICAgIH1cclxufVxyXG5cclxuWk9mZnNldC5wcm9wVHlwZXMgPSB7XHJcbiAgICBvbkJhY2s6IFJlYWN0LlByb3BUeXBlcy5mdW5jLFxyXG4gICAgb25DbG9zZTogUmVhY3QuUHJvcFR5cGVzLmZ1bmMsXHJcbiAgICBmbHV4OiBSZWFjdC5Qcm9wVHlwZXMub2JqZWN0LmlzUmVxdWlyZWQsXHJcbiAgICBwcmludGVyOiBSZWFjdC5Qcm9wVHlwZXMub2JqZWN0LmlzUmVxdWlyZWQsXHJcbn07XHJcblxyXG5aT2Zmc2V0LmRlZmF1bHRQcm9wcyA9IHtcclxuICAgIG9uQmFjazogKCkgPT4ge30sXHJcbiAgICBvbkNsb3NlOiAoKSA9PiB7fSxcclxufTtcclxuXHJcbm1vZHVsZS5leHBvcnRzID0gWk9mZnNldDtcclxuIl19
