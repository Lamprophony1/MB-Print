'use strict';

const React = require('react');

const ce = React.createElement;
const {
  DOM: {
    div,
    strong
  }
} = React;

const R = require('ramda');

const FluxComponent = require('eagle-print/views/flux_component');

const PanelHeader = require('./panelHeader');

const {
  CHANGE_EVENT
} = require('../../../constants/copyBotLogs');

const {
  PrinterStateEnum
} = require('../../../constants');

const {
  pSplit
} = require('../../../util');

const WaitableButton = require('../WaitableButton');

class CopyBotLogs extends FluxComponent {
  constructor(props) {
    super(props);
    this._i18n = this.props.flux.getService('TranslationService');
    this._trackingService = this.props.flux.getService('TrackingService');
    this._loggingService = this.props.flux.getService('LoggingService');
    this._store = this.props.flux.store('CopyBotLogs');
    this._actions = this.props.flux.actions.CopyBotLogs;
    this.onChange = this.onChange.bind(this);
    this.state = this._store.getState(this.props.printer.getId());
  }

  componentDidMount() {
    this._store.addListener(CHANGE_EVENT, this.onChange);
  }

  componentWillUnmount() {
    this._store.removeListener(CHANGE_EVENT, this.onChange);
  }

  onChange() {
    this.setState(this._store.getState(this.props.printer.getId()));
  }

  renderButtons() {
    const {
      printer
    } = this.props;
    const id = printer.getId();
    const {
      tmpPath
    } = this.state;
    const disabled = printer.getStatus().state === PrinterStateEnum.Busy || printer.getStatus().state === PrinterStateEnum.Unauthenticated;
    if (this.state.error) return div({}, div({}, strong({}, this._i18n.t('mb:copyBotLogs.error'))), div({
      style: {
        marginTop: 10
      }
    }, ce(WaitableButton, {
      waiting: false,
      buttonProps: {
        disabled,
        type: 'secondary',
        onClick: () => this._actions.copyLogs(id),
        label: this._i18n.t('mb:copyBotLogs.tryAgain')
      }
    })));
    if (this.state.isCopying) return div({}, ce(WaitableButton, {
      waiting: true,
      buttonProps: {
        type: 'secondary',
        label: this._i18n.t('mb:copyBotLogs.copying'),
        disabled: true
      }
    }));
    if (tmpPath) return div({}, div({}, strong({}, this._i18n.t('mb:copyBotLogs.copied'))), div({
      style: {
        marginTop: 10
      }
    }, ce(WaitableButton, {
      waiting: false,
      buttonProps: {
        type: 'secondary',
        label: this._i18n.t('mb:copyBotLogs.send'),
        onClick: () => this._actions.sendToSupport(id)
      }
    })), div({
      style: {
        marginTop: 10
      }
    }, ce(WaitableButton, {
      waiting: false,
      buttonProps: {
        type: 'secondary',
        label: this._i18n.t('mb:copyBotLogs.save'),
        onClick: () => this._actions.saveLogs(id)
      }
    })));
    return div({}, ce(WaitableButton, {
      waiting: false,
      buttonProps: {
        disabled,
        type: 'secondary',
        label: this._i18n.t('mb:copyBotLogs.copy'),
        onClick: () => this._actions.copyLogs(id)
      }
    }));
  }

  render() {
    return div(R.merge(this.props, {
      id: 'copybotlogs',
      className: `${this.props.className || 'copybotlogs'} printerPanel`,
      style: {
        position: 'relative',
        height: '100%'
      }
    }), // PANEL HEADER
    ce(PanelHeader, {
      title: this._i18n.t('mb:copyBotLogs.title'),
      flux: this.props.flux,
      printer: this.props.printer,
      onBack: this.props.onBack,
      onClose: this.props.onClose
    }), // PANEL BODY
    div({
      className: 'panel-body'
    }, pSplit(this._i18n.t('mb:copyBotLogs.info')), this.renderButtons()), // PANEL FOOTER PILL
    div({
      className: 'printerPanel'
    }, div({
      style: {
        marginBottom: 50
      }
    })));
  }

}

CopyBotLogs.propTypes = {
  flux: React.PropTypes.object.isRequired,
  onBack: React.PropTypes.func.isRequired,
  onClose: React.PropTypes.func.isRequired,
  printer: React.PropTypes.object.isRequired,
  className: React.PropTypes.string
};
module.exports = CopyBotLogs;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvcHlCb3RMb2dzLmpzIl0sIm5hbWVzIjpbIlJlYWN0IiwicmVxdWlyZSIsImNlIiwiY3JlYXRlRWxlbWVudCIsIkRPTSIsImRpdiIsInN0cm9uZyIsIlIiLCJGbHV4Q29tcG9uZW50IiwiUGFuZWxIZWFkZXIiLCJDSEFOR0VfRVZFTlQiLCJQcmludGVyU3RhdGVFbnVtIiwicFNwbGl0IiwiV2FpdGFibGVCdXR0b24iLCJDb3B5Qm90TG9ncyIsImNvbnN0cnVjdG9yIiwicHJvcHMiLCJfaTE4biIsImZsdXgiLCJnZXRTZXJ2aWNlIiwiX3RyYWNraW5nU2VydmljZSIsIl9sb2dnaW5nU2VydmljZSIsIl9zdG9yZSIsInN0b3JlIiwiX2FjdGlvbnMiLCJhY3Rpb25zIiwib25DaGFuZ2UiLCJiaW5kIiwic3RhdGUiLCJnZXRTdGF0ZSIsInByaW50ZXIiLCJnZXRJZCIsImNvbXBvbmVudERpZE1vdW50IiwiYWRkTGlzdGVuZXIiLCJjb21wb25lbnRXaWxsVW5tb3VudCIsInJlbW92ZUxpc3RlbmVyIiwic2V0U3RhdGUiLCJyZW5kZXJCdXR0b25zIiwiaWQiLCJ0bXBQYXRoIiwiZGlzYWJsZWQiLCJnZXRTdGF0dXMiLCJCdXN5IiwiVW5hdXRoZW50aWNhdGVkIiwiZXJyb3IiLCJ0Iiwic3R5bGUiLCJtYXJnaW5Ub3AiLCJ3YWl0aW5nIiwiYnV0dG9uUHJvcHMiLCJ0eXBlIiwib25DbGljayIsImNvcHlMb2dzIiwibGFiZWwiLCJpc0NvcHlpbmciLCJzZW5kVG9TdXBwb3J0Iiwic2F2ZUxvZ3MiLCJyZW5kZXIiLCJtZXJnZSIsImNsYXNzTmFtZSIsInBvc2l0aW9uIiwiaGVpZ2h0IiwidGl0bGUiLCJvbkJhY2siLCJvbkNsb3NlIiwibWFyZ2luQm90dG9tIiwicHJvcFR5cGVzIiwiUHJvcFR5cGVzIiwib2JqZWN0IiwiaXNSZXF1aXJlZCIsImZ1bmMiLCJzdHJpbmciLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQSxNQUFNQSxLQUFL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Q0FBbkMsQ0FuQkcsQ0FBVjtBQXFCSDs7QUFuSW1DOztBQXNJeENuRCxXQUFXLENBQUNvRCxTQUFaLEdBQXdCO0FBQ3BCaEQsRUFBQUEsSUFBSSxFQUFFbEIsS0FBSyxDQUFDbUUsU0FBTixDQUFnQkMsTUFBaEIsQ0FBdUJDLFVBRFQ7QUFFcEJOLEVBQUFBLE1BQU0sRUFBRS9ELEtBQUssQ0FBQ21FLFNBQU4sQ0FBZ0JHLElBQWhCLENBQXFCRCxVQUZUO0FBR3BCTCxFQUFBQSxPQUFPLEVBQUVoRSxLQUFLLENBQUNtRSxTQUFOLENBQWdCRyxJQUFoQixDQUFxQkQsVUFIVjtBQUlwQnZDLEVBQUFBLE9BQU8sRUFBRTlCLEtBQUssQ0FBQ21FLFNBQU4sQ0FBZ0JDLE1BQWhCLENBQXVCQyxVQUpaO0FBS3BCVixFQUFBQSxTQUFTLEVBQUUzRCxLQUFLLENBQUNtRSxTQUFOLENBQWdCSTtBQUxQLENBQXhCO0FBUUFDLE1BQU0sQ0FBQ0MsT0FBUCxHQUFpQjNELFdBQWpCIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xyXG5cclxuY29uc3QgUmVhY3QgPSByZXF1aXJlKCdyZWFjdCcpO1xyXG5jb25zdCBjZSA9IFJlYWN0LmNyZWF0ZUVsZW1lbnQ7XHJcbmNvbnN0IHtcclxuICAgIERPTTogeyBkaXYsIHN0cm9uZyB9LFxyXG59ID0gUmVhY3Q7XHJcbmNvbnN0IFIgPSByZXF1aXJlKCdyYW1kYScpO1xyXG5jb25zdCBGbHV4Q29tcG9uZW50ID0gcmVxdWlyZSgnZWFnbGUtcHJpbnQvdmlld3MvZmx1eF9jb21wb25lbnQnKTtcclxuXHJcbmNvbnN0IFBhbmVsSGVhZGVyID0gcmVxdWlyZSgnLi9wYW5lbEhlYWRlcicpO1xyXG5jb25zdCB7IENIQU5HRV9FVkVOVCB9ID0gcmVxdWlyZSgnLi4vLi4vLi4vY29uc3RhbnRzL2NvcHlCb3RMb2dzJyk7XHJcbmNvbnN0IHsgUHJpbnRlclN0YXRlRW51bSB9ID0gcmVxdWlyZSgnLi4vLi4vLi4vY29uc3RhbnRzJyk7XHJcbmNvbnN0IHsgcFNwbGl0IH0gPSByZXF1aXJlKCcuLi8uLi8uLi91dGlsJyk7XHJcbmNvbnN0IFdhaXRhYmxlQnV0dG9uID0gcmVxdWlyZSgnLi4vV2FpdGFibGVCdXR0b24nKTtcclxuXHJcbmNsYXNzIENvcHlCb3RMb2dzIGV4dGVuZHMgRmx1eENvbXBvbmVudCB7XHJcbiAgICBjb25zdHJ1Y3Rvcihwcm9wcykge1xyXG4gICAgICAgIHN1cGVyKHByb3BzKTtcclxuXHJcbiAgICAgICAgdGhpcy5faTE4biA9IHRoaXMucHJvcHMuZmx1eC5nZXRTZXJ2aWNlKCdUcmFuc2xhdGlvblNlcnZpY2UnKTtcclxuICAgICAgICB0aGlzLl90cmFja2luZ1NlcnZpY2UgPSB0aGlzLnByb3BzLmZsdXguZ2V0U2VydmljZSgnVHJhY2tpbmdTZXJ2aWNlJyk7XHJcbiAgICAgICAgdGhpcy5fbG9nZ2luZ1NlcnZpY2UgPSB0aGlzLnByb3BzLmZsdXguZ2V0U2VydmljZSgnTG9nZ2luZ1NlcnZpY2UnKTtcclxuXHJcbiAgICAgICAgdGhpcy5fc3RvcmUgPSB0aGlzLnByb3BzLmZsdXguc3RvcmUoJ0NvcHlCb3RMb2dzJyk7XHJcbiAgICAgICAgdGhpcy5fYWN0aW9ucyA9IHRoaXMucHJvcHMuZmx1eC5hY3Rpb25zLkNvcHlCb3RMb2dzO1xyXG5cclxuICAgICAgICB0aGlzLm9uQ2hhbmdlID0gdGhpcy5vbkNoYW5nZS5iaW5kKHRoaXMpO1xyXG5cclxuICAgICAgICB0aGlzLnN0YXRlID0gdGhpcy5fc3RvcmUuZ2V0U3RhdGUodGhpcy5wcm9wcy5wcmludGVyLmdldElkKCkpO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbXBvbmVudERpZE1vdW50KCkge1xyXG4gICAgICAgIHRoaXMuX3N0b3JlLmFkZExpc3RlbmVyKENIQU5HRV9FVkVOVCwgdGhpcy5vbkNoYW5nZSk7XHJcbiAgICB9XHJcblxyXG4gICAgY29tcG9uZW50V2lsbFVubW91bnQoKSB7XHJcbiAgICAgICAgdGhpcy5fc3RvcmUucmVtb3ZlTGlzdGVuZXIoQ0hBTkdFX0VWRU5ULCB0aGlzLm9uQ2hhbmdlKTtcclxuICAgIH1cclxuXHJcbiAgICBvbkNoYW5nZSgpIHtcclxuICAgICAgICB0aGlzLnNldFN0YXRlKHRoaXMuX3N0b3JlLmdldFN0YXRlKHRoaXMucHJvcHMucHJpbnRlci5nZXRJZCgpKSk7XHJcbiAgICB9XHJcblxyXG4gICAgcmVuZGVyQnV0dG9ucygpIHtcclxuICAgICAgICBjb25zdCB7IHByaW50ZXIgfSA9IHRoaXMucHJvcHM7XHJcbiAgICAgICAgY29uc3QgaWQgPSBwcmludGVyLmdldElkKCk7XHJcbiAgICAgICAgY29uc3QgeyB0bXBQYXRoIH0gPSB0aGlzLnN0YXRlO1xyXG4gICAgICAgIGNvbnN0IGRpc2FibGVkID1cclxuICAgICAgICAgICAgcHJpbnRlci5nZXRTdGF0dXMoKS5zdGF0ZSA9PT0gUHJpbnRlclN0YXRlRW51bS5CdXN5IHx8XHJcbiAgICAgICAgICAgIHByaW50ZXIuZ2V0U3RhdHVzKCkuc3RhdGUgPT09IFByaW50ZXJTdGF0ZUVudW0uVW5hdXRoZW50aWNhdGVkO1xyXG5cclxuICAgICAgICBpZiAodGhpcy5zdGF0ZS5lcnJvcilcclxuICAgICAgICAgICAgcmV0dXJuIGRpdihcclxuICAgICAgICAgICAgICAgIHt9LFxyXG4gICAgICAgICAgICAgICAgZGl2KHt9LCBzdHJvbmcoe30sIHRoaXMuX2kxOG4udCgnbWI6Y29weUJvdExvZ3MuZXJyb3InKSkpLFxyXG4gICAgICAgICAgICAgICAgZGl2KFxyXG4gICAgICAgICAgICAgICAgICAgIHsgc3R5bGU6IHsgbWFyZ2luVG9wOiAxMCB9IH0sXHJcbiAgICAgICAgICAgICAgICAgICAgY2UoV2FpdGFibGVCdXR0b24sIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgd2FpdGluZzogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJ1dHRvblByb3BzOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXNhYmxlZCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdzZWNvbmRhcnknLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb25DbGljazogKCkgPT4gdGhpcy5fYWN0aW9ucy5jb3B5TG9ncyhpZCksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogdGhpcy5faTE4bi50KCdtYjpjb3B5Qm90TG9ncy50cnlBZ2FpbicpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICApXHJcbiAgICAgICAgICAgICk7XHJcblxyXG4gICAgICAgIGlmICh0aGlzLnN0YXRlLmlzQ29weWluZylcclxuICAgICAgICAgICAgcmV0dXJuIGRpdihcclxuICAgICAgICAgICAgICAgIHt9LFxyXG4gICAgICAgICAgICAgICAgY2UoV2FpdGFibGVCdXR0b24sIHtcclxuICAgICAgICAgICAgICAgICAgICB3YWl0aW5nOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgIGJ1dHRvblByb3BzOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdzZWNvbmRhcnknLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogdGhpcy5faTE4bi50KCdtYjpjb3B5Qm90TG9ncy5jb3B5aW5nJyksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpc2FibGVkOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICApO1xyXG5cclxuICAgICAgICBpZiAodG1wUGF0aClcclxuICAgICAgICAgICAgcmV0dXJuIGRpdihcclxuICAgICAgICAgICAgICAgIHt9LFxyXG4gICAgICAgICAgICAgICAgZGl2KHt9LCBzdHJvbmcoe30sIHRoaXMuX2kxOG4udCgnbWI6Y29weUJvdExvZ3MuY29waWVkJykpKSxcclxuICAgICAgICAgICAgICAgIGRpdihcclxuICAgICAgICAgICAgICAgICAgICB7IHN0eWxlOiB7IG1hcmdpblRvcDogMTAgfSB9LFxyXG4gICAgICAgICAgICAgICAgICAgIGNlKFdhaXRhYmxlQnV0dG9uLCB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHdhaXRpbmc6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBidXR0b25Qcm9wczoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ3NlY29uZGFyeScsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogdGhpcy5faTE4bi50KCdtYjpjb3B5Qm90TG9ncy5zZW5kJyksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbkNsaWNrOiAoKSA9PiB0aGlzLl9hY3Rpb25zLnNlbmRUb1N1cHBvcnQoaWQpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICApLFxyXG4gICAgICAgICAgICAgICAgZGl2KFxyXG4gICAgICAgICAgICAgICAgICAgIHsgc3R5bGU6IHsgbWFyZ2luVG9wOiAxMCB9IH0sXHJcbiAgICAgICAgICAgICAgICAgICAgY2UoV2FpdGFibGVCdXR0b24sIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgd2FpdGluZzogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJ1dHRvblByb3BzOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnc2Vjb25kYXJ5JyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsOiB0aGlzLl9pMThuLnQoJ21iOmNvcHlCb3RMb2dzLnNhdmUnKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s6ICgpID0+IHRoaXMuX2FjdGlvbnMuc2F2ZUxvZ3MoaWQpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICApXHJcbiAgICAgICAgICAgICk7XHJcblxyXG4gICAgICAgIHJldHVybiBkaXYoXHJcbiAgICAgICAgICAgIHt9LFxyXG4gICAgICAgICAgICBjZShXYWl0YWJsZUJ1dHRvbiwge1xyXG4gICAgICAgICAgICAgICAgd2FpdGluZzogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICBidXR0b25Qcm9wczoge1xyXG4gICAgICAgICAgICAgICAgICAgIGRpc2FibGVkLFxyXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6ICdzZWNvbmRhcnknLFxyXG4gICAgICAgICAgICAgICAgICAgIGxhYmVsOiB0aGlzLl9pMThuLnQoJ21iOmNvcHlCb3RMb2dzLmNvcHknKSxcclxuICAgICAgICAgICAgICAgICAgICBvbkNsaWNrOiAoKSA9PiB0aGlzLl9hY3Rpb25zLmNvcHlMb2dzKGlkKSxcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgKTtcclxuICAgIH1cclxuXHJcbiAgICByZW5kZXIoKSB7XHJcbiAgICAgICAgcmV0dXJuIGRpdihcclxuICAgICAgICAgICAgUi5tZXJnZSh0aGlzLnByb3BzLCB7XHJcbiAgICAgICAgICAgICAgICBpZDogJ2NvcHlib3Rsb2dzJyxcclxuICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogYCR7dGhpcy5wcm9wcy5jbGFzc05hbWUgfHwgJ2NvcHlib3Rsb2dzJ30gcHJpbnRlclBhbmVsYCxcclxuICAgICAgICAgICAgICAgIHN0eWxlOiB7IHBvc2l0aW9uOiAncmVsYXRpdmUnLCBoZWlnaHQ6ICcxMDAlJyB9LFxyXG4gICAgICAgICAgICB9KSxcclxuICAgICAgICAgICAgLy8gUEFORUwgSEVBREVSXHJcbiAgICAgICAgICAgIGNlKFBhbmVsSGVhZGVyLCB7XHJcbiAgICAgICAgICAgICAgICB0aXRsZTogdGhpcy5faTE4bi50KCdtYjpjb3B5Qm90TG9ncy50aXRsZScpLFxyXG4gICAgICAgICAgICAgICAgZmx1eDogdGhpcy5wcm9wcy5mbHV4LFxyXG4gICAgICAgICAgICAgICAgcHJpbnRlcjogdGhpcy5wcm9wcy5wcmludGVyLFxyXG4gICAgICAgICAgICAgICAgb25CYWNrOiB0aGlzLnByb3BzLm9uQmFjayxcclxuICAgICAgICAgICAgICAgIG9uQ2xvc2U6IHRoaXMucHJvcHMub25DbG9zZSxcclxuICAgICAgICAgICAgfSksXHJcblxyXG4gICAgICAgICAgICAvLyBQQU5FTCBCT0RZXHJcbiAgICAgICAgICAgIGRpdih7IGNsYXNzTmFtZTogJ3BhbmVsLWJvZHknIH0sIHBTcGxpdCh0aGlzLl9pMThuLnQoJ21iOmNvcHlCb3RMb2dzLmluZm8nKSksIHRoaXMucmVuZGVyQnV0dG9ucygpKSxcclxuXHJcbiAgICAgICAgICAgIC8vIFBBTkVMIEZPT1RFUiBQSUxMXHJcbiAgICAgICAgICAgIGRpdih7IGNsYXNzTmFtZTogJ3ByaW50ZXJQYW5lbCcgfSwgZGl2KHsgc3R5bGU6IHsgbWFyZ2luQm90dG9tOiA1MCB9IH0pKVxyXG4gICAgICAgICk7XHJcbiAgICB9XHJcbn1cclxuXHJcbkNvcHlCb3RMb2dzLnByb3BUeXBlcyA9IHtcclxuICAgIGZsdXg6IFJlYWN0LlByb3BUeXBlcy5vYmplY3QuaXNSZXF1aXJlZCxcclxuICAgIG9uQmFjazogUmVhY3QuUHJvcFR5cGVzLmZ1bmMuaXNSZXF1aXJlZCxcclxuICAgIG9uQ2xvc2U6IFJlYWN0LlByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsXHJcbiAgICBwcmludGVyOiBSZWFjdC5Qcm9wVHlwZXMub2JqZWN0LmlzUmVxdWlyZWQsXHJcbiAgICBjbGFzc05hbWU6IFJlYWN0LlByb3BUeXBlcy5zdHJpbmcsXHJcbn07XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IENvcHlCb3RMb2dzO1xyXG4iXX0=
