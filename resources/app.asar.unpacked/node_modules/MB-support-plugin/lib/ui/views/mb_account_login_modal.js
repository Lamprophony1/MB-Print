'use strict';

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

const FluxComponent = require('eagle-print/views/flux_component');

const React = require('react');

const path = require('path');

const Isvg = require('react-inlinesvg');

const {
  ipcRenderer
} = require('electron');

const pluginName = require('../../../index').pluginName;

const ErrorsEnum = require('../../thingiverse-api-errors').ErrorsEnum;

const ProxySettingsModal = require('./proxySettingsModal');

class MBAccountLoginModal extends FluxComponent {
  constructor(...args) {
    super(...args);

    _defineProperty(this, "state", {
      username: this.props.email || '',
      password: '',
      inProgress: false,
      showProxy: false,

      /**
       * @type {undefined|string}
       */
      lastError: undefined,
      // 'This is a test';
      ssoTimeoutId: undefined
    });

    _defineProperty(this, "trackingService", this.getFlux().getService('TrackingService'));

    _defineProperty(this, "componentWillMount", () => {
      this.getFlux().getService('MenuService').setDisabled(true);
      super.componentWillMount();
      ipcRenderer.on('received-url', this.handleLoginOauthPKCE);
    });

    _defineProperty(this, "componentWillUnmount", () => {
      super.componentWillUnmount();
      this.getFlux().getService('MenuService').setDisabled(false);
      ipcRenderer.removeAllListeners(['received-url']);
    });

    _defineProperty(this, "componentDidMount", () => {
      super.componentDidMount();
      this.refs.emailInput.select();
    });

    _defineProperty(this, "componentDidUpdate", (prevProps, prevState) => {
      // When changing from a non-error state -> error state, focus the username input (i.e. failed login)
      if (this.state.lastError && !prevState.lastError) {
        this.refs.emailInput.select();
      }
    });

    _defineProperty(this, "handleUsernameChange", e => {
      this.setState({
        username: e.target.value
      });
    });

    _defineProperty(this, "handlePasswordChange", e => {
      this.setState({
        password: e.target.value
      });
    });

    _defineProperty(this, "authenticate", (username, password) => {
      const plugin = this.getFlux().getPlugin(pluginName);
      return plugin.authenticate(username, password).then(thingiverseToken => {
        // save out the auth info...this function should eventually save it to the json file
        return plugin.save_auth_info(username, thingiverseToken).then(userInfo => {
          return userInfo;
        });
      });
    });

    _defineProperty(this, "handleLogin", () => {
      const flux = this.getFlux();
      this.setState({
        lastError: undefined
      });

      if (this.validateCredentials()) {
        this.setState({
          inProgress: true
        });
        const log = flux.getService('LoggingService');
        log.debug('Thingiverse sign in request for: ', this.state.username);
        const authenticationPromise = this.authenticate(this.state.username, this.state.password);
        authenticationPromise.then(userInfo => {
          log.info('authenticate success');
          flux.getService('ModalService').hide();
          return userInfo;
        }).catch(err => {
          const i18n = flux.getService('TranslationService');
          let errorMessage;
          this.trackingService.addEvent({
            name: 'Failed Log In'
          });
          log.info('authenticate failed');

          if (err.errorEnum === ErrorsEnum.AccessDenied) {
            log.warn('Login failed because of invalid credentials');
            errorMessage = i18n.t('mb:accountSignIn.mismatch_login_error');
          } else if (err.errorEnum === ErrorsEnum.ConnectionError) {
            log.warn('Login failed because of connection error');
            errorMessage = i18n.t('mb:accountSignIn.connection_login_error');
          } else if (err.errorEnum === ErrorsEnum.MethodNotAllowed) {
            log.warn('Login failed');
            errorMessage = i18n.t('mb:accountSignIn.unknown_login_error');
          } else if (err.errorEnum === ErrorsEnum.FileNotFound) {
            log.warn('File Not Found');
            errorMessage = i18n.t('mb:accountSignIn.not_found');
          } else if (err.errorEnum === ErrorsEnum.ServerError) {
            log.warn('Server Error');
            errorMessage = i18n.t('mb:accountSignIn.server_error');
          } else if (err.errorEnum === ErrorsEnum.ClientError) {
            log.warn('Client Error');
            errorMessage = i18n.t('mb:accountSignIn.client_error');
          } else {
            log.error('Login failed for unknown reason', err);
            errorMessage = i18n.t('mb:accountSignIn.unknown_login_error');
          }

          this.setState({
            inProgress: false,
            lastError: errorMessage
          });

          if (this.props.onAuthenticationError) {
            this.props.onAuthenticationError();
          }
        });
      }
    });

    _defineProperty(this, "handleLoginOauthPKCE", (_event, data) => {
      const mbPlugin = this.getFlux().getPlugin(pluginName);
      const i18n = this.getFlux().getService('TranslationService');
      const ModalService = this.getFlux().getService('ModalService');
      const LoggingService = this.getFlux().getService('LoggingService');
      const urlParams = new URLSearchParams(data);
      const codeValidationRegex = /^[a-zA-Z0-9]{16}$/;
      const code = urlParams.get('code');
      const error = urlParams.get('error');
      let accessToken = '';

      if (error) {
        LoggingService.error('Server Error');
        this.setState({
          inProgress: false,
          lastError: error
        });
        this.props.onAuthenticationError();
      } else {
        // validate the 'code' query param
        if (codeValidationRegex.test(code)) {
          mbPlugin // Request authorization token to MB-Services (tv/reflector)
          ._loginOauthPKCE(code) // Request user info given the access token
          .then(jsonRes => {
            LoggingService.info('authenticate success');
            accessToken = jsonRes.access_token;
            return mbPlugin._thingiverseApiClient.getUser(accessToken);
          }) // Update userinfo and access token within the app
          .then(info => {
            LoggingService.info('get user info success');
            const {
              name
            } = info;
            return mbPlugin.save_auth_info(name, accessToken);
          }) // Close login modal
          .then(() => {
            ModalService.hide();
          }).catch(e => {
            LoggingService.error('Login failed during the Oauth process', e);
            this.setState({
              inProgress: false,
              lastError: i18n.t('mb:accountSignIn.client_error')
            });
            this.props.onAuthenticationError();
          });
        } else {
          LoggingService.error('Unrecognized Code Value Error');
          this.setState({
            inProgress: false,
            lastError: i18n.t('mb:accountSignIn.client_error')
          });
          this.props.onAuthenticationError();
        }
      } // Clear the timeout with the login modal incase
      // if client runs into errors


      const {
        ssoTimeoutId
      } = this.state;
      ssoTimeoutId ? clearTimeout(ssoTimeoutId) : null;
      this.setState({
        ssoTimeoutId: undefined
      });
    });

    _defineProperty(this, "handleKeyDown", e => {
      this.setState({
        lastError: undefined
      });

      if (e.keyCode === 13) {
        this.handleLogin();
      }
    });

    _defineProperty(this, "validateCredentials", () => {
      return this.state.username.length > 0 && this.state.password.length > 0;
    });

    _defineProperty(this, "handleForgottenPassword", () => {
      this.trackingService.addEvent({
        name: 'Forgot Password Hit'
      });
      const forgottenPasswordURL = 'https://accounts.makerbot.com/forgot';

      require('electron').remote.shell.openExternal(forgottenPasswordURL);
    });

    _defineProperty(this, "handleSignup", e => {
      this.trackingService.addEvent({
        name: 'Sign Up Button Hit'
      });
      const signupURL = 'https://accounts.makerbot.com/register?active=1&theme=store&utm_source=mbp&utm_campaign=createaccount';

      require('electron').remote.shell.openExternal(signupURL);
    });

    _defineProperty(this, "handleTerms", e => {
      this.trackingService.addEvent({
        name: 'Terms of Service Hit'
      });
      const signupURL = 'http://www.makerbot.com/legal/terms';

      require('electron').remote.shell.openExternal(signupURL);
    });

    _defineProperty(this, "handlePrivacyPolicy", e => {
      this.trackingService.addEvent({
        name: 'Privacy Policy Hit'
      });
      const signupURL = 'http://www.makerbot.com/legal/privacy';

      require('electron').remote.shell.openExternal(signupURL);
    });

    _defineProperty(this, "handleGoogleSso", () => {
      const i18n = this.getFlux().getService('TranslationService');
      const plugin = this.getFlux().getPlugin(pluginName);

      const signInUrl = plugin._generateOauthAuthReqUrl();

      this.trackingService.addEvent({
        name: 'Google SSO Hit'
      });
      this.setState({
        inProgress: true,
        lastError: undefined
      }); // Set timeout with Google SSO

      const ssoTimeoutId = setTimeout(() => {
        if (this.refs.loginButton) {
          this.setState({
            inProgress: false,
            lastError: i18n.t('mb:accountSignIn.timed_out')
          });
          this.props.onAuthenticationError();
        }
      }, 2 * 60 * 1000);
      this.setState({
        ssoTimeoutId
      });

      require('electron').remote.shell.openExternal(signInUrl);
    });

    _defineProperty(this, "getErrorDiv", () => {
      const width = 25,
            height = 25,
            viewBox = `0 0 ${width} ${height}`;
      return /*#__PURE__*/React.createElement("div", {
        className: "error"
      }, this.state.lastError ? /*#__PURE__*/React.createElement("svg", {
        ref: "errorIcon",
        className: "error-icon",
        width: width,
        height: height,
        viewBox: viewBox
      }, /*#__PURE__*/React.createElement("image", {
        xlinkHref: path.resolve(__dirname, 'images/alert-icon-white.svg'),
        height: height,
        width: width
      })) : null, this.state.lastError ? /*#__PURE__*/React.createElement("span", {
        className: "error-text"
      }, " ", this.state.lastError, " ") : null);
    });

    _defineProperty(this, "renderUsernameField", i18n => {
      return /*#__PURE__*/React.createElement("div", {
        className: `form-group auth-input ${this.state.lastError ? 'has-error' : ''}`
      }, /*#__PURE__*/React.createElement("label", null, (null, i18n.t('mb:accountSignIn.username'))), /*#__PURE__*/React.createElement("input", {
        ref: "emailInput",
        className: `input-text ${this.state.lastError ? 'has-error' : ''}`,
        onChange: this.handleUsernameChange,
        onKeyDown: this.handleKeyDown,
        disabled: this.state.inProgress,
        placeholder: i18n.t('mb:accountSignIn.username'),
        keyboardType: "email-address",
        autoFocus: true
      }));
    });

    _defineProperty(this, "renderPasswordField", i18n => {
      return /*#__PURE__*/React.createElement("div", {
        className: "form-group auth-input "
      }, /*#__PURE__*/React.createElement("label", null, (null, i18n.t('mb:accountSignIn.password'))), /*#__PURE__*/React.createElement("a", {
        onClick: this.handleForgottenPassword,
        className: "forgot-pwd-link"
      }, i18n.t('mb:accountSignIn.forgot_password')), /*#__PURE__*/React.createElement("input", {
        ref: "passwordInput",
        type: "password",
        className: `input-text ${this.state.lastError ? 'has-error' : ''}`,
        onChange: this.handlePasswordChange,
        onKeyDown: this.handleKeyDown,
        placeholder: i18n.t('mb:accountSignIn.password'),
        disabled: this.state.inProgress
      }));
    });

    _defineProperty(this, "renderLinks", i18n => {
      return /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("label", null, (null, i18n.t('mb:accountSignIn.signing_terms_header'))), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("a", {
        onClick: this.handleTerms
      }, i18n.t('mb:accountSignIn.terms_service')), /*#__PURE__*/React.createElement("label", null, (null, ' â€¢ ')), /*#__PURE__*/React.createElement("a", {
        onClick: this.handlePrivacyPolicy
      }, i18n.t('mb:accountSignIn.privacy_policy'))));
    });

    _defineProperty(this, "renderLoginButtonGroup", (i18n, loginButtonClass) => {
      return /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("div", {
        className: "buttonGroup loginButtonGroup"
      }, /*#__PURE__*/React.createElement("button", {
        ref: "loginButton",
        className: loginButtonClass,
        onClick: this.handleLogin,
        disabled: this.state.inProgress
      }, this.state.inProgress ? /*#__PURE__*/React.createElement("div", {
        className: "refreshSpinnerWhite spinning"
      }, /*#__PURE__*/React.createElement(Isvg, {
        src: "icons/spinner-small.svg",
        key: "printerRefreshSpinner"
      })) : i18n.t('mb:accountSignIn.login')), /*#__PURE__*/React.createElement("button", {
        ref: "signupButton",
        className: "button secondary",
        onClick: this.handleSignup
      }, i18n.t('mb:accountSignIn.signup'))), this.renderGoogleSsoButtonGroup(i18n, 'buttonGroup loginButtonGroup'), /*#__PURE__*/React.createElement("div", {
        className: "buttonGroup loginButtonGroup"
      }, /*#__PURE__*/React.createElement("a", {
        onClick: () => this.setState({
          showProxy: true
        })
      }, i18n.t('mb:accountSignIn.proxy_link'))));
    });

    _defineProperty(this, "renderGoogleSsoButtonGroup", (i18n, loginButtonClass) => {
      const googleLogo = path.resolve(__dirname, 'images/google-logo.svg');
      return /*#__PURE__*/React.createElement("section", {
        id: "google-sso",
        className: loginButtonClass
      }, /*#__PURE__*/React.createElement("div", {
        className: "sso-separator"
      }, "or"), /*#__PURE__*/React.createElement("button", {
        id: "google-sso-btn",
        onClick: this.handleGoogleSso,
        disabled: this.state.inProgress
      }, /*#__PURE__*/React.createElement("div", {
        className: "google-sso-btn-content"
      }, /*#__PURE__*/React.createElement("img", {
        src: googleLogo,
        alt: "Google Logo",
        width: "25px"
      }), /*#__PURE__*/React.createElement("span", {
        className: "sso-text"
      }, 'Sign in with Google'))));
    });

    _defineProperty(this, "renderLogin", (i18n, loginButtonClass) => {
      const makerbotLogo = path.resolve(__dirname, 'images/mb_sign_in_logo.svg');
      return /*#__PURE__*/React.createElement("div", this.props, /*#__PURE__*/React.createElement("div", {
        className: "mbLoginModal"
      }, /*#__PURE__*/React.createElement("div", {
        className: "print-logo"
      }, /*#__PURE__*/React.createElement("img", {
        src: makerbotLogo
      }), /*#__PURE__*/React.createElement("label", null, (null, i18n.t('mb:accountSignIn.sign_in')))), this.getErrorDiv(), this.renderUsernameField(i18n), this.renderPasswordField(i18n), this.renderLinks(i18n), this.renderLoginButtonGroup(i18n, loginButtonClass)));
    });

    _defineProperty(this, "render", () => {
      const i18n = this.getFlux().getService('TranslationService');
      let loginButtonClass = 'button primary loginButton';

      if (this.state.showProxy) {
        return /*#__PURE__*/React.createElement(ProxySettingsModal, {
          onDone: () => this.setState({
            showProxy: false
          }),
          flux: this.getFlux()
        });
      }

      if (this.state.inProgress || !this.validateCredentials()) {
        loginButtonClass += ' disabled1';
      }

      return this.renderLogin(i18n, loginButtonClass);
    });
  }

}

MBAccountLoginModal.displayName = 'MBAccountLoginModal';
MBAccountLoginModal.propTypes = {
  onAuthenticationError: React.PropTypes.func
};
module.exports = MBAccountLoginModal;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1iX2FjY291bnRfbG9naW5fbW9kYWwuanMiXSwibmFtZXMiOlsiRmx1eENvbXBvbmVudCIsInJlcXVpcmUiLCJSZWFjdCIsInBhdGgiLCJJc3ZnIiwiaXBjUmVuZGVyZXIiLCJwbHVnaW5OYW1lIiwiRXJyb3JzRW51bSIsIlByb3h5U2V0dGluZ3NNb2RhbCIsIk1CQWNjb3VudExvZ2luTW9kYWwiLCJ1c2VybmFtZSIsInByb3BzIiwiZW1haWwiLCJwYXNzd29yZCIsImluUHJvZ3Jlc3MiLCJzaG93UHJveHkiLCJsYXN0RXJyb3IiLCJ1bmRlZmluZWQiLCJzc29UaW1lb3V0SWQiLCJnZXRGbHV4IiwiZ2V0U2VydmljZSIsInNldERpc2FibGVkIiwiY29tcG9uZW50V2lsbE1vdW50Iiwib24iLCJoYW5kbGVMb2dpbk9hdXRoUEtDRSIsImNvbXBvbmVudFdpbGxVbm1vdW50IiwicmVtb3ZlQWxsTGlzdGVuZXJzIiwiY29tcG9uZW50RGlkTW91bnQiLCJyZWZzIiwiZW1haWxJbnB1dCIsInNlbGVjdCIsInByZXZQcm9wcyIsInByZXZTdGF0ZSIsInN0YXRlIiwiZSIsInNldFN0YXRlIiwidGFyZ2V0IiwidmFsdWUiLCJwbHVnaW4iLCJnZXRQbHVnaW4iLCJhdXRoZW50aWNhdGUiLCJ0aGVuIiwidGhpbmdpdmVyc2VUb2tlbiIsInNhdmVfYXV0aF9pbmZvIiwidXNlckluZm8iLCJmbHV4IiwidmFsaWRhdGVDcmVkZW50aWFscyIsImxvZyIsImRlYnVnIiwiYXV0aGVudGljYXRpb25Qcm9taXNlIiwiaW5mbyIsImhpZGUiLCJjYXRjaCIsImVyciIsImkxOG4iLCJlcnJvck1lc3NhZ2UiLCJ0cmFja2luZ1NlcnZpY2UiLCJhZGRFdmVudCIsIm5hbWUiLCJlcnJvckVudW0iLCJBY2Nlc3NEZW5pZWQiLCJ3YXJuIiwidCIsIkNvbm5lY3Rpb25FcnJvciIsIk1ldGhvZE5vdEFsbG93ZWQiLCJGaWxlTm90Rm91bmQiLCJTZXJ2ZXJFcnJvciIsIkNsaWVudEVycm9yIiwiZXJyb3IiLCJvbkF1dGhlbnRpY2F0aW9uRXJyb3IiLCJfZXZlbnQiLCJkYXRhIiwibWJQbHVnaW4iLCJNb2RhbFNlcnZpY2UiLCJMb2dnaW5nU2VydmljZSIsInVybFBhcmFtcyIsIlVSTFNlYXJjaFBhcmFtcyIsImNvZGVWYWxpZGF0aW9uUmVnZXgiLCJjb2RlIiwiZ2V0IiwiYWNjZXNzVG9rZW4iLCJ0ZXN0IiwiX2xvZ2luT2F1dGhQS0NFIiwianNvblJlcyIsImFjY2Vzc190b2tlbiIsIl90aGluZ2l2ZXJzZUFwaUNsaWVudCIsImdldFVzZXIiLCJjbGVhclRpbWVvdXQiLCJrZXlDb2RlIiwiaGFuZGxlTG9naW4iLCJsZW5ndGgiLCJmb3Jnb3R0ZW5QYXNzd29yZFVSTCIsInJlbW90ZSIsInNoZWxsIiwib3BlbkV4dGVybmFsIiwic2lnbnVwVVJMIiwic2lnbkluVXJsIiwiX2dlbmVyYXRlT2F1dGhBdXRoUmVxVXJsIiwic2V0VGltZW91dCIsImxvZ2luQnV0dG9uIiwid2lkdGgiLCJoZWlnaHQiLCJ2aWV3Qm94IiwicmVzb2x2ZSIsIl9fZGlybmFtZSIsImhhbmRsZVVzZXJuYW1lQ2hhbmdlIiwiaGFuZGxlS2V5RG93biIsImhhbmRsZUZvcmdvdHRlblBhc3N3b3JkIiwiaGFuZGxlUGFzc3dvcmRDaGFuZ2UiLCJoYW5kbGVUZXJtcyIsImhhbmRsZVByaXZhY3lQb2xpY3kiLCJsb2dpbkJ1dHRvbkNsYXNzIiwiaGFuZGxlU2lnbnVwIiwicmVuZGVyR29vZ2xlU3NvQnV0dG9uR3JvdXAiLCJnb29nbGVMb2dvIiwiaGFuZGxlR29vZ2xlU3NvIiwibWFrZXJib3RMb2dvIiwiZ2V0RXJyb3JEaXYiLCJyZW5kZXJVc2VybmFtZUZpZWxkIiwicmVuZGVyUGFzc3dvcmRGaWVsZCIsInJlbmRlckxpbmtzIiwicmVuZGVyTG9naW5CdXR0b25Hcm91cCIsInJlbmRlckxvZ2luIiwiZGlzcGxheU5hbWUiLCJwcm9wVHlwZXMiLCJQcm9wVHlwZXMiLCJmdW5jIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7QUFFQSxNQUFNQSxhQUFhLEdBQUdDLE9BQU8sQ0FBQyxrQ0FBRCxDQUE3Qjs7QUFDQSxNQUFNQyxLQUFLLEdBQUdELE9BQU8sQ0FBQyxPQUFELENBQXJCOztBQUNBLE1BQU1FLElBQUksR0FBR0YsT0FBTyxDQUFDLE1BQUQsQ0FBcEI7O0FBQ0EsTUFBTUcsSUFBSSxHQUFHSCxPQUFPLENBQUMsaUJBQUQsQ0FBcEI7O0FBQ0EsTUFBTTtBQUFFSSxFQUFBQTtBQUFGLElBQWtCSixPQUFPLENBQUMsVUFBRCxDQUEvQjs7QUFFQSxNQUFNSyxVQUFVLEdBQUdMLE9BQU8sQ0FBQyxnQkFBRCxDQUFQLENBQTBCSyxVQUE3Qzs7QUFDQSxNQUFNQyxVQUFVLEdBQUdOLE9BQU8sQ0FBQyw4QkFBRCxDQUFQLENBQXdDTSxVQUEzRDs7QUFDQSxNQUFNQyxrQkFBa0IsR0FBR1AsT0FBTyxDQUFDLHNCQUFELENBQWxDOztBQUVBLE1BQU1RLG1CQUFOLFNBQWtDVCxhQUFsQyxDQUFnRDtBQUFBO0FBQUE7O0FBQUEsbUNBQ3BDO0FBQ0pVLE1BQUFBLFFBQVEsRUFBRSxLQUFLQyxLQUFMLENBQVdDLEtBQVgsSUFBb0IsRUFEMUI7QUFFSkMsTUFBQUEsUUFBUSxFQUFFLEVBRk47QUFHSkMsTUFBQUEsVUFBVSxFQUFFLEtBSFI7QUFJSkMsTUFBQUEsU0FBUyxFQUFFLEtBSlA7O0FBS0o7QUFDUjtBQUNBO0FBQ1FDLE1BQUFBLFNBQVMsRUFBRUMsU0FSUDtBQVFrQjtBQUN0QkMsTUFBQUEsWUFBWSxFQUFFRDtBQVRWLEtBRG9DOztBQUFBLDZDQWExQixLQUFLRSxPQUFMLEdBQWVDLFVBQWYsQ0FBMEIsaUJBQTFCLENBYjBCOztBQUFBLGdEQWV2QixNQUFNO0FBQ3ZCLFdBQUtELE9BQUwsR0FDS0MsVUFETCxDQUNnQixhQURoQixFQUVLQyxXQUZMLENBRWlCLElBRmpCO0FBR0EsWUFBTUMsa0JBQU47QUFDQWpCLE1BQUFBLFdBQVcsQ0FBQ2tCLEVBQVosQ0FBZSxjQUFmLEVBQStCLEtBQUtDLG9CQUFwQztBQUNILEtBckIyQzs7QUFBQSxrREF1QnJCLE1BQU07QUFDekIsWUFBTUMsb0JBQU47QUFDQSxXQUFLTixPQUFMLEdBQ0tDLFVBREwsQ0FDZ0IsYUFEaEIsRUFFS0MsV0FGTCxDQUVpQixLQUZqQjtBQUdBaEIsTUFBQUEsV0FBVyxDQUFDcUIsa0JBQVosQ0FBK0IsQ0FBQyxjQUFELENBQS9CO0FBQ0gsS0E3QjJDOztBQUFBLCtDQStCeEIsTUFBTTtBQUN0QixZQUFNQyxpQkFBTjtBQUNBLFdBQUtDLElBQUwsQ0FBVUMsVUFBVixDQUFxQkMsTUFBckI7QUFDSCxLQWxDMkM7O0FBQUEsZ0RBb0N2QixDQUFDQyxTQUFELEVBQVlDLFNBQVosS0FBMEI7QUFDM0M7QUFDQSxVQUFJLEtBQUtDLEtBQUwsQ0FBV2pCLFNBQVgsSUFBd0IsQ0FBQ2dCLFNBQVMsQ0FBQ2hCLFNBQXZDLEVBQWtEO0FBQzlDLGFBQUtZLElBQUwsQ0FBVUMsVUFBVixDQUFxQkMsTUFBckI7QUFDSDtBQUNKLEtBekMyQzs7QUFBQSxrREEyQ3JCSSxDQUFDLElBQUk7QUFDeEIsV0FBS0MsUUFBTCxDQUFjO0FBQUV6QixRQUFBQSxRQUFRLEVBQUV3QixDQUFDLENBQUNFLE1BQUYsQ0FBU0M7QUFBckIsT0FBZDtBQUNILEtBN0MyQzs7QUFBQSxrREErQ3JCSCxDQUFDLElBQUk7QUFDeEIsV0FBS0MsUUFBTCxDQUFjO0FBQUV0QixRQUFBQSxRQUFRLEVBQUVxQixDQUFDLENBQUNFLE1BQUYsQ0FBU0M7QUFBckIsT0FBZDtBQUNILEtBakQyQzs7QUFBQSwwQ0FtRDdCLENBQUMzQixRQUFELEVBQVdHLFFBQVgsS0FBd0I7QUFDbkMsWUFBTXlCLE1BQU0sR0FBRyxLQUFLbkIsT0FBTCxHQUFlb0IsU0FBZixDQUF5QmpDLFVBQXpCLENBQWY7QUFDQSxhQUFPZ0MsTUFBTSxDQUFDRSxZQUFQLENBQW9COUIsUUFBcEIsRUFBOEJHLFFBQTlCLEVBQXdDNEIsSUFBeEMsQ0FBNkNDLGdCQUFnQixJQUFJO0FBQ3BFO0FBQ0EsZUFBT0osTUFBTSxDQUFDSyxjQUFQLENBQXNCakMsUUFBdEIsRUFBZ0NnQyxnQkFBaEMsRUFBa0RELElBQWxELENBQXVERyxRQUFRLElBQUk7QUFDdEUsaUJBQU9BLFFBQVA7QUFDSCxTQUZNLENBQVA7QUFHSCxPQUxNLENBQVA7QUFNSCxLQTNEMkM7O0FBQUEseUNBNkQ5QixNQUFNO0FBQ2hCLFlBQU1DLElBQUksR0FBRyxLQUFLMUIsT0FBTCxFQUFiO0FBQ0EsV0FBS2dCLFFBQUwsQ0FBYztBQUFFbkIsUUFBQUEsU0FBUyxFQUFFQztBQUFiLE9BQWQ7O0FBQ0EsVUFBSSxLQUFLNkIsbUJBQUwsRUFBSixFQUFnQztBQUM1QixhQUFLWCxRQUFMLENBQWM7QUFBRXJCLFVBQUFBLFVBQVUsRUFBRTtBQUFkLFNBQWQ7QUFFQSxjQUFNaUMsR0FBRyxHQUFHRixJQUFJLENBQUN6QixVQUFMLENBQWdCLGdCQUFoQixDQUFaO0FBQ0EyQixRQUFBQSxHQUFHLENBQUNDLEtBQUosQ0FBVSxtQ0FBVixFQUErQyxLQUFLZixLQUFMLENBQVd2QixRQUExRDtBQUNBLGNBQU11QyxxQkFBcUIsR0FBRyxLQUFLVCxZQUFMLENBQWtCLEtBQUtQLEtBQUwsQ0FBV3ZCLFFBQTdCLEVBQXVDLEtBQUt1QixLQUFMLENBQVdwQixRQUFsRCxDQUE5QjtBQUNBb0MsUUFBQUEscUJBQXFCLENBQ2hCUixJQURMLENBQ1VHLFFBQVEsSUFBSTtBQUNkRyxVQUFBQSxHQUFHLENBQUNHLElBQUosQ0FBUyxzQkFBVDtBQUNBTCxVQUFBQSxJQUFJLENBQUN6QixVQUFMLENBQWdCLGNBQWhCLEVBQWdDK0IsSUFBaEM7QUFDQSxpQkFBT1AsUUFBUDtBQUNILFNBTEwsRUFNS1EsS0FOTCxDQU1XQyxHQUFHLElBQUk7QUFDVixnQkFBTUMsSUFBSSxHQUFHVCxJQUFJLENBQUN6QixVQUFMLENBQWdCLG9CQUFoQixDQUFiO0FBQ0EsY0FBSW1DLFlBQUo7QUFDQSxlQUFLQyxlQUFMLENBQXFCQyxRQUFyQixDQUE4QjtBQUFFQyxZQUFBQSxJQUFJLEVBQUU7QUFBUixXQUE5QjtBQUNBWCxVQUFBQSxHQUFHLENBQUNHLElBQUosQ0FBUyxxQkFBVDs7QUFFQSxjQUFJRyxHQUFHLENBQUNNLFNBQUosS0FBa0JwRCxVQUFVLENBQUNxRCxZQUFqQyxFQUErQztBQUMzQ2IsWUFBQUEsR0FBRyxDQUFDYyxJQUFKLENBQVMsNkNBQVQ7QUFDQU4sWUFBQUEsWUFBWSxHQUFHRCxJQUFJLENBQUNRLENBQUwsQ0FBTyx1Q0FBUCxDQUFmO0FBQ0gsV0FIRCxNQUdPLElBQUlULEdBQUcsQ0FBQ00sU0FBSixLQUFrQnBELFVBQVUsQ0FBQ3dELGVBQWpDLEVBQWtEO0FBQ3JEaEIsWUFBQUEsR0FBRyxDQUFDYyxJQUFKLENBQVMsMENBQVQ7QUFDQU4sWUFBQUEsWUFBWSxHQUFHRCxJQUFJLENBQUNRLENBQUwsQ0FBTyx5Q0FBUCxDQUFmO0FBQ0gsV0FITSxNQUdBLElBQUlULEdBQUcsQ0FBQ00sU0FBSixLQUFrQnBELFVBQVUsQ0FBQ3lELGdCQUFqQyxFQUFtRDtBQUN0RGpCLFlBQUFBLEdBQUcsQ0FBQ2MsSUFBSixDQUFTLGNBQVQ7QUFDQU4sWUFBQUEsWUFBWSxHQUFHRCxJQUFJLENBQUNRLENBQUwsQ0FBTyxzQ0FBUCxDQUFmO0FBQ0gsV0FITSxNQUdBLElBQUlULEdBQUcsQ0FBQ00sU0FBSixLQUFrQnBELFVBQVUsQ0FBQzBELFlBQWpDLEVBQStDO0FBQ2xEbEIsWUFBQUEsR0FBRyxDQUFDYyxJQUFKLENBQVMsZ0JBQVQ7QUFDQU4sWUFBQUEsWUFBWSxHQUFHRCxJQUFJLENBQUNRLENBQUwsQ0FBTyw0QkFBUCxDQUFmO0FBQ0gsV0FITSxNQUdBLElBQUlULEdBQUcsQ0FBQ00sU0FBSixLQUFrQnBELFVBQVUsQ0FBQzJELFdBQWpDLEVBQThDO0FBQ2pEbkIsWUFBQUEsR0FBRyxDQUFDYyxJQUFKLENBQVMsY0FBVDtBQUNBTixZQUFBQSxZQUFZLEdBQUdELElBQUksQ0FBQ1EsQ0FBTCxDQUFPLCtCQUFQLENBQWY7QUFDSCxXQUhNLE1BR0EsSUFBSVQsR0FBRyxDQUFDTSxTQUFKLEtBQWtCcEQsVUFBVSxDQUFDNEQsV0FBakMsRUFBOEM7QUFDakRwQixZQUFBQSxHQUFHLENBQUNjLElBQUosQ0FBUyxjQUFUO0FBQ0FOLFlBQUFBLFlBQVksR0FBR0QsSUFBSSxDQUFDUSxDQUFMLENBQU8sK0JBQVAsQ0FBZjtBQUNILFdBSE0sTUFHQTtBQUNIZixZQUFBQSxHQUFHLENBQUNxQixLQUFKLENBQVUsaUNBQVYsRUFBNkNmLEdBQTdDO0FBQ0FFLFlBQUFBLFlBQVksR0FBR0QsSUFBSSxDQUFDUSxDQUFMLENBQU8sc0NBQVAsQ0FBZjtBQUNIOztBQUNELGVBQUszQixRQUFMLENBQWM7QUFBRXJCLFlBQUFBLFVBQVUsRUFBRSxLQUFkO0FBQXFCRSxZQUFBQSxTQUFTLEVBQUV1QztBQUFoQyxXQUFkOztBQUVBLGNBQUksS0FBSzVDLEtBQUwsQ0FBVzBELHFCQUFmLEVBQXNDO0FBQ2xDLGlCQUFLMUQsS0FBTCxDQUFXMEQscUJBQVg7QUFDSDtBQUNKLFNBdkNMO0FBd0NIO0FBQ0osS0EvRzJDOztBQUFBLGtEQWlIckIsQ0FBQ0MsTUFBRCxFQUFTQyxJQUFULEtBQWtCO0FBQ3JDLFlBQU1DLFFBQVEsR0FBRyxLQUFLckQsT0FBTCxHQUFlb0IsU0FBZixDQUF5QmpDLFVBQXpCLENBQWpCO0FBQ0EsWUFBTWdELElBQUksR0FBRyxLQUFLbkMsT0FBTCxHQUFlQyxVQUFmLENBQTBCLG9CQUExQixDQUFiO0FBQ0EsWUFBTXFELFlBQVksR0FBRyxLQUFLdEQsT0FBTCxHQUFlQyxVQUFmLENBQTBCLGNBQTFCLENBQXJCO0FBQ0EsWUFBTXNELGNBQWMsR0FBRyxLQUFLdkQsT0FBTCxHQUFlQyxVQUFmLENBQTBCLGdCQUExQixDQUF2QjtBQUNBLFlBQU11RCxTQUFTLEdBQUcsSUFBSUMsZUFBSixDQUFvQkwsSUFBcEIsQ0FBbEI7QUFDQSxZQUFNTSxtQkFBbUIsR0FBRyxtQkFBNUI7QUFDQSxZQUFNQyxJQUFJLEdBQUdILFNBQVMsQ0FBQ0ksR0FBVixDQUFjLE1BQWQsQ0FBYjtBQUNBLFlBQU1YLEtBQUssR0FBR08sU0FBUyxDQUFDSSxHQUFWLENBQWMsT0FBZCxDQUFkO0FBQ0EsVUFBSUMsV0FBVyxHQUFHLEVBQWxCOztBQUVBLFVBQUlaLEtBQUosRUFBVztBQUNQTSxRQUFBQSxjQUFjLENBQUNOLEtBQWYsQ0FBcUIsY0FBckI7QUFDQSxhQUFLakMsUUFBTCxDQUFjO0FBQUVyQixVQUFBQSxVQUFVLEVBQUUsS0FBZDtBQUFxQkUsVUFBQUEsU0FBUyxFQUFFb0Q7QUFBaEMsU0FBZDtBQUNBLGFBQUt6RCxLQUFMLENBQVcwRCxxQkFBWDtBQUNILE9BSkQsTUFJTztBQUNIO0FBQ0EsWUFBSVEsbUJBQW1CLENBQUNJLElBQXBCLENBQXlCSCxJQUF6QixDQUFKLEVBQW9DO0FBQ2hDTixVQUFBQSxRQUFRLENBQ0o7QUFESSxXQUVIVSxlQUZMLENBRXFCSixJQUZyQixFQUdJO0FBSEosV0FJS3JDLElBSkwsQ0FJVTBDLE9BQU8sSUFBSTtBQUNiVCxZQUFBQSxjQUFjLENBQUN4QixJQUFmLENBQW9CLHNCQUFwQjtBQUNBOEIsWUFBQUEsV0FBVyxHQUFHRyxPQUFPLENBQUNDLFlBQXRCO0FBRUEsbUJBQU9aLFFBQVEsQ0FBQ2EscUJBQVQsQ0FBK0JDLE9BQS9CLENBQXVDTixXQUF2QyxDQUFQO0FBQ0gsV0FUTCxFQVVJO0FBVkosV0FXS3ZDLElBWEwsQ0FXVVMsSUFBSSxJQUFJO0FBQ1Z3QixZQUFBQSxjQUFjLENBQUN4QixJQUFmLENBQW9CLHVCQUFwQjtBQUNBLGtCQUFNO0FBQUVRLGNBQUFBO0FBQUYsZ0JBQVdSLElBQWpCO0FBRUEsbUJBQU9zQixRQUFRLENBQUM3QixjQUFULENBQXdCZSxJQUF4QixFQUE4QnNCLFdBQTlCLENBQVA7QUFDSCxXQWhCTCxFQWlCSTtBQWpCSixXQWtCS3ZDLElBbEJMLENBa0JVLE1BQU07QUFDUmdDLFlBQUFBLFlBQVksQ0FBQ3RCLElBQWI7QUFDSCxXQXBCTCxFQXFCS0MsS0FyQkwsQ0FxQldsQixDQUFDLElBQUk7QUFDUndDLFlBQUFBLGNBQWMsQ0FBQ04sS0FBZixDQUFxQix1Q0FBckIsRUFBOERsQyxDQUE5RDtBQUNBLGlCQUFLQyxRQUFMLENBQWM7QUFBRXJCLGNBQUFBLFVBQVUsRUFBRSxLQUFkO0FBQXFCRSxjQUFBQSxTQUFTLEVBQUVzQyxJQUFJLENBQUNRLENBQUwsQ0FBTywrQkFBUDtBQUFoQyxhQUFkO0FBQ0EsaUJBQUtuRCxLQUFMLENBQVcwRCxxQkFBWDtBQUNILFdBekJMO0FBMEJILFNBM0JELE1BMkJPO0FBQ0hLLFVBQUFBLGNBQWMsQ0FBQ04sS0FBZixDQUFxQiwrQkFBckI7QUFDQSxlQUFLakMsUUFBTCxDQUFjO0FBQUVyQixZQUFBQSxVQUFVLEVBQUUsS0FBZDtBQUFxQkUsWUFBQUEsU0FBUyxFQUFFc0MsSUFBSSxDQUFDUSxDQUFMLENBQU8sK0JBQVA7QUFBaEMsV0FBZDtBQUNBLGVBQUtuRCxLQUFMLENBQVcwRCxxQkFBWDtBQUNIO0FBQ0osT0FqRG9DLENBbURyQztBQUNBOzs7QUFDQSxZQUFNO0FBQUVuRCxRQUFBQTtBQUFGLFVBQW1CLEtBQUtlLEtBQTlCO0FBQ0FmLE1BQUFBLFlBQVksR0FBR3FFLFlBQVksQ0FBQ3JFLFlBQUQsQ0FBZixHQUFnQyxJQUE1QztBQUNBLFdBQUtpQixRQUFMLENBQWM7QUFBRWpCLFFBQUFBLFlBQVksRUFBRUQ7QUFBaEIsT0FBZDtBQUNILEtBeksyQzs7QUFBQSwyQ0EySzVCaUIsQ0FBQyxJQUFJO0FBQ2pCLFdBQUtDLFFBQUwsQ0FBYztBQUFFbkIsUUFBQUEsU0FBUyxFQUFFQztBQUFiLE9BQWQ7O0FBQ0EsVUFBSWlCLENBQUMsQ0FBQ3NELE9BQUYsS0FBYyxFQUFsQixFQUFzQjtBQUNsQixhQUFLQyxXQUFMO0FBQ0g7QUFDSixLQWhMMkM7O0FBQUEsaURBa0x0QixNQUFNO0FBQ3hCLGFBQU8sS0FBS3hELEtBQUwsQ0FBV3ZCLFFBQVgsQ0FBb0JnRixNQUFwQixHQUE2QixDQUE3QixJQUFrQyxLQUFLekQsS0FBTCxDQUFXcEIsUUFBWCxDQUFvQjZFLE1BQXBCLEdBQTZCLENBQXRFO0FBQ0gsS0FwTDJDOztBQUFBLHFEQXNMbEIsTUFBTTtBQUM1QixXQUFLbEMsZUFBTCxDQUFxQkMsUUFBckIsQ0FBOEI7QUFBRUMsUUFBQUEsSUFBSSxFQUFFO0FBQVIsT0FBOUI7QUFDQSxZQUFNaUMsb0JBQW9CLEdBQUcsc0NBQTdCOztBQUNBMUYsTUFBQUEsT0FBTyxDQUFDLFVBQUQsQ0FBUCxDQUFvQjJGLE1BQXBCLENBQTJCQyxLQUEzQixDQUFpQ0MsWUFBakMsQ0FBOENILG9CQUE5QztBQUNILEtBMUwyQzs7QUFBQSwwQ0E0TDdCekQsQ0FBQyxJQUFJO0FBQ2hCLFdBQUtzQixlQUFMLENBQXFCQyxRQUFyQixDQUE4QjtBQUFFQyxRQUFBQSxJQUFJLEVBQUU7QUFBUixPQUE5QjtBQUNBLFlBQU1xQyxTQUFTLEdBQ1gsdUdBREo7O0FBRUE5RixNQUFBQSxPQUFPLENBQUMsVUFBRCxDQUFQLENBQW9CMkYsTUFBcEIsQ0FBMkJDLEtBQTNCLENBQWlDQyxZQUFqQyxDQUE4Q0MsU0FBOUM7QUFDSCxLQWpNMkM7O0FBQUEseUNBbU05QjdELENBQUMsSUFBSTtBQUNmLFdBQUtzQixlQUFMLENBQXFCQyxRQUFyQixDQUE4QjtBQUFFQyxRQUFBQSxJQUFJLEVBQUU7QUFBUixPQUE5QjtBQUNBLFlBQU1xQyxTQUFTLEdBQUcscUNBQWxCOztBQUNBOUYsTUFBQUEsT0FBTyxDQUFDLFVBQUQsQ0FBUCxDQUFvQjJGLE1BQXBCLENBQTJCQyxLQUEzQixDQUFpQ0MsWUFBakMsQ0FBOENDLFNBQTlDO0FBQ0gsS0F2TTJDOztBQUFBLGlEQXlNdEI3RCxDQUFDLElBQUk7QUFDdkIsV0FBS3NCLGVBQUwsQ0FBcUJDLFFBQXJCLENBQThCO0FBQUVDLFFBQUFBLElBQUksRUFBRTtBQUFSLE9BQTlCO0FBQ0EsWUFBTXFDLFNBQVMsR0FBRyx1Q0FBbEI7O0FBQ0E5RixNQUFBQSxPQUFPLENBQUMsVUFBRCxDQUFQLENBQW9CMkYsTUFBcEIsQ0FBMkJDLEtBQTNCLENBQWlDQyxZQUFqQyxDQUE4Q0MsU0FBOUM7QUFDSCxLQTdNMkM7O0FBQUEsNkNBK00xQixNQUFNO0FBQ3BCLFlBQU16QyxJQUFJLEdBQUcsS0FBS25DLE9BQUwsR0FBZUMsVUFBZixDQUEwQixvQkFBMUIsQ0FBYjtBQUNBLFlBQU1rQixNQUFNLEdBQUcsS0FBS25CLE9BQUwsR0FBZW9CLFNBQWYsQ0FBeUJqQyxVQUF6QixDQUFmOztBQUNBLFlBQU0wRixTQUFTLEdBQUcxRCxNQUFNLENBQUMyRCx3QkFBUCxFQUFsQjs7QUFFQSxXQUFLekMsZUFBTCxDQUFxQkMsUUFBckIsQ0FBOEI7QUFBRUMsUUFBQUEsSUFBSSxFQUFFO0FBQVIsT0FBOUI7QUFDQSxXQUFLdkIsUUFBTCxDQUFjO0FBQUVyQixRQUFBQSxVQUFVLEVBQUUsSUFBZDtBQUFvQkUsUUFBQUEsU0FBUyxFQUFFQztBQUEvQixPQUFkLEVBTm9CLENBUXBCOztBQUNBLFlBQU1DLFlBQVksR0FBR2dGLFVBQVUsQ0FBQyxNQUFNO0FBQ2xDLFlBQUksS0FBS3RFLElBQUwsQ0FBVXVFLFdBQWQsRUFBMkI7QUFDdkIsZUFBS2hFLFFBQUwsQ0FBYztBQUFFckIsWUFBQUEsVUFBVSxFQUFFLEtBQWQ7QUFBcUJFLFlBQUFBLFNBQVMsRUFBRXNDLElBQUksQ0FBQ1EsQ0FBTCxDQUFPLDRCQUFQO0FBQWhDLFdBQWQ7QUFDQSxlQUFLbkQsS0FBTCxDQUFXMEQscUJBQVg7QUFDSDtBQUNKLE9BTDhCLEVBSzVCLElBQUksRUFBSixHQUFTLElBTG1CLENBQS9CO0FBTUEsV0FBS2xDLFFBQUwsQ0FBYztBQUFFakIsUUFBQUE7QUFBRixPQUFkOztBQUVBakIsTUFBQUEsT0FBTyxDQUFDLFVBQUQsQ0FBUCxDQUFvQjJGLE1BQXBCLENBQTJCQyxLQUEzQixDQUFpQ0MsWUFBakMsQ0FBOENFLFNBQTlDO0FBQ0gsS0FqTzJDOztBQUFBLHlDQW1POUIsTUFBTTtBQUNoQixZQUFNSSxLQUFLLEdBQUcsRUFBZDtBQUFBLFlBQ0lDLE1BQU0sR0FBRyxFQURiO0FBQUEsWUFFSUMsT0FBTyxHQUFJLE9BQU1GLEtBQU0sSUFBR0MsTUFBTyxFQUZyQztBQUlBLDBCQUNJO0FBQUssUUFBQSxTQUFTLEVBQUM7QUFBZixTQUNLLEtBQUtwRSxLQUFMLENBQVdqQixTQUFYLGdCQUNHO0FBQUssUUFBQSxHQUFHLEVBQUMsV0FBVDtBQUFxQixRQUFBLFNBQVMsRUFBQyxZQUEvQjtBQUE0QyxRQUFBLEtBQUssRUFBRW9GLEtBQW5EO0FBQTBELFFBQUEsTUFBTSxFQUFFQyxNQUFsRTtBQUEwRSxRQUFBLE9BQU8sRUFBRUM7QUFBbkYsc0JBQ0k7QUFDSSxRQUFBLFNBQVMsRUFBRW5HLElBQUksQ0FBQ29HLE9BQUwsQ0FBYUMsU0FBYixFQUF3Qiw2QkFBeEIsQ0FEZjtBQUVJLFFBQUEsTUFBTSxFQUFFSCxNQUZaO0FBR0ksUUFBQSxLQUFLLEVBQUVEO0FBSFgsUUFESixDQURILEdBUUcsSUFUUixFQVVLLEtBQUtuRSxLQUFMLENBQVdqQixTQUFYLGdCQUF1QjtBQUFNLFFBQUEsU0FBUyxFQUFDO0FBQWhCLGNBQStCLEtBQUtpQixLQUFMLENBQVdqQixTQUExQyxNQUF2QixHQUFzRixJQVYzRixDQURKO0FBY0gsS0F0UDJDOztBQUFBLGlEQXdQdEJzQyxJQUFJLElBQUk7QUFDMUIsMEJBQ0k7QUFBSyxRQUFBLFNBQVMsRUFBRyx5QkFBd0IsS0FBS3JCLEtBQUwsQ0FBV2pCLFNBQVgsR0FBdUIsV0FBdkIsR0FBcUMsRUFBRztBQUFqRixzQkFDSSxvQ0FBUyxNQUFNc0MsSUFBSSxDQUFDUSxDQUFMLENBQU8sMkJBQVAsQ0FBZixFQURKLGVBRUk7QUFDSSxRQUFBLEdBQUcsRUFBQyxZQURSO0FBRUksUUFBQSxTQUFTLEVBQUcsY0FBYSxLQUFLN0IsS0FBTCxDQUFXakIsU0FBWCxHQUF1QixXQUF2QixHQUFxQyxFQUFHLEVBRnJFO0FBR0ksUUFBQSxRQUFRLEVBQUUsS0FBS3lGLG9CQUhuQjtBQUlJLFFBQUEsU0FBUyxFQUFFLEtBQUtDLGFBSnBCO0FBS0ksUUFBQSxRQUFRLEVBQUUsS0FBS3pFLEtBQUwsQ0FBV25CLFVBTHpCO0FBTUksUUFBQSxXQUFXLEVBQUV3QyxJQUFJLENBQUNRLENBQUwsQ0FBTywyQkFBUCxDQU5qQjtBQU9JLFFBQUEsWUFBWSxFQUFDLGVBUGpCO0FBUUksUUFBQSxTQUFTLEVBQUU7QUFSZixRQUZKLENBREo7QUFlSCxLQXhRMkM7O0FBQUEsaURBMFF0QlIsSUFBSSxJQUFJO0FBQzFCLDBCQUNJO0FBQUssUUFBQSxTQUFTLEVBQUM7QUFBZixzQkFDSSxvQ0FBUyxNQUFNQSxJQUFJLENBQUNRLENBQUwsQ0FBTywyQkFBUCxDQUFmLEVBREosZUFFSTtBQUFHLFFBQUEsT0FBTyxFQUFFLEtBQUs2Qyx1QkFBakI7QUFBMEMsUUFBQSxTQUFTLEVBQUM7QUFBcEQsU0FDS3JELElBQUksQ0FBQ1EsQ0FBTCxDQUFPLGtDQUFQLENBREwsQ0FGSixlQUtJO0FBQ0ksUUFBQSxHQUFHLEVBQUMsZUFEUjtBQUVJLFFBQUEsSUFBSSxFQUFDLFVBRlQ7QUFHSSxRQUFBLFNBQVMsRUFBRyxjQUFhLEtBQUs3QixLQUFMLENBQVdqQixTQUFYLEdBQXVCLFdBQXZCLEdBQXFDLEVBQUcsRUFIckU7QUFJSSxRQUFBLFFBQVEsRUFBRSxLQUFLNEYsb0JBSm5CO0FBS0ksUUFBQSxTQUFTLEVBQUUsS0FBS0YsYUFMcEI7QUFNSSxRQUFBLFdBQVcsRUFBRXBELElBQUksQ0FBQ1EsQ0FBTCxDQUFPLDJCQUFQLENBTmpCO0FBT0ksUUFBQSxRQUFRLEVBQUUsS0FBSzdCLEtBQUwsQ0FBV25CO0FBUHpCLFFBTEosQ0FESjtBQWlCSCxLQTVSMkM7O0FBQUEseUNBOFI5QndDLElBQUksSUFBSTtBQUNsQiwwQkFDSSw4Q0FDSSxvQ0FBUyxNQUFNQSxJQUFJLENBQUNRLENBQUwsQ0FBTyx1Q0FBUCxDQUFmLEVBREosZUFFSSw4Q0FDSTtBQUFHLFFBQUEsT0FBTyxFQUFFLEtBQUsrQztBQUFqQixTQUErQnZELElBQUksQ0FBQ1EsQ0FBTCxDQUFPLGdDQUFQLENBQS9CLENBREosZUFFSSxvQ0FBUyxNQUFNLEtBQWYsRUFGSixlQUdJO0FBQUcsUUFBQSxPQUFPLEVBQUUsS0FBS2dEO0FBQWpCLFNBQXVDeEQsSUFBSSxDQUFDUSxDQUFMLENBQU8saUNBQVAsQ0FBdkMsQ0FISixDQUZKLENBREo7QUFVSCxLQXpTMkM7O0FBQUEsb0RBMlNuQixDQUFDUixJQUFELEVBQU95RCxnQkFBUCxLQUE0QjtBQUNqRCwwQkFDSSw4Q0FDSTtBQUFLLFFBQUEsU0FBUyxFQUFDO0FBQWYsc0JBQ0k7QUFDSSxRQUFBLEdBQUcsRUFBQyxhQURSO0FBRUksUUFBQSxTQUFTLEVBQUVBLGdCQUZmO0FBR0ksUUFBQSxPQUFPLEVBQUUsS0FBS3RCLFdBSGxCO0FBSUksUUFBQSxRQUFRLEVBQUUsS0FBS3hELEtBQUwsQ0FBV25CO0FBSnpCLFNBTUssS0FBS21CLEtBQUwsQ0FBV25CLFVBQVgsZ0JBQ0c7QUFBSyxRQUFBLFNBQVMsRUFBQztBQUFmLHNCQUNJLG9CQUFDLElBQUQ7QUFBTSxRQUFBLEdBQUcsRUFBQyx5QkFBVjtBQUFvQyxRQUFBLEdBQUcsRUFBQztBQUF4QyxRQURKLENBREgsR0FLR3dDLElBQUksQ0FBQ1EsQ0FBTCxDQUFPLHdCQUFQLENBWFIsQ0FESixlQWVJO0FBQVEsUUFBQSxHQUFHLEVBQUMsY0FBWjtBQUEyQixRQUFBLFNBQVMsRUFBQyxrQkFBckM7QUFBd0QsUUFBQSxPQUFPLEVBQUUsS0FBS2tEO0FBQXRFLFNBQ0sxRCxJQUFJLENBQUNRLENBQUwsQ0FBTyx5QkFBUCxDQURMLENBZkosQ0FESixFQW9CSyxLQUFLbUQsMEJBQUwsQ0FBZ0MzRCxJQUFoQyxFQUFzQyw4QkFBdEMsQ0FwQkwsZUFxQkk7QUFBSyxRQUFBLFNBQVMsRUFBQztBQUFmLHNCQUNJO0FBQUcsUUFBQSxPQUFPLEVBQUUsTUFBTSxLQUFLbkIsUUFBTCxDQUFjO0FBQUVwQixVQUFBQSxTQUFTLEVBQUU7QUFBYixTQUFkO0FBQWxCLFNBQXVEdUMsSUFBSSxDQUFDUSxDQUFMLENBQU8sNkJBQVAsQ0FBdkQsQ0FESixDQXJCSixDQURKO0FBMkJILEtBdlUyQzs7QUFBQSx3REF5VWYsQ0FBQ1IsSUFBRCxFQUFPeUQsZ0JBQVAsS0FBNEI7QUFDckQsWUFBTUcsVUFBVSxHQUFHL0csSUFBSSxDQUFDb0csT0FBTCxDQUFhQyxTQUFiLEVBQXdCLHdCQUF4QixDQUFuQjtBQUVBLDBCQUNJO0FBQVMsUUFBQSxFQUFFLEVBQUMsWUFBWjtBQUF5QixRQUFBLFNBQVMsRUFBRU87QUFBcEMsc0JBQ0k7QUFBSyxRQUFBLFNBQVMsRUFBQztBQUFmLGNBREosZUFFSTtBQUFRLFFBQUEsRUFBRSxFQUFDLGdCQUFYO0FBQTRCLFFBQUEsT0FBTyxFQUFFLEtBQUtJLGVBQTFDO0FBQTJELFFBQUEsUUFBUSxFQUFFLEtBQUtsRixLQUFMLENBQVduQjtBQUFoRixzQkFDSTtBQUFLLFFBQUEsU0FBUyxFQUFDO0FBQWYsc0JBQ0k7QUFBSyxRQUFBLEdBQUcsRUFBRW9HLFVBQVY7QUFBc0IsUUFBQSxHQUFHLEVBQUMsYUFBMUI7QUFBd0MsUUFBQSxLQUFLLEVBQUM7QUFBOUMsUUFESixlQUVJO0FBQU0sUUFBQSxTQUFTLEVBQUM7QUFBaEIsU0FBNEIscUJBQTVCLENBRkosQ0FESixDQUZKLENBREo7QUFXSCxLQXZWMkM7O0FBQUEseUNBeVY5QixDQUFDNUQsSUFBRCxFQUFPeUQsZ0JBQVAsS0FBNEI7QUFDdEMsWUFBTUssWUFBWSxHQUFHakgsSUFBSSxDQUFDb0csT0FBTCxDQUFhQyxTQUFiLEVBQXdCLDRCQUF4QixDQUFyQjtBQUVBLDBCQUNJLDJCQUFTLEtBQUs3RixLQUFkLGVBQ0k7QUFBSyxRQUFBLFNBQVMsRUFBQztBQUFmLHNCQUNJO0FBQUssUUFBQSxTQUFTLEVBQUM7QUFBZixzQkFDSTtBQUFLLFFBQUEsR0FBRyxFQUFFeUc7QUFBVixRQURKLGVBRUksb0NBQVMsTUFBTTlELElBQUksQ0FBQ1EsQ0FBTCxDQUFPLDBCQUFQLENBQWYsRUFGSixDQURKLEVBS0ssS0FBS3VELFdBQUwsRUFMTCxFQU1LLEtBQUtDLG1CQUFMLENBQXlCaEUsSUFBekIsQ0FOTCxFQU9LLEtBQUtpRSxtQkFBTCxDQUF5QmpFLElBQXpCLENBUEwsRUFRSyxLQUFLa0UsV0FBTCxDQUFpQmxFLElBQWpCLENBUkwsRUFTSyxLQUFLbUUsc0JBQUwsQ0FBNEJuRSxJQUE1QixFQUFrQ3lELGdCQUFsQyxDQVRMLENBREosQ0FESjtBQWVILEtBM1cyQzs7QUFBQSxvQ0E2V25DLE1BQU07QUFDWCxZQUFNekQsSUFBSSxHQUFHLEtBQUtuQyxPQUFMLEdBQWVDLFVBQWYsQ0FBMEIsb0JBQTFCLENBQWI7QUFDQSxVQUFJMkYsZ0JBQWdCLEdBQUcsNEJBQXZCOztBQUVBLFVBQUksS0FBSzlFLEtBQUwsQ0FBV2xCLFNBQWYsRUFBMEI7QUFDdEIsNEJBQU8sb0JBQUMsa0JBQUQ7QUFBb0IsVUFBQSxNQUFNLEVBQUUsTUFBTSxLQUFLb0IsUUFBTCxDQUFjO0FBQUVwQixZQUFBQSxTQUFTLEVBQUU7QUFBYixXQUFkLENBQWxDO0FBQXVFLFVBQUEsSUFBSSxFQUFFLEtBQUtJLE9BQUw7QUFBN0UsVUFBUDtBQUNIOztBQUVELFVBQUksS0FBS2MsS0FBTCxDQUFXbkIsVUFBWCxJQUF5QixDQUFDLEtBQUtnQyxtQkFBTCxFQUE5QixFQUEwRDtBQUN0RGlFLFFBQUFBLGdCQUFnQixJQUFJLFlBQXBCO0FBQ0g7O0FBRUQsYUFBTyxLQUFLVyxXQUFMLENBQWlCcEUsSUFBakIsRUFBdUJ5RCxnQkFBdkIsQ0FBUDtBQUNILEtBMVgyQztBQUFBOztBQUFBOztBQTZYaER0RyxtQkFBbUIsQ0FBQ2tILFdBQXBCLEdBQWtDLHFCQUFsQztBQUNBbEgsbUJBQW1CLENBQUNtSCxTQUFwQixHQUFnQztBQUM1QnZELEVBQUFBLHFCQUFxQixFQUFFbkUsS0FBSyxDQUFDMkgsU0FBTixDQUFnQkM7QUFEWCxDQUFoQztBQUlBQyxNQUFNLENBQUNDLE9BQVAsR0FBaUJ2SCxtQkFBakIiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XHJcblxyXG5jb25zdCBGbHV4Q29tcG9uZW50ID0gcmVxdWlyZSgnZWFnbGUtcHJpbnQvdmlld3MvZmx1eF9jb21wb25lbnQnKTtcclxuY29uc3QgUmVhY3QgPSByZXF1aXJlKCdyZWFjdCcpO1xyXG5jb25zdCBwYXRoID0gcmVxdWlyZSgncGF0aCcpO1xyXG5jb25zdCBJc3ZnID0gcmVxdWlyZSgncmVhY3QtaW5saW5lc3ZnJyk7XHJcbmNvbnN0IHsgaXBjUmVuZGVyZXIgfSA9IHJlcXVpcmUoJ2VsZWN0cm9uJyk7XHJcblxyXG5jb25zdCBwbHVnaW5OYW1lID0gcmVxdWlyZSgnLi4vLi4vLi4vaW5kZXgnKS5wbHVnaW5OYW1lO1xyXG5jb25zdCBFcnJvcnNFbnVtID0gcmVxdWlyZSgnLi4vLi4vdGhpbmdpdmVyc2UtYXBpLWVycm9ycycpLkVycm9yc0VudW07XHJcbmNvbnN0IFByb3h5U2V0dGluZ3NNb2RhbCA9IHJlcXVpcmUoJy4vcHJveHlTZXR0aW5nc01vZGFsJyk7XHJcblxyXG5jbGFzcyBNQkFjY291bnRMb2dpbk1vZGFsIGV4dGVuZHMgRmx1eENvbXBvbmVudCB7XHJcbiAgICBzdGF0ZSA9IHtcclxuICAgICAgICB1c2VybmFtZTogdGhpcy5wcm9wcy5lbWFpbCB8fCAnJyxcclxuICAgICAgICBwYXNzd29yZDogJycsXHJcbiAgICAgICAgaW5Qcm9ncmVzczogZmFsc2UsXHJcbiAgICAgICAgc2hvd1Byb3h5OiBmYWxzZSxcclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBAdHlwZSB7dW5kZWZpbmVkfHN0cmluZ31cclxuICAgICAgICAgKi9cclxuICAgICAgICBsYXN0RXJyb3I6IHVuZGVmaW5lZCwgLy8gJ1RoaXMgaXMgYSB0ZXN0JztcclxuICAgICAgICBzc29UaW1lb3V0SWQ6IHVuZGVmaW5lZCxcclxuICAgIH07XHJcblxyXG4gICAgdHJhY2tpbmdTZXJ2aWNlID0gdGhpcy5nZXRGbHV4KCkuZ2V0U2VydmljZSgnVHJhY2tpbmdTZXJ2aWNlJyk7XHJcblxyXG4gICAgY29tcG9uZW50V2lsbE1vdW50ID0gKCkgPT4ge1xyXG4gICAgICAgIHRoaXMuZ2V0Rmx1eCgpXHJcbiAgICAgICAgICAgIC5nZXRTZXJ2aWNlKCdNZW51U2VydmljZScpXHJcbiAgICAgICAgICAgIC5zZXREaXNhYmxlZCh0cnVlKTtcclxuICAgICAgICBzdXBlci5jb21wb25lbnRXaWxsTW91bnQoKTtcclxuICAgICAgICBpcGNSZW5kZXJlci5vbigncmVjZWl2ZWQtdXJsJywgdGhpcy5oYW5kbGVMb2dpbk9hdXRoUEtDRSk7XHJcbiAgICB9O1xyXG5cclxuICAgIGNvbXBvbmVudFdpbGxVbm1vdW50ID0gKCkgPT4ge1xyXG4gICAgICAgIHN1cGVyLmNvbXBvbmVudFdpbGxVbm1vdW50KCk7XHJcbiAgICAgICAgdGhpcy5nZXRGbHV4KClcclxuICAgICAgICAgICAgLmdldFNlcnZpY2UoJ01lbnVTZXJ2aWNlJylcclxuICAgICAgICAgICAgLnNldERpc2FibGVkKGZhbHNlKTtcclxuICAgICAgICBpcGNSZW5kZXJlci5yZW1vdmVBbGxMaXN0ZW5lcnMoWydyZWNlaXZlZC11cmwnXSk7XHJcbiAgICB9O1xyXG5cclxuICAgIGNvbXBvbmVudERpZE1vdW50ID0gKCkgPT4ge1xyXG4gICAgICAgIHN1cGVyLmNvbXBvbmVudERpZE1vdW50KCk7XHJcbiAgICAgICAgdGhpcy5yZWZzLmVtYWlsSW5wdXQuc2VsZWN0KCk7XHJcbiAgICB9O1xyXG5cclxuICAgIGNvbXBvbmVudERpZFVwZGF0ZSA9IChwcmV2UHJvcHMsIHByZXZTdGF0ZSkgPT4ge1xyXG4gICAgICAgIC8vIFdoZW4gY2hhbmdpbmcgZnJvbSBhIG5vbi1lcnJvciBzdGF0ZSAtPiBlcnJvciBzdGF0ZSwgZm9jdXMgdGhlIHVzZXJuYW1lIGlucHV0IChpLmUuIGZhaWxlZCBsb2dpbilcclxuICAgICAgICBpZiAodGhpcy5zdGF0ZS5sYXN0RXJyb3IgJiYgIXByZXZTdGF0ZS5sYXN0RXJyb3IpIHtcclxuICAgICAgICAgICAgdGhpcy5yZWZzLmVtYWlsSW5wdXQuc2VsZWN0KCk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICBoYW5kbGVVc2VybmFtZUNoYW5nZSA9IGUgPT4ge1xyXG4gICAgICAgIHRoaXMuc2V0U3RhdGUoeyB1c2VybmFtZTogZS50YXJnZXQudmFsdWUgfSk7XHJcbiAgICB9O1xyXG5cclxuICAgIGhhbmRsZVBhc3N3b3JkQ2hhbmdlID0gZSA9PiB7XHJcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IHBhc3N3b3JkOiBlLnRhcmdldC52YWx1ZSB9KTtcclxuICAgIH07XHJcblxyXG4gICAgYXV0aGVudGljYXRlID0gKHVzZXJuYW1lLCBwYXNzd29yZCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IHBsdWdpbiA9IHRoaXMuZ2V0Rmx1eCgpLmdldFBsdWdpbihwbHVnaW5OYW1lKTtcclxuICAgICAgICByZXR1cm4gcGx1Z2luLmF1dGhlbnRpY2F0ZSh1c2VybmFtZSwgcGFzc3dvcmQpLnRoZW4odGhpbmdpdmVyc2VUb2tlbiA9PiB7XHJcbiAgICAgICAgICAgIC8vIHNhdmUgb3V0IHRoZSBhdXRoIGluZm8uLi50aGlzIGZ1bmN0aW9uIHNob3VsZCBldmVudHVhbGx5IHNhdmUgaXQgdG8gdGhlIGpzb24gZmlsZVxyXG4gICAgICAgICAgICByZXR1cm4gcGx1Z2luLnNhdmVfYXV0aF9pbmZvKHVzZXJuYW1lLCB0aGluZ2l2ZXJzZVRva2VuKS50aGVuKHVzZXJJbmZvID0+IHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB1c2VySW5mbztcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG5cclxuICAgIGhhbmRsZUxvZ2luID0gKCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IGZsdXggPSB0aGlzLmdldEZsdXgoKTtcclxuICAgICAgICB0aGlzLnNldFN0YXRlKHsgbGFzdEVycm9yOiB1bmRlZmluZWQgfSk7XHJcbiAgICAgICAgaWYgKHRoaXMudmFsaWRhdGVDcmVkZW50aWFscygpKSB7XHJcbiAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoeyBpblByb2dyZXNzOiB0cnVlIH0pO1xyXG5cclxuICAgICAgICAgICAgY29uc3QgbG9nID0gZmx1eC5nZXRTZXJ2aWNlKCdMb2dnaW5nU2VydmljZScpO1xyXG4gICAgICAgICAgICBsb2cuZGVidWcoJ1RoaW5naXZlcnNlIHNpZ24gaW4gcmVxdWVzdCBmb3I6ICcsIHRoaXMuc3RhdGUudXNlcm5hbWUpO1xyXG4gICAgICAgICAgICBjb25zdCBhdXRoZW50aWNhdGlvblByb21pc2UgPSB0aGlzLmF1dGhlbnRpY2F0ZSh0aGlzLnN0YXRlLnVzZXJuYW1lLCB0aGlzLnN0YXRlLnBhc3N3b3JkKTtcclxuICAgICAgICAgICAgYXV0aGVudGljYXRpb25Qcm9taXNlXHJcbiAgICAgICAgICAgICAgICAudGhlbih1c2VySW5mbyA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgbG9nLmluZm8oJ2F1dGhlbnRpY2F0ZSBzdWNjZXNzJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgZmx1eC5nZXRTZXJ2aWNlKCdNb2RhbFNlcnZpY2UnKS5oaWRlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVzZXJJbmZvO1xyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgIC5jYXRjaChlcnIgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGkxOG4gPSBmbHV4LmdldFNlcnZpY2UoJ1RyYW5zbGF0aW9uU2VydmljZScpO1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCBlcnJvck1lc3NhZ2U7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy50cmFja2luZ1NlcnZpY2UuYWRkRXZlbnQoeyBuYW1lOiAnRmFpbGVkIExvZyBJbicgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgbG9nLmluZm8oJ2F1dGhlbnRpY2F0ZSBmYWlsZWQnKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGVyci5lcnJvckVudW0gPT09IEVycm9yc0VudW0uQWNjZXNzRGVuaWVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvZy53YXJuKCdMb2dpbiBmYWlsZWQgYmVjYXVzZSBvZiBpbnZhbGlkIGNyZWRlbnRpYWxzJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yTWVzc2FnZSA9IGkxOG4udCgnbWI6YWNjb3VudFNpZ25Jbi5taXNtYXRjaF9sb2dpbl9lcnJvcicpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZXJyLmVycm9yRW51bSA9PT0gRXJyb3JzRW51bS5Db25uZWN0aW9uRXJyb3IpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbG9nLndhcm4oJ0xvZ2luIGZhaWxlZCBiZWNhdXNlIG9mIGNvbm5lY3Rpb24gZXJyb3InKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3JNZXNzYWdlID0gaTE4bi50KCdtYjphY2NvdW50U2lnbkluLmNvbm5lY3Rpb25fbG9naW5fZXJyb3InKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGVyci5lcnJvckVudW0gPT09IEVycm9yc0VudW0uTWV0aG9kTm90QWxsb3dlZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBsb2cud2FybignTG9naW4gZmFpbGVkJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yTWVzc2FnZSA9IGkxOG4udCgnbWI6YWNjb3VudFNpZ25Jbi51bmtub3duX2xvZ2luX2Vycm9yJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChlcnIuZXJyb3JFbnVtID09PSBFcnJvcnNFbnVtLkZpbGVOb3RGb3VuZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBsb2cud2FybignRmlsZSBOb3QgRm91bmQnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3JNZXNzYWdlID0gaTE4bi50KCdtYjphY2NvdW50U2lnbkluLm5vdF9mb3VuZCcpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZXJyLmVycm9yRW51bSA9PT0gRXJyb3JzRW51bS5TZXJ2ZXJFcnJvcikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBsb2cud2FybignU2VydmVyIEVycm9yJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yTWVzc2FnZSA9IGkxOG4udCgnbWI6YWNjb3VudFNpZ25Jbi5zZXJ2ZXJfZXJyb3InKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGVyci5lcnJvckVudW0gPT09IEVycm9yc0VudW0uQ2xpZW50RXJyb3IpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbG9nLndhcm4oJ0NsaWVudCBFcnJvcicpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBlcnJvck1lc3NhZ2UgPSBpMThuLnQoJ21iOmFjY291bnRTaWduSW4uY2xpZW50X2Vycm9yJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbG9nLmVycm9yKCdMb2dpbiBmYWlsZWQgZm9yIHVua25vd24gcmVhc29uJywgZXJyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3JNZXNzYWdlID0gaTE4bi50KCdtYjphY2NvdW50U2lnbkluLnVua25vd25fbG9naW5fZXJyb3InKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IGluUHJvZ3Jlc3M6IGZhbHNlLCBsYXN0RXJyb3I6IGVycm9yTWVzc2FnZSB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMucHJvcHMub25BdXRoZW50aWNhdGlvbkVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucHJvcHMub25BdXRoZW50aWNhdGlvbkVycm9yKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICBoYW5kbGVMb2dpbk9hdXRoUEtDRSA9IChfZXZlbnQsIGRhdGEpID0+IHtcclxuICAgICAgICBjb25zdCBtYlBsdWdpbiA9IHRoaXMuZ2V0Rmx1eCgpLmdldFBsdWdpbihwbHVnaW5OYW1lKTtcclxuICAgICAgICBjb25zdCBpMThuID0gdGhpcy5nZXRGbHV4KCkuZ2V0U2VydmljZSgnVHJhbnNsYXRpb25TZXJ2aWNlJyk7XHJcbiAgICAgICAgY29uc3QgTW9kYWxTZXJ2aWNlID0gdGhpcy5nZXRGbHV4KCkuZ2V0U2VydmljZSgnTW9kYWxTZXJ2aWNlJyk7XHJcbiAgICAgICAgY29uc3QgTG9nZ2luZ1NlcnZpY2UgPSB0aGlzLmdldEZsdXgoKS5nZXRTZXJ2aWNlKCdMb2dnaW5nU2VydmljZScpO1xyXG4gICAgICAgIGNvbnN0IHVybFBhcmFtcyA9IG5ldyBVUkxTZWFyY2hQYXJhbXMoZGF0YSk7XHJcbiAgICAgICAgY29uc3QgY29kZVZhbGlkYXRpb25SZWdleCA9IC9eW2EtekEtWjAtOV17MTZ9JC87XHJcbiAgICAgICAgY29uc3QgY29kZSA9IHVybFBhcmFtcy5nZXQoJ2NvZGUnKTtcclxuICAgICAgICBjb25zdCBlcnJvciA9IHVybFBhcmFtcy5nZXQoJ2Vycm9yJyk7XHJcbiAgICAgICAgbGV0IGFjY2Vzc1Rva2VuID0gJyc7XHJcblxyXG4gICAgICAgIGlmIChlcnJvcikge1xyXG4gICAgICAgICAgICBMb2dnaW5nU2VydmljZS5lcnJvcignU2VydmVyIEVycm9yJyk7XHJcbiAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoeyBpblByb2dyZXNzOiBmYWxzZSwgbGFzdEVycm9yOiBlcnJvciB9KTtcclxuICAgICAgICAgICAgdGhpcy5wcm9wcy5vbkF1dGhlbnRpY2F0aW9uRXJyb3IoKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAvLyB2YWxpZGF0ZSB0aGUgJ2NvZGUnIHF1ZXJ5IHBhcmFtXHJcbiAgICAgICAgICAgIGlmIChjb2RlVmFsaWRhdGlvblJlZ2V4LnRlc3QoY29kZSkpIHtcclxuICAgICAgICAgICAgICAgIG1iUGx1Z2luXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gUmVxdWVzdCBhdXRob3JpemF0aW9uIHRva2VuIHRvIE1CLVNlcnZpY2VzICh0di9yZWZsZWN0b3IpXHJcbiAgICAgICAgICAgICAgICAgICAgLl9sb2dpbk9hdXRoUEtDRShjb2RlKVxyXG4gICAgICAgICAgICAgICAgICAgIC8vIFJlcXVlc3QgdXNlciBpbmZvIGdpdmVuIHRoZSBhY2Nlc3MgdG9rZW5cclxuICAgICAgICAgICAgICAgICAgICAudGhlbihqc29uUmVzID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgTG9nZ2luZ1NlcnZpY2UuaW5mbygnYXV0aGVudGljYXRlIHN1Y2Nlc3MnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYWNjZXNzVG9rZW4gPSBqc29uUmVzLmFjY2Vzc190b2tlbjtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBtYlBsdWdpbi5fdGhpbmdpdmVyc2VBcGlDbGllbnQuZ2V0VXNlcihhY2Nlc3NUb2tlbik7XHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAvLyBVcGRhdGUgdXNlcmluZm8gYW5kIGFjY2VzcyB0b2tlbiB3aXRoaW4gdGhlIGFwcFxyXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKGluZm8gPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBMb2dnaW5nU2VydmljZS5pbmZvKCdnZXQgdXNlciBpbmZvIHN1Y2Nlc3MnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgeyBuYW1lIH0gPSBpbmZvO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG1iUGx1Z2luLnNhdmVfYXV0aF9pbmZvKG5hbWUsIGFjY2Vzc1Rva2VuKTtcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgIC8vIENsb3NlIGxvZ2luIG1vZGFsXHJcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBNb2RhbFNlcnZpY2UuaGlkZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGUgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBMb2dnaW5nU2VydmljZS5lcnJvcignTG9naW4gZmFpbGVkIGR1cmluZyB0aGUgT2F1dGggcHJvY2VzcycsIGUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNldFN0YXRlKHsgaW5Qcm9ncmVzczogZmFsc2UsIGxhc3RFcnJvcjogaTE4bi50KCdtYjphY2NvdW50U2lnbkluLmNsaWVudF9lcnJvcicpIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnByb3BzLm9uQXV0aGVudGljYXRpb25FcnJvcigpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgTG9nZ2luZ1NlcnZpY2UuZXJyb3IoJ1VucmVjb2duaXplZCBDb2RlIFZhbHVlIEVycm9yJyk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNldFN0YXRlKHsgaW5Qcm9ncmVzczogZmFsc2UsIGxhc3RFcnJvcjogaTE4bi50KCdtYjphY2NvdW50U2lnbkluLmNsaWVudF9lcnJvcicpIH0pO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5wcm9wcy5vbkF1dGhlbnRpY2F0aW9uRXJyb3IoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gQ2xlYXIgdGhlIHRpbWVvdXQgd2l0aCB0aGUgbG9naW4gbW9kYWwgaW5jYXNlXHJcbiAgICAgICAgLy8gaWYgY2xpZW50IHJ1bnMgaW50byBlcnJvcnNcclxuICAgICAgICBjb25zdCB7IHNzb1RpbWVvdXRJZCB9ID0gdGhpcy5zdGF0ZTtcclxuICAgICAgICBzc29UaW1lb3V0SWQgPyBjbGVhclRpbWVvdXQoc3NvVGltZW91dElkKSA6IG51bGw7XHJcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IHNzb1RpbWVvdXRJZDogdW5kZWZpbmVkIH0pO1xyXG4gICAgfTtcclxuXHJcbiAgICBoYW5kbGVLZXlEb3duID0gZSA9PiB7XHJcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IGxhc3RFcnJvcjogdW5kZWZpbmVkIH0pO1xyXG4gICAgICAgIGlmIChlLmtleUNvZGUgPT09IDEzKSB7XHJcbiAgICAgICAgICAgIHRoaXMuaGFuZGxlTG9naW4oKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIHZhbGlkYXRlQ3JlZGVudGlhbHMgPSAoKSA9PiB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuc3RhdGUudXNlcm5hbWUubGVuZ3RoID4gMCAmJiB0aGlzLnN0YXRlLnBhc3N3b3JkLmxlbmd0aCA+IDA7XHJcbiAgICB9O1xyXG5cclxuICAgIGhhbmRsZUZvcmdvdHRlblBhc3N3b3JkID0gKCkgPT4ge1xyXG4gICAgICAgIHRoaXMudHJhY2tpbmdTZXJ2aWNlLmFkZEV2ZW50KHsgbmFtZTogJ0ZvcmdvdCBQYXNzd29yZCBIaXQnIH0pO1xyXG4gICAgICAgIGNvbnN0IGZvcmdvdHRlblBhc3N3b3JkVVJMID0gJ2h0dHBzOi8vYWNjb3VudHMubWFrZXJib3QuY29tL2ZvcmdvdCc7XHJcbiAgICAgICAgcmVxdWlyZSgnZWxlY3Ryb24nKS5yZW1vdGUuc2hlbGwub3BlbkV4dGVybmFsKGZvcmdvdHRlblBhc3N3b3JkVVJMKTtcclxuICAgIH07XHJcblxyXG4gICAgaGFuZGxlU2lnbnVwID0gZSA9PiB7XHJcbiAgICAgICAgdGhpcy50cmFja2luZ1NlcnZpY2UuYWRkRXZlbnQoeyBuYW1lOiAnU2lnbiBVcCBCdXR0b24gSGl0JyB9KTtcclxuICAgICAgICBjb25zdCBzaWdudXBVUkwgPVxyXG4gICAgICAgICAgICAnaHR0cHM6Ly9hY2NvdW50cy5tYWtlcmJvdC5jb20vcmVnaXN0ZXI/YWN0aXZlPTEmdGhlbWU9c3RvcmUmdXRtX3NvdXJjZT1tYnAmdXRtX2NhbXBhaWduPWNyZWF0ZWFjY291bnQnO1xyXG4gICAgICAgIHJlcXVpcmUoJ2VsZWN0cm9uJykucmVtb3RlLnNoZWxsLm9wZW5FeHRlcm5hbChzaWdudXBVUkwpO1xyXG4gICAgfTtcclxuXHJcbiAgICBoYW5kbGVUZXJtcyA9IGUgPT4ge1xyXG4gICAgICAgIHRoaXMudHJhY2tpbmdTZXJ2aWNlLmFkZEV2ZW50KHsgbmFtZTogJ1Rlcm1zIG9mIFNlcnZpY2UgSGl0JyB9KTtcclxuICAgICAgICBjb25zdCBzaWdudXBVUkwgPSAnaHR0cDovL3d3dy5tYWtlcmJvdC5jb20vbGVnYWwvdGVybXMnO1xyXG4gICAgICAgIHJlcXVpcmUoJ2VsZWN0cm9uJykucmVtb3RlLnNoZWxsLm9wZW5FeHRlcm5hbChzaWdudXBVUkwpO1xyXG4gICAgfTtcclxuXHJcbiAgICBoYW5kbGVQcml2YWN5UG9saWN5ID0gZSA9PiB7XHJcbiAgICAgICAgdGhpcy50cmFja2luZ1NlcnZpY2UuYWRkRXZlbnQoeyBuYW1lOiAnUHJpdmFjeSBQb2xpY3kgSGl0JyB9KTtcclxuICAgICAgICBjb25zdCBzaWdudXBVUkwgPSAnaHR0cDovL3d3dy5tYWtlcmJvdC5jb20vbGVnYWwvcHJpdmFjeSc7XHJcbiAgICAgICAgcmVxdWlyZSgnZWxlY3Ryb24nKS5yZW1vdGUuc2hlbGwub3BlbkV4dGVybmFsKHNpZ251cFVSTCk7XHJcbiAgICB9O1xyXG5cclxuICAgIGhhbmRsZUdvb2dsZVNzbyA9ICgpID0+IHtcclxuICAgICAgICBjb25zdCBpMThuID0gdGhpcy5nZXRGbHV4KCkuZ2V0U2VydmljZSgnVHJhbnNsYXRpb25TZXJ2aWNlJyk7XHJcbiAgICAgICAgY29uc3QgcGx1Z2luID0gdGhpcy5nZXRGbHV4KCkuZ2V0UGx1Z2luKHBsdWdpbk5hbWUpO1xyXG4gICAgICAgIGNvbnN0IHNpZ25JblVybCA9IHBsdWdpbi5fZ2VuZXJhdGVPYXV0aEF1dGhSZXFVcmwoKTtcclxuXHJcbiAgICAgICAgdGhpcy50cmFja2luZ1NlcnZpY2UuYWRkRXZlbnQoeyBuYW1lOiAnR29vZ2xlIFNTTyBIaXQnIH0pO1xyXG4gICAgICAgIHRoaXMuc2V0U3RhdGUoeyBpblByb2dyZXNzOiB0cnVlLCBsYXN0RXJyb3I6IHVuZGVmaW5lZCB9KTtcclxuXHJcbiAgICAgICAgLy8gU2V0IHRpbWVvdXQgd2l0aCBHb29nbGUgU1NPXHJcbiAgICAgICAgY29uc3Qgc3NvVGltZW91dElkID0gc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLnJlZnMubG9naW5CdXR0b24pIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoeyBpblByb2dyZXNzOiBmYWxzZSwgbGFzdEVycm9yOiBpMThuLnQoJ21iOmFjY291bnRTaWduSW4udGltZWRfb3V0JykgfSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnByb3BzLm9uQXV0aGVudGljYXRpb25FcnJvcigpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSwgMiAqIDYwICogMTAwMCk7XHJcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IHNzb1RpbWVvdXRJZCB9KTtcclxuXHJcbiAgICAgICAgcmVxdWlyZSgnZWxlY3Ryb24nKS5yZW1vdGUuc2hlbGwub3BlbkV4dGVybmFsKHNpZ25JblVybCk7XHJcbiAgICB9O1xyXG5cclxuICAgIGdldEVycm9yRGl2ID0gKCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IHdpZHRoID0gMjUsXHJcbiAgICAgICAgICAgIGhlaWdodCA9IDI1LFxyXG4gICAgICAgICAgICB2aWV3Qm94ID0gYDAgMCAke3dpZHRofSAke2hlaWdodH1gO1xyXG5cclxuICAgICAgICByZXR1cm4gKFxyXG4gICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0nZXJyb3InPlxyXG4gICAgICAgICAgICAgICAge3RoaXMuc3RhdGUubGFzdEVycm9yID8gKFxyXG4gICAgICAgICAgICAgICAgICAgIDxzdmcgcmVmPSdlcnJvckljb24nIGNsYXNzTmFtZT0nZXJyb3ItaWNvbicgd2lkdGg9e3dpZHRofSBoZWlnaHQ9e2hlaWdodH0gdmlld0JveD17dmlld0JveH0+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIDxpbWFnZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgeGxpbmtIcmVmPXtwYXRoLnJlc29sdmUoX19kaXJuYW1lLCAnaW1hZ2VzL2FsZXJ0LWljb24td2hpdGUuc3ZnJyl9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ9e2hlaWdodH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoPXt3aWR0aH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgLz5cclxuICAgICAgICAgICAgICAgICAgICA8L3N2Zz5cclxuICAgICAgICAgICAgICAgICkgOiBudWxsfVxyXG4gICAgICAgICAgICAgICAge3RoaXMuc3RhdGUubGFzdEVycm9yID8gPHNwYW4gY2xhc3NOYW1lPSdlcnJvci10ZXh0Jz4ge3RoaXMuc3RhdGUubGFzdEVycm9yfSA8L3NwYW4+IDogbnVsbH1cclxuICAgICAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgKTtcclxuICAgIH07XHJcblxyXG4gICAgcmVuZGVyVXNlcm5hbWVGaWVsZCA9IGkxOG4gPT4ge1xyXG4gICAgICAgIHJldHVybiAoXHJcbiAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPXtgZm9ybS1ncm91cCBhdXRoLWlucHV0ICR7dGhpcy5zdGF0ZS5sYXN0RXJyb3IgPyAnaGFzLWVycm9yJyA6ICcnfWB9PlxyXG4gICAgICAgICAgICAgICAgPGxhYmVsPnsobnVsbCwgaTE4bi50KCdtYjphY2NvdW50U2lnbkluLnVzZXJuYW1lJykpfTwvbGFiZWw+XHJcbiAgICAgICAgICAgICAgICA8aW5wdXRcclxuICAgICAgICAgICAgICAgICAgICByZWY9J2VtYWlsSW5wdXQnXHJcbiAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lPXtgaW5wdXQtdGV4dCAke3RoaXMuc3RhdGUubGFzdEVycm9yID8gJ2hhcy1lcnJvcicgOiAnJ31gfVxyXG4gICAgICAgICAgICAgICAgICAgIG9uQ2hhbmdlPXt0aGlzLmhhbmRsZVVzZXJuYW1lQ2hhbmdlfVxyXG4gICAgICAgICAgICAgICAgICAgIG9uS2V5RG93bj17dGhpcy5oYW5kbGVLZXlEb3dufVxyXG4gICAgICAgICAgICAgICAgICAgIGRpc2FibGVkPXt0aGlzLnN0YXRlLmluUHJvZ3Jlc3N9XHJcbiAgICAgICAgICAgICAgICAgICAgcGxhY2Vob2xkZXI9e2kxOG4udCgnbWI6YWNjb3VudFNpZ25Jbi51c2VybmFtZScpfVxyXG4gICAgICAgICAgICAgICAgICAgIGtleWJvYXJkVHlwZT0nZW1haWwtYWRkcmVzcydcclxuICAgICAgICAgICAgICAgICAgICBhdXRvRm9jdXM9e3RydWV9XHJcbiAgICAgICAgICAgICAgICAvPlxyXG4gICAgICAgICAgICA8L2Rpdj5cclxuICAgICAgICApO1xyXG4gICAgfTtcclxuXHJcbiAgICByZW5kZXJQYXNzd29yZEZpZWxkID0gaTE4biA9PiB7XHJcbiAgICAgICAgcmV0dXJuIChcclxuICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9J2Zvcm0tZ3JvdXAgYXV0aC1pbnB1dCAnPlxyXG4gICAgICAgICAgICAgICAgPGxhYmVsPnsobnVsbCwgaTE4bi50KCdtYjphY2NvdW50U2lnbkluLnBhc3N3b3JkJykpfTwvbGFiZWw+XHJcbiAgICAgICAgICAgICAgICA8YSBvbkNsaWNrPXt0aGlzLmhhbmRsZUZvcmdvdHRlblBhc3N3b3JkfSBjbGFzc05hbWU9J2ZvcmdvdC1wd2QtbGluayc+XHJcbiAgICAgICAgICAgICAgICAgICAge2kxOG4udCgnbWI6YWNjb3VudFNpZ25Jbi5mb3Jnb3RfcGFzc3dvcmQnKX1cclxuICAgICAgICAgICAgICAgIDwvYT5cclxuICAgICAgICAgICAgICAgIDxpbnB1dFxyXG4gICAgICAgICAgICAgICAgICAgIHJlZj0ncGFzc3dvcmRJbnB1dCdcclxuICAgICAgICAgICAgICAgICAgICB0eXBlPSdwYXNzd29yZCdcclxuICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU9e2BpbnB1dC10ZXh0ICR7dGhpcy5zdGF0ZS5sYXN0RXJyb3IgPyAnaGFzLWVycm9yJyA6ICcnfWB9XHJcbiAgICAgICAgICAgICAgICAgICAgb25DaGFuZ2U9e3RoaXMuaGFuZGxlUGFzc3dvcmRDaGFuZ2V9XHJcbiAgICAgICAgICAgICAgICAgICAgb25LZXlEb3duPXt0aGlzLmhhbmRsZUtleURvd259XHJcbiAgICAgICAgICAgICAgICAgICAgcGxhY2Vob2xkZXI9e2kxOG4udCgnbWI6YWNjb3VudFNpZ25Jbi5wYXNzd29yZCcpfVxyXG4gICAgICAgICAgICAgICAgICAgIGRpc2FibGVkPXt0aGlzLnN0YXRlLmluUHJvZ3Jlc3N9XHJcbiAgICAgICAgICAgICAgICAvPlxyXG4gICAgICAgICAgICA8L2Rpdj5cclxuICAgICAgICApO1xyXG4gICAgfTtcclxuXHJcbiAgICByZW5kZXJMaW5rcyA9IGkxOG4gPT4ge1xyXG4gICAgICAgIHJldHVybiAoXHJcbiAgICAgICAgICAgIDxkaXY+XHJcbiAgICAgICAgICAgICAgICA8bGFiZWw+eyhudWxsLCBpMThuLnQoJ21iOmFjY291bnRTaWduSW4uc2lnbmluZ190ZXJtc19oZWFkZXInKSl9PC9sYWJlbD5cclxuICAgICAgICAgICAgICAgIDxkaXY+XHJcbiAgICAgICAgICAgICAgICAgICAgPGEgb25DbGljaz17dGhpcy5oYW5kbGVUZXJtc30+e2kxOG4udCgnbWI6YWNjb3VudFNpZ25Jbi50ZXJtc19zZXJ2aWNlJyl9PC9hPlxyXG4gICAgICAgICAgICAgICAgICAgIDxsYWJlbD57KG51bGwsICcg4oCiICcpfTwvbGFiZWw+XHJcbiAgICAgICAgICAgICAgICAgICAgPGEgb25DbGljaz17dGhpcy5oYW5kbGVQcml2YWN5UG9saWN5fT57aTE4bi50KCdtYjphY2NvdW50U2lnbkluLnByaXZhY3lfcG9saWN5Jyl9PC9hPlxyXG4gICAgICAgICAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgICAgIDwvZGl2PlxyXG4gICAgICAgICk7XHJcbiAgICB9O1xyXG5cclxuICAgIHJlbmRlckxvZ2luQnV0dG9uR3JvdXAgPSAoaTE4biwgbG9naW5CdXR0b25DbGFzcykgPT4ge1xyXG4gICAgICAgIHJldHVybiAoXHJcbiAgICAgICAgICAgIDxkaXY+XHJcbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0nYnV0dG9uR3JvdXAgbG9naW5CdXR0b25Hcm91cCc+XHJcbiAgICAgICAgICAgICAgICAgICAgPGJ1dHRvblxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZWY9J2xvZ2luQnV0dG9uJ1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU9e2xvZ2luQnV0dG9uQ2xhc3N9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s9e3RoaXMuaGFuZGxlTG9naW59XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpc2FibGVkPXt0aGlzLnN0YXRlLmluUHJvZ3Jlc3N9XHJcbiAgICAgICAgICAgICAgICAgICAgPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICB7dGhpcy5zdGF0ZS5pblByb2dyZXNzID8gKFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9J3JlZnJlc2hTcGlubmVyV2hpdGUgc3Bpbm5pbmcnPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxJc3ZnIHNyYz0naWNvbnMvc3Bpbm5lci1zbWFsbC5zdmcnIGtleT0ncHJpbnRlclJlZnJlc2hTcGlubmVyJyAvPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICkgOiAoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpMThuLnQoJ21iOmFjY291bnRTaWduSW4ubG9naW4nKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICApfVxyXG4gICAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPlxyXG4gICAgICAgICAgICAgICAgICAgIDxidXR0b24gcmVmPSdzaWdudXBCdXR0b24nIGNsYXNzTmFtZT0nYnV0dG9uIHNlY29uZGFyeScgb25DbGljaz17dGhpcy5oYW5kbGVTaWdudXB9PlxyXG4gICAgICAgICAgICAgICAgICAgICAgICB7aTE4bi50KCdtYjphY2NvdW50U2lnbkluLnNpZ251cCcpfVxyXG4gICAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPlxyXG4gICAgICAgICAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgICAgICAgICB7dGhpcy5yZW5kZXJHb29nbGVTc29CdXR0b25Hcm91cChpMThuLCAnYnV0dG9uR3JvdXAgbG9naW5CdXR0b25Hcm91cCcpfVxyXG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9J2J1dHRvbkdyb3VwIGxvZ2luQnV0dG9uR3JvdXAnPlxyXG4gICAgICAgICAgICAgICAgICAgIDxhIG9uQ2xpY2s9eygpID0+IHRoaXMuc2V0U3RhdGUoeyBzaG93UHJveHk6IHRydWUgfSl9PntpMThuLnQoJ21iOmFjY291bnRTaWduSW4ucHJveHlfbGluaycpfTwvYT5cclxuICAgICAgICAgICAgICAgIDwvZGl2PlxyXG4gICAgICAgICAgICA8L2Rpdj5cclxuICAgICAgICApO1xyXG4gICAgfTtcclxuXHJcbiAgICByZW5kZXJHb29nbGVTc29CdXR0b25Hcm91cCA9IChpMThuLCBsb2dpbkJ1dHRvbkNsYXNzKSA9PiB7XHJcbiAgICAgICAgY29uc3QgZ29vZ2xlTG9nbyA9IHBhdGgucmVzb2x2ZShfX2Rpcm5hbWUsICdpbWFnZXMvZ29vZ2xlLWxvZ28uc3ZnJyk7XHJcblxyXG4gICAgICAgIHJldHVybiAoXHJcbiAgICAgICAgICAgIDxzZWN0aW9uIGlkPSdnb29nbGUtc3NvJyBjbGFzc05hbWU9e2xvZ2luQnV0dG9uQ2xhc3N9PlxyXG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9J3Nzby1zZXBhcmF0b3InPm9yPC9kaXY+XHJcbiAgICAgICAgICAgICAgICA8YnV0dG9uIGlkPSdnb29nbGUtc3NvLWJ0bicgb25DbGljaz17dGhpcy5oYW5kbGVHb29nbGVTc299IGRpc2FibGVkPXt0aGlzLnN0YXRlLmluUHJvZ3Jlc3N9PlxyXG4gICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSdnb29nbGUtc3NvLWJ0bi1jb250ZW50Jz5cclxuICAgICAgICAgICAgICAgICAgICAgICAgPGltZyBzcmM9e2dvb2dsZUxvZ299IGFsdD0nR29vZ2xlIExvZ28nIHdpZHRoPScyNXB4JyAvPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzc05hbWU9J3Nzby10ZXh0Jz57J1NpZ24gaW4gd2l0aCBHb29nbGUnfTwvc3Bhbj5cclxuICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cclxuICAgICAgICAgICAgICAgIDwvYnV0dG9uPlxyXG4gICAgICAgICAgICA8L3NlY3Rpb24+XHJcbiAgICAgICAgKTtcclxuICAgIH07XHJcblxyXG4gICAgcmVuZGVyTG9naW4gPSAoaTE4biwgbG9naW5CdXR0b25DbGFzcykgPT4ge1xyXG4gICAgICAgIGNvbnN0IG1ha2VyYm90TG9nbyA9IHBhdGgucmVzb2x2ZShfX2Rpcm5hbWUsICdpbWFnZXMvbWJfc2lnbl9pbl9sb2dvLnN2ZycpO1xyXG5cclxuICAgICAgICByZXR1cm4gKFxyXG4gICAgICAgICAgICA8ZGl2IHsuLi50aGlzLnByb3BzfT5cclxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSdtYkxvZ2luTW9kYWwnPlxyXG4gICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSdwcmludC1sb2dvJz5cclxuICAgICAgICAgICAgICAgICAgICAgICAgPGltZyBzcmM9e21ha2VyYm90TG9nb30gLz5cclxuICAgICAgICAgICAgICAgICAgICAgICAgPGxhYmVsPnsobnVsbCwgaTE4bi50KCdtYjphY2NvdW50U2lnbkluLnNpZ25faW4nKSl9PC9sYWJlbD5cclxuICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cclxuICAgICAgICAgICAgICAgICAgICB7dGhpcy5nZXRFcnJvckRpdigpfVxyXG4gICAgICAgICAgICAgICAgICAgIHt0aGlzLnJlbmRlclVzZXJuYW1lRmllbGQoaTE4bil9XHJcbiAgICAgICAgICAgICAgICAgICAge3RoaXMucmVuZGVyUGFzc3dvcmRGaWVsZChpMThuKX1cclxuICAgICAgICAgICAgICAgICAgICB7dGhpcy5yZW5kZXJMaW5rcyhpMThuKX1cclxuICAgICAgICAgICAgICAgICAgICB7dGhpcy5yZW5kZXJMb2dpbkJ1dHRvbkdyb3VwKGkxOG4sIGxvZ2luQnV0dG9uQ2xhc3MpfVxyXG4gICAgICAgICAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgICAgIDwvZGl2PlxyXG4gICAgICAgICk7XHJcbiAgICB9O1xyXG5cclxuICAgIHJlbmRlciA9ICgpID0+IHtcclxuICAgICAgICBjb25zdCBpMThuID0gdGhpcy5nZXRGbHV4KCkuZ2V0U2VydmljZSgnVHJhbnNsYXRpb25TZXJ2aWNlJyk7XHJcbiAgICAgICAgbGV0IGxvZ2luQnV0dG9uQ2xhc3MgPSAnYnV0dG9uIHByaW1hcnkgbG9naW5CdXR0b24nO1xyXG5cclxuICAgICAgICBpZiAodGhpcy5zdGF0ZS5zaG93UHJveHkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIDxQcm94eVNldHRpbmdzTW9kYWwgb25Eb25lPXsoKSA9PiB0aGlzLnNldFN0YXRlKHsgc2hvd1Byb3h5OiBmYWxzZSB9KX0gZmx1eD17dGhpcy5nZXRGbHV4KCl9IC8+O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHRoaXMuc3RhdGUuaW5Qcm9ncmVzcyB8fCAhdGhpcy52YWxpZGF0ZUNyZWRlbnRpYWxzKCkpIHtcclxuICAgICAgICAgICAgbG9naW5CdXR0b25DbGFzcyArPSAnIGRpc2FibGVkMSc7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gdGhpcy5yZW5kZXJMb2dpbihpMThuLCBsb2dpbkJ1dHRvbkNsYXNzKTtcclxuICAgIH07XHJcbn1cclxuXHJcbk1CQWNjb3VudExvZ2luTW9kYWwuZGlzcGxheU5hbWUgPSAnTUJBY2NvdW50TG9naW5Nb2RhbCc7XHJcbk1CQWNjb3VudExvZ2luTW9kYWwucHJvcFR5cGVzID0ge1xyXG4gICAgb25BdXRoZW50aWNhdGlvbkVycm9yOiBSZWFjdC5Qcm9wVHlwZXMuZnVuYyxcclxufTtcclxuXHJcbm1vZHVsZS5leHBvcnRzID0gTUJBY2NvdW50TG9naW5Nb2RhbDtcclxuIl19
