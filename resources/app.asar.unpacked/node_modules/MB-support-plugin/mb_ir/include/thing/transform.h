// Copyright 2013 Makerbot Industries

#ifndef INCLUDE_THING_TRANSFORM_H_
#define INCLUDE_THING_TRANSFORM_H_

// See MW-2333
// remove when upgrading eigen
#if defined(__unix__) || defined(__unix)
#include <unistd.h>
#endif

#include <Eigen/Geometry>

namespace LibThing {

/// Transforms represented with separate translation, rotation, and scale
///
/// Individually storing the three components of the transform avoids
/// annoyance with decomposing the rotation and scaling components.
struct THING_API Transform {
  EIGEN_MAKE_ALIGNED_OPERATOR_NEW

  /// Initialize with empty transform
  ///
  /// - No translation
  /// - Identity rotation
  /// - Scaling factors of 1
  Transform();

  Transform(const Eigen::Vector3f &translation,
            const Eigen::Quaternionf &rotation,
            const Eigen::Vector3f &scale);

  explicit Transform(const Eigen::Matrix4f &matrix);

  /// Result of (translation * rotation * scale)
  Eigen::Affine3f asAffine3f() const;

  /// update the post transform scale in x, y, and z
  ///
  /// for some machines, we want to update the scale of each instance to be
  /// printed to arrive at desired dimensional accurcy.
  void updateScale(float x, float y, float z);

  Eigen::Vector3f translation;
  Eigen::Quaternionf rotation;
  Eigen::Vector3f scale;
  Eigen::Vector3f post_transform_scale;
};
}

#endif  // INCLUDE_THING_TRANSFORM_H_
