#ifndef SRC_MGL_CONFIGURATION_H_
#define SRC_MGL_CONFIGURATION_H_

#include <string>
#include <jsoncpp/json/json.h>

namespace mgl {

/// Container for a Miracle Grue Configuration file.
///
/// This class takes a filepath to a Miracle Grue configuration file, and then
/// loads / stores it in a Json::Value object. Some members can be set and
/// accessed via public methods.
class MGL_API Configuration {
 public:
    /// standard constructor
    ///
    /// m_filepath and m_root are both empty. initialize() is called.
    Configuration();

    /// standard constructor
    ///
    /// @param srcFilename - filepath to a miracle grue configuration file.
    ///
    /// opens and loads srcFilename into m_root. then calls initialize().
    explicit Configuration(std::string& srcFilename);

    /// standard  destructor
    ~Configuration();

    /// set and access the jsonProgress parameter
    ///
    /// if jsonProgress is set to true, progress will be output in a json format
    void set_jsonProgress(bool progressAsJson);
    bool jsonProgress() const;

    /// set and access the memoryThreshold parameter
    ///
    /// miracle grue will avoid using significantly more than this many
    /// megabytes of memory.
    void set_memoryThreshold(unsigned int memoryThreshold);
    unsigned int memoryThreshold() const;

    /// set and access the putOnPlate parameter
    ///
    /// if true, miracle grue will translate the model so that the lowest model
    /// points are on the build plate
    void set_putOnPlate(bool put_on_plate);
    bool putOnPlate() const;

    /// reset m_filepath and m_root and re-initialize the Configuration.
    void readFromFile(const char* filename);
    void readFromFile(const std::string &filename);

    /// reset m_root and re-initialize the Configuration.
    void readFromJson(const Json::Value &configuration);

    void set_accelConfig(const std::string & accel_conf_path);
    const std::string & accelConfig() const;

    /// get the entire Configuration as a JSON dict in a std::string using
    /// whatever styled writer passed in.
    std::string asJson(Json::StyledWriter writer = Json::StyledWriter()) const;

    /// access m_root as a const reference.
    const Json::Value& root() const {
        return m_root;
    }

 private:

    /// set a default value for jsonProgress, metadataOutput,
    /// jsonToolpathOutput, and memoryThreshold for the Configuration if they
    /// weren't initialized in the file at m_filepath.
    void initialize();

    // stores the filepath to the configuration file for this Configuration
    std::string m_filepath;

    // stores filepath to accel configuration file
    std::string m_accel_conf_path;

    // stores the JSON dictionary for this Configuration
    Json::Value m_root;
};

} // namespace mgl

#endif  // SRC_MGL_CONFIGURATION_H_
