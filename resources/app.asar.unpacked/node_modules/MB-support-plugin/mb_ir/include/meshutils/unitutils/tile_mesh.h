#pragma once

#include <memory>
#include <vector>

#include <Eigen/Geometry>

#include "geomutils/Vector2.h"
#include "geomutils/Vector3.h"
#include "meshutils/connected_mesh.h"

#include "meshutils/unitutils/planar_mesh.h"

namespace unitutils {

/**
 * A TileMesh is a rectangular prism mesh consisting of two parallel
 * PlanarMeshes on the top and bottom with borders "knitted" together with
 * faces along each side.  TileMeshes are watertight, and each of the
 * PlanarMeshes can be accessed and modified separately.
 *
 * This allows TileMeshes to be modified with algorithmic "patterns" along the
 * top and bottom of a rectangular shape, making them easily customizable for
 * testing.
 */
class MESHUTILS_API TileMesh {
public:
    TileMesh(const geomutils::Vector3& position,
             Scalar height,
             const geomutils::Vector2& cell_size,
             const Eigen::Vector2i& cell_dims,
             std::shared_ptr<LibThing::ConnectedMesh> shared_mesh =
                 std::shared_ptr<LibThing::ConnectedMesh>());

    LibThing::ConnectedMesh& getMesh();

    PlanarMesh& getBottom();

    PlanarMesh& getTop();

private:
    void init();

    PlanarMesh m_bottom;
    PlanarMesh m_top;
};
}
