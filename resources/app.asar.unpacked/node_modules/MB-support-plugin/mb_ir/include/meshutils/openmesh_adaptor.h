// Copyright 2013 MakerBot Industries
/*
 * File:   openmesh_adaptor.h
 * Author: quynhdinh
 *
 * Created on July 11, 2013, 11:29 AM
 */

#ifndef INCLUDE_MESHUTILS_OPENMESH_ADAPTOR_H_
#define INCLUDE_MESHUTILS_OPENMESH_ADAPTOR_H_

#include <OpenMesh/Core/IO/MeshIO.hh>
#include <OpenMesh/Core/Mesh/TriMesh_ArrayKernelT.hh>
#include <OpenMesh/Core/System/config.h>
#include <OpenMesh/Core/Mesh/Status.hh>

#include <vector>

namespace LibThing {

// Define Eigen traits
struct AdaptorTraits : OpenMesh::DefaultTraits {
  // Let Point and Normal be a vector of doubles
  typedef OpenMesh::Vec3d Point;
  typedef OpenMesh::Vec3d Normal;

  // Enable attributes
  VertexAttributes(OpenMesh::Attributes::Status);
  FaceAttributes(OpenMesh::Attributes::Status);
  EdgeAttributes(OpenMesh::Attributes::Status);
  HalfedgeAttributes(OpenMesh::Attributes::Status);

  // Uncomment next line to disable attribute PrevHalfedge
  // HalfedgeAttributes( OpenMesh::Attributes::None );
  //
  // or
  //
  // HalfedgeAttributes( 0 );

  VertexTraits {
      VertexT()
        { dups.clear(); }

      void setOriginal(OpenMesh::VertexHandle & orig) {
          original = orig;
      }

      unsigned int addDuplicate(OpenMesh::VertexHandle & dup) {
          dups.push_back(dup);
          return dups.size();
      }

      OpenMesh::VertexHandle & origVert() {
          return original;
      }

      std::vector<OpenMesh::VertexHandle> & dupList() {
          return dups;
      }

      bool isDup() const {
          return original.is_valid();
      }

      bool hasDups() const {
          if (dups.size()) return true;
          else
              return false;
      }

   private:
      OpenMesh::VertexHandle original;
      std::vector<OpenMesh::VertexHandle> dups;
  };
};

// Define mesh with the new traits!
typedef OpenMesh::TriMesh_ArrayKernelT<AdaptorTraits> OpenMeshAdaptor;
}
#endif  // INCLUDE_MESHUTILS_OPENMESH_ADAPTOR_H_
