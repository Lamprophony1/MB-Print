// Copyright 2014 MakerBot Industries

#ifndef FIRMWARE_PARSER_SRC_COMMAND_HH_
#define FIRMWARE_PARSER_SRC_COMMAND_HH_

#include <bitset>

#include "machine_definitions.hh"
#include "mbcoreutils/toolpath_tags.h"

#ifdef _MSC_VER
#include <stdint.h>
#endif

namespace BirdWing {

// A Command is a structure for keeping track of what individual
// command components we have seen when parsing a command packet.
// It does not have any knowledge of what set of components are
// needed for a given function.  Most fields do not need to be
// initialized as long as components is zeroed out.
struct Command {
    enum Component {
        kFunction = 0,

        // Keep these in order
        kPointX,
        kPointY,
        kPointZ,
        kPointA,
        kPointB,

        kFeedrate,

        // Keep these in order
        kRelativeX,
        kRelativeY,
        kRelativeZ,
        kRelativeA,
        kRelativeB,

        kExtruderIndex,
        kTemperature,
        kPosition,
        kValueFloat,
        kValueBool,
        kSeconds,
        nComponents
    };

    // These must match the name of the ParserInterface command
    enum Function {
        kUnknown = 0,
        kMove,
        kSetExtruderPosition,
        kSetTemperatureTarget,
        kWaitForTargetTemperature,
        kToggleFan,
        kSetFanDuty,
        kChangeToolhead,
        kDelay,
        kPause,
        kEnablePurge
    };

    std::bitset<Component::nComponents> components;

    // Keeps track of which tags we have seen in a tags array; needs to be
    // zeroed out on init since we don't have a component flag for this.
    std::bitset<MakerBot::ToolpathTag::LAST> tags;

    // Not a component of a command, should be set by the parser
    int32_t parser_index;

    // Every parameter that is part of any command.
    std::vector<float> point;
    float feedrate;
    float position;
    float seconds;
    float value_float;
    int16_t temperature;
    uint8_t extruder_index;
    std::vector<bool> relative;
    bool value_bool;

    Function function;
};

}  // namespace BirdWing

#endif  // FIRMWARE_PARSER_SRC_COMMAND_HH_
