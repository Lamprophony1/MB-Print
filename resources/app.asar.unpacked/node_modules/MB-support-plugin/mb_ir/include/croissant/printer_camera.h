#ifndef INCLUDE_CROISSANT_PRINTER_CAMERA_H_
#define INCLUDE_CROISSANT_PRINTER_CAMERA_H_

#include <vector>

#include <mbcoreutils/json.h>
#include <jsonrpc/jsonrpc.h>

namespace croissant {

class PrinterPrivate;

class Camera {
 public:
  enum FrameFormat {
    Invalid=0,
    YUYV=1,
    JPEG=2
  };

  typedef std::vector<uint8_t> CameraFrame;

  Camera();
  ~Camera();

  void cameraFrameCallback(JsonRpc & jsonrpc);
  // designate a callback to be called with the camera frame as jpg
  void setCallback(std::function<void(CameraFrame &&)> & frameReceivedCallback);
  // set m_callback to do nothing
  void unsetCallback();

 private:
  struct FrameInfo {
    uint32_t size;
    uint32_t image_width;
    uint32_t image_height;
    uint32_t image_format;
  };

  static FrameInfo parseHeader(const char * frameInfo);

  std::shared_ptr<std::function<void(CameraFrame &&)> > m_callback;
};
}  // namespace croissant

#endif  // INCLUDE_CROISSANT_PRINTER_CAMERA_H_
