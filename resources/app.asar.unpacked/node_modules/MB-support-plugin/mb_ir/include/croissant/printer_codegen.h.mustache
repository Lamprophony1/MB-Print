// Copyright 2015 MakerBot Industries

#ifndef INCLUDE_CROISSANT_PRINTER_CODEGEN_H_
#define INCLUDE_CROISSANT_PRINTER_CODEGEN_H_

#include <memory>
#include <boost/optional.hpp>

#include "croissant/methods.h"

namespace croissant {

class PrinterPrivate;

class CROISSANT_API PrinterCodegen {
  public:
    {{#requests}}
    class CROISSANT_API {{cppname}}Method : methods::{{cppname}} {
      public:
        {{cppname}}Method();
        bool isSupported();
        void checkSupported();
        {{^has_parameters}}
        boost::future<{{{return_type}}}> operator() ();
        {{/has_parameters}}
        {{#has_parameters}}
        boost::future<{{{return_type}}}> operator() (
            const methods::{{cppname}}::Parameters &p
        );
        boost::future<{{{return_type}}}> operator() (
            {{#parameters}}
            {{^has_default}}
            {{{cpptype}}}{{cppname}}{{^lastparam}},{{/lastparam}}
            {{/has_default}}
            {{#has_default}}
            boost::optional<{{{cpptype}}}> {{cppname}}=boost::none{{^lastparam}},{{/lastparam}}
            {{/has_default}}
            {{/parameters}}
        );
        {{/has_parameters}}
      protected:
        std::weak_ptr<PrinterPrivate> m_printerPrivate;
        friend class PrinterCodegen;
    };

    {{/requests}}
    {{#requests}}
    {{cppname}}Method {{cppname}};
    {{/requests}}

    {{#notifications}}
    class CROISSANT_API {{cppname}} {
      public:
        {{cppname}}();
        void setCallback(
            std::function <void(
            {{#parameters}}
            {{{cpptype}}}{{cppname}}{{^lastparam}},{{/lastparam}}
            {{/parameters}}
            )> func);
        void unsetCallback();
      private:
        {{^is_request}}
        std::shared_ptr<JsonRpcNotification> m_func;
        {{/is_request}}
        {{#is_request}}
        std::shared_ptr<JsonRpcMethod> m_func;
        {{/is_request}}

      protected:
        std::weak_ptr<PrinterPrivate> m_printerPrivate;
        friend class PrinterCodegen;
    };

    {{/notifications}}
    {{#notifications}}
    {{cppname}} {{cppname}};
    {{/notifications}}

  protected:
    void setPrivate(std::shared_ptr<PrinterPrivate> pp);

};

}  // namespace croissant

#endif  // INCLUDE_CROISSANT_PRINTER_H_
