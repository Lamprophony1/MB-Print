// Copyright 2015 MakerBot Industries

#ifndef INCLUDE_GEOMUTILS_LOOP_H_
#define INCLUDE_GEOMUTILS_LOOP_H_

#include <vector>

#include "geomutils/Vector2.h"
#include "geomutils/LineSegment2.h"
#include "geomutils/data_structures/simple_loop.h"

namespace geomutils {

/// A basic_simple_loop of Points
///
/// Apply the basic_simple_loop iteration and access to a collection of points,
/// and add geometry-specific functionality
class Loop : public basic_simple_loop<Vector2> {
  public:
    // parent type used for convinience
    typedef basic_simple_loop<Vector2> parent_type;

    GEOMUTILS_API Loop();

    explicit GEOMUTILS_API Loop(const parent_type& other);

    explicit GEOMUTILS_API Loop(parent_type&& other);

    explicit GEOMUTILS_API Loop(const std::vector<Vector2>& points);

    GEOMUTILS_API Loop& operator =(const parent_type& other);

    GEOMUTILS_API Loop& operator =(parent_type&& other);

    /// True if the point is inside of the loop, false otherwise.
    GEOMUTILS_API bool windingContains(const Vector2& point) const;

    /// True if the point lies on the loop, false otherwise.
    GEOMUTILS_API bool onLoop(const Vector2& point) const;

    /// Segment from point at @a iter to point just forward of it
    GEOMUTILS_API LineSegment2 segmentAfterPoint(const_iterator iter) const;

    /// Segment from point at @a iter to point just reverse of it
    GEOMUTILS_API
    LineSegment2 segmentAfterPoint(const_reverse_iterator iter) const;

    /// Segment from point at @a iter to point just reverse of it
    template <
        typename STORE_TYPE,
        typename VALUE_TYPE,
        bool REVERSE,
        bool CLOSED
    >
    inline LineSegment2 segmentAfterPoint(
        parent_type::clamp_iterator_base<
            STORE_TYPE, VALUE_TYPE, REVERSE, CLOSED
        > iter) const {
        return segmentAfterPoint(iter.base());
    }

    // For testing, returns a normalized version of this loop with the minimum
    // x/y point first
    GEOMUTILS_API Loop normalized() const;
};

GEOMUTILS_API std::ostream& operator<<(std::ostream& ostream, const Loop& loop);

}  // namespace geomutils

namespace boost {
namespace serialization {

template <typename Archive>
void serialize(Archive& ar, geomutils::Loop& dest, const unsigned int) {
  ar & static_cast<geomutils::Loop::parent_type&>(dest);
}

}  // namespace serialization
}  // namespace boost

#endif  // INCLUDE_GEOMUTILS_LOOP_H_
