// Copyright 2011 MakerBot Industries
// Origionally written by Far McKon and Hugo Boyer for MakerBot

#ifndef INCLUDE_GEOMUTILS_LINESEGMENT2_H_
#define INCLUDE_GEOMUTILS_LINESEGMENT2_H_

#include <functional>
#include <vector>

#include "geomutils/Vector2.h"

namespace geomutils {

/// A line segment of two 2D points.
class GEOMUTILS_API LineSegment2 {
 public:
  /// the 2 points
  Vector2 a, b;

 public:
  LineSegment2();
  LineSegment2(const LineSegment2& other);
  LineSegment2(const Vector2 &a, const Vector2 &b);

  LineSegment2 & operator=(const LineSegment2 & other);
  bool operator==(const LineSegment2 &other) const;
  bool operator!=(const LineSegment2 &other) const;

  /// Calculate the area of a square with length of the LineSegment
  Scalar squaredLength() const;

  /// Calculate the length of the LineSegment
  Scalar length() const;

  /// Return a LineSegment with its end point shifted by the given distance
  ///
  /// The end point is shifted in the same direction as the segment.
  LineSegment2 elongate(const Scalar& dist) const;

  /// Return a LineSegment with its start point shifted by the given distance
  ///
  /// The start point is shifted in the same direction as the segment.
  LineSegment2 prelongate(const Scalar& dist) const;

  /// Return true iff the rhs intesects with the LineSegment
  bool intersects(const LineSegment2& rhs) const;

  /// @brief Find the intersection point of two line segments
  ///
  /// @param point Intersection point between two segments
  /// @return true if the segments intersect
  bool intersectionPoint(const LineSegment2 &other, Vector2 &point) const;

  /// Return true iff the point lies on the line segment
  ///
  /// @param point the point to check against.
  bool contains(const Vector2& point) const;

  // TODO(zap) - get a good definition for these two
  Scalar testLeft(const Vector2& point) const;
  Scalar testRight(const Vector2& point) const;

  /// Return a 2D Vector along the length of the the LineSegment
  Vector2 direction() const;

  /// Return a normalized  2D Vector along the length of the the LineSegment
  Vector2 normal() const;

  /// Return a LineSegment with points a and b flipped.
  LineSegment2 flip();

  /// Less comparator for LineSegment2s
  ///
  /// Less results have no meaning outside of its usefulness for uniqueness.
  /// Use this for map and set comparators.
  struct Less : public
      std::binary_function<const LineSegment2&, const LineSegment2&, bool> {
    bool operator()(const LineSegment2 &first,
                    const LineSegment2 &second) const {
      if (Vector2::Less() (first.a, second.a))
        return true;
      else if (Vector2::Less() (second.a, first.a))
        return false;
      else if (Vector2::Less() (first.b, second.b))
        return true;
      else
        return false;
    }
  };
};

/// ostream for LineSegment2 objects
std::ostream& operator <<(std::ostream &os, const LineSegment2 &s);

/// Return true if the passed line segments are colinear within the tolerance
bool collinear(const LineSegment2 &prev,
               const LineSegment2 &current,
               Scalar tol,
               Vector2 &mid);

/// Return true if lhs intersects rhs
bool intersects(const LineSegment2& lhs, const LineSegment2& rhs);

}  // namespace geomutils

#endif  // INCLUDE_GEOMUTILS_LINESEGMENT2_H_
