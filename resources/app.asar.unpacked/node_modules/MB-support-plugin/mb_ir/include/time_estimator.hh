#ifndef TIME_ESTIMATOR_HH
#define TIME_ESTIMATOR_HH

#include <string>
#include <jsoncpp/json/value.h>

class ManagementAccelerator;

namespace AccelerationSimulator {
TIME_ESTIMATE_API void CalculateTimeEstimate(
        const Json::Value & config,
        const std::string & input_path,
        std::shared_ptr<std::ostream> outstream,
        bool do_ugly_birdwing_timing_hack);

TIME_ESTIMATE_API void DoTest(
        const Json::Value & config,
        const std::string & input_path,
        std::shared_ptr<std::ostream> outstream,
        bool do_benchmark);

TIME_ESTIMATE_API void DoLog(
        const Json::Value & config,
        const std::string & input_path,
        std::shared_ptr<std::ostream> outstream,
        bool log_sequence_index);


class TIME_ESTIMATE_API CommandStreamTimeEstimator {
  public:
    CommandStreamTimeEstimator();
    ~CommandStreamTimeEstimator();

    void Reset();
    bool Initialize(const std::string & config_path);

    void SendMoveCommand(const std::vector<float>& point_mm,
                        const float mm_per_second,
                        const std::vector<bool>& relative);
    void SendMoveCommand(const std::vector<float>& point_mm,
                        const float mm_per_second,
                        const std::vector<bool>& relative,
                        const std::vector<MakerBot::ToolpathTag>& tags);
    void SendDelay(float seconds);
    void SendWaitForTargetTemperature(uint8_t index);

    double GetTimeEstimate();

  private:
    bool m_initialized;
    std::unique_ptr<ManagementAccelerator> m_machine;
    std::shared_ptr<std::stringstream> m_result;
    int m_parser_index;
};
}

#endif /* TIME_ESTIMATOR_HH */
